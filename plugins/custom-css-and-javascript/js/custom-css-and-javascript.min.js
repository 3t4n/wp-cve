var hm_custom_code_editor,hm_custom_code_editor_has_changes=!1,hm_custom_css_js_save_publish=!1,hm_custom_css_js_rev=0,hm_custom_css_js_published_rev=0,hm_custom_css_js_mode,wpz_admin__navigate;jQuery(document).ready(function(e){hm_custom_code_editor=CodeMirror(document.getElementById("hm_custom_code_editor"),{lineNumbers:!0,matchBrackets:!0}),hm_custom_code_editor.on("change",function(){if(hm_custom_code_editor_has_changes)return;hm_custom_code_editor_has_changes=!0,e(".hm-custom-css-js-save-btn").html("Save").prop("disabled",!1),e(".hm-custom-css-js-publish-btn").html("Save &amp; Publish").prop("disabled",!1)}),e(".hm-custom-css-js-save-btn").click(function(){e(".hm-custom-css-js-save-btn").prop("disabled",!0).html("Saving..."),e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_save",mode:hm_custom_css_js_mode,code:hm_custom_code_editor.getValue()}).done(function(n){n.success?(e(".hm-custom-css-js-save-btn").html("Saved"),hm_custom_css_js_rev=n.data,hm_custom_code_editor_has_changes=!1,hm_custom_css_js_save_publish?e(".hm-custom-css-js-publish-btn").click():t()):(alert("Error while saving. Please try again. Your security token may be expired; you may need to copy your work and reload the page to continue."),e(".hm-custom-css-js-save-btn").html("Save").prop("disabled",!1),hm_custom_css_js_save_publish&&e(".hm-custom-css-js-publish-btn").html("Save &amp; Publish").prop("disabled",!0))}).fail(function(){alert("Error while saving. Please try again. Your security token may be expired; you may need to copy your work and reload the page to continue."),e(".hm-custom-css-js-save-btn").html("Save").prop("disabled",!1),hm_custom_css_js_save_publish&&e(".hm-custom-css-js-publish-btn").html("Save &amp; Publish").prop("disabled",!0)})}),e(".hm-custom-css-js-publish-btn").click(function(){if(e(".hm-custom-css-js-publish-btn").prop("disabled",!0).html("Publishing..."),!e(".hm-custom-css-js-save-btn").prop("disabled")){hm_custom_css_js_save_publish=!0,e(".hm-custom-css-js-save-btn").click();return}hm_custom_css_js_save_publish=!1,e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_publish",mode:hm_custom_css_js_mode,minify:e(".hm-custom-css-js-minify-cb").prop("checked")?1:0,rev:hm_custom_css_js_rev}).done(function(n){n.success?(e(".hm-custom-css-js-publish-btn").html("Published"),t()):(alert("Error while publishing. Please try again. Your security token may be expired; you may need to reload the page to continue."),e(".hm-custom-css-js-publish-btn").html("Save &amp; Publish").prop("disabled",!1))}).fail(function(){alert("Error while publishing. Please try again. Your security token may be expired; you may need to reload the page to continue."),e(".hm-custom-css-js-publish-btn").html("Save &amp; Publish").prop("disabled",!1)})}),e(".hm-custom-css-js-delete-revisions-btn").click(function(){e(this).prop("disabled",!0).html("Deleting..."),e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_delete_revisions",mode:hm_custom_css_js_mode}).done(function(n){n.success?(t(),e(".hm-custom-css-js-delete-revisions-btn").html("Delete All").prop("disabled",!1)):(alert("Error while deleting. Please try again. Your security token may be expired; you may need to reload the page to continue."),e(".hm-custom-css-js-delete-revisions-btn").html("Delete All").prop("disabled",!1))}).fail(function(){alert("Error while deleting. Please try again. Your security token may be expired; you may need to reload the page to continue."),e(".hm-custom-css-js-delete-revisions-btn").html("Delete All").prop("disabled",!1)})}),e(window).resize(function(){e("#hm_custom_code_editor, #hm_custom_code_editor .CodeMirror").height(Math.max(150,e(window).height()-e("#hm_custom_code_editor").offset().top-e(".hm-custom-css-js-save-btn").height()-30)),hm_custom_code_editor.refresh()}),e(window).resize(),e(window).on("beforeunload",function(e){if(hm_custom_code_editor_has_changes)return e.returnValue="You have unsaved changes that will be lost if you leave this page!",e.returnValue}),e("#hm_custom_css_js_revisions").on("click","li > a.view-rev",function(){if(hm_custom_code_editor_has_changes&&!confirm("You have unsaved changes that will be lost if you view this revision!"))return;var n=e(this).parent().attr("id").substring(20);e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_get_revision",mode:hm_custom_css_js_mode,rev:n}).done(function(t){t.success?(hm_custom_code_editor.doc.setValue(t.data.content),hm_custom_css_js_rev=t.data.id,e("#hm_custom_css_js_revisions .active").removeClass("active"),e("#hm_custom_css_js_rev"+hm_custom_css_js_rev).addClass("active"),e(".hm-custom-css-js-save-btn").html("Saved").prop("disabled",!0),hm_custom_css_js_rev==hm_custom_css_js_published_rev&&e(".hm-custom-css-js-publish-btn").html("Published").prop("disabled",!0),hm_custom_code_editor_has_changes=!1):alert("Error while loading. Please try again. Your security token may be expired; you may need to reload the page to continue.")}).fail(function(){alert("Error while loading. Please try again. Your security token may be expired; you may need to reload the page to continue.")})}),e("#hm_custom_css_js_revisions").on("click","li > a.del-rev",function(){var s=e(this).parent().attr("id").substring(20);e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_delete_revision",mode:hm_custom_css_js_mode,rev:s}).done(function(e){e.success?t():alert("Error while deleting. Please try again. Your security token may be expired; you may need to reload the page to continue.")}).fail(function(){alert("Error while deleting. Please try again. Your security token may be expired; you may need to reload the page to continue.")})});function t(){e.post(pp_custom_css_js_config.api_url,{action:"hm_custom_css_js_get_revisions",mode:hm_custom_css_js_mode}).done(function(t){if(t.success)if(e("#hm_custom_css_js_revisions").empty(),t.data.length==0)e("#hm_custom_css_js_revisions").append("<li>None</li>");else{for(var n=0;n<t.data.length;++n)e("#hm_custom_css_js_revisions").append('<li id="hm_custom_css_js_rev'+t.data[n].id+'"><a class="view-rev" href="javascript:void(0);">'+t.data[n].rev_date+"</a>"+(t.data[n].published?" [published]":' <a class="del-rev" href="javascript:void(0);">[delete]</a>')+"</li>"),t.data[n].published&&(hm_custom_css_js_published_rev=t.data[n].id);hm_custom_css_js_rev==0?(hm_custom_code_editor_has_changes=!1,e("#hm_custom_css_js_revisions > li:first-child > a.view-rev").click()):e("#hm_custom_css_js_rev"+hm_custom_css_js_rev).addClass("active")}})}window.hm_custom_css_js_set_mode=function(n){hm_custom_css_js_mode=n,e("#hm-custom-css-js-minify-cb-css, #hm-custom-css-js-minify-cb-javascript").hide().filter("#hm-custom-css-js-minify-cb-"+n.toLowerCase()).show(),e("#wpz-custom-css-js-settings-code h3:first").text(n==="JavaScript"?"Custom JavaScript":"Custom CSS"),hm_custom_css_js_rev=0,hm_custom_css_js_published_rev=0,hm_custom_code_editor.setValue(""),hm_custom_code_editor.setOption("mode",n.toLowerCase()),t()},hm_custom_css_js_set_mode(location.hash==="#JavaScript"?"JavaScript":"CSS"),jQuery("#wpz-custom-css-js-settings-tabs a").on("click",function(){if(hm_custom_code_editor_has_changes&&e(this).attr("href")!=="#"+hm_custom_css_js_mode&&!confirm("You have unsaved changes that will be lost if you leave this tab!"))return!1}),location.hash&&wpz_admin__navigate()}),wpz_admin__navigate=function(){var e,t=location.hash=="#CSS"||location.hash=="#JavaScript"?"code":location.hash.substr(1);jQuery("#wpz-custom-css-js-settings-tabs-content > div, #wpz-custom-css-js-settings-tabs > li").removeClass("wpz-custom-css-js-settings-active"),jQuery("#wpz-custom-css-js-settings-"+t).addClass("wpz-custom-css-js-settings-active"),jQuery('#wpz-custom-css-js-settings-tabs > li:has(a[href="'+location.hash+'"])').addClass("wpz-custom-css-js-settings-active"),hm_custom_code_editor_has_changes=!1,t==="code"?(e=location.hash.substr(1),e!==hm_custom_css_js_mode&&hm_custom_css_js_set_mode(e)):hm_custom_css_js_mode=""},jQuery(window).on("hashchange",wpz_admin__navigate)