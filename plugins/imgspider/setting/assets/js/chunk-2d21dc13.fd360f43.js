(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d21dc13"],{d33a:function(t,a,e){"use strict";e.r(a);var r={name:"wbsUpload",props:{url:String,itemname:String},methods:{uploadFiles:function(){var e=window.frame||window.wb_frame;e||((e=wp.media({title:"选择文件",button:{text:"确认"},multiple:!1})).on("select",function(t){var a=e.state().get("selection").toJSON()[0].url;e.vm.$emit("get-file",a)}),window.wb_frame=e),e.vm=this,e.open()}}},e=e("2877"),r={name:"Watermark",data(){return{formChanged:0,isLoaded:!1,action:wb_cnf.action||{act:"",fetch:"",push:""},is_pro:0,filter_domain:"",can_use:wb_cnf.watermark,watermark_preview:"",cnf:{},opt:{del_src_url:0,filter:{},rule:{},proxy_manual:[],watermark:{}},tooltips:{wt_need_extend:"水印需要PHP Imagick扩展，当前服务器未检测到对应扩展。当前功能无效。"},fonts:{0:"默认",1:"Arial",2:"Arial Black",3:"Comic Sans MS",4:"Courier New",5:"Georgia",6:"Impact",7:"Tahoma",8:"Times New Roman",9:"Trebuchet MS",10:"Verdana"},postion:{1:"右下方",2:"左下方",3:"右上方",4:"左上方",5:"正中心",6:"自定义"},postionCss:{1:"right:20px;bottom:20px;",2:"left:20px;bottom:20px;",3:"right:20px;top:20px;",4:"left:20px;top:20px;",5:"left:50%;top:50%;transform:translate(-50%,-50%)",6:""}}},components:{WbsUploadBox:Object(e.a)(r,function(){var a=this,t=a.$createElement,t=a._self._c||t;return t("div",{staticClass:"wbs-upload-box"},[t("input",{staticClass:"wbs-input upload-input",attrs:{type:"text",name:a.itemname},domProps:{value:a.url},on:{change:function(t){return a.$emit("get-file",t.target.value)}}}),t("button",{staticClass:"wbs-btn",attrs:{type:"button"},on:{click:function(t){return a.uploadFiles()}}},[t("svg",{staticClass:"wb-icon sico-upload "},[t("use",{attrs:{"xlink:href":"#sico-upload"}})]),t("span",[a._v("选择图片")])])])},[],!1,null,null,null).exports},created(){this._getData(),this.$verify(),this.$cnf.is_pro&&this.$isPrdActive(this.$WB)},filters:{},methods:{remove(){const a=this;a.$wbui.confirm("慎重操作！是否删除原图备份数据，删除后无法恢复？",{yes:function(){a.$api.getData({action:a.action.act,op:"recover"}).then(t=>{t.code?a.$wbui.toast("处理失败，"+t.desc):a.$wbui.toast("备份删除成功")})}})},recover(){const a=this;a.$wbui.confirm("恢复原图将删除水印图片，是否确定需要恢复？",{yes:function(){a.$api.getData({action:a.action.act,op:"recover"}).then(t=>{t.code?a.$wbui.toast("恢复失败，"+t.desc):a.$wbui.toast("恢复成功")})}})},update_preview(){const a=this;a.$api.getData({action:a.action.act,op:"watermark_preview",watermark:a.opt.watermark}).then(t=>{a.watermark_preview="data:image/png;base64,"+t})},set_watermark_type(t){const a=this;if(!a.is_pro)return a.$wbui.confirm("该功能为Pro版本专属。",{btn:["了解详情","取消"],yes:function(){a.$router.push({path:"/about-pro"})}}),a.opt.watermark.type=0,!1},_getData(){const a=this;a.$api.getData({action:a.action.act,op:a.action.fetch}).then(t=>{a.opt=t.data.opt,a.cnf=t.data.cnf,a.opt.watermark.alpha&&(a.opt.watermark.alpha=+a.opt.watermark.alpha),a.check_ext(),!a.is_pro&&a.opt.watermark.type&&(a.opt.watermark.type=0),a.isLoaded=!0,this.$nextTick(()=>{this.formChanged=1})})},updateData(){const a=this;a.$api.saveData({_ajax_nonce:_wb_imgspider_ajax_nonce,action:a.action.act,op:a.action.push,opt:a.opt,tab:"watermark"}).then(t=>{t.code||a.$wbui.toast("保存成功"),a.formChanged=1})},check_ext(){imgspider_ver&&window.imgspider&&(this.is_pro=1)}},mounted(){this.is_pro=imgspider_ver&&window.imgspider?1:0},computed:{previewStyle(){var t=this,a=`font-size:${t.opt.watermark.size}px;color:${t.opt.watermark.color};opacity:${t.opt.watermark.alpha/100};`;return t.opt.watermark.pos<6?a+t.postionCss[t.opt.watermark.pos]:a+`top:${t.opt.watermark.y}%;left:${t.opt.watermark.x}%;`},previewStyleImg(){var t=this,a=`opacity:${t.opt.watermark.alpha/100};`;return t.opt.watermark.pos<6?a+t.postionCss[t.opt.watermark.pos]:a+`top:${t.opt.watermark.y}%;left:${t.opt.watermark.x}%;`}},watch:{opt:{handler(){this.formChanged++},deep:!0}},beforeRouteLeave(t,a,e){const r=this;1<r.formChanged?r.$wbui.open({content:"您修改的设置尚未保存，确定离开此页面吗？",btn:["保存并离开","放弃修改"],yes(){return e(!1),r.updateData(()=>{e()}),!1},no(){return e(),!1}}):e()}},e=Object(e.a)(r,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.isLoaded,expression:"!isLoaded"}],staticClass:"wbs-content-inner base-code",class:{"wb-page-loaded":e.isLoaded}},[r("div",{staticClass:"wbs-main"},[e.can_use?e._e():r("el-alert",{attrs:{title:e.tooltips.wt_need_extend,type:"warning"}}),r("table",{staticClass:"wbs-form-table mt"},[r("tbody",[r("tr",[r("th",{staticClass:"row w8em"},[e._v("水印类型")]),r("td",{staticClass:"info"},[r("el-radio-group",{on:{change:e.set_watermark_type},model:{value:e.opt.watermark.type,callback:function(t){e.$set(e.opt.watermark,"type",t)},expression:"opt.watermark.type"}},e._l({0:"关闭",1:"图片",2:"文字"},function(t,a){return r("el-radio",{key:a,attrs:{label:+a}},[e._v(e._s(t))])}),1)],1)])]),r("tbody",{directives:[{name:"show",rawName:"v-show",value:0<e.opt.watermark.type,expression:"opt.watermark.type > 0"}]},[r("tr",{directives:[{name:"show",rawName:"v-show",value:1==e.opt.watermark.type,expression:"opt.watermark.type == 1"}]},[r("th",{staticClass:"row"},[e._v("水印图片")]),r("td",[r("WbsUploadBox",{attrs:{url:e.opt.watermark.image},on:{"get-file":function(t){e.opt.watermark.image=t}}})],1)]),r("tr",{directives:[{name:"show",rawName:"v-show",value:2==e.opt.watermark.type,expression:"opt.watermark.type == 2"}]},[r("th",{staticClass:"row"},[e._v("水印文字")]),r("td",[r("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.opt.watermark.text,callback:function(t){e.$set(e.opt.watermark,"text",t)},expression:"opt.watermark.text"}})],1)])]),r("tbody",[r("tr",[r("th",{staticClass:"row"},[e._v("水印样式")]),r("td",[r("div",{staticClass:"with-sub-form-table"},[r("table",{staticClass:"wbs-form-table-sub"},[r("tbody",{directives:[{name:"show",rawName:"v-show",value:2==e.opt.watermark.type,expression:"opt.watermark.type == 2"}]},[r("tr",[r("th",{staticClass:"row w6em"},[e._v("字体")]),r("td",[r("el-radio-group",{model:{value:e.opt.watermark.font,callback:function(t){e.$set(e.opt.watermark,"font",t)},expression:"opt.watermark.font"}},e._l(e.fonts,function(t,a){return r("el-radio",{key:a,staticClass:"mt",attrs:{label:+a}},[r("span",{class:"imgspider-font-"+a},[e._v(e._s(t))])])}),1)],1)]),r("tr",[r("th",{staticClass:"row w6em"},[e._v("字体大小")]),r("td",[r("el-input-number",{attrs:{min:24,max:120,size:"mini",label:"字体大小"},model:{value:e.opt.watermark.size,callback:function(t){e.$set(e.opt.watermark,"size",t)},expression:"opt.watermark.size"}})],1)]),r("tr",[r("th",{staticClass:"row w6em"},[e._v("字体颜色")]),r("td",[r("el-color-picker",{model:{value:e.opt.watermark.color,callback:function(t){e.$set(e.opt.watermark,"color",t)},expression:"opt.watermark.color"}})],1)])]),r("tbody",[r("tr",[r("th",{staticClass:"row w6em"},[e._v("透明度")]),r("td",{staticClass:"info"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.opt.watermark.alpha,expression:"opt.watermark.alpha"}],staticClass:"w8em ib",attrs:{type:"range"},domProps:{value:e.opt.watermark.alpha},on:{__r:function(t){return e.$set(e.opt.watermark,"alpha",t.target.value)}}}),e._v(" "+e._s(e.opt.watermark.alpha)+"% ")])])])])])])]),r("tr",[r("th",{staticClass:"row"},[e._v("应用分辨率")]),r("td",[r("div",[e._v(" 最小宽度 "),r("el-input",{staticClass:"w8em",attrs:{size:"mini",type:"number"},model:{value:e.opt.watermark.min_width,callback:function(t){e.$set(e.opt.watermark,"min_width",t)},expression:"opt.watermark.min_width"}}),e._v(" px ")],1),r("div",{staticClass:"mt"},[e._v(" 最小高度 "),r("el-input",{staticClass:"w8em",attrs:{size:"mini",type:"number"},model:{value:e.opt.watermark.min_height,callback:function(t){e.$set(e.opt.watermark,"min_height",t)},expression:"opt.watermark.min_height"}}),e._v(" px ")],1)])]),r("tr",[r("th",{staticClass:"row"},[e._v("应用范围")]),r("td",{staticClass:"info"},[r("el-radio-group",{model:{value:e.opt.watermark.apply,callback:function(t){e.$set(e.opt.watermark,"apply",t)},expression:"opt.watermark.apply"}},[r("el-radio",{attrs:{label:"new"}},[r("span",[e._v("仅新增图片")])]),r("el-radio",{attrs:{label:"all"}},[r("span",[e._v("全部图片 "),r("wbs-tooltip",{attrs:{"data-msg":"旧图片定时处理，每小时处理10张"}})],1)])],1)],1)]),r("tr",[r("th",{staticClass:"row"},[e._v("备份选项")]),r("td",{staticClass:"info"},[r("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.recover()}}},[e._v("恢复原图")]),r("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.remove()}}},[e._v("删除备份")])],1)]),r("tr",[r("th",{staticClass:"row"},[e._v("水印位置")]),r("td",{staticClass:"info"},[r("el-radio-group",{model:{value:e.opt.watermark.pos,callback:function(t){e.$set(e.opt.watermark,"pos",t)},expression:"opt.watermark.pos"}},e._l(e.postion,function(t,a){return r("el-radio",{key:"post"+a,attrs:{label:+a}},[r("span",[e._v(e._s(t))])])}),1),6==e.opt.watermark.pos?r("div",{staticClass:"mt"},[r("div",[r("h3",[e._v("水平位置")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.opt.watermark.x,expression:"opt.watermark.x"}],staticClass:"w8em ib",attrs:{type:"range"},domProps:{value:e.opt.watermark.x},on:{__r:function(t){return e.$set(e.opt.watermark,"x",t.target.value)}}}),e._v(" "+e._s(e.opt.watermark.x)+"% ")]),r("div",{staticClass:"mt"},[r("h3",[e._v("垂直位置")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.opt.watermark.y,expression:"opt.watermark.y"}],staticClass:"w8em ib",attrs:{type:"range"},domProps:{value:e.opt.watermark.y},on:{__r:function(t){return e.$set(e.opt.watermark,"y",t.target.value)}}}),e._v(" "+e._s(e.opt.watermark.y)+"% ")])]):e._e()],1)]),r("tr",[r("th",{staticClass:"row"},[e._v("预览")]),r("td",[r("div",{staticClass:"wb-preview-box",staticStyle:{"background-color":"#ddd",position:"relative"}},[1==e.opt.watermark.type?r("div",{staticClass:"mask img-mask",staticStyle:{position:"absolute"},style:e.previewStyleImg},[r("img",{attrs:{src:e.opt.watermark.image}})]):2==e.opt.watermark.type?r("div",{staticClass:"mask",class:"imgspider-font-"+e.opt.watermark.font,staticStyle:{position:"absolute","line-height":"1"},style:e.previewStyle},[e._v(" "+e._s(e.opt.watermark.text)+" ")]):e._e()]),e.can_use?r("div",{staticClass:"mt"},[r("el-button",{attrs:{size:"mini"},on:{click:e.update_preview}},[e._v("生成示例图片")])],1):e._e(),e.can_use?r("div",{staticClass:"wb-preview-box mt"},[e.watermark_preview?r("img",{attrs:{src:e.watermark_preview}}):e._e()]):e._e()])])])]),r("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:e.isLoaded,expression:"isLoaded"}],staticClass:"mt"})],1),e.isLoaded&&!e.is_pro?r("wbs-more-sources"):e._e(),r("wbs-footer"),r("wbs-ctrl-bar",{on:{submit:e.updateData}})],1)},[],!1,null,null,null);a.default=e.exports}}]);