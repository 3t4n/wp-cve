var FireBox_Form=function(){function e(e){this.form=e,this.submitButtonClass=".firebox-block-button-element",this.formControlGroupClass=".fb-form-control-group",this.formInputClass=".fb-form-input",this.formMessageClass=".fb-form-response",this.requiredFieldMessage=this.form.querySelector(".fb_form_required_field_message").value,this.invalidEmailMessage=this.form.querySelector(".fb_form_invalid_email_message").value,this.honeypotFieldTriggered=this.form.querySelector(".fb_form_honeypot_field_triggered")?this.form.querySelector(".fb_form_honeypot_field_triggered").value:"",this.initEvents()}var r=e.prototype;return r.initEvents=function(){var r=this;this.form.querySelector(this.submitButtonClass)&&this.form.querySelector(this.submitButtonClass).addEventListener("click",this.submitForm.bind(this)),this.form.addEventListener("keyup",function(e){r.onFormEnterSubmit(e)}),this.form.addEventListener("focusout",function(e){r.updateFieldStateWhileTyping(e)})},r.updateFieldStateWhileTyping=function(e){var r,t=e.target.closest(this.formInputClass);t&&((r=this.validateField(t)).error?this.setFieldHasError(t,r.error):this.setFieldHasNoError(t))},r.onFormEnterSubmit=function(e){e.preventDefault(),13!==e.keyCode||this.isTextareaField(e.target)||this.submitForm(e)},r.isTextareaField=function(e){return e.closest("textarea.fb-form-input")},r.submitForm=function(s){var i=this;s.preventDefault();var o=this.getFields();if(o){var a=!0,n={form_id:this.form.querySelector('input[name="fb_form[form_id]"]').value,fields:{}},l=null;if(o.forEach(function(e){"fb_form[hnpt]"===e.name&&""!==e.value&&(a=!1,i.showFormMessage(i.honeypotFieldTriggered,!0));var r=i.validateField(e);if(r.error)return a=!1,i.setFieldHasError(e,r.error),void(l||(l=!0,e.focus()));i.setFieldHasNoError(e);var t=(t=r.name.replace("fb_form[","")).replace("]","");n.fields[t]=r}),a){this.setLoading(!0);var f=this,e=this.emitEvent("beforeSubmit");if(e.defaultPrevented)return e.detail.hasOwnProperty("error")&&this.showFormMessage(e.detail.error,!0),void f.setLoading(!1);var r=this.form.closest(".fb-inst")?this.form.closest(".fb-inst").dataset.id:null,t=!!this.form.closest(".fb-inst")&&parseInt(this.form.closest(".fb-inst").firebox.box_log_id),m=new FormData;m.append("nonce",fbox_js_object.nonce),m.append("action","fb_form_submit"),m.append("form_data",JSON.stringify(n)),m.append("box_log_id",t),m.append("box_id",r),fetch(fbox_js_object.ajax_url,{method:"post",body:m}).then(function(e){return e.json()}).then(function(e){var t,r;e.validation&&e.validation.length?(t=!1,e.validation.forEach(function(e){var r=f.form.querySelector('.fb-form-input[name="fb_form['+e.name+']"]'+f.formInputClass);t=!0,f.setFieldHasError(r,e.validation_message)}),t&&f.showFormMessage(e.message,!0),f.emitEvent("validation_error",{response:e})):e.error?(f.showFormMessage(e.message,e.error),f.emitEvent("error",{response:e})):("message"===e.action?f.showFormMessage(e.message,e.error):(r=f.emitEvent("beforeRedirectUser",{url:e.redirectURL}),window.location.href=r.detail.url),e.resetForm&&f.resetForm(o),e.hideForm&&f.form.classList.add("fb-hide-form"),f.form.closest(".fb-inst")&&f.form.closest(".fb-inst").classList.add("fb-form-success"),f.emitEvent("success",{response:e,submitButton:s.srcElement})),e.hideForm||f.setLoading(!1)})}}},r.emitEvent=function(e,r,t){var s;if(e)return(r=r||{}).instance=this,(t=t||!0)&&(s="FireBoxForm"+this.capitalize(e),this.dispatchEvent(s,document,r)),this.dispatchEvent(e,this.form,r)},r.capitalize=function(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},r.dispatchEvent=function(e,r,t){var s=new CustomEvent(e,{detail:t,cancelable:!0});return r.dispatchEvent(s),s},r.resetForm=function(e){e.forEach(function(e){e.value=""})},r.setLoading=function(e){void 0===e&&(e=!0);var r=this.form.querySelector(this.submitButtonClass);r&&(e?(r.dataset.initialLabel||r.setAttribute("data-initial-label",r.innerHTML),r.classList.add("is-working"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="10" r="40" stroke-dasharray="164.93361431346415 56.97787143782138"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg>'):(r.innerHTML=r.dataset.initialLabel,r.classList.remove("is-working")))},r.showFormMessage=function(e,r){void 0===r&&(r=!1);var t=this.form.querySelector(this.formMessageClass);t||(this.form.appendChild(this.getFormMessageTemplate()),t=this.form.querySelector(this.formMessageClass)),t.classList.add("fb-msg-is-visible"),t.innerHTML=e,r?t.classList.add("is-error"):t.classList.remove("is-error")},r.getFormMessageTemplate=function(){var e=document.createElement("div");return e.className=this.formMessageClass.substring(1),e},r.hideFormMessage=function(){var e=this.form.querySelector(this.formMessageClass);e&&(e.classList.remove("fb-msg-is-visible","is-error"),e.innerHTML="")},r.setFieldHasError=function(e,r){var t,s;!e||(t=e.closest(this.formControlGroupClass))&&(t.classList.contains("has-errors")?t.querySelector(".fb-form-field-error").innerHTML=r:(t.classList.add("has-errors"),(s=this.getErrorMessageTemplate()).innerHTML=r,t.appendChild(s)))},r.getErrorMessageTemplate=function(){var e=document.createElement("div");return e.className="fb-form-field-error",e},r.setFieldHasNoError=function(e){var r=e.closest(this.formControlGroupClass);r&&r.classList.contains("has-errors")&&(r.classList.remove("has-errors"),r.querySelector(".fb-form-field-error").remove())},r.validateField=function(e){var r,t,s=e.name,i=e.type,o=e.value;return!e.required||"hidden"===i||""!==o.trim()?"email"!==i||this.validateEmail(o)?{name:s,type:i,value:o,id:null==e||null==(r=e.closest(".fb-form-control-group"))||null==(t=r.dataset)?void 0:t.fieldId}:{error:this.invalidEmailMessage}:{error:this.requiredFieldMessage}},r.getFields=function(){return this.form.querySelectorAll(this.formInputClass)},r.validateEmail=function(e){return String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},e}();document.addEventListener("DOMContentLoaded",function(e){document.querySelectorAll("form.wp-block-firebox-form").forEach(function(e){new FireBox_Form(e)})});

