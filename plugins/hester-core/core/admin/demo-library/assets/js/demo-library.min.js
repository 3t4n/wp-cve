!function(e){"use strict";var t=e("body"),r=e(document),s=(e("#page"),e("html")),o={import_start_time:"",install_plugins:[],installed_plugins:[],progress:0,import_steps:[],completed_steps:[],init:function(){e(document).ready(o.ready),e(window).on("load",o.load),o.bindUIActions(),e(document).trigger("hesterCoreReady")},ready:function(){},load:function(){o.populateTemplates(hesterCoreDemoLibrary.templates)},bindUIActions:function(){r.on("click",".hester-demo .demo-screenshot, .hester-demo .preview",o.preview),r.on("click",".hester-demo .import",function(t){e(this).siblings(".preview").click(),e(".wp-full-overlay-main iframe").on("load",function(){e(".wp-full-overlay-header .hester-demo-import").trigger("click")})}),r.on("click",".close-full-overlay",o.closePreview),r.keyup(function(t){27===t.keyCode&&e(".close-full-overlay").trigger("click")}),r.on("click",".next-theme",o.previewNext),r.on("click",".previous-theme",o.previewPrevious),r.on("click",".devices button",o.previewDevice),r.on("click",".collapse-sidebar",o.collapseSidebar),r.on("click",".hester-demo-section-title .control-toggle label",o.collapsePreviewSection),r.on("click",".hester-demo-import",o.importDemo),r.on("click","#import_content, #import_media",o.importOptionsContent),r.on("hester-core-import_started",o.importStarted),r.on("hester-core-install_plugins",o.pluginsInstallActivate),r.on("hester-core-import_customizer",o.importCustomizer),r.on("hester-core-import_content",o.importContent),r.on("hester-core-import_widgets",o.importWidgets),r.on("hester-core-import_options",o.importOptions),r.on("hester-core-import_wpforms",o.importWPForms),r.on("hester-core-import_completed",o.importCompleted),r.on("click",".demo-filters a",o.filters),r.on("input",".demo-search input",o.search)},preview:function(t){t.preventDefault();e(this).parents(".hester-demo").data("demo-id");var r=e(this).parents(".hester-demo");r.addClass("hester-demo-previewed"),s.addClass("hester-demo-preview-on"),o.previewDemo(r)},previewDemo:function(t){var r=wp.template("hester-core-demo-preview"),s={id:t.data("demo-id"),pro:t.data("demo-pro"),url:t.data("demo-url"),screenshot:t.data("demo-screenshot"),name:t.data("demo-name"),description:t.data("demo-description"),slug:t.data("demo-slug"),required_plugins:t.data("required-plugins"),is_pro:!!hesterCoreDemoLibrary.is_pro,upgrade_to_pro:hesterCoreDemoLibrary.upgrade_to_pro_url};e(".theme-install-overlay").remove(),e(".hester-section.demos").append(r(s)),e(".theme-install-overlay").css("display","block"),o.updateNextPrev(),e(".wp-full-overlay-main iframe").on("load",function(){e(".hester-demo-preview .hester-demo-import").removeAttr("disabled")})},updateNextPrev:function(){if(t.hasClass("importing"))e(".next-theme, .previous-theme").addClass("disabled");else{var r=e(".hester-demo-previewed").parent(),s=r.nextAll(".hester-column").length,o=r.prevAll(".hester-column").length;0==s?e(".next-theme").addClass("disabled"):0!=s&&e(".next-theme").removeClass("disabled"),0==o?e(".previous-theme").addClass("disabled"):0!=o&&e(".previous-theme").removeClass("disabled")}},closePreview:function(t){t.preventDefault(),e("body").hasClass("importing")&&!confirm(hesterCoreDemoLibrary.strings.closeWindowWarning)||(e("body").removeClass("importing"),e(".previous-theme, .next-theme").removeClass("disabled"),e(".theme-install-overlay").css("display","none"),e(".theme-install-overlay").remove(),e(".hester-demo-previewed").removeClass("hester-demo-previewed"),s.removeClass("hester-demo-preview-on"))},previewPrevious:function(t){t.preventDefault();var r=e(".hester-demo-previewed").removeClass("hester-demo-previewed").parent().prev(".hester-column").find(".hester-demo").addClass("hester-demo-previewed");e(this).parents(".wp-full-overlay-header").data("demo-id");o.previewDemo(r)},previewNext:function(t){t.preventDefault();var r=e(".hester-demo-previewed").removeClass("hester-demo-previewed").parent().next(".hester-column").find(".hester-demo").addClass("hester-demo-previewed");e(this).parents(".wp-full-overlay-header").data("demo-id");o.previewDemo(r)},previewDevice:function(t){var r=e(t.currentTarget).data("device");e(".theme-install-overlay").removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+r).data("current-preview-device",r),o.previewDeviceButtons(r)},previewDeviceButtons:function(t){var r=e(".wp-full-overlay-footer .devices");r.find("button").removeClass("active").attr("aria-pressed",!1),r.find("button.preview-"+t).addClass("active").attr("aria-pressed",!0)},collapseSidebar:function(){event.preventDefault();var t=e(".wp-full-overlay");return t.hasClass("expanded")?(t.removeClass("expanded"),void t.addClass("collapsed")):t.hasClass("collapsed")?(t.removeClass("collapsed"),void t.addClass("expanded")):void 0},collapsePreviewSection:function(){var t=e(this).closest(".hester-demo-section-title").next(".hester-demo-section-content");e(this).prev('input[type="checkbox"]').is(":checked")?t.removeClass("hidden"):t.addClass("hidden")},importDemo:function(s){if(s.preventDefault(),confirm(hesterCoreDemoLibrary.strings.importDemoWarning)){new Date;o.import_start_time=new Date,void 0!==e(this).attr("disabled")&&e(this).hasClass("disabled")||(o.install_plugins=e(".plugin-list input:checked").not(":disabled").map(function(){return{slug:e(this).data("slug"),name:e(this).next(".hester-label").html(),status:e(this).data("status")}}).get(),o.import_steps=e(".hester-demo-section-content.import-options input:checked").map(function(){if("import_media"!==e(this).attr("id"))return e(this).attr("id")}).get(),o.install_plugins.length&&o.import_steps.unshift("install_plugins"),o.import_steps.includes("import_content")&&(e("#install_plugin_wpforms-lite").is(":checked")&&o.import_steps.splice(o.import_steps.indexOf("import_content"),0,"import_wpforms"),o.import_steps.push("import_options")),o.import_steps.unshift("import_started"),o.import_steps.push("import_completed"),t.addClass("importing"),o.updateNextPrev(),e(".hester-checkbox input").attr("disabled","disabled"),e(".wp-full-overlay-header .hester-demo-import").text(hesterCoreDemoLibrary.strings.importing),r.trigger("hester-core-"+o.import_steps[0]))}},pluginsInstallActivate:function(){o.progress_delta=50/o.import_steps.length/o.install_plugins.length,o.pluginInstall(o.install_plugins[0])},pluginInstall:function(t){if(e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.installingPlugin+t.name),wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(event),e(document).on("credential-modal-cancel",function(){wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),"not_installed"===t.status)wp.updates.installPlugin({slug:t.slug,success:function(){o.updateProgressBar(),e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.installed),o.pluginActivate(t)},error:function(e){console.log(e)}});else if("installed"===t.status)o.updateProgressBar(),e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.installed),o.pluginActivate(t);else{if(o.updateProgressBar(),e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.activated),o.installed_plugins.push(o.install_plugins.shift()),o.install_plugins.length)return o.pluginInstall(o.install_plugins[0]);o.importNextStep()}},pluginActivate:function(t){return e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.activatingPlugin+t.name),e.ajax({url:hester_strings.ajaxurl,type:"POST",dataType:"json",data:{_ajax_nonce:hester_strings.wpnonce,action:"hester_core_import_step",import_step:"activate_plugin",plugin:t,demo_id:e(".wp-full-overlay-header").data("demo-slug")}}).then(function(t){if(o.updateProgressBar(),e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.activated),o.installed_plugins.push(o.install_plugins.shift()),o.install_plugins.length)return o.pluginInstall(o.install_plugins[0]);o.importNextStep()})},importStepAJAX:function(t){return t._ajax_nonce=hester_strings.wpnonce,t.action="hester_core_import_step",t.demo_id=e(".wp-full-overlay-header").data("demo-slug"),e.ajax({url:hester_strings.ajaxurl,type:"POST",dataType:"json",data:t}).done(function(e){e.success?(o.updateProgressBar(),o.importNextStep()):console.log(e)}).fail(function(e,t,r){console.log(e),console.log(t),console.log(r)})},importStarted:function(){return o.importStepAJAX({import_step:"import_started"})},importCustomizer:function(){e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importingCustomizer);return o.importStepAJAX({import_step:"import_customizer"})},importContent:function(){e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importingContent);var t={import_step:"import_content",attachments:e("#import_media").is(":checked")?1:0};return o.importStepAJAX(t)},importOptions:function(){e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importingOptions);return o.importStepAJAX({import_step:"import_options"})},importWPForms:function(){e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importingWPForms);return o.importStepAJAX({import_step:"import_wpforms"})},importWidgets:function(){e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importingWidgets);return o.importStepAJAX({import_step:"import_widgets"})},importCompleted:function(){o.importStepAJAX({import_step:"import_completed"}),e(".wp-full-overlay-header .hester-demo-import").html(hesterCoreDemoLibrary.strings.preview),e(".hester-demo-preview .hester-demo-import").removeClass("hester-demo-import").attr("href",hesterCoreDemoLibrary.homeurl),e(".wp-full-overlay-footer .status").text(hesterCoreDemoLibrary.strings.importCompleted),t.removeClass("importing"),setTimeout(function(){e(".wp-full-overlay-footer .hester-btn").addClass("animate")},100),setTimeout(function(){e(".wp-full-overlay-footer .hester-btn").removeClass("animate")},3e3),o.updateNextPrev()},importNextStep:function(){o.import_steps.length?(o.completed_steps.push(o.import_steps.shift()),o.updateProgressBar(),r.trigger("hester-core-"+o.import_steps[0])):r.trigger("hester-core-import_completed")},updateProgressBar:function(){var t=(100-o.progress)/o.import_steps.length;o.install_plugins.length>0&&(t/=2,t/=o.install_plugins.length),o.progress+=t,e("#hester-progress-bar .hester-progress-percentage").css("width",o.progress+"%")},importOptionsContent:function(){var t=e(this);"import_content"===t.attr("id")&&(t.is(":checked")?e("#import_media").removeAttr("disabled","disabled"):e("#import_media").attr("disabled","disabled").removeAttr("checked")),"import_media"===t.attr("id")&&t.is(":checked")&&e("#import_content").attr("checked","checked")},populateTemplates:function(t){if(e(".hester-section.demos").html(""),_.isEmpty(t))e(".hester-section.demos").html('<div class="hester-column">'+hesterCoreDemoLibrary.strings.noResultsFound+"</div>");else{var r,s=wp.template("hester-core-demo-item");for(var o in t)r={id:o,pro:t[o].pro,url:t[o].url,screenshot:t[o].screenshot,name:t[o].name,description:t[o].description,slug:t[o].slug,required_plugins:t[o].plugins,is_pro:!!hesterCoreDemoLibrary.is_pro,upgrade_to_pro:hesterCoreDemoLibrary.upgrade_to_pro_url},e(".hester-section.demos").append(s(r))}},filters:function(){var t=e(this);t.closest("ul").find("li").removeClass("selected"),t.closest("li").addClass("selected"),o.filterDemoList()},search:function(){var t=e(this),r=0;r&&clearTimeout(r);var s=t.val();(!s||s&&s.length>=4)&&(r=setTimeout(function(){o.filterDemoList()},300))},filterDemoList:function(){var t={category:e(".demo-filters .demo-categories li.selected a").data("category"),builder:e(".demo-filters .demo-builders li.selected a").data("builder"),s:e(".demo-search input").val()};return e.ajax({url:hester_strings.ajaxurl,type:"POST",dataType:"json",data:{_ajax_nonce:hester_strings.wpnonce,action:"hester-core-filter-demos",filters:t}}).then(function(e){e.success&&o.populateTemplates(e.data)})}};o.init(),window.HesterCoreDemoLibrary=o}(jQuery);