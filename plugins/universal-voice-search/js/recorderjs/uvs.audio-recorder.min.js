(function(t){var n=uvsWorkerPath,e=function(t,e){function o(t,n){if(null==t)return n;let e=(4*t+n)/5;return e}function r(){try{if("undefined"!=typeof uvsMicButtonElInCtx&&null!==uvsMicButtonElInCtx){var t=uvsMicButtonElInCtx.className||"";-1!=t.indexOf("listening")&&uvsMicButtonElInCtx.click()}}catch(t){console.log("uvs Error: Unable to reset Mic button.")}}var i=e||{},a=i.bufferLen||4096;this.context=t.context;var c=t.context.createAnalyser();t.connect(c),c.fftSize=2048;let s=null,l=null,u=null,f=null,d=!1,h=0,p=0;this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(a,2,2):this.node=this.context.createJavaScriptNode(a,2,2);var v=new Worker(i.workerPath||n);v.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var x,g=!1;this.node.onaudioprocess=function(t){if(g){var n=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(n);var e=0;for(let t=0;t<n.length;t++)e+=n[t];l=o(l,e),l=parseInt(l),null==u?u=l:l<u&&(u=l),null==f?f=l:l>f&&(f=l,f>2*u&&(d=!0)),s+10<l&&(p=0,h+=1),s-10>l&&(h=0,p+=1),s=l,p>17&&d&&r(),v.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})}},this.configure=function(t){for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])},this.record=function(t=null){g=!0,uvsMicButtonElInCtx=t},this.stop=function(){g=!1,s=null,h=0,p=0,l=null,u=null,f=null,d=!1},this.clear=function(){uvsMicButtonInCtx=null,v.postMessage({command:"clear"})},this.getBuffers=function(t){x=t||i.callback,v.postMessage({command:"getBuffers"})},this.exportWAV=function(t,n){if(x=t||i.callback,n=n||i.type||"audio/wav",!x)throw new Error("Callback not set");v.postMessage({command:"exportWAV",type:n})},this.exportMonoWAV=function(t,n){if(x=t||i.callback,n=n||i.type||"audio/wav",!x)throw new Error("Callback not set");v.postMessage({command:"exportMonoWAV",type:n})},this.convertBlobToBase64=function(t){return new Promise(function(n,e){if(!(void 0!==t&&t&&t instanceof Blob))return void e(null);let o=new FileReader;o.readAsDataURL(t),o.onload=function(){let t=o.result;void 0!==t&&t&&-1!==t.indexOf(",")?n(t.split(",")[1]):e(null)},o.onerror=function(t){o.abort()},o.onabort=function(){e(null)}})},v.onmessage=function(t){var n=t.data;x(n)},c.connect(this.node),this.node.connect(this.context.destination)};t.Recorder=e})(window);