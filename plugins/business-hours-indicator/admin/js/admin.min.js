jQuery(document).ready(function(){new Core.Admin.Main(jQuery(document.body))});
var Core;!function(t){!function(e){var i=function(){function e(e){var i=t.Admin.Helpers.Context.getSlug();this.parent=e,this.form=this.parent.find("#"+i+"-form"),this.settingsKey=t.Admin.Helpers.Context.getSettingsKey(),this.currentTab=this.parent.find(".mabel-nav-tab-active").data("tab"),this.sidebars=this.parent.find(".mabel-sidebar"),this.mainSidebar=this.sidebars.filter('[data-sidebar-for="main"]'),this.initTabs(),this.initDependencies(),this.toggleSidebars(),this.initAjax(),this.initEvents()}return e.prototype.initEvents=function(){var e=this,i=window.tb_remove;window.tb_remove=function(){i(),t.Admin.Dispatcher.publish("modal:closed"),e.saveSettings()},t.Admin.Dispatcher.subscribe("settings:save",function(){e.saveSettings()})},e.prototype.initAjax=function(){var t=this;this.form.find('select, input[type="text"], textarea, input[type=checkbox]').not(".skip-save").on("change",function(){t.saveSettings()})},e.prototype.saveSettings=function(){var e=this;this.parent.find(".all-settings-saved").hide(),this.parent.find(".saving-settings").show();var i=this.form.serialize();jQuery.post("options.php",i).done(function(){e.parent.find(".all-settings-saved").show(),e.parent.find(".saving-settings").hide(),t.Admin.Dispatcher.publish("settings:saved",i)})},e.prototype.initDependencies=function(){var t=this;this.parent.find('[name*="'+this.settingsKey+'"]').each(function(e,i){var n=jQuery(i),s=n.data("dependency");if(s){var a=t.parent.find('[name="'+t.settingsKey+"["+s.element_id+']"]').not(".skip-dependency");a&&(a.on("change",function(){var t=a.val(),e=!1;if(a.is(":checkbox")){var i=a.is(":checked");t==s.value&&i&&(e=!0)}else t==s.value&&(e=!0);e?n.closest("tr").show():n.closest("tr").hide()}),a.trigger("change"))}})},e.prototype.initTabs=function(){var e=this,i=this.parent.find(".mabel-nav-tab-wrapper a"),n=this.parent.find(".mabel-tab");i.on("click",function(s){s.preventDefault();var a=jQuery(s.currentTarget),r=a.data("tab");i.removeClass("mabel-nav-tab-active"),a.addClass("mabel-nav-tab-active"),n.hide(),e.parent.find(".tab-"+r).show(),t.Admin.Dispatcher.publish("tab:changed",r),e.currentTab=r,e.toggleSidebars()})},e.prototype.toggleSidebars=function(){this.sidebars.hide();var t=this.sidebars.filter('[data-sidebar-for="'+this.currentTab+'"]');t.length&&!t.is(":empty")?t.show():this.mainSidebar.show()},e}();e.Main=i}(t.Admin||(t.Admin={}))}(Core||(Core={}));
var Core;!function(i){!function(i){var t=function(){function i(){}return i.subscribe=function(i,t){this.hOP.call(this.topics,i)||(this.topics[i]=[]);var o=this.topics[i].push(t)-1;return{remove:function(){delete this.topics[i][o]}}},i.publish=function(i,t){this.hOP.call(this.topics,i)&&this.topics[i].forEach(function(i){i(void 0!=t?t:{})})},i.topics=[],i.hOP=[].hasOwnProperty,i}();i.Dispatcher=t}(i.Admin||(i.Admin={}))}(Core||(Core={}));
var Core;!function(t){!function(t){!function(t){var n=function(){function t(){}return t.getSlug=function(){return jQuery("[data-context]").data("slug")},t.getSettingsKey=function(){return jQuery("[data-context]").data("settings-key")},t.getAdminAjaxUrl=function(){return jQuery("[data-context]").data("admin-ajax-url")},t}();t.Context=n}(t.Helpers||(t.Helpers={}))}(t.Admin||(t.Admin={}))}(Core||(Core={}));
var BHIAdmin;!function(e){var n=function(){function n(n){this.home=n;var r=(new e.AjaxHelper(n),new e.TemplateHelper(n)),i=new e.LocationHelper(n,r);new e.HoursHelper(n,r,i),new e.EventHelper(n,i)}return n}();e.Main=n}(BHIAdmin||(BHIAdmin={})),jQuery(document).ready(function(){new BHIAdmin.Main(jQuery(document.body))});
var BHIAdmin;!function(t){var i=function(){function t(t){var i=this;this.parent=t,this.url=Core.Admin.Helpers.Context.getAdminAjaxUrl(),this.exampleIndicator=this.parent.find(".example-indicator"),this.exampleList=this.parent.find(".example-list"),this.updateExamples(),Core.Admin.Dispatcher.subscribe("settings:saved",function(){i.updateExamples()})}return t.prototype.updateExamples=function(){var t=this;this.exampleList.html('<div class="t-c">Updating...</div>'),this.exampleIndicator.html('<div class="t-c">Updating...</div>'),jQuery.post(this.url,{action:"mb-bhi-update-indicator"},function(i){t.exampleIndicator.html(i)}),jQuery.post(this.url,{action:"mb-bhi-update-list"},function(i){t.exampleList.html(i)})},t}();t.AjaxHelper=i}(BHIAdmin||(BHIAdmin={}));
var BHIAdmin;!function(i){var n=function(){function i(i,n){this.home=i,this.locationHelper=n,this.initEvents()}return i.prototype.initEvents=function(){var i=this;Core.Admin.Dispatcher.subscribe("/locations/changed",function(n){i.home.find('input[name="mb-bhi-settings[locations]"]').val(JSON.stringify(n)),Core.Admin.Dispatcher.publish("settings:save")}),Core.Admin.Dispatcher.subscribe("modal:closed",function(){i.locationHelper.setCurrentLocation(null)})},i}();i.EventHelper=n}(BHIAdmin||(BHIAdmin={}));
var BHIAdmin;!function(t){var e=function(){function t(t,e,o){this.home=t,this.locationDisplay=t.find(".loc-display"),this.templateHelper=e,this.locationHelper=o,this.openHours(),this.addHours(),this.openHolidays(),this.addHoliday(),this.deleteHoliday(),this.openVacations(),this.addVacation(),this.deleteVacation()}return t.prototype.openHours=function(){var t=this;this.locationDisplay.on("click",".btn-open-edit-hours",function(e){e.preventDefault();var o=jQuery(this),a=t.locationHelper.getLocationByName(o.data("loc"));a&&a.Days&&(t.templateHelper.drawTemplate("businesshours",a.Days),t.locationHelper.setCurrentLocation(a),window.tb_show("Edit Holidays for "+a.Name,"#TB_inline?height=550&amp;width=600&amp;inlineId=add-hours"))})},t.prototype.addHours=function(){var t=this;this.home.find(".btn-edit-hours").on("click",function(e){e.preventDefault();var o=[];jQuery(".add-hours-table tr").each(function(e,a){var i=jQuery(a),n=i.data("day"),r={Day:n,Hours:[]};r.Hours=t.validateAndAdd(i),o.push(r)}),t.locationHelper.getCurrentLocation().Days=o,Core.Admin.Dispatcher.publish("/locations/changed",t.locationHelper.getLocations()),window.tb_remove()})},t.prototype.openHolidays=function(){var t=this;this.locationDisplay.on("click",".btn-open-edit-specials",function(e){e.preventDefault();var o=t.locationHelper.getLocationByName(jQuery(this).data("loc"));o&&(t.templateHelper.drawTemplate("showholiday",o.Holidays),t.templateHelper.drawTemplate("addholiday",{}),t.locationHelper.setCurrentLocation(o),window.tb_show("Edit holidays for "+o.Name,"#TB_inline?height=550&amp;width=500&amp;inlineId=add-specials"))})},t.prototype.addHoliday=function(){var t=this;this.home.find(".add-specials-table").on("click",".btn-add-special",function(e){e.preventDefault();var o=jQuery(this).closest("tr"),a={Day:o.find(".date select[name=day]").val(),Month:o.find(".date select[name=month]").val(),Hours:[]};a.Hours=t.validateAndAdd(o);var i=t.locationHelper.getCurrentLocation();i.Holidays.push(a),t.templateHelper.drawTemplate("showholiday",i.Holidays),Core.Admin.Dispatcher.publish("/locations/changed",t.locationHelper.getLocations())})},t.prototype.deleteHoliday=function(){var t=this;this.home.find(".sd-display").on("click",".btn-delete",function(e){e.preventDefault();var o=jQuery(this),a=o.closest("tr");a.hide("fast",function(){a.remove();var e=t.locationHelper.getCurrentLocation(),i=o.data("holiday").split(",");e.Holidays=_.filter(e.Holidays,function(t){return t.Day!==i[0]||t.Month!==i[1]}),Core.Admin.Dispatcher.publish("/locations/changed",t.locationHelper.getLocations())})})},t.prototype.openVacations=function(){var t=this;this.locationDisplay.on("click",".btn-open-edit-vacation",function(e){e.preventDefault();var o=jQuery(this),a=t.locationHelper.getLocationByName(o.data("loc"));a&&(t.templateHelper.drawTemplate("showvacations",a.Vacations),t.templateHelper.drawTemplate("addvacation",{}),t.locationHelper.setCurrentLocation(a),window.tb_show("Edit vacations for "+a.Name,"#TB_inline?height=550&amp;width=500&amp;inlineId=add-vacation"))})},t.prototype.addVacation=function(){var t=this;this.home.find(".add-vacation-table").on("click",".btn-add-vacation",function(e){e.preventDefault();var o=jQuery(this).closest("tr"),a=t.locationHelper.getCurrentLocation();a.Vacations.push({FromDay:o.find("select[name=from-day]").val(),ToDay:o.find("select[name=to-day]").val(),From:o.find("select[name=from]").val(),To:o.find("select[name=to]").val()}),t.templateHelper.drawTemplate("showvacations",a.Vacations),Core.Admin.Dispatcher.publish("/locations/changed",t.locationHelper.getLocations())})},t.prototype.deleteVacation=function(){var t=this;this.home.find(".vac-display").on("click",".btn-delete",function(e){e.preventDefault();var o=jQuery(this).closest("tr");o.hide("fast",function(){o.remove(),t.locationHelper.getCurrentLocation().Vacations.splice(jQuery(".vac-display").find(".close").index(jQuery(this)),1),Core.Admin.Dispatcher.publish("/locations/changed",t.locationHelper.getLocations())})})},t.prototype.validateAndAdd=function(t){var e=[],o=this,a=!1;return t.find(".hours > div").each(function(t,i){var n=jQuery(i),r=n.find("select[name=From]").val(),l=n.find("select[name=To]").val(),s=n.find("select[name=ToIndication]").val(),d=n.find("select[name=FromIndication]").val(),c=o.to24(r,d),p=o.to24(l,s);_.every(e,function(t){var e=o.to24(t.From,t.FromIndication),a=o.to24(t.To,t.ToIndication);return e>=a&&(a+=24),e<c&&e<p&&a<c&&a<p||e>c&&e>p&&a>c&&a>p})?e.push({From:r,To:l,ToIndication:s,FromIndication:d}):a=!0}),a&&alert("One or more combinations weren't correct. They were not added to your time table"),e},t.prototype.to24=function(t,e){return t=t.split(":"),t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),"PM"==e&&t[0]<12&&(t[0]=t[0]+12),"AM"==e&&12==t[0]&&(t[0]=24),parseFloat(t[0]+"."+t[1])},t}();t.HoursHelper=e}(BHIAdmin||(BHIAdmin={}));
var BHIAdmin;!function(t){var o=function(){function t(t,o){this.home=t,this.templateHelper=o,this.locationDisplay=t.find(".loc-display");var e=this.home.find('input[name="mb-bhi-settings[locations]"]').val();if(this.locations=e?JSON.parse(e):[],this.emptylocation=JSON.parse(this.home.find(".locations-wrapper").attr("data-empty-object")),!this.emptylocation)throw"Empty location object not found.";this.init()}return t.prototype.init=function(){this.openLocationDialog(),this.addLocation(),this.deleteLocation(),this.templateHelper.drawTemplate("location",this.locations)},t.prototype.openLocationDialog=function(){var t=this;this.home.find(".btn-open-lpopup").on("click",function(o){o.preventDefault(),t.locations.length>=mabel_ajax.clamp?alert("To add more locations, please upgrade to the PRO version."):window.tb_show("Add a new location","#TB_inline?width=500&height=350&inlineId=add-location")})},t.prototype.addLocation=function(){var t=this;this.home.find(".btn-add-loc").click(function(o){if(o.preventDefault(),t.locations.length>=mabel_ajax.clamp)alert("To add more locations, please upgrade to the PRO version.");else{var e=jQuery.extend(!0,{},t.emptylocation),n=jQuery.trim(t.home.find("input[name=loc-name]").val());n&&(e.Name=t.escapeHtml(n),t.locations.push(e),t.templateHelper.drawTemplate("location",t.locations),Core.Admin.Dispatcher.publish("/locations/changed",t.getLocations()),window.tb_remove())}})},t.prototype.getLocations=function(){return this.locations},t.prototype.getLocationByName=function(t){return _.findWhere(this.locations,{Name:""+t})},t.prototype.setCurrentLocation=function(t){this.openLocation=t},t.prototype.getCurrentLocation=function(){return this.openLocation},t.prototype.deleteLocation=function(){var t=this;this.locationDisplay.on("click",".btn-delete",function(o){if(o.preventDefault(),confirm("Are you sure you want to do delete this entry?")){var e=jQuery(this),n=e.closest(".sd-entry");n.slideUp("fast",function(){n.remove(),t.locations=_.filter(t.locations,function(t){return t.Name!==e.data("loc")}),Core.Admin.Dispatcher.publish("/locations/changed",t.getLocations()),Core.Admin.Dispatcher.publish("settings:save")})}})},t.prototype.escapeHtml=function(t){var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"&frasl;"};return String(t).replace(/[&<>"'\/]/g,function(t){return o[t]})},t}();t.LocationHelper=o}(BHIAdmin||(BHIAdmin={}));
var BHIAdmin;!function(t){var e=function(){function t(t){this.home=t,this.config=[{id:"location",templateScriptId:"tplLocation",templateView:"loc-display"},{id:"businesshours",templateScriptId:"tplBusinessHours",subtemplates:[{name:"renderHours",templateScriptId:"tplHourSelect"},{name:"renderIndication",templateScriptId:"tplHourIndication"}],templateView:"add-hours-table"},{id:"showholiday",templateScriptId:"tplShowHoliday",templateView:"sd-display"},{id:"addholiday",templateView:"add-specials-table",templateScriptId:"tplAddHoliday",subtemplates:[{name:"renderHours",templateScriptId:"tplHourSelect"},{name:"renderIndication",templateScriptId:"tplHourIndication"}]},{id:"showvacations",templateScriptId:"tplShowVacations",templateView:"vac-display"},{id:"addvacation",templateScriptId:"tplAddVacation",templateView:"add-vacation-table"}],this.init()}return t.prototype.init=function(){var t=this;_.each(this.config,function(e){e.template=_.template(t.home.find("#"+e.templateScriptId).html()),e.subtemplates&&(e.subtemplateCache=[],_.each(e.subtemplates,function(a){e.subtemplateCache.push({name:a.name,template:_.template(t.home.find("#"+a.templateScriptId).html())})}))})},t.prototype.drawTemplate=function(t,e){var a=_.findWhere(this.config,{id:t});if(a){var i={model:e,templateEngine:function(t,e){return _.findWhere(a.subtemplateCache,{name:t}).template(e)}};this.home.find("."+a.templateView).html(a.template(i))}},t}();t.TemplateHelper=e}(BHIAdmin||(BHIAdmin={}));