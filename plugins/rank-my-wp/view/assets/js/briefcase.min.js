if(typeof RKMW_DEBUG==="undefined")var RKMW_DEBUG=false;(function($){"use strict";var briefcaseTable;var labelTable;var suggestTable;$.fn.rkmw_Briefcase=function(){var $this=this;var $popupAddKeyword=$this.find(".rkmw_add_keyword_dialog");var $popupAddLabel=$this.find(".rkmw_add_labels_dialog");var $popupEditLabel=$this.find(".rkmw_edit_label_dialog");$this.listenAdd=function(){$popupAddLabel.find("#rkmw_labelcolor").wpColorPicker();$popupAddLabel.find("#rkmw_save_label").on("click",function(){var $button=$(this);var $name=$popupAddLabel.find("input#rkmw_labelname").val();var $color=$popupAddLabel.find("input#rkmw_labelcolor").val();$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_addlabel",name:$name,color:$color,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("rkmw_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("rkmw_minloading");$.rkmw_showMessage(response.error).addClass("rkmw_error")}}).fail(function(){$button.removeClass("rkmw_minloading")},"json")});$this.find(".rkmw_save_keyword_labels").on("click",function(){var $popup=$(this).parents(".rkmw_label_manage_popup:last");var $button=$(this);var $keyword=$(this).data("keyword");var $labels=[];$popup.find('input[name="rkmw_labels"]:checked').each(function(){$labels.push(this.value)});$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_keywordlabel",keyword:$keyword,labels:$labels,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("rkmw_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("rkmw_minloading");$.rkmw_showMessage(response.error).addClass("rkmw_error")}}).fail(function(){$button.removeClass("rkmw_minloading")},"json")})};$this.listenEdit=function(){$popupEditLabel.find("#rkmw_labelcolor").wpColorPicker();$this.find(".rkmw_edit_label").on("click",function(){$("#element .wp-picker-clear").trigger("click");$popupEditLabel.find("input#rkmw_labelid").val($(this).attr("data-id"));$popupEditLabel.find("input#rkmw_labelname").val($(this).attr("data-name"));$popupEditLabel.find("input#rkmw_labelcolor").val($(this).attr("data-color"));$popupEditLabel.find("input#rkmw_labelcolor").trigger("change");$popupAddKeyword.modal("hide");$popupAddLabel.modal("hide");$popupEditLabel.modal("show")});$popupEditLabel.find("#rkmw_save_label").on("click",function(){var $button=$(this);var $id=$popupEditLabel.find("#rkmw_labelid").val();var $name=$popupEditLabel.find("#rkmw_labelname").val();var $color=$popupEditLabel.find("#rkmw_labelcolor").val();$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_editlabel",id:$id,name:$name,color:$color,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("rkmw_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("rkmw_minloading");$.rkmw_showMessage(response.error).addClass("rkmw_error")}}).fail(function(){$button.removeClass("rkmw_minloading")},"json")})};$this.listenCount=function(){$this.find(".rkmw_open_subrow").on("click",function(){var $button=$(this);var $id=$(this).data("id");var $keyword=$(this).data("keyword");$this.find(".fa_showmore").removeClass("fa-sort-asc");if($("#rkmw_subrow_"+$id).is(":visible")){$("#rkmw_subrow_"+$id).hide();return}$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_article",keyword:$keyword,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.error!=="undefined"){if(response.error==="limit_exceeded"){$.rkmw_showMessage(response.error).addClass("rkmw_error")}else{$.rkmw_showMessage(response.error,1e4).addClass("rkmw_error")}}else if(typeof response.articles!=="undefined"){$(".rkmw_subrow").hide();$("#rkmw_subrow_"+$id).find("td").html(response.articles);$("#rkmw_subrow_"+$id).show()}$("#rkmw_row_"+$id).find(".fa_showmore").addClass("fa-sort-asc");$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")})};$this.listenDelete=function(){$this.find(".rkmw_delete").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this);var $keyword=$(this).data("keyword");var $id=$(this).data("id");$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_deletekeyword",keyword:$keyword,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$this.find("#rkmw_row_"+$id).remove();$this.find("#rkmw_subrow_"+$id).remove()}else if(typeof response.error!=="undefined"){$.rkmw_showMessage(response.error).addClass("rkmw_error")}$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")}});$this.find(".rkmw_delete_label").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this).parents(".rkmw_saved_label:last");var $id=$(this).data("id");$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_deletelabel",id:$id,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.deleted!=="undefined"){location.reload();$button.remove();$this.find("label[data-id="+$id+"]").remove();$this.find(".rkmw_circle_label[data-id="+$id+"]").remove()}else if(typeof response.error!=="undefined"){$.rkmw_showMessage(response.error).addClass("rkmw_error")}$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")}});$this.find(".rkmw_delete_found").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this);var $keyword=$(this).data("keyword");var $id=$(this).data("id");$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_briefcase_deletefound",keyword:$keyword,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$this.find("#rkmw_row_"+$id).remove();$this.find("#rkmw_subrow_"+$id).remove()}else if(typeof response.error!=="undefined"){$.rkmw_showMessage(response.error).addClass("rkmw_error")}$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")}})};$this.listenDoSerp=function(){$this.find(".rkmw_research_doserp").on("click",function(){var $button=$(this);var $keyword=$(this).data("keyword");var $success=$(this).data("success");var $link=$(this).data("link");$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:"rkmw_ajax_briefcase_doserp",keyword:$keyword,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$.rkmw_showMessage(response.message).addClass("rkmw_success");$button.html('<a href="'+$link+'">'+$success+"</a>");$button.off("click")}else if(typeof response.error!=="undefined"){$.rkmw_showMessage(response.error)}$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")})};$this.listenOptions=function(){$("#rkmw_briefcase .rkmw_filter_label input[type=checkbox]").click(function(){$("#rkmw_briefcase .rkmw_filter_label input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("rkmw_active")}});if($(this).is(":checked")){$(this).next("label").addClass("rkmw_active")}});$("#rkmw_briefcase .rkmw_add_keyword_dialog input[type=checkbox]").click(function(){$("#rkmw_briefcase .rkmw_add_keyword_dialog input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("rkmw_active")}});if($(this).is(":checked")){$(this).next("label").addClass("rkmw_active")}});$("#rkmw_briefcase .rkmw_label_manage_popup input[type=checkbox]").click(function(){var $popup=$(this).parents(".rkmw_label_manage_popup:last");$popup.find("input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("rkmw_active")}});if($(this).is(":checked")){$(this).next("label").addClass("rkmw_active")}})};$this.bulkAction=function(){$this.find(".rkmw_bulk_submit").on("click",function(){var $button=$(this);if($this.find(".rkmw_bulk_action").find(":selected").val()!==""){if(!$button.hasClass("btn-modal")&&$this.find(".rkmw_bulk_action").find(":selected").val()==="rkmw_ajax_briefcase_bulk_label"){$this.find("#rkmw_label_manage_popup_bulk").modal("show");return}if($this.find(".rkmw_bulk_action").find(":selected").data("confirm")){if(!confirm($this.find(".rkmw_bulk_action").find(":selected").data("confirm"))){return}}var $rkmw_bulk_input=[];jQuery($this.find(".rkmw_bulk_input").serializeArray()).each(function(){$rkmw_bulk_input.push($(this).attr("value"))});var $rkmw_bulk_labels=[];jQuery($this.find(".rkmw_bulk_labels").serializeArray()).each(function(){$rkmw_bulk_labels.push($(this).attr("value"))});$button.addClass("rkmw_minloading");$.post(rkmwQuery.ajaxurl,{action:$this.find(".rkmw_bulk_action").find(":selected").val(),inputs:$rkmw_bulk_input,labels:$rkmw_bulk_labels,rkmw_nonce:rkmwQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$.rkmw_showMessage(response.message).addClass("rkmw_success");if($this.find(".rkmw_bulk_action").find(":selected").val()==="rkmw_ajax_briefcase_bulk_doserp"){$this.find(".rkmw_bulk_input").each(function(){if($(this).is(":checked")){$(this).parents("tr:last").find(".rkmw_research_doserp").remove();$(this).prop("checked",false)}})}else if($this.find(".rkmw_bulk_action").find(":selected").val()==="rkmw_ajax_briefcase_bulk_delete"){$this.find(".rkmw_bulk_input").each(function(){if($(this).is(":checked")){briefcaseTable.row($(this).parents("tr:last")).remove().draw()}})}else{location.reload()}}else if(typeof response.error!=="undefined"){$.rkmw_showMessage(response.error)}$button.removeClass("rkmw_minloading")}).fail(function(){$button.removeClass("rkmw_minloading")},"json")}})};$this.listenAdd();$this.listenEdit();$this.listenDelete();$this.listenDoSerp();$this.listenOptions();$this.bulkAction();return $this};$.fn.loadTable=function(){$.extend($.fn.dataTableExt.oSort,{"formatted-value-pre":function(a){return $("<div></div>").append(a).find("span").data("value")},"formatted-value-asc":function(a,b){return a-b},"formatted-value-desc":function(a,b){return b-a},"formatted-progress-pre":function(a){return $("<div></div>").append(a).find("button").data("value")},"formatted-progress-asc":function(a,b){return a-b},"formatted-progress-desc":function(a,b){return b-a},"formatted-num-pre":function(a){return parseInt(a.replace(/[^\d\-\.]/g,""))},"formatted-num-asc":function(a,b){return a-b},"formatted-num-desc":function(a,b){return b-a},"formatted-rank-pre":function(a){var div=$("<div>"+a+"</div>");if(div.find("button").length){return parseInt(div.find("button").data("value"))}if(div.find("a").length){return parseInt(div.find("a").data("value"))}return parseInt(div.data("value"))},"formatted-rank-asc":function(a,b){return a-b},"formatted-rank-desc":function(a,b){return b-a}});return $(this).DataTable({columnDefs:[{targets:2,sortable:true,type:"formatted-rank"},{targets:3,sortable:true,type:"formatted-value"},{targets:4,sortable:true,type:"formatted-progress"},{targets:[0,5],sortable:false}],bPaginate:true,bLengthChange:false,bFilter:false,iDisplayLength:10,aaSorting:[2,"asc"]})};$.fn.loadLabelTable=function(){$(this).DataTable({columnDefs:[{targets:[1],searchable:true,sortable:true},{targets:[0,2,3],sortable:false}],bPaginate:true,bLengthChange:false,bFilter:false,iDisplayLength:10,aaSorting:[1,"desc"],fixedColumns:true})};$.fn.loadSuggestTable=function(){$.extend($.fn.dataTableExt.oSort,{"formatted-value-pre":function(a){return $("<div></div>").append(a).find("span").data("value")},"formatted-value-asc":function(a,b){return a-b},"formatted-value-desc":function(a,b){return b-a}});$(this).DataTable({columnDefs:[{targets:[5,6],sortable:false},{targets:[2,3,4],sortable:true,type:"formatted-value"}],bPaginate:false,bLengthChange:false,bFilter:true,iDisplayLength:50,fixedColumns:true})};$(document).ready(function(){$("#rkmw_briefcase").rkmw_Briefcase();$("#rkmw_briefcaselabels").rkmw_Briefcase();$("#rkmw_suggested").rkmw_Briefcase();briefcaseTable=$("#rkmw_briefcase table.table").loadTable();labelTable=$("#rkmw_briefcaselabels table.table").loadLabelTable();suggestTable=$("#rkmw_suggested table.table").loadSuggestTable()})})(jQuery);