{"version":3,"file":"peachpay_square_ach-blocks.js","mappings":"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","sources":["webpack://peachpay-for-woocommerce/./core/blocks/src/currency-fallback.tsx","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/currency.ts","webpack://peachpay-for-woocommerce/./frontend/@shared/ts/error.ts","webpack://peachpay-for-woocommerce/external window \"React\"","webpack://peachpay-for-woocommerce/external window \"regeneratorRuntime\"","webpack://peachpay-for-woocommerce/external window [\"peachpay_checkout_blocks\"]","webpack://peachpay-for-woocommerce/external window [\"wc\",\"wcBlocksRegistry\"]","webpack://peachpay-for-woocommerce/external window [\"wc\",\"wcSettings\"]","webpack://peachpay-for-woocommerce/external window [\"wp\",\"element\"]","webpack://peachpay-for-woocommerce/external window [\"wp\",\"htmlEntities\"]","webpack://peachpay-for-woocommerce/external window [\"wp\",\"i18n\"]","webpack://peachpay-for-woocommerce/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://peachpay-for-woocommerce/webpack/bootstrap","webpack://peachpay-for-woocommerce/webpack/runtime/compat get default export","webpack://peachpay-for-woocommerce/webpack/runtime/define property getters","webpack://peachpay-for-woocommerce/webpack/runtime/hasOwnProperty shorthand","webpack://peachpay-for-woocommerce/./core/payments/square/blocks/src/ach/index.tsx"],"sourcesContent":["import {peachpayUpdateCurrencyCookie} from '../../../frontend/@shared/ts/currency';\nimport {__} from '@wordpress/i18n';\n\nexport default function CurrencyFallback(props: {name: string; currency: string | null}) {\n\tfunction changeCurrency() {\n\t\tif (!props.currency) {\n\t\t\treturn;\n\t\t}\n\n\t\tpeachpayUpdateCurrencyCookie(props.currency);\n\t\twindow.location.reload();\n\t}\n\n\treturn props.currency ? (\n\t\t<div style={{display: 'flex', flexDirection: 'column'}}>\n\t\t\t<p style={{textAlign: 'justify', margin: '0.5rem 0 0', fontSize: 'smaller'}}>\n\t\t\t\t{props.name} {__('does not support the currency you currently have chosen.', 'peachpay-for-woocommerce')} <b>{__('Update to', 'peachpay-for-woocommerce')} {props.currency}</b> {__('below to use this payment method.', 'peachpay-for-woocommerce')}\n\t\t\t</p>\n\t\t\t<button type='button' className='button currency-fallback-button' style={{fontSize: 'smaller', marginBottom: '16px'}}\n\t\t\t\tonClick={changeCurrency}\n\t\t\t>{__('Update to', 'peachpay-for-woocommerce')} {props.currency}</button>\n\t\t</div>\n\t) : null;\n}\n","function peachpayUpdateCurrencyCookie(newCurrency: string) {\n\tdocument.cookie = `pp_active_currency=${newCurrency};path=/`;\n}\n\nexport {peachpayUpdateCurrencyCookie};\n","/**\n * Gets a stringified error or if the stringified result is an empy string or empty object the default .toString() is used.\n * Created because JSON.stringify(error) will return {} for Error objects (https://stackoverflow.com/a/50738205/16998523).\n *\n * @param {unknown} error\n */\nexport function getErrorString(error: unknown): string {\n\tif (error instanceof Error && error.stack) {\n\t\treturn error.stack;\n\t}\n\n\tconst errorString = JSON.stringify(error);\n\treturn errorString && errorString !== '{}' ? errorString : `${error as string}`;\n}\n\n/**\n * Takes an unknown value and coerces it into an error and finally returns the error message string\n */\nexport function getErrorMessage(thrownError: unknown) {\n\treturn _toErrorWithMessage(thrownError).message;\n}\n\nfunction _toErrorWithMessage(thrownError: unknown): {message: string} {\n\tif (_isErrorWithMessage(thrownError)) {\n\t\treturn thrownError;\n\t}\n\n\ttry {\n\t\treturn new Error(JSON.stringify(thrownError));\n\t} catch {\n\t\treturn new Error(String(thrownError));\n\t}\n}\n\nfunction _isErrorWithMessage(thrownError: unknown): thrownError is {message: string} {\n\treturn (\n\t\ttypeof thrownError === 'object'\n    && thrownError !== null\n    && 'message' in thrownError\n    && typeof thrownError.message === 'string'\n\t);\n}\n","module.exports = window[\"React\"];","module.exports = window[\"regeneratorRuntime\"];","module.exports = window[\"peachpay_checkout_blocks\"];","module.exports = window[\"wc\"][\"wcBlocksRegistry\"];","module.exports = window[\"wc\"][\"wcSettings\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"htmlEntities\"];","module.exports = window[\"wp\"][\"i18n\"];","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","import {__} from '@wordpress/i18n';\nimport {registerPaymentMethod} from '@woocommerce/blocks-registry';\nimport {getSetting} from '@woocommerce/settings';\nimport {decodeEntities} from '@wordpress/html-entities';\nimport {useEffect} from '@wordpress/element';\nimport {type PaymentMethodInterface} from '@woocommerce/types';\nimport {type CheckoutAfterProcessingWithErrorEventData} from '@woocommerce/checkout';\nimport {type TokenResult, type Payments, type ACH, type PlaidEventName} from '@square/web-payments-sdk-types';\nimport {startTransaction, updateTransaction, z} from '@peachpay/checkout-blocks';\nimport {getErrorString} from '../../../../../../frontend/@shared/ts/error';\nimport CurrencyFallback from '../../../../../blocks/src/currency-fallback';\n\nconst SettingsSchema = z.object({\n\ticon: z.string(),\n\ttitle: z.string(),\n\tdescription: z.string(),\n\tfallback_currency: z.string().nullable(),\n\tsupports: z.string().array(),\n\tsquare: z.object({\n\t\tapplication_id: z.string(),\n\t\tlocation_id: z.string(),\n\t}),\n});\n\nconst parsedResult = SettingsSchema.safeParse(getSetting('peachpay_square_ach_data'));\nif (!parsedResult.success) {\n\tthrow new Error(`Payment method \"peachpay_square_ach\" setup aborted. Invalid settings.\\n\\n${parsedResult.error.message}`);\n}\n\nconst settings = parsedResult.data;\nconst title = decodeEntities(settings.title);\nconst description = decodeEntities(settings.description);\n\nif (!window.Square) {\n\tthrow new Error('Payment method \"peachpay_square_ach\" setup aborted. Square SDK not loaded.');\n}\n\nlet payments: Payments;\ntry {\n\tpayments = window.Square.payments(settings.square.application_id, settings.square.location_id);\n} catch (err) {\n\tthrow new Error(`Payment method \"peachpay_square_ach\" setup aborted. Could not create Payments instance.\\n\\n${getErrorString(err)}`);\n}\n\n/**\n * Component to render the payment method label\n */\nfunction Label(props: PaymentMethodInterface) {\n\tconst {PaymentMethodLabel, PaymentMethodIcons} = props.components;\n\treturn (\n\t\t<>\n\t\t\t<PaymentMethodLabel text={title} />\n\t\t\t<PaymentMethodIcons className='pp-label-icon' icons={[{\n\t\t\t\tid: 'peachpay_square_ach',\n\t\t\t\tsrc: settings.icon,\n\t\t\t\talt: title,\n\t\t\t}]} />\n\t\t</>\n\t);\n}\n\n/**\n * Component to render the ACH payment method body\n */\nfunction Content({billing, eventRegistration, emitResponse}: PaymentMethodInterface) {\n\tconst {\n\t\tonPaymentSetup,\n\t\tonCheckoutFail,\n\t} = eventRegistration;\n\n\t/**\n\t * Handle payment tokenization and verification right before the order is submitted.\n\t */\n\tuseEffect(() => onPaymentSetup(async () => {\n\t\tconst {result: transactionId, error} = await startTransaction('peachpay_square_ach');\n\t\tif (error || !transactionId) {\n\t\t\treturn {\n\t\t\t\ttype: emitResponse.responseTypes.ERROR,\n\t\t\t\tmessage: getErrorString(error) ?? __('An unknown error occured while creating the transaction.', 'peachpay-for-woocommerce'),\n\t\t\t};\n\t\t}\n\n\t\tlet ach: ACH | null = null;\n\t\ttry {\n\t\t\tach = await payments.ach({\n\t\t\t\tredirectURI: window.location.href,\n\t\t\t\ttransactionId,\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconst note = getErrorString(err);\n\t\t\tawait updateTransaction(transactionId, {note, paymentStatus: 'creationfailed'});\n\t\t\treturn {\n\t\t\t\ttype: emitResponse.responseTypes.ERROR,\n\t\t\t\tmessage: note,\n\t\t\t};\n\t\t}\n\n\t\tach.addEventListener('ontokenization' as PlaidEventName.ON_TOKENIZATION, _event => {\n\t\t\t// This event is required to be registered with Square ACH. But we\n\t\t\t// do not use it so this callback is empty.\n\t\t});\n\n\t\tlet tokenResult: TokenResult | null = null;\n\t\ttry {\n\t\t\ttokenResult = await ach.tokenize({\n\t\t\t\taccountHolderName: billing.billingAddress.first_name + ' ' + billing.billingAddress.last_name,\n\t\t\t});\n\n\t\t\tif (tokenResult.status !== 'OK' || !tokenResult.token) {\n\t\t\t\tlet note = (tokenResult.errors\n\t\t\t\t\t?.map(err => err.message)\n\t\t\t\t\t?.join('<br/>')\n\t\t\t\t\t\t?? __('Tokenization failed. Please try again or use a different payment method.', 'peachpay-for-woocommerce')\n\t\t\t\t);\n\n\t\t\t\tif (tokenResult.status === 'Cancel') {\n\t\t\t\t\tnote = __('Payment was cancelled', 'peachpay-for-woocommerce');\n\t\t\t\t}\n\n\t\t\t\tawait updateTransaction(transactionId, {note, paymentStatus: 'creationfailed'});\n\t\t\t\treturn {\n\t\t\t\t\ttype: emitResponse.responseTypes.ERROR,\n\t\t\t\t\tmessage: note,\n\t\t\t\t};\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst note = getErrorString(err);\n\t\t\tawait updateTransaction(transactionId, {note, paymentStatus: 'creationfailed'});\n\t\t\treturn {\n\t\t\t\ttype: emitResponse.responseTypes.ERROR,\n\t\t\t\tmessage: note,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttype: emitResponse.responseTypes.SUCCESS,\n\t\t\tmeta: {\n\t\t\t\tpaymentMethodData: {\n\t\t\t\t\tpeachpay_transaction_id: transactionId,\n\t\t\t\t\tpeachpay_square_source_id: tokenResult.token,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}), [\n\t\tbilling.billingAddress,\n\t\tonPaymentSetup,\n\t]);\n\n\t/**\n\t * Handle checkout failure after the order was submitted. Failure may or may\n\t * not be payment related.\n\t */\n\tuseEffect(() => onCheckoutFail(async (data: CheckoutAfterProcessingWithErrorEventData) => ({\n\t\ttype: emitResponse.responseTypes.ERROR,\n\t\tmessage: (data.processingResponse?.paymentDetails?.['message']) ?? __('An unknown error occured while processing the payment.', 'peachpay-for-woocommerce'),\n\t\tmessageContext: emitResponse.noticeContexts.PAYMENTS,\n\t})), [onCheckoutFail]);\n\n\t/**\n\t * If the payment method does not support the current currency we will show\n\t * a fallback button to allow changing the currency.\n\t *\n\t * Note: Due to how our currency switcher works the `fallback_currency` setting\n\t * is only defined when the payment does not support the current currency and\n\t * does not change after page load.\n\t */\n\tif (settings.fallback_currency) {\n\t\treturn <CurrencyFallback name={title} currency={settings.fallback_currency} />;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<img style={{maxHeight: '25px'}} src={settings.icon}></img>\n\t\t\t<p style={{textAlign: 'left', margin: '0.5rem 0 0'}} >{title} {__('selected for checkout.', 'peachpay-for-woocommerce')}</p>\n\t\t\t<hr style={{margin: '0.5rem 0'}}/>\n\t\t\t<p style={{textAlign: 'left', margin: '0', fontSize: 'smaller'}}>{description}</p>\n\t\t</>\n\t);\n}\n\nregisterPaymentMethod({\n\tname: 'peachpay_square_ach',\n\tariaLabel: title,\n\tcanMakePayment(data) {\n\t\treturn data.paymentMethods.includes('peachpay_square_ach');\n\t},\n\t// @ts-expect-error WC will clone these components and pass the props when used.\n\tlabel: <Label />,\n\t// @ts-expect-error WC will clone these components and pass the props when used.\n\tcontent: <Content />,\n\t// @ts-expect-error WC will clone these components and pass the props when used.\n\tedit: <Content />,\n\tsupports: {\n\t\tfeatures: settings.supports,\n\t},\n});\n"],"names":["CurrencyFallback","props","currency","createElement","style","display","flexDirection","textAlign","margin","fontSize","name","__","type","className","marginBottom","onClick","peachpayUpdateCurrencyCookie","window","location","reload","newCurrency","document","cookie","getErrorString","error","Error","stack","errorString","JSON","stringify","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","done","Promise","then","_asyncToGenerator","fn","self","this","args","arguments","apply","err","undefined","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","parsedResult","z","object","icon","string","title","description","fallback_currency","nullable","supports","array","square","application_id","location_id","safeParse","getSetting","success","message","payments","settings","data","decodeEntities","Square","Content","_ref","billing","eventRegistration","emitResponse","onPaymentSetup","onCheckoutFail","useEffect","_regeneratorRuntime","_callee","_yield$startTransacti","transactionId","_getErrorString","ach","note","tokenResult","_tokenResult$errors$m","_tokenResult$errors","_note","_note2","_context","prev","next","startTransaction","sent","result","abrupt","responseTypes","ERROR","redirectURI","href","t0","updateTransaction","paymentStatus","addEventListener","_event","tokenize","accountHolderName","billingAddress","first_name","last_name","status","token","errors","map","join","t1","SUCCESS","meta","paymentMethodData","peachpay_transaction_id","peachpay_square_source_id","stop","_ref3","_callee2","_data$processingRespo","_data$processingRespo2","_context2","processingResponse","paymentDetails","messageContext","noticeContexts","PAYMENTS","_x","Fragment","maxHeight","src","registerPaymentMethod","ariaLabel","canMakePayment","paymentMethods","includes","label","_props$components","components","PaymentMethodLabel","PaymentMethodIcons","text","icons","id","alt","content","edit","features"],"sourceRoot":""}