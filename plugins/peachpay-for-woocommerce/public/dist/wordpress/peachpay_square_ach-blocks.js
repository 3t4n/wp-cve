!function(){"use strict";var e={127:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(86),a=n(412),o=n(736);function c(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){if(e instanceof Error&&e.stack)return e.stack;var t=JSON.stringify(e);return t&&"{}"!==t?t:`${e}`}n.d(t,{H:function(){return r}})},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},307:function(e){e.exports=window.wp.element},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},861:function(e,t,n){function r(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var c=e.apply(t,n);function s(e){r(c,a,o,s,i,"next",e)}function i(e){r(c,a,o,s,i,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return a}})}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(861),t=n(86),r=n(284),a=n.n(r),o=n(736),c=n(613),s=n(617),i=n(629),u=n(307),p=n(22),l=n(906),m=n(127),d=p.z.object({icon:p.z.string(),title:p.z.string(),description:p.z.string(),fallback_currency:p.z.string().nullable(),supports:p.z.string().array(),square:p.z.object({application_id:p.z.string(),location_id:p.z.string()})}).safeParse((0,s.getSetting)("peachpay_square_ach_data"));if(!d.success)throw new Error(`Payment method "peachpay_square_ach" setup aborted. Invalid settings.\n\n${d.error.message}`);var f,y=d.data,h=(0,i.decodeEntities)(y.title),w=(0,i.decodeEntities)(y.description);if(!window.Square)throw new Error('Payment method "peachpay_square_ach" setup aborted. Square SDK not loaded.');try{f=window.Square.payments(y.square.application_id,y.square.location_id)}catch(e){throw new Error(`Payment method "peachpay_square_ach" setup aborted. Could not create Payments instance.\n\n${(0,l.H)(e)}`)}function _(n){var r=n.billing,c=n.eventRegistration,s=n.emitResponse,i=c.onPaymentSetup,d=c.onCheckoutFail;return(0,u.useEffect)((function(){return i((0,e.Z)(a().mark((function e(){var t,n,c,i,u,m,d,y,h,w,_;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.startTransaction)("peachpay_square_ach");case 2:if(t=e.sent,n=t.result,!(c=t.error)&&n){e.next=7;break}return e.abrupt("return",{type:s.responseTypes.ERROR,message:null!==(i=(0,l.H)(c))&&void 0!==i?i:(0,o.__)("An unknown error occured while creating the transaction.","peachpay-for-woocommerce")});case 7:return u=null,e.prev=8,e.next=11,f.ach({redirectURI:window.location.href,transactionId:n});case 11:u=e.sent,e.next=20;break;case 14:return e.prev=14,e.t0=e.catch(8),m=(0,l.H)(e.t0),e.next=19,(0,p.updateTransaction)(n,{note:m,paymentStatus:"creationfailed"});case 19:return e.abrupt("return",{type:s.responseTypes.ERROR,message:m});case 20:return u.addEventListener("ontokenization",(function(e){})),d=null,e.prev=22,e.next=25,u.tokenize({accountHolderName:r.billingAddress.first_name+" "+r.billingAddress.last_name});case 25:if("OK"===(d=e.sent).status&&d.token){e.next=32;break}return w=null!==(y=null===(h=d.errors)||void 0===h||null===(h=h.map((function(e){return e.message})))||void 0===h?void 0:h.join("<br/>"))&&void 0!==y?y:(0,o.__)("Tokenization failed. Please try again or use a different payment method.","peachpay-for-woocommerce"),"Cancel"===d.status&&(w=(0,o.__)("Payment was cancelled","peachpay-for-woocommerce")),e.next=31,(0,p.updateTransaction)(n,{note:w,paymentStatus:"creationfailed"});case 31:return e.abrupt("return",{type:s.responseTypes.ERROR,message:w});case 32:e.next=40;break;case 34:return e.prev=34,e.t1=e.catch(22),_=(0,l.H)(e.t1),e.next=39,(0,p.updateTransaction)(n,{note:_,paymentStatus:"creationfailed"});case 39:return e.abrupt("return",{type:s.responseTypes.ERROR,message:_});case 40:return e.abrupt("return",{type:s.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:n,peachpay_square_source_id:d.token}}});case 41:case"end":return e.stop()}}),e,null,[[8,14],[22,34]])}))))}),[r.billingAddress,i]),(0,u.useEffect)((function(){return d(function(){var t=(0,e.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:s.responseTypes.ERROR,message:null!==(n=null===(r=t.processingResponse)||void 0===r||null===(r=r.paymentDetails)||void 0===r?void 0:r.message)&&void 0!==n?n:(0,o.__)("An unknown error occured while processing the payment.","peachpay-for-woocommerce"),messageContext:s.noticeContexts.PAYMENTS});case 1:case"end":return e.stop()}}),e)})));return function(_x){return t.apply(this,arguments)}}())}),[d]),y.fallback_currency?(0,t.createElement)(m.Z,{name:h,currency:y.fallback_currency}):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("img",{style:{maxHeight:"25px"},src:y.icon}),(0,t.createElement)("p",{style:{textAlign:"left",margin:"0.5rem 0 0"}},h," ",(0,o.__)("selected for checkout.","peachpay-for-woocommerce")),(0,t.createElement)("hr",{style:{margin:"0.5rem 0"}}),(0,t.createElement)("p",{style:{textAlign:"left",margin:"0",fontSize:"smaller"}},w))}(0,c.registerPaymentMethod)({name:"peachpay_square_ach",ariaLabel:h,canMakePayment(e){return e.paymentMethods.includes("peachpay_square_ach")},label:(0,t.createElement)((function(e){var n=e.components,r=n.PaymentMethodLabel,a=n.PaymentMethodIcons;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(r,{text:h}),(0,t.createElement)(a,{className:"pp-label-icon",icons:[{id:"peachpay_square_ach",src:y.icon,alt:h}]}))}),null),content:(0,t.createElement)(_,null),edit:(0,t.createElement)(_,null),supports:{features:y.supports}})}()}();
//# sourceMappingURL=peachpay_square_ach-blocks.js.map