!function(){"use strict";var e={465:function(e,t,n){n.d(t,{J:function(){return u}});var r="https://js.stripe.com/v3",a=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,o="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",s=null,i=Promise.resolve().then((function(){return e=null,null!==s||(s=new Promise((function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(o),window.Stripe)t(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(r,'"]')),t=0;t<e.length;t++){var n=e[t];if(a.test(n.src))return n}return null}();s&&e?console.warn(o):s||(s=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(r).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n}(e)),s.addEventListener("load",(function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))})),s.addEventListener("error",(function(){n(new Error("Failed to load Stripe.js"))}))}catch(e){return void n(e)}else t(null)}))),s;var e})),c=!1;i.catch((function(e){c||console.warn(e)}));var u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c=!0;var r=Date.now();return i.then((function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.2.0",startTime:t})}(r,n),r}(e,t,r)}))}},127:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(86),a=n(412),o=n(736);function s(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},583:function(e,t,n){n.d(t,{Jb:function(){return u},Nm:function(){return f},Rp:function(){return l}});var r=n(861),a=n(284),o=n.n(a),s=n(465),i=n(877),c=n(22),u=function(){var e=(0,r.Z)(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){try{e((0,s.J)(t,{locale:"auto",stripeAccount:n}))}catch(t){e(t.message)}})));case 1:case"end":return e.stop()}}),e)})));return function(_x,t){return e.apply(this,arguments)}}(),p=c.z.object({setup_intent_details:c.z.object({client_secret:c.z.string()})});function l(e){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(o().mark((function e(t){var n,r,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("security",t.setup_intent_nonce),n.append("payment_method_type",t.payment_method_type),t.payment_method_ID&&n.append("payment_method",t.payment_method_ID),e.next=6,(0,i.Fi)(t.setup_intent_url,{method:"POST",body:n});case 6:if(r=e.sent,a=r.error,s=r.result,!a&&null!=s&&s.data){e.next=11;break}return e.abrupt("return",null);case 11:if((c=p.safeParse(s.data)).success){e.next=14;break}return e.abrupt("return",null);case 14:return e.abrupt("return",c.data);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var t,n=c.z.object({data:c.z.object({client_secret:c.z.string()}),intermediate_url:c.z.string(),success_url:c.z.string(),transaction_id:c.z.string()});try{t=JSON.parse(atob(decodeURIComponent(e)))}catch(e){return console.error(e),null}var r=n.safeParse(t);return r.success?r.data:(console.error(r.error),null)}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){if(e instanceof Error&&e.stack)return e.stack;var t=JSON.stringify(e);return t&&"{}"!==t?t:`${e}`}function a(e){return function(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message}(e))return e;try{return new Error(JSON.stringify(e))}catch(t){return new Error(String(e))}}(e).message}n.d(t,{H:function(){return r},e:function(){return a}})},877:function(e,t,n){n.d(t,{Fi:function(){return s}});var r=n(861),a=n(284),o=n.n(a);function s(e,t){return i.apply(this,arguments)}function i(){return i=(0,r.Z)(o().mark((function e(t,n){var a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:/\{\s*"[\s\S]*[^{}]*\}/g,e.abrupt("return",fetch(t,n).then(function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.text());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){try{return{result:JSON.parse(e)}}catch(n){var t=a.exec(e);return null!==t&&t[0]?(console.log("Fixed malformed JSON. Original:"),console.log(e),{result:JSON.parse(t[0])}):(console.log("Unable to fix malformed JSON"),{error:n})}})).catch((function(e){return{error:e}})));case 2:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},907:function(e,t,n){function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},878:function(e,t,n){function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},861:function(e,t,n){function r(e,t,n,r,a,o,s){try{var i=e[o](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var s=e.apply(t,n);function i(e){r(s,a,o,i,c,"next",e)}function c(e){r(s,a,o,i,c,"throw",e)}i(void 0)}))}}n.d(t,{Z:function(){return a}})},902:function(e,t,n){function r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,s,i=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw a}}return i}}n.d(t,{Z:function(){return r}})},267:function(e,t,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},324:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(878),a=n(902),o=n(181),s=n(267);function i(e,t){return(0,r.Z)(e)||(0,a.Z)(e,t)||(0,o.Z)(e,t)||(0,s.Z)()}},181:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(324),t=n(861),r=n(86),a=n(284),o=n.n(a),s=n(736),i=n(613),c=n(617),u=n(629),p=n(583),l=n(22),d=n(127),f=n(906),m=l.z.object({title:l.z.string(),icon_url:l.z.string(),conditions:l.z.string(),supports:l.z.string().array(),connect_id:l.z.string(),public_key:l.z.string(),setup_intent_url:l.z.string(),setup_intent_nonce:l.z.string(),currency_fallback_required:l.z.string().nullable()}).safeParse((0,c.getSetting)("peachpay_stripe_sepadebit_data",!1));if(!m.success)throw new Error(`PeachPay Stripe SEPA Direct Debit data is not available.\n\n${m.error.message}`);var y=m.data,_=(0,u.decodeEntities)(y.title);(0,p.Jb)(y.public_key,y.connect_id).then((function(n){if(null===n)throw new Error("Stripe is null");if("string"==typeof n)throw new Error(n);var a=n.elements().create("iban",{style:{base:{color:"#32325d",fontSize:"16px"}},supportedCountries:["SEPA"]}),c=function(i){var c=i.emitResponse,u=i.eventRegistration,m=i.billing,h=u.onPaymentSetup,b=u.onCheckoutSuccess,g=u.onCheckoutFail,v=(0,r.useRef)(null);return(0,r.useEffect)((function(){v.current&&(v.current.innerHTML="",a.mount(v.current))}),[]),(0,r.useEffect)((function(){return h((0,t.Z)(o().mark((function e(){var t,r,i,u,d,_,h,b,g,v,w,x,S,E,R,k,T,A,O;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.startTransaction)("peachpay_stripe_sepadebit");case 2:if(t=e.sent,r=t.result,!(i=t.error)){e.next=7;break}return e.abrupt("return",{type:c.responseTypes.ERROR,message:(0,f.e)(i)});case 7:if(void 0!==r){e.next=9;break}return e.abrupt("return",{type:c.responseTypes.ERROR,message:(0,s.__)("Missing transaction ID","peachpay-for-woocommerce")});case 9:return e.prev=9,e.next=12,n.createPaymentMethod({type:"sepa_debit",sepa_debit:a,billing_details:{address:{city:m.billingAddress.city,country:m.billingAddress.country,line1:m.billingAddress.address_1,line2:m.billingAddress.address_2,postal_code:m.billingAddress.postcode,state:m.billingAddress.state},email:m.billingAddress.email,name:m.billingAddress.first_name+" "+m.billingAddress.last_name,phone:m.billingAddress.phone}});case 12:if(u=e.sent,d=u.paymentMethod,!(_=u.error)){e.next=20;break}return b=null!==(h=_.message)&&void 0!==h?h:(0,s.__)("Failed to tokenize payment method.","peachpay-for-woocommerce"),e.next=19,(0,l.updateTransaction)(r,{note:b});case 19:return e.abrupt("return",{type:c.responseTypes.ERROR,message:b});case 20:if(d.id){e.next=25;break}return g=(0,s.__)("Failed to tokenize payment method, ID missing.","peachpay-for-woocommerce"),e.next=24,(0,l.updateTransaction)(r,{note:g});case 24:return e.abrupt("return",{type:c.responseTypes.ERROR,message:g});case 25:if(!(m.cartTotal.value>0)){e.next=27;break}return e.abrupt("return",{type:c.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r,peachpay_stripe_payment_method_id:d.id}}});case 27:return e.next=29,(0,p.Rp)({payment_method_type:"sepa_debit",payment_method_ID:d.id,setup_intent_url:y.setup_intent_url,setup_intent_nonce:y.setup_intent_nonce});case 29:if(null!==(v=e.sent)){e.next=35;break}return w=(0,s.__)("Failed to create setup intent.","peachpay-for-woocommerce"),e.next=34,(0,l.updateTransaction)(r,{note:w});case 34:return e.abrupt("return",{type:c.responseTypes.ERROR,message:w});case 35:return e.next=37,n.confirmSepaDebitSetup(v.setup_intent_details.client_secret,{payment_method:{sepa_debit:a,billing_details:{name:m.billingAddress.first_name+" "+m.billingAddress.last_name,email:m.billingAddress.email}}});case 37:if(x=e.sent,S=x.error,E=x.setupIntent,!S){e.next=45;break}return k=null!==(R=S.message)&&void 0!==R?R:(0,s.__)("Failed to confirm setup intent.","peachpay-for-woocommerce"),e.next=44,(0,l.updateTransaction)(r,{note:k});case 44:return e.abrupt("return",{type:c.responseTypes.ERROR,message:k});case 45:if("succeeded"===E.status){e.next=50;break}return T=`${(0,s.__)("Setup intent resulted in invalid status","peachpay-for-woocommerce")} (${E.status})`,e.next=49,(0,l.updateTransaction)(r,{note:T});case 49:return e.abrupt("return",{type:c.responseTypes.ERROR,message:T});case 50:if("object"!=typeof E.payment_method&&null!==E.payment_method){e.next=55;break}return A=`${(0,s.__)("Payment method invalid type","peachpay-for-woocommerce")} (${typeof E.payment_method})`,e.next=54,(0,l.updateTransaction)(r,{note:A});case 54:return e.abrupt("return",{type:c.responseTypes.ERROR,message:A});case 55:return e.abrupt("return",{type:c.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r,peachpay_stripe_payment_method_id:E.payment_method}}});case 58:return e.prev=58,e.t0=e.catch(9),O=(0,f.H)(e.t0),e.next=63,(0,l.updateTransaction)(r,{note:O});case 63:return e.abrupt("return",{type:c.responseTypes.ERROR,message:O});case 64:case"end":return e.stop()}}),e,null,[[9,58]])}))))}),[h,m.billingAddress,m.cartTotal]),(0,r.useEffect)((function(){var r=b(function(){var r=(0,t.Z)(o().mark((function t(r){var a,i,u,l,d,f,m,y,_,h,b,g,v,w,x,S;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=new URL(r.redirectUrl),i=a.hash.split("="),u=(0,e.Z)(i,2),l=u[0],d=u[1],""!==a.hash&&"#payment_data"===l&&d){t.next=4;break}return t.abrupt("return");case 4:if(null!==(f=(0,p.Nm)(d))){t.next=7;break}return t.abrupt("return",{type:c.responseTypes.ERROR,message:(0,s.__)("Failed to parse payment data","peachpay-for-woocommerce")});case 7:return m=f.data.client_secret,y=f.success_url,t.next=11,n.retrievePaymentIntent(m);case 11:if(_=t.sent,h=_.paymentIntent,b=_.error,h&&!b){t.next=16;break}return t.abrupt("return",{type:c.responseTypes.ERROR,message:null!==(g=null==b?void 0:b.message)&&void 0!==g?g:(0,s.__)("Failed to retrieve payment intent.","peachpay-for-woocommerce"),messageContext:c.noticeContexts.PAYMENTS});case 16:if("succeeded"!==h.status&&"requires_capture"!==h.status&&"processing"!==h.status){t.next=18;break}return t.abrupt("return",{type:c.responseTypes.SUCCESS,redirectUrl:y});case 18:if("requires_action"!==h.status){t.next=28;break}return t.next=21,n.confirmSepaDebitPayment(m);case 21:if(v=t.sent,w=v.paymentIntent,x=v.error,w&&!x){t.next=26;break}return t.abrupt("return",{type:c.responseTypes.ERROR,message:null!==(S=null==x?void 0:x.message)&&void 0!==S?S:(0,s.__)("Failed to confirm payment intent.","peachpay-for-woocommerce"),messageContext:c.noticeContexts.PAYMENTS});case 26:if("succeeded"!==w.status&&"requires_capture"!==w.status&&"processing"!==w.status){t.next=28;break}return t.abrupt("return",{type:c.responseTypes.SUCCESS,redirectUrl:y});case 28:return t.abrupt("return",{type:c.responseTypes.ERROR,message:(0,s.__)("Something went wrong, but the payment may have gone through. Please contact store support.","peachpay-for-woocommerce"),messageContext:c.noticeContexts.PAYMENTS});case 29:case"end":return t.stop()}}),t)})));return function(_x){return r.apply(this,arguments)}}());return r}),[b]),(0,r.useEffect)((function(){return g((function(e){var t,n;return(null===(t=e.processingResponse)||void 0===t?void 0:t.paymentStatus)===c.responseTypes.FAIL?{type:c.responseTypes.FAIL,message:e.processingResponse.paymentDetails.message,messageContext:c.noticeContexts.PAYMENTS}:"not set"===(null===(n=e.processingResponse)||void 0===n?void 0:n.paymentStatus)&&e.processingResponse.message?{type:"not set",message:e.processingResponse.message,messageContext:c.noticeContexts.CHECKOUT}:{type:c.responseTypes.ERROR,message:(0,s.__)("Something went wrong while processing the request.","peachpay-for-woocommerce"),messageContext:c.noticeContexts.PAYMENTS}}))}),[g]),y.currency_fallback_required?(0,r.createElement)(d.Z,{name:_,currency:y.currency_fallback_required}):(0,r.createElement)("div",null,(0,r.createElement)("div",{ref:v},"Loading..."),(0,r.createElement)("p",{style:{fontSize:"smaller",textAlign:"justify",paddingTop:"16px"}},y.conditions))};(0,i.registerPaymentMethod)({ariaLabel:_,canMakePayment(e){return e.paymentMethods.includes("peachpay_stripe_sepadebit")},content:(0,r.createElement)(c,null),edit:(0,r.createElement)(c,null),label:(0,r.createElement)((function(e){var t=e.components,n=t.PaymentMethodLabel,a=t.PaymentMethodIcons;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(n,{text:_}),(0,r.createElement)(a,{icons:[{id:"peachpay_stripe_sepadebit",src:y.icon_url,alt:_}],className:"pp-label-icon"}))}),null),name:"peachpay_stripe_sepadebit",supports:{features:y.supports}})})).catch((function(e){throw e}))}()}();
//# sourceMappingURL=peachpay_stripe_sepadebit-blocks.js.map