!function(){"use strict";var e={465:function(e,t,n){n.d(t,{J:function(){return u}});var r="https://js.stripe.com/v3",a=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,o="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",s=null,c=Promise.resolve().then((function(){return e=null,null!==s||(s=new Promise((function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(o),window.Stripe)t(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(r,'"]')),t=0;t<e.length;t++){var n=e[t];if(a.test(n.src))return n}return null}();s&&e?console.warn(o):s||(s=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(r).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n}(e)),s.addEventListener("load",(function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))})),s.addEventListener("error",(function(){n(new Error("Failed to load Stripe.js"))}))}catch(e){return void n(e)}else t(null)}))),s;var e})),i=!1;c.catch((function(e){i||console.warn(e)}));var u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i=!0;var r=Date.now();return c.then((function(e){return function(e,t,n){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.2.0",startTime:t})}(r,n),r}(e,t,r)}))}},127:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(86),a=n(412),o=n(736);function s(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},583:function(e,t,n){n.d(t,{Jb:function(){return u},Nm:function(){return f},Rp:function(){return l}});var r=n(861),a=n(284),o=n.n(a),s=n(465),c=n(877),i=n(22),u=function(){var e=(0,r.Z)(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){try{e((0,s.J)(t,{locale:"auto",stripeAccount:n}))}catch(t){e(t.message)}})));case 1:case"end":return e.stop()}}),e)})));return function(_x,t){return e.apply(this,arguments)}}(),p=i.z.object({setup_intent_details:i.z.object({client_secret:i.z.string()})});function l(e){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(o().mark((function e(t){var n,r,a,s,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("security",t.setup_intent_nonce),n.append("payment_method_type",t.payment_method_type),t.payment_method_ID&&n.append("payment_method",t.payment_method_ID),e.next=6,(0,c.Fi)(t.setup_intent_url,{method:"POST",body:n});case 6:if(r=e.sent,a=r.error,s=r.result,!a&&null!=s&&s.data){e.next=11;break}return e.abrupt("return",null);case 11:if((i=p.safeParse(s.data)).success){e.next=14;break}return e.abrupt("return",null);case 14:return e.abrupt("return",i.data);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var t,n=i.z.object({data:i.z.object({client_secret:i.z.string()}),intermediate_url:i.z.string(),success_url:i.z.string(),transaction_id:i.z.string()});try{t=JSON.parse(atob(decodeURIComponent(e)))}catch(e){return console.error(e),null}var r=n.safeParse(t);return r.success?r.data:(console.error(r.error),null)}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){return function(e){if(function(e){return"object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message}(e))return e;try{return new Error(JSON.stringify(e))}catch(t){return new Error(String(e))}}(e).message}n.d(t,{e:function(){return r}})},877:function(e,t,n){n.d(t,{Fi:function(){return s}});var r=n(861),a=n(284),o=n.n(a);function s(e,t){return c.apply(this,arguments)}function c(){return c=(0,r.Z)(o().mark((function e(t,n){var a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:/\{\s*"[\s\S]*[^{}]*\}/g,e.abrupt("return",fetch(t,n).then(function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.text());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){try{return{result:JSON.parse(e)}}catch(n){var t=a.exec(e);return null!==t&&t[0]?(console.log("Fixed malformed JSON. Original:"),console.log(e),{result:JSON.parse(t[0])}):(console.log("Unable to fix malformed JSON"),{error:n})}})).catch((function(e){return{error:e}})));case 2:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},907:function(e,t,n){function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},878:function(e,t,n){function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},861:function(e,t,n){function r(e,t,n,r,a,o,s){try{var c=e[o](s),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var s=e.apply(t,n);function c(e){r(s,a,o,c,i,"next",e)}function i(e){r(s,a,o,c,i,"throw",e)}c(void 0)}))}}n.d(t,{Z:function(){return a}})},902:function(e,t,n){function r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,s,c=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=o.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw a}}return c}}n.d(t,{Z:function(){return r}})},267:function(e,t,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},324:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(878),a=n(902),o=n(181),s=n(267);function c(e,t){return(0,r.Z)(e)||(0,a.Z)(e,t)||(0,o.Z)(e,t)||(0,s.Z)()}},181:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"==typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(324),t=n(861),r=n(86),a=n(284),o=n.n(a),s=n(736),c=n(613),i=n(617),u=n(583),p=n(22),l=n(127),d=n(906),f=n(629),m=p.z.object({icon:p.z.string(),title:p.z.string(),description:p.z.string(),supports:p.z.string().array(),connect_id:p.z.string(),public_key:p.z.string(),setup_intent_url:p.z.string(),setup_intent_nonce:p.z.string(),currency_fallback_required:p.z.union([p.z.string(),p.z.null()])}).safeParse((0,i.getSetting)("peachpay_stripe_card_data",!1));if(!m.success)throw console.error(m.error),new Error((0,s.__)("PeachPay Stripe Card data is not available","peachpay-for-woocommerce"));var y=m.data,_=(0,f.decodeEntities)(y.title),h=(0,f.decodeEntities)(y.description);(0,u.Jb)(y.public_key,y.connect_id).then((function(n){if(null===n)throw new Error((0,s.__)("Stripe is null","peachpay-for-woocommerce"));if("string"==typeof n)throw new Error(n);var a=n.elements().create("card",{style:{base:{color:"#333",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#6a6a6a"}}},hidePostalCode:!0}),i=function(c){var i=c.emitResponse,f=c.eventRegistration,m=c.billing,v=f.onPaymentSetup,b=f.onCheckoutSuccess,g=f.onCheckoutFail,w=(0,r.useRef)(null);return(0,r.useEffect)((function(){w.current&&(w.current.innerHTML="",a.mount(w.current))}),[]),(0,r.useEffect)((function(){return v((0,t.Z)(o().mark((function e(){var t,r,c,l,f,_,h,v,b,g,w,x,S,E;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,p.startTransaction)("peachpay_stripe_card");case 3:if(!(t=e.sent).error){e.next=6;break}return e.abrupt("return",{type:i.responseTypes.ERROR,message:(0,d.e)(t.error)});case 6:if(void 0!==t.result){e.next=8;break}return e.abrupt("return",{type:i.responseTypes.ERROR,message:(0,s.__)("Missing transaction ID","peachpay-for-woocommerce")});case 8:return r=t.result,e.next=11,n.createPaymentMethod({type:"card",card:a,billing_details:{address:{city:m.billingAddress.city,country:m.billingAddress.country,line1:m.billingAddress.address_1,line2:m.billingAddress.address_2,postal_code:m.billingAddress.postcode,state:m.billingAddress.state},email:m.billingAddress.email,name:m.billingAddress.first_name+" "+m.billingAddress.last_name,phone:m.billingAddress.phone}});case 11:if(!(c=e.sent).error){e.next=17;break}return f=null!==(l=c.error.message)&&void 0!==l?l:(0,s.__)("Failed to tokenize payment method.","peachpay-for-woocommerce"),e.next=16,(0,p.updateTransaction)(r,{paymentStatus:"creationfailed",note:f});case 16:return e.abrupt("return",{type:i.responseTypes.ERROR,message:f});case 17:if(!(m.cartTotal.value>0)){e.next=19;break}return e.abrupt("return",{type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r,peachpay_stripe_payment_method_id:c.paymentMethod.id}}});case 19:return e.next=21,(0,u.Rp)({payment_method_type:"card",payment_method_ID:c.paymentMethod.id,setup_intent_url:y.setup_intent_url,setup_intent_nonce:y.setup_intent_nonce});case 21:if(null!==(_=e.sent)){e.next=27;break}return h=(0,s.__)("Failed to create setup intent.","peachpay-for-woocommerce"),e.next=26,(0,p.updateTransaction)(r,{paymentStatus:"creationfailed",note:h});case 26:return e.abrupt("return",{type:i.responseTypes.ERROR,message:h});case 27:return e.next=29,n.confirmCardSetup(_.setup_intent_details.client_secret);case 29:if(v=e.sent,b=v.error,g=v.setupIntent,!b){e.next=37;break}return x=null!==(w=b.message)&&void 0!==w?w:(0,s.__)("Failed to confirm setup intent.","peachpay-for-woocommerce"),e.next=36,(0,p.updateTransaction)(r,{paymentStatus:"creationfailed",note:x});case 36:return e.abrupt("return",{type:i.responseTypes.ERROR,message:x});case 37:if("succeeded"===g.status){e.next=42;break}return S=(0,s.__)("Setup intent resulted in invalid status","peachpay-for-woocommerce")+`(${g.status})`,e.next=41,(0,p.updateTransaction)(r,{paymentStatus:"creationfailed",note:S});case 41:return e.abrupt("return",{type:i.responseTypes.ERROR,message:S});case 42:if("object"!=typeof g.payment_method&&null!==g.payment_method){e.next=47;break}return E=(0,s.__)("Payment method invalid type:","peachpay-for-woocommerce")+`(${typeof g.payment_method})`,e.next=46,(0,p.updateTransaction)(r,{paymentStatus:"creationfailed",note:E});case 46:return e.abrupt("return",{type:i.responseTypes.ERROR,message:E});case 47:return e.abrupt("return",{type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r,peachpay_stripe_payment_method_id:g.payment_method}}});case 50:return e.prev=50,e.t0=e.catch(0),e.abrupt("return",{type:i.responseTypes.ERROR,message:e.t0.message});case 53:case"end":return e.stop()}}),e,null,[[0,50]])}))))}),[m.billingAddress,m.cartTotal.value,v]),(0,r.useEffect)((function(){var r=b(function(){var r=(0,t.Z)(o().mark((function t(r){var a,c,p,l,d,f,m,y,_,h,v,b,g,w,x,S;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=new URL(r.redirectUrl),c=a.hash.split("="),p=(0,e.Z)(c,2),l=p[0],d=p[1],""!==a.hash&&"#payment_data"===l&&d){t.next=4;break}return t.abrupt("return");case 4:if(null!==(f=(0,u.Nm)(d))){t.next=7;break}return t.abrupt("return",{type:i.responseTypes.ERROR,message:(0,s.__)("Failed to parse payment data","peachpay-for-woocommerce")});case 7:return m=f.data.client_secret,y=f.success_url,t.next=11,n.retrievePaymentIntent(m);case 11:if(_=t.sent,h=_.paymentIntent,!(v=_.error)){t.next=16;break}return t.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(b=null==v?void 0:v.message)&&void 0!==b?b:(0,s.__)("Failed to retrieve payment intent.","peachpay-for-woocommerce"),messageContext:i.noticeContexts.PAYMENTS});case 16:if("succeeded"!==h.status&&"requires_capture"!==h.status){t.next=18;break}return t.abrupt("return",{type:i.responseTypes.SUCCESS,redirectUrl:y});case 18:if("requires_action"!==h.status){t.next=29;break}return t.next=21,n.confirmCardPayment(m);case 21:if(g=t.sent,w=g.paymentIntent,!(x=g.error)){t.next=26;break}return t.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(S=null==x?void 0:x.message)&&void 0!==S?S:(0,s.__)("Failed to confirm payment intent.","peachpay-for-woocommerce"),messageContext:i.noticeContexts.PAYMENTS});case 26:if("succeeded"!==w.status&&"requires_capture"!==w.status){t.next=28;break}return t.abrupt("return",{type:i.responseTypes.SUCCESS,redirectUrl:y});case 28:return t.abrupt("return",{type:i.responseTypes.ERROR,message:(0,s.__)("Confirmed payment intent invalid status:","peachpay-for-woocommerce")+`${w.status}`,messageContext:i.noticeContexts.PAYMENTS});case 29:return t.abrupt("return",{type:i.responseTypes.ERROR,message:(0,s.__)("Failed to confirm payment intent with status:","peachpay-for-woocommerce")+`${h.status}`,messageContext:i.noticeContexts.PAYMENTS});case 30:case"end":return t.stop()}}),t)})));return function(_x){return r.apply(this,arguments)}}());return r}),[b]),(0,r.useEffect)((function(){return g((function(e){var t,n,r;return(null===(t=e.processingResponse)||void 0===t?void 0:t.paymentStatus)===i.responseTypes.FAIL?{type:i.responseTypes.FAIL,message:e.processingResponse.paymentDetails.message,messageContext:i.noticeContexts.PAYMENTS}:{type:i.responseTypes.FAIL,message:null!==(n=null===(r=e.processingResponse)||void 0===r?void 0:r.message)&&void 0!==n?n:(0,s.__)("Checkout failed unexpectedly","peachpay-for-woocommerce")+`${JSON.stringify(e)}`,messageContext:i.noticeContexts.PAYMENTS}}))}),[g]),y.currency_fallback_required?(0,r.createElement)("div",null,(0,r.createElement)(l.Z,{name:_,currency:y.currency_fallback_required})):(0,r.createElement)("div",null,(0,r.createElement)("div",{style:{marginBottom:"0.5rem"}},h),(0,r.createElement)("div",{ref:w},"Loading..."))};(0,c.registerPaymentMethod)({ariaLabel:_,canMakePayment(e){return e.paymentMethods.includes("peachpay_stripe_card")},content:(0,r.createElement)(i,null),edit:(0,r.createElement)(i,null),label:(0,r.createElement)((function(e){var t=e.components,n=t.PaymentMethodLabel,a=t.PaymentMethodIcons;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(n,{text:_}),(0,r.createElement)(a,{className:"pp-label-icon",icons:[{id:"peachpay_stripe_card",src:y.icon,alt:y.title}]}))}),null),savedTokenComponent:(0,r.createElement)((function(e){var n=e.emitResponse,a=e.eventRegistration.onPaymentSetup;(0,r.useEffect)((function(){return a((0,t.Z)(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,p.startTransaction)("peachpay_stripe_card");case 3:if(!(r=t.sent).error&&r.result){t.next=6;break}throw r.error;case 6:return t.abrupt("return",{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r.result,"wc-peachpay_stripe_card-payment-token":e.token}}});case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",{type:n.responseTypes.ERROR,message:t.t0.message});case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))))}),[e,a])}),null),name:"peachpay_stripe_card",supports:{features:y.supports,showSavedCards:!y.currency_fallback_required,showSaveOption:!y.currency_fallback_required}})})).catch((function(e){throw e}))}()}();
//# sourceMappingURL=peachpay_stripe_card-blocks.js.map