!function(){"use strict";var e={127:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(86),a=n(412),o=n(736);function c(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){if(e instanceof Error&&e.stack)return e.stack;var t=JSON.stringify(e);return t&&"{}"!==t?t:`${e}`}n.d(t,{H:function(){return r}})},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},307:function(e){e.exports=window.wp.element},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},861:function(e,t,n){function r(e,t,n,r,a,o,c){try{var s=e[o](c),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var c=e.apply(t,n);function s(e){r(c,a,o,s,u,"next",e)}function u(e){r(c,a,o,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return a}})}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(861),t=n(86),r=n(284),a=n.n(r),o=n(736),c=n(613),s=n(617),u=n(629),i=n(307),l=n(22),p=n(906),d=n(127),f=l.z.object({icon:l.z.string(),title:l.z.string(),description:l.z.string(),fallback_currency:l.z.string().nullable(),supports:l.z.string().array(),square:l.z.object({application_id:l.z.string(),location_id:l.z.string()})}).safeParse((0,s.getSetting)("peachpay_square_card_data"));if(!f.success)throw new Error(`Payment method "peachpay_square_card" setup aborted. Invalid settings.\n\n${f.error.message}`);var m,y=f.data,h=(0,u.decodeEntities)(y.title),v=(0,u.decodeEntities)(y.description);if(!window.Square)throw new Error('Payment method "peachpay_square_card" setup aborted. Square SDK not loaded.');try{m=window.Square.payments(y.square.application_id,y.square.location_id)}catch(e){throw new Error(`Payment method "peachpay_square_card" setup aborted. Could not create Payments instance.\n\n${(0,p.H)(e)}`)}function _(n){var r=n.billing,c=n.eventRegistration,s=n.emitResponse,u=c.onPaymentSetup,f=c.onCheckoutFail,_=(0,i.useRef)(null),b=(0,i.useRef)(null);return(0,i.useEffect)((function(){var t=function(){var t=(0,e.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==b.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,m.card();case 4:return _.current=e.sent,new ResizeObserver((function(){var e;null===(e=_.current)||void 0===e||e.recalculateSize()})).observe(b.current),e.next=9,_.current.attach(b.current);case 9:null===(t=b.current.querySelector(".pp-loading-blur"))||void 0===t||t.remove();case 10:case"end":return e.stop()}}),e)})));return function(){return t.apply(this,arguments)}}();return t().catch(console.error),function(){var e;null===(e=_.current)||void 0===e||e.detach().then((function(){var e;return null===(e=_.current)||void 0===e?void 0:e.destroy()})).catch(console.error)}}),[]),(0,i.useEffect)((function(){return u((0,e.Z)(a().mark((function e(){var t,n,c,u,i,d,f,y,h,v,b,w,g,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.startTransaction)("peachpay_square_card");case 2:if(t=e.sent,n=t.result,!(c=t.error)&&n){e.next=7;break}return e.abrupt("return",{type:s.responseTypes.ERROR,message:null!==(u=(0,p.H)(c))&&void 0!==u?u:(0,o.__)("An unknown error occured while creating the transaction.","peachpay-for-woocommerce")});case 7:if(_.current){e.next=12;break}return i=(0,o.__)("Missing ref to Square card element. Please try again or use a different payment method.","peachpay-for-woocommerce"),e.next=11,(0,l.updateTransaction)(n,{note:i,paymentStatus:"creationfailed"});case 11:return e.abrupt("return",{type:s.responseTypes.ERROR,message:i});case 12:return d=null,e.prev=13,e.next=16,_.current.tokenize();case 16:if("OK"===(d=e.sent).status&&d.token){e.next=22;break}return h=null!==(f=null===(y=d.errors)||void 0===y||null===(y=y.map((function(e){return e.message})))||void 0===y?void 0:y.join("<br/>"))&&void 0!==f?f:(0,o.__)("Card tokenization failed. Please try again or use a different payment method.","peachpay-for-woocommerce"),e.next=21,(0,l.updateTransaction)(n,{note:h,paymentStatus:"creationfailed"});case 21:return e.abrupt("return",{type:s.responseTypes.ERROR,message:h});case 22:e.next=30;break;case 24:return e.prev=24,e.t0=e.catch(13),v=(0,p.H)(e.t0),e.next=29,(0,l.updateTransaction)(n,{note:v,paymentStatus:"creationfailed"});case 29:return e.abrupt("return",{type:s.responseTypes.ERROR,message:v});case 30:return b=null,e.prev=31,w=function(){var e={addressLines:[r.billingAddress.address_1,r.billingAddress.address_2],city:r.billingAddress.city,countryCode:r.billingAddress.country,email:r.billingAddress.email,familyName:r.billingAddress.last_name,givenName:r.billingAddress.first_name,phone:r.billingAddress.phone,state:r.billingAddress.state,postalCode:r.billingAddress.postcode};return r.cartTotal.value>0?{intent:"CHARGE",amount:String(r.cartTotal.value),currencyCode:r.currency.code,billingContact:e}:{intent:"STORE",billingContact:e}},e.next=35,m.verifyBuyer(d.token,w());case 35:if(b=e.sent){e.next=41;break}return g=(0,o.__)("Card verification failed. Please try again or use a different payment method.","peachpay-for-woocommerce"),e.next=40,(0,l.updateTransaction)(n,{note:g,paymentStatus:"creationfailed"});case 40:return e.abrupt("return",{type:s.responseTypes.ERROR,message:g});case 41:e.next=50;break;case 43:return e.prev=43,e.t1=e.catch(31),x=(0,p.H)(e.t1),e.t1 instanceof Error&&"VerifyBuyerError"===e.t1.name&&(x=(0,o.__)("Card verification failed or was canceled by the buyer.","peachpay-for-woocommerce")),e.next=49,(0,l.updateTransaction)(n,{note:x,paymentStatus:"creationfailed"});case 49:return e.abrupt("return",{type:s.responseTypes.ERROR,message:x});case 50:return e.abrupt("return",{type:s.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:n,peachpay_square_source_id:d.token,peachpay_square_verification_id:b.token}}});case 51:case"end":return e.stop()}}),e,null,[[13,24],[31,43]])}))))}),[r.billingAddress,r.cartTotal.value,r.currency.code,u]),(0,i.useEffect)((function(){return f(function(){var t=(0,e.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:s.responseTypes.ERROR,message:null!==(n=null===(r=t.processingResponse)||void 0===r||null===(r=r.paymentDetails)||void 0===r?void 0:r.message)&&void 0!==n?n:(0,o.__)("An unknown error occured while processing the payment.","peachpay-for-woocommerce"),messageContext:s.noticeContexts.PAYMENTS});case 1:case"end":return e.stop()}}),e)})));return function(_x){return t.apply(this,arguments)}}())}),[f]),y.fallback_currency?(0,t.createElement)(d.Z,{name:h,currency:y.fallback_currency}):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,v),(0,t.createElement)("div",{ref:b},(0,t.createElement)("div",{className:"pp-loading-blur",style:{height:"5rem"}})))}(0,c.registerPaymentMethod)({name:"peachpay_square_card",ariaLabel:h,canMakePayment(e){return e.paymentMethods.includes("peachpay_square_card")},label:(0,t.createElement)((function(e){var n=e.components,r=n.PaymentMethodLabel,a=n.PaymentMethodIcons;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(r,{text:h}),(0,t.createElement)(a,{className:"pp-label-icon",icons:[{id:"peachpay_square_card",src:y.icon,alt:h}]}))}),null),content:(0,t.createElement)(_,null),savedTokenComponent:(0,t.createElement)((function(t){var n=t.emitResponse,r=t.eventRegistration,o=t.token,c=r.onPaymentSetup;(0,i.useEffect)((function(){return c((0,e.Z)(a().mark((function e(){var t,r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.startTransaction)("peachpay_square_card");case 2:if(t=e.sent,r=t.result,!(c=t.error)&&r){e.next=7;break}return e.abrupt("return",{type:n.responseTypes.ERROR,message:(0,p.H)(c)});case 7:return e.abrupt("return",{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:r,"wc-peachpay_square_card-payment-token":o}}});case 8:case"end":return e.stop()}}),e)}))))}),[c])}),null),edit:(0,t.createElement)(_,null),supports:{features:y.supports,showSavedCards:!y.fallback_currency,showSaveOption:!y.fallback_currency}})}()}();
//# sourceMappingURL=peachpay_square_card-blocks.js.map