!function(){"use strict";var e={127:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(86),a=n(412),o=n(736);function c(e){return e.currency?(0,r.createElement)("div",{style:{display:"flex",flexDirection:"column"}},(0,r.createElement)("p",{style:{textAlign:"justify",margin:"0.5rem 0 0",fontSize:"smaller"}},e.name," ",(0,o.__)("does not support the currency you currently have chosen.","peachpay-for-woocommerce")," ",(0,r.createElement)("b",null,(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)," ",(0,o.__)("below to use this payment method.","peachpay-for-woocommerce")),(0,r.createElement)("button",{type:"button",className:"button currency-fallback-button",style:{fontSize:"smaller",marginBottom:"16px"},onClick:function(){e.currency&&((0,a.k)(e.currency),window.location.reload())}},(0,o.__)("Update to","peachpay-for-woocommerce")," ",e.currency)):null}},894:function(e,t,n){n.d(t,{d:function(){return a}});var r=["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","UGX","VND","VUV","XAF","XOF","XPF"];function a(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Number.parseInt(e),c=Number.parseInt(t);return a&&(o+=c),r.includes(n)||(o/=100),o.toFixed(2)}},526:function(e,t,n){n.d(t,{f:function(){return o}});var r=n(894);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){return{countryCode:e.merchantCountry,currencyCode:e.currency,lineItems:c(e),discounts:u(e),taxLineItems:i(e),shippingLineItems:s(e),total:l(e),requestBillingContact:!1,requestShippingContact:!1}}function c(e){var t,n=new Array,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,c=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw c}}}}(e.items);try{for(o.s();!(t=o.n()).done;){var c=t.value;n.push({id:c.sku,label:c.name+" Ã— "+c.quantity,amount:(0,r.d)(c.totals.line_subtotal,c.totals.line_subtotal_tax,c.totals.currency_code,e.displayPricesIncludingTax)})}}catch(e){o.e(e)}finally{o.f()}return n}function u(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];if("total_discount"===o.key&&0!==o.value){var c=String(e.displayPricesIncludingTax?o.valueWithTax:o.value);t.push({label:o.label,amount:(0,r.d)(c,"0",e.currency)})}}return t}function i(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];"total_tax"===o.key&&0!==o.value&&t.push({label:o.label,amount:(0,r.d)(String(o.value),"0",e.currency)})}return t}function s(e){for(var t=new Array,n=0,a=e.summary;n<a.length;n++){var o=a[n];"total_shipping"===o.key&&0!==o.value&&t.push({label:o.label,amount:(0,r.d)(String(o.value),"0",e.currency)})}return t}function l(e){return{label:e.total.label,amount:(0,r.d)(String(e.total.value),"0",e.currency)}}},412:function(e,t,n){function r(e){document.cookie=`pp_active_currency=${e};path=/`}n.d(t,{k:function(){return r}})},906:function(e,t,n){function r(e){if(e instanceof Error&&e.stack)return e.stack;var t=JSON.stringify(e);return t&&"{}"!==t?t:`${e}`}n.d(t,{H:function(){return r}})},86:function(e){e.exports=window.React},284:function(e){e.exports=window.regeneratorRuntime},22:function(e){e.exports=window.peachpay_checkout_blocks},613:function(e){e.exports=window.wc.wcBlocksRegistry},617:function(e){e.exports=window.wc.wcSettings},307:function(e){e.exports=window.wp.element},629:function(e){e.exports=window.wp.htmlEntities},736:function(e){e.exports=window.wp.i18n},861:function(e,t,n){function r(e,t,n,r,a,o,c){try{var u=e[o](c),i=u.value}catch(e){return void n(e)}u.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var c=e.apply(t,n);function u(e){r(c,a,o,u,i,"next",e)}function i(e){r(c,a,o,u,i,"throw",e)}u(void 0)}))}}n.d(t,{Z:function(){return a}})}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e=n(861),t=n(86),r=n(284),a=n.n(r),o=n(736),c=n(613),u=n(617),i=n(629),s=n(307),l=n(22),p=n(906),y=n(127),f=n(526),m=l.z.object({icon:l.z.string(),title:l.z.string(),description:l.z.string(),fallback_currency:l.z.string().nullable(),supports:l.z.string().array(),square:l.z.object({application_id:l.z.string(),location_id:l.z.string(),country_code:l.z.string()})}).safeParse((0,u.getSetting)("peachpay_square_googlepay_data"));if(!m.success)throw new Error(`Payment method "peachpay_square_googlepay" setup aborted. Invalid settings.\n\n${m.error.message}`);var d,g=m.data,h=(0,i.decodeEntities)(g.title),v=(0,i.decodeEntities)(g.description);if(!window.Square)throw new Error('Payment method "peachpay_square_googlepay" setup aborted. Square SDK not loaded.');try{d=window.Square.payments(g.square.application_id,g.square.location_id)}catch(e){throw new Error(`Payment method "peachpay_square_googlepay" setup aborted. Could not create Payments instance.\n\n${(0,p.H)(e)}`)}function w(n){var r=n.billing,c=n.cartData,u=n.eventRegistration,i=n.emitResponse,m=u.onPaymentSetup,w=u.onCheckoutFail,_=(0,s.useRef)(null),b=(0,s.useRef)(null);return(0,s.useEffect)((function(){var t=function(){var t=(0,e.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.current=d.paymentRequest((0,f.f)({merchantCountry:g.square.country_code,currency:r.currency.code,items:c.cartItems,summary:r.cartTotalItems,total:r.cartTotal,displayPricesIncludingTax:r.displayPricesIncludingTax})),e.next=3,d.googlePay(_.current);case 3:b.current=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(){return t.apply(this,arguments)}}();return t().catch(console.error),function(){var e;null===(e=b.current)||void 0===e||e.destroy().catch(console.error)}}),[]),(0,s.useEffect)((function(){var e;null===(e=_.current)||void 0===e||e.update((0,f.f)({merchantCountry:g.square.country_code,currency:r.currency.code,items:c.cartItems,summary:r.cartTotalItems,total:r.cartTotal,displayPricesIncludingTax:r.displayPricesIncludingTax}))}),[c.cartItems,r.currency.code,r.cartTotalItems,r.cartTotal,r.displayPricesIncludingTax]),(0,s.useEffect)((function(){return m((0,e.Z)(a().mark((function e(){var t,n,r,c,u,s,y,f,m,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.startTransaction)("peachpay_square_googlepay");case 2:if(t=e.sent,n=t.result,!(r=t.error)&&n){e.next=7;break}return e.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(c=(0,p.H)(r))&&void 0!==c?c:(0,o.__)("An unknown error occured while creating the transaction.","peachpay-for-woocommerce")});case 7:if(b.current){e.next=12;break}return u=(0,o.__)("Missing ref to Square Google Pay element. Please try again or use a different payment method.","peachpay-for-woocommerce"),e.next=11,(0,l.updateTransaction)(n,{note:u,paymentStatus:"creationfailed"});case 11:return e.abrupt("return",{type:i.responseTypes.ERROR,message:u});case 12:return s=null,e.prev=13,e.next=16,b.current.tokenize();case 16:if("OK"===(s=e.sent).status&&s.token){e.next=23;break}return m=null!==(y=null===(f=s.errors)||void 0===f||null===(f=f.map((function(e){return e.message})))||void 0===f?void 0:f.join("<br/>"))&&void 0!==y?y:(0,o.__)("Google Pay tokenization failed. Please try again or use a different payment method.","peachpay-for-woocommerce"),"Cancel"===s.status&&(m=(0,o.__)("Payment was cancelled","peachpay-for-woocommerce")),e.next=22,(0,l.updateTransaction)(n,{note:m,paymentStatus:"creationfailed"});case 22:return e.abrupt("return",{type:i.responseTypes.ERROR,message:m});case 23:e.next=31;break;case 25:return e.prev=25,e.t0=e.catch(13),d=(0,p.H)(e.t0),e.next=30,(0,l.updateTransaction)(n,{note:d,paymentStatus:"creationfailed"});case 30:return e.abrupt("return",{type:i.responseTypes.ERROR,message:d});case 31:return e.abrupt("return",{type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{peachpay_transaction_id:n,peachpay_square_source_id:s.token}}});case 32:case"end":return e.stop()}}),e,null,[[13,25]])}))))}),[m]),(0,s.useEffect)((function(){return w(function(){var t=(0,e.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:i.responseTypes.ERROR,message:null!==(n=null===(r=t.processingResponse)||void 0===r||null===(r=r.paymentDetails)||void 0===r?void 0:r.message)&&void 0!==n?n:(0,o.__)("An unknown error occured while processing the payment.","peachpay-for-woocommerce"),messageContext:i.noticeContexts.PAYMENTS});case 1:case"end":return e.stop()}}),e)})));return function(_x){return t.apply(this,arguments)}}())}),[w]),g.fallback_currency?(0,t.createElement)(y.Z,{name:h,currency:g.fallback_currency}):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("img",{style:{maxHeight:"25px"},src:g.icon}),(0,t.createElement)("p",{style:{textAlign:"left",margin:"0.5rem 0 0"}},h," ",(0,o.__)("selected for checkout.","peachpay-for-woocommerce")),(0,t.createElement)("hr",{style:{margin:"0.5rem 0"}}),(0,t.createElement)("p",{style:{textAlign:"left",margin:"0",fontSize:"smaller"}},v))}(0,c.registerPaymentMethod)({name:"peachpay_square_googlepay",ariaLabel:h,canMakePayment(e){return e.paymentMethods.includes("peachpay_square_googlepay")},label:(0,t.createElement)((function(e){var n=e.components,r=n.PaymentMethodLabel,a=n.PaymentMethodIcons;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(r,{text:h}),(0,t.createElement)(a,{className:"pp-label-icon",icons:[{id:"peachpay_square_googlepay",src:g.icon,alt:h}]}))}),null),content:(0,t.createElement)(w,null),edit:(0,t.createElement)(w,null),supports:{features:g.supports}})}()}();
//# sourceMappingURL=peachpay_square_googlepay-blocks.js.map