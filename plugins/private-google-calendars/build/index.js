(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.blockEditor,a=window.wp.element,s=window.wp.components,i=JSON.stringify(window.pgc_trans.fullcalendar_version>=5?{headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,listWeek"}}:{header:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"}},null,2);function c(e,t,n,a){const s=Object.assign({},e);s[n]=a;const i={};return i[t]=s,i}function l(e){try{return""===e||Object.keys(JSON.parse(e)).length>0}catch(e){return!1}}(0,t.registerBlockType)("pgc-plugin/calendar",{title:"Private Google Calendars",icon:"calendar",category:"widgets",attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",theme:"",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},edit(t){const[r,d]=(0,a.useState)(l(t.attributes.fullcalendarconfig)),[o,u]=(0,a.useState)(t.attributes.fullcalendarconfig),[p,h]=(0,a.useState)(!1),f=t.attributes.calendars;let b=0;Object.keys(f).forEach((function(e){f[e]&&(b+=1)}));const g=t.attributes.config,w=t.attributes.hideoptions,y=t.attributes.fullcalendarconfig,m=t.attributes.publiccalendarids,_=t.attributes.uncheckedcalendarids,v=function(e){t.setAttributes(c(f,"calendars",this,e))},k=function(e){t.setAttributes(c(g,"config",this,e))},E=function(e){t.setAttributes(c(w,"hideoptions",this,e))},j=function(e){d(l(e)),t.setAttributes({fullcalendarconfig:""===e?"":e})};let C=null;C=Object.keys(window.pgc_selected_calendars).map((t=>{const n=window.pgc_selected_calendars[t];return(0,e.createElement)(s.CheckboxControl,{style:{backgroundColor:n.backgroundColor},className:"pgc-sidebar-row",onChange:v.bind(t),label:n.summary,checked:t in f&&f[t]})})),C.length||C.push((0,e.createElement)("em",null,"No private calendars")),C.push((0,e.createElement)(s.HorizontalRule,null));const O=[["eventpopup",window.pgc_trans.eventpopup],["eventlink",window.pgc_trans.eventlink],["eventdescription",window.pgc_trans.eventdescription],["eventlocation",window.pgc_trans.eventlocation],["eventattendees",window.pgc_trans.eventattendees],["eventattachments",window.pgc_trans.eventattachments],["eventcreator",window.pgc_trans.eventcreator],["eventcalendarname",window.pgc_trans.eventcalendarname]].map((t=>(0,e.createElement)(s.CheckboxControl,{className:"pgc-sidebar-row",onChange:k.bind(t[0]),label:t[1],checked:g[t[0]]}))),$=w.hidepassed?(0,e.createElement)(s.TextControl,{label:`${window.pgc_trans.more_than} ${w.hidepasseddays} ${window.pgc_trans.days_ago}`,type:"number",min:0,value:w.hidepasseddays,onChange:E.bind("hidepasseddays")}):null,N=w.hidefuture?(0,e.createElement)(s.TextControl,{label:`${window.pgc_trans.more_than} ${w.hidefuturedays} ${window.pgc_trans.days_from_now}`,type:"number",min:0,value:w.hidefuturedays,onChange:E.bind("hidefuturedays")}):null;(0,a.useEffect)((()=>{const e=wp.data.subscribe((function(){if(wp.data.select("core/editor")){const t=wp.data.select("core/editor").isSavingPost(),n=wp.data.select("core/editor").isAutosavingPost();if(t&&!n){if(!r){let t=setTimeout((function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.malformed_json)}),0);e()}if(!b&&!m){let t=setTimeout((function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.enter_one_or_more_public_calendar_ids)}),0);e()}}}}));return e}));const S=o?(0,e.createElement)(a.Fragment,null,(0,e.createElement)(s.TextareaControl,{rows:10,onKeyDown:function(e){if(9==e.keyCode){e.preventDefault();const t=e.target,n=t.selectionStart,a=t.value.substring(0,n)+"  "+t.value.substring(t.selectionEnd);j(a);let s=setTimeout((()=>{clearTimeout(s),t.selectionEnd=n+2}),0)}},className:"pgc-fullcalendarconfigarea "+(r?"":"has-error"),value:y,help:r?"":window.pgc_trans.malformed_json_short,label:window.pgc_trans.fullcalendar_config,placeHolder:i,onChange:j}),(0,e.createElement)("div",{className:"pgc-copy-link"},(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),j(i)}},window.pgc_trans.copy_default_fullcalendar_config),(0,e.createElement)("span",{onClick:()=>h(!0),class:"dashicons dashicons-editor-help"}))):null,T=p?function(t){return(0,e.createElement)(s.Modal,{title:"FullCalendar config",onRequestClose:t.onClose},(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.copy_fullcalendar_config_info}}),(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.fullcalendar_docs_link}}))}({onClose:()=>{h(!1)}}):null;return(0,e.createElement)(a.Fragment,null,(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(s.PanelBody,{title:window.pgc_trans.selected_calendars+" ("+(0===b?window.pgc_trans.none:b)+")",initialOpen:!0},C,(0,e.createElement)(s.TextControl,{label:window.pgc_trans.comma_separated_list_calendar_ids,value:m,onChange:function(e){t.setAttributes({publiccalendarids:e})}})),(0,e.createElement)(s.PanelBody,{title:window.pgc_trans.calendar_options,initialOpen:!0},(0,e.createElement)(s.CheckboxControl,{className:"pgc-sidebar-row",onChange:u,label:window.pgc_trans.edit_fullcalendar_config,checked:o}),(0,e.createElement)(s.CheckboxControl,{className:"pgc-sidebar-row",onChange:E.bind("hidepassed"),label:window.pgc_trans.hide_passed_events,checked:w.hidepassed}),$,(0,e.createElement)(s.CheckboxControl,{className:"pgc-sidebar-row",onChange:E.bind("hidefuture"),label:window.pgc_trans.hide_future_events,checked:w.hidefuture}),N),(0,e.createElement)(s.PanelBody,{title:window.pgc_trans.theme,initialOpen:!0},(0,e.createElement)(s.SelectControl,{value:g.theme||"",onChange:k.bind("theme"),options:[{value:"",label:window.pgc_trans.default},...window.pgc_trans.themes.map((function(e){return{value:e,label:e}}))]})),(0,e.createElement)(s.PanelBody,{title:window.pgc_trans.filter_options},(0,e.createElement)(s.SelectControl,{value:!0===g.filter?"top":g.filter,onChange:k.bind("filter"),options:[{value:"",label:window.pgc_trans.hide_filter},{value:"top",label:window.pgc_trans.show_filter_top},{value:"bottom",label:window.pgc_trans.show_filter_bottom}]}),(0,e.createElement)(s.TextControl,{label:window.pgc_trans.filter_uncheckedcalendarids,value:_,onChange:function(e){t.setAttributes({uncheckedcalendarids:e})}})),(0,e.createElement)(s.PanelBody,{title:window.pgc_trans.popup_options+" ("+(g.eventpopup?window.pgc_trans.show:window.pgc_trans.hide)+")",initialOpen:!0},O)),(0,e.createElement)("div",null,"Private Google Calendars Block"),S,T)},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e||"theme"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(t.attributes.publiccalendarids||Object.keys(t.attributes.calendars).length)&&(n.calendarids=t.attributes.publiccalendarids,Object.keys(t.attributes.calendars).length)){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),n.calendarids+=(n.calendarids.length&&e.length?",":"")+e.join(",")}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")},deprecated:[{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(t.attributes.publiccalendarids||Object.keys(t.attributes.calendars).length)&&(n.calendarids=t.attributes.publiccalendarids,Object.keys(t.attributes.calendars).length)){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),n.calendarids+=(n.calendarids.length&&e.length?",":"")+e.join(",")}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),t.attributes.config.public)n.calendarids=t.attributes.publiccalendarids;else if(Object.keys(t.attributes.calendars).length){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),e.length&&(n.calendarids=e.join(","))}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:!0,eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save:function(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),t.attributes.config.public)n.calendarids=t.attributes.publiccalendarids;else if(Object.keys(t.attributes.calendars).length){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),e.length&&(n.calendarids=e.join(","))}return Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}}]})})();