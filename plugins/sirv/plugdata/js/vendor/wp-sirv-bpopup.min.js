/*================================================================================
 * @name: bPopup - if you can't get it up, use bPopup
 * @author: (c)Bjoern Klinggaard (twitter@bklinggaard)
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.11.0.min
================================================================================*/
!function(o){"use strict";o.fn.bPopup=function(t,n){"function"==typeof t&&(n=t,t=null);var e=o.extend({},o.fn.bPopup.defaults,t);e.scrollBar||o("html").css("overflow","hidden");var i,a,l,s,c,d,r,f,u,p,$,h=this,w=o(document),b=window,m=o(b),C=W(),g=D(),_=/OS 6(_\d)+/i.test(navigator.userAgent),k=0;return h.close=function(){x()},h.reposition=function(o){T(o)},h.each(function(){o(this).data("bPopup")||(z(e.onOpen),i="__b-popup"+(k=(m.data("bPopup")||0)+1)+"__",l="auto"!==e.position[1],s="auto"!==e.position[0],c="fixed"===e.positionStyle,f=h.outerHeight(!0),u=h.outerWidth(!0),e.loadUrl?function t(){switch(e.contentContainer=o(e.contentContainer||h),e.content){case"iframe":var n=o('<iframe class="b-iframe" '+e.iframeAttr+"></iframe>");n.appendTo(e.contentContainer),f=h.outerHeight(!0),u=h.outerWidth(!0),y(),n.attr("src",e.loadUrl),z(e.loadCallback);break;case"image":y(),o("<img />").load(function(){z(e.loadCallback),v(o(this))}).attr("src",e.loadUrl).hide().appendTo(e.contentContainer);break;default:y(),o('<div class="b-ajax-wrapper"></div>').load(e.loadUrl,e.loadData,function(t,n,i){z(e.loadCallback,n),v(o(this))}).hide().appendTo(e.contentContainer)}}():y())});function y(){e.modal&&o('<div class="b-modal '+i+'"></div>').css({backgroundColor:e.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:e.zIndex+k}).appendTo(e.appendTo).fadeTo(e.speed,e.opacity),B(),h.data("bPopup",e).data("id",i).css({left:"slideIn"==e.transition||"slideBack"==e.transition?"slideBack"==e.transition?w.scrollLeft()+g:-((r+u)*1):I(!(!e.follow[0]&&s||c)),position:e.positionStyle||"absolute",top:"slideDown"==e.transition||"slideUp"==e.transition?"slideUp"==e.transition?w.scrollTop()+C:d+-1*f:S(!(!e.follow[1]&&l||c)),"z-index":e.zIndex+k+1}).each(function(){e.appending&&o(this).appendTo(e.appendTo)}),P(!0)}function x(){return e.modal&&o(".b-modal."+h.data("id")).fadeTo(e.speed,0,function(){o(this).remove()}),e.scrollBar||o("html").css("overflow","auto"),o(".b-modal."+i).off("click"),w.off("keydown."+i),m.off("."+i).data("bPopup",m.data("bPopup")-1>0?m.data("bPopup")-1:null),h.off("click."+i,".bClose, ."+e.closeClass,x).data("bPopup",null),clearTimeout($),P(),!1}function T(t){C=W(),g=D(),((a=H()).x||a.y)&&(clearTimeout(p),p=setTimeout(function(){B(),t=t||e.followSpeed;var n={};a.x&&(n.left=e.follow[0]?I(!0):"auto"),a.y&&(n.top=e.follow[1]?S(!0):"auto"),h.dequeue().each(function(){c?o(this).css({left:r,top:d}):o(this).animate(n,t,e.followEasing)})},50))}function v(o){var t=o.width(),n=o.height(),i={};e.contentContainer.css({height:n,width:t}),n>=h.height()&&(i.height=h.height()),t>=h.width()&&(i.width=h.width()),f=h.outerHeight(!0),u=h.outerWidth(!0),B(),e.contentContainer.css({height:"auto",width:"auto"}),i.left=I(!(!e.follow[0]&&s||c)),i.top=S(!(!e.follow[1]&&l||c)),h.animate(i,250,function(){o.show(),a=H()})}function P(o){switch(o?e.transition:e.transitionClose||e.transition){case"slideIn":t({left:o?I(!(!e.follow[0]&&s||c)):w.scrollLeft()-(u||h.outerWidth(!0))-200});break;case"slideBack":t({left:o?I(!(!e.follow[0]&&s||c)):w.scrollLeft()+g+200});break;case"slideDown":t({top:o?S(!(!e.follow[1]&&l||c)):w.scrollTop()-(f||h.outerHeight(!0))-200});break;case"slideUp":t({top:o?S(!(!e.follow[1]&&l||c)):w.scrollTop()+C+200});break;default:h.stop().fadeTo(e.speed,o?1:0,function(){U(o)})}function t(t){h.css({display:"block",opacity:1}).animate(t,e.speed,e.easing,function(){U(o)})}}function U(t){t?(m.data("bPopup",k),h.on("click."+i,".bClose, ."+e.closeClass,x),e.modalClose&&o(".b-modal."+i).css("cursor","pointer").on("click",x),!_&&(e.follow[0]||e.follow[1])&&m.on("scroll."+i,function(){if(a.x||a.y){var o={};a.x&&(o.left=e.follow[0]?I(!c):"auto"),a.y&&(o.top=e.follow[1]?S(!c):"auto"),h.dequeue().animate(o,e.followSpeed,e.followEasing)}}).on("resize."+i,function(){T()}),e.escClose&&w.on("keydown."+i,function(o){27==o.which&&x()}),z(n),e.autoClose&&($=setTimeout(x,e.autoClose))):(h.hide(),z(e.onClose),e.loadUrl&&(e.contentContainer.empty(),h.css({height:"auto",width:"auto"})))}function I(o){return o?r+w.scrollLeft():r}function S(o){return o?d+w.scrollTop():d}function z(o,t){"function"==typeof o&&o.call(h,t)}function B(){d=l?e.position[1]:Math.max(0,(C-h.outerHeight(!0))/2-e.amsl),r=s?e.position[0]:(g-h.outerWidth(!0))/2,a=H()}function H(){return{x:g>h.outerWidth(!0),y:C>h.outerHeight(!0)}}function W(){return m.height()}function D(){return m.width()}},o.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}}(jQuery);
