jQuery(document).ready((function(e){let t;window.formfield="",e("body").on("click",".ea_settings_upload_button",(function(n){n.preventDefault();const r=e(this);window.formfield=e(this).parent().prev(),t||(t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:r.data("uploader_title"),button:{text:r.data("uploader_button_text")},multiple:!1}),t.on("menu:render:default",(function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})})),t.on("insert",(function(){t.state().get("selection").each((function(e,t){e=e.toJSON(),window.formfield.val(e.url)}))}))),t.open()})),e(".ea-financial-start").datepicker("destroy"),e(".ea-financial-start").datepicker({dateFormat:"dd-mm"});var n={init(){e("#ea-currency-settings").on("change",".ea_currencies_code select",this.populate_currency).on("click","#ea_add_currency",this.add_currency).on("click",".ea_remove_currency",this.remove_currency).on("submit",this.submit)},block(){e("#ea-currency-settings").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e("#ea-currency-settings button").attr("disabled","disabled")},unblock(){e("#ea-currency-settings").unblock(),e("#ea-currency-settings button").removeAttr("disabled")},add_currency(t){t.preventDefault(),e(".ea-select2").select2("destroy");const n=e("#ea_currencies tr:last"),r=n.clone(),a=n.parent().find("tr").length;return r.find("td input").not(":input[type=checkbox]").val(""),r.find('td [type="checkbox"]').attr("checked",!1),r.find("input, select").each((function(){let t=e(this).attr("name");t.includes("code")&&e(this).val(""),t=t.replace(/\[(\d+)\]/,"["+parseInt(a)+"]"),e(this).attr("name",t).attr("id",t)})),r.insertAfter(n),e(document.body).trigger("ea_select2_init"),!1},remove_currency(t){if(t.preventDefault(),e("#ea_currencies tbody tr").length<2)return e.eaccounting_notice({message:"Last item is not removable."}),!1;e(this).closest("tr").remove()},populate_currency(){const t=e(this).val();if(!t)return;const n=eaccounting_codes[t];e(this).closest("tr").find(".ea_currencies_rate input").val("1.0000").end().find(".ea_currencies_precision input").val(n.precision).end().find(".ea_currencies_position select").val(n.position).end().find(".ea_currencies_decimal_separator input").val(n.decimal_separator).end().find(".ea_currencies_thousand_separator input").val(n.thousand_separator).end()},submit(t){t.preventDefault(),n.block();const r=e("#ea-currency-settings").serializeObject();e.post(ajaxurl,r,(function(e){})).always((function(t){e.eaccounting_notice(t),n.unblock()}))}};n.init()}));