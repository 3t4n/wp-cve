jQuery((function(e){"use strict";const t=function(t,n){e(t).inputmask("decimal",{alias:"numeric",groupSeparator:n.thousand_separator,autoGroup:!0,digits:n.precision,radixPoint:n.decimal_separator,digitsOptional:!1,allowMinus:!1,prefix:n.symbol,placeholder:"0.000",rightAlign:0,autoUnmask:!0})};var n={init(){e(document).on("change",'#ea-revenue-form [name="account_id"]',this.update_amount_input).on("submit","#ea-revenue-form",this.submit)},block(){e("#ea-revenue-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-revenue-form").unblock()},update_amount_input(a){const o=parseInt(a.target.value,10);if(isNaN(o))return!1;n.block();const c={action:"eaccounting_get_account_currency",account_id:o,_wpnonce:eaccounting_form_i10n.nonce.get_currency};e.post(ajaxurl,c,(function(n){n.success&&t(e('#ea-revenue-form [name="amount"]'),n.data)})).always((function(t){n.unblock(),e.eaccounting_notice(t)}))},submit(t){t.preventDefault(),n.block();const a=e("#ea-revenue-form").serializeObject();e.post(ajaxurl,a,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),n.unblock()}))}},a={init(){e(document).on("change",'#ea-payment-form [name="account_id"]',this.update_amount_input).on("submit","#ea-payment-form",this.submit)},block(){e("#ea-payment-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-payment-form").unblock()},update_amount_input(n){const o=parseInt(n.target.value,10);if(isNaN(o))return!1;a.block();const c={action:"eaccounting_get_account_currency",account_id:o,_wpnonce:eaccounting_form_i10n.nonce.get_currency};e.post(ajaxurl,c,(function(n){n.success&&t(e('#ea-payment-form [name="amount"]'),n.data)})).always((function(t){a.unblock(),e.eaccounting_notice(t)}))},submit(t){t.preventDefault(),a.block();const n=e("#ea-payment-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),a.unblock()}))}},o={init(){e("#ea-account-form").on("select2:select",'[name="currency_code"]',this.update_amount_input).on("submit",this.submit)},block(){e("#ea-account-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-account-form").unblock()},update_amount_input(n){const a=n.params.data.id;if(!a)return!1;const o=eaccounting_form_i10n.global_currencies[a];t(e('#ea-account-form [name="opening_balance"]'),o)},submit(t){t.preventDefault(),o.block();const n=e("#ea-account-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),o.unblock()}))}},c={init(){e("#ea-transfer-form").on("change",'[name="from_account_id"]',this.update_amount_input).find("#from_account_id").trigger("change").end().on("submit",this.submit)},block(){e("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-transfer-form").unblock()},update_amount_input(n){const a=parseInt(n.target.value,10);if(isNaN(a))return!1;c.block();const o={action:"eaccounting_get_account_currency",account_id:a,_wpnonce:eaccounting_form_i10n.nonce.get_currency};e.post(ajaxurl,o,(function(n){n.success&&t(e('#ea-transfer-form [name="amount"]'),n.data)})).always((function(t){c.unblock(),e.eaccounting_notice(t)}))},submit(t){t.preventDefault(),c.block();const n=e("#ea-transfer-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),c.unblock()}))}},i={init(){e("#ea-customer-form").on("submit",this.submit)},block(){e("#ea-customer-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-customer-form").unblock()},submit(t){t.preventDefault(),i.block();const n=e("#ea-customer-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),i.unblock()}))}},l={init(){e("#ea-vendor-form").on("submit",this.submit)},block(){e("#ea-vendor-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-vendor-form").unblock()},submit(t){t.preventDefault(),l.block();const n=e("#ea-vendor-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),l.unblock()}))}},u={init(){e("#ea-category-form").on("submit",this.submit)},block(){e("#ea-category-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-category-form").unblock()},submit(t){t.preventDefault(),u.block();const n=e("#ea-category-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),u.unblock()}))}};const r={init(){e("#ea-item-form").on("submit",this.submit)},block(){e("#ea-item-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-item-form").unblock()},submit(t){t.preventDefault(),u.block();const n=e("#ea-item-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),u.unblock()}))}};var s={init(){e("#ea-currency-form").on("change",'[name="code"]',this.update_currency_props).on("submit",this.submit)},block(){e("#ea-currency-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-currency-form").unblock()},update_currency_props(t){const n=t.target.value;if(!n)return!1;const a=eaccounting_form_i10n.global_currencies[n];e('[name="name"]',"#ea-currency-form").val(a.name).change(),e('[name="precision"]',"#ea-currency-form").val(a.precision).change(),e('[name="position"]',"#ea-currency-form").val(a.position).change(),e('[name="symbol"]',"#ea-currency-form").val(a.symbol).change(),e('[name="decimal_separator"]',"#ea-currency-form").val(a.decimal_separator).change(),e('[name="thousand_separator"]',"#ea-currency-form").val(a.thousand_separator).change()},submit(t){t.preventDefault(),s.block();const n=e("#ea-currency-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),s.unblock()}))}},m={init(){e("#ea-invoice-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),e("#ea-invoice").on("click",".delete_note",this.delete_note).on("click",".receive-payment",this.receive_payment),e(document).on("submit","#invoice-note-form",this.add_note),e(document.body).on("ea_invoice_updated",this.recalculate)},block(){e("#ea-invoice-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-invoice-form").unblock()},add_line_item(t){t.preventDefault();const n=e(e("#ea-invoice-line-template").html()),a=e(e("#ea-invoice-item-selector").html());let o=a.attr("name");const c=Array(1).fill(null).map((function(){return Math.random().toString(10).substr(2)})).join("");n.addClass("editing"),e(n).find(":input").each((function(){let t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+c+"]"),e(this).attr("name",t).attr("id",t)})),o=o.replace(/\[(\d+)\]/,"["+c+"]"),a.attr("name",o).attr("id",o),a.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(a),e("#ea-document__line-items").append(n),e(document.body).trigger("ea_select2_init")},item_selected(t){const n=t.params.data;e(t.target).closest("tr").find("input.line_item_price").val(n.item.sale_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.sales_tax),e("body").trigger("ea_invoice_updated")},remove_line_item(t){t.preventDefault(),e(this).closest("tr").remove(),m.recalculate()},edit_line_item(t){t.preventDefault();const n=e(this).closest(".ea-document__line");if(n.hasClass("editing"))return n.removeClass("editing"),e("body").trigger("ea_invoice_updated"),!1;n.siblings("tr").removeClass("editing"),n.addClass("editing")},delete_note(t){t.preventDefault();const n=e(this).closest(".ea-document-notes__item"),a=n.data("nonce"),o={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:a};e.post(ajaxurl,o,(function(t){t.success&&(n.remove(),e("#ea-invoice_notes-body").replaceWith(t.data.notes))})).always((function(t){e.eaccounting_notice(t)}))},add_discount(t){e("#ea-modal-add-discount").ea_modal({onReady(t){e("#discount",t.$modal).val(e("#ea-invoice-form #discount").val()),e("#discount_type",t.$modal).val(e("#ea-invoice-form #discount_type").val())},onSubmit(t,n){e("#ea-invoice-form #discount").val(t.discount),e("#ea-invoice-form #discount_type").val(t.discount_type),n.close(),m.recalculate()}})},receive_payment(t){t.preventDefault();const n=e("#ea-modal-add-invoice-payment"),a=e(this).data("currency");n.ea_modal({onReady(t){eaccounting_mask_amount(e('[name="amount"]',t.$modal),a)},onSubmit(t,n){e.post(ajaxurl,t,(function(e){})).always((function(t){n.close(),e.eaccounting_notice(t),location.reload()}))}})},add_note(t){t.preventDefault();const n=e(this);eaccounting_block(n);const a=n.serializeObject();e.post(ajaxurl,a,(function(t){t.success&&e("#ea-invoice_notes-body").replaceWith(t.data.notes)})).always((function(t){e.eaccounting_notice(t),eaccounting_unblock(n),e("#invoice-note-form textarea").val("")}))},recalculate(){m.block();const t=e.extend({},e("#ea-invoice-form").serializeObject(),{action:"eaccounting_invoice_recalculate"});e.post(ajaxurl,t,(function(t){t.success?e("#ea-invoice-form .ea-document__items-wrapper").replaceWith(t.data.html):e.eaccounting_notice(t)})).always((function(e){m.unblock()}))},submit(t){t.preventDefault(),m.block();const n=e("#ea-invoice-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),m.unblock()}))}},d={init(){e("#ea-bill-form").on("click",".add-line-item",this.add_line_item).on("select2:select",".select-item",this.item_selected).on("click",".delete-line",this.remove_line_item).on("click",".edit-line, .save-line",this.edit_line_item).on("click",".add-discount",this.add_discount).on("change",'[name="currency_code"]',this.recalculate).on("click",".recalculate",this.recalculate).on("submit",this.submit),e("#ea-bill").on("click",".delete_note",this.delete_note).on("click",".add-payment",this.add_payment),e(document).on("submit","#bill-note-form",this.add_note),e(document.body).on("ea_bill_updated",this.recalculate)},block(){e("#ea-bill-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){e("#ea-bill-form").unblock()},add_line_item(t){t.preventDefault();const n=e(e("#ea-bill-line-template").html()),a=e(e("#ea-bill-item-selector").html());let o=a.attr("name");const c=Array(1).fill(null).map((function(){return Math.random().toString(10).substr(2)})).join("");n.addClass("editing"),e(n).find(":input").each((function(){let t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+c+"]"),e(this).attr("name",t).attr("id",t)})),o=o.replace(/\[(\d+)\]/,"["+c+"]"),a.attr("name",o).attr("id",o),a.css({width:"90%",maxWidth:"none"}),n.find(".ea-document__line-name").html(a),e("#ea-document__line-items").append(n),e(document.body).trigger("ea_select2_init")},item_selected(t){const n=t.params.data;e(t.target).closest("tr").find("input.line_item_price").val(n.item.purchase_price).end().find("input.line_item_quantity").val(1).end().find("input.line_item_tax").val(n.item.purchase_tax),e("body").trigger("ea_bill_updated")},remove_line_item(t){t.preventDefault(),e(this).closest("tr").remove(),d.recalculate()},edit_line_item(t){t.preventDefault();const n=e(this).closest(".ea-document__line");if(n.hasClass("editing"))return n.removeClass("editing"),e("body").trigger("ea_bill_updated"),!1;n.siblings("tr").removeClass("editing"),n.addClass("editing")},delete_note(t){t.preventDefault();const n=e(this).closest(".ea-document-notes__item"),a=n.data("nonce"),o={action:"eaccounting_delete_note",id:n.data("noteid"),nonce:a};e.post(ajaxurl,o,(function(t){t.success&&(n.remove(),e("#ea-bill_notes-body").replaceWith(t.data.notes))})).always((function(t){e.eaccounting_notice(t)}))},add_discount(t){e("#ea-modal-add-discount").ea_modal({onReady(t){e("#discount",t.$modal).val(e("#ea-bill-form #discount").val()),e("#discount_type",t.$modal).val(e("#ea-bill-form #discount_type").val())},onSubmit(t,n){e("#ea-bill-form #discount").val(t.discount),e("#ea-bill-form #discount_type").val(t.discount_type),n.close(),d.recalculate()}})},add_payment(t){t.preventDefault();const n=e("#ea-modal-add-bill-payment"),a=e(this).data("currency");n.ea_modal({onReady(t){eaccounting_mask_amount(e("#amount",t.$modal),a)},onSubmit(t,n){e.post(ajaxurl,t,(function(e){})).always((function(t){n.close(),e.eaccounting_notice(t),location.reload()}))}})},add_note(t){t.preventDefault();const n=e(this);eaccounting_block(n);const a=n.serializeObject();e.post(ajaxurl,a,(function(t){t.success&&e("#ea-bill_notes-body").replaceWith(t.data.notes)})).always((function(t){e.eaccounting_notice(t),eaccounting_unblock(n),e("#bill-note-form textarea").val("")}))},recalculate(){d.block();const t=e.extend({},e("#ea-bill-form").serializeObject(),{action:"eaccounting_bill_recalculate"});e.post(ajaxurl,t,(function(t){t.success?e("#ea-bill-form .ea-document__items-wrapper").replaceWith(t.data.html):e.eaccounting_notice(t)})).always((function(e){d.unblock()}))},submit(t){t.preventDefault(),d.block();const n=e("#ea-bill-form").serializeObject();e.post(ajaxurl,n,(function(t){e.eaccounting_redirect(t)})).always((function(t){e.eaccounting_notice(t),d.unblock()}))}};n.init(),a.init(),o.init(),c.init(),i.init(),l.init(),u.init(),s.init(),r.init(),m.init(),d.init()}));