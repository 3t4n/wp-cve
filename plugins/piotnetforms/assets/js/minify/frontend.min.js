jQuery(document).ready((function(t){function e(e){var i=e,s=i.data("piotnetforms-submit-form-id"),o=t(document).find("[data-piotnetforms-id="+s+"]"),a=i.data("piotnetforms-required-text"),n=[],l=0,r=new FormData,d=i.closest(".piotnetforms-submit");o.each((function(){if(null==t(this).data("piotnetforms-html")){var e=t(this).closest(".piotnetforms-field-type-checkbox.piotnetforms-field-required"),i=0;if(e.length>0&&(i=e.find("input[type=checkbox]:checked").length),null!=t(this).attr("oninvalid")&&(a=t(this).attr("oninvalid").replace("this.setCustomValidity('","").replace("')","")),!t(this)[0].checkValidity()&&"none"!=t(this).closest(".piotnetforms-widget").css("display")&&"none"!=t(this).closest("[data-piotnetforms-conditional-logic]").css("display")&&null==t(this).data("piotnetforms-honeypot")&&0==t(this).closest("[data-piotnetforms-signature]").length||0==i&&e.length>0&&"none"!=t(this).closest(".piotnetforms-fields-wrapper").css("display"))"none"==t(this).css("display")||"none"==t(this).closest("div").css("display")||null!=t(this).data("piotnetforms-image-select")||e.length>0?t(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a):null==t(this).data("piotnetforms-image-select")&&t(this)[0].reportValidity(),l++;else{t(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(""),t(this).closest("[data-piotnetforms-signature]").length>0&&(t(this).closest("[data-piotnetforms-signature]").find("[data-piotnetforms-signature-export]").trigger("click"),""==t(this).val()&&"none"!=t(this).closest(".piotnetforms-widget").css("display")&&null!=t(this).attr("required")&&(t(this).closest(".piotnetforms-field-group").find("[data-piotnetforms-required]").html(a),l++));var s=t(this).attr("type"),o=t(this).attr("name");if("file"==s)t(this).hasClass("error")?l++:(o=t(this).attr("id").replace("form-field-",""),t.each(t(this)[0].files,(function(t,e){r.append(o+"[]",e)})),(g={}).label=t(this).closest(".piotnetforms-field-group").find(".piotnetforms-field-label").html(),g.name=o,g.value="",g.type=t(this).attr("type"),g.upload=1,null!=t(this).data("piotnetforms-remove-this-field-from-repeater")&&(g.repeater_remove_this_field="1"),null!=t(this).data("attach-files")&&(g["attach-files"]=1),n.push(g));else{if(-1!==o.indexOf("[]")){var d=[];"checkbox"==s?t(this).closest(".piotnetforms-fields-wrapper").find('[name="'+o+'"]:checked').each((function(){d.push(t(this).val())})):null==(d=t(this).val())&&(d=[]),h="";for(var p="",f=[],m=0;m<d.length;m++){if(null!=t(this).data("piotnetforms-send-data-by-label")){var c=d[m];"checkbox"==s?(u=t(this).closest(".piotnetforms-fields-wrapper").find('[value="'+c+'"]')).length>0&&(p+=u.data("piotnetforms-send-data-by-label")+","):(u=t(this).find('[value="'+c+'"]')).length>0&&(p+=u.html()+",")}h+=d[m]+",",null!=t(this).attr("data-piotnetforms-booking-item-options")&&(c=d[m],(u=t(this).closest(".piotnetforms-fields-wrapper").find('[value="'+c+'"]')).length>0&&(console.log(u.attr("data-piotnetforms-booking-item-options")),f.push(u.attr("data-piotnetforms-booking-item-options"))))}h=h.replace(/,(\s+)?$/,"")}else if("radio"==s||"checkbox"==s){null!=t(this).data("piotnetforms-send-data-by-label")&&(p=t(this).closest(".piotnetforms-fields-wrapper").find('[name="'+o+'"]:checked').data("piotnetforms-send-data-by-label"));var h=t(this).closest(".piotnetforms-fields-wrapper").find('[name="'+o+'"]:checked').val()}else if(null!=t(this).data("piotnetforms-calculated-fields"))h=t(this).siblings(".piotnetforms-calculated-fields-form").text();else{var u;if(null!=t(this).data("piotnetforms-send-data-by-label"))c=t(this).val().trim(),(u=t(this).find('[value="'+c+'"]')).length>0&&(p=u.html());h=t(this).val().trim()}var g;null!=h&&((g={}).label=t(this).closest(".piotnetforms-field-group").find(".piotnetforms-field-label").html(),g.name=o.replace("[]","").replace("form_fields[","").replace("]",""),g.value=h,null!=d&&(g.value_multiple=d),g.type=t(this).attr("type"),""!=p&&(g.value_label=p),n.push(g))}}}})),0==l&&(t(document).find('[data-piotnetforms-id="'+s+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:.45}),i.closest(".piotnetforms-submit").css({opacity:.45}),i.closest(".piotnetforms-submit").addClass("piotnetforms-waiting"),r.append("action","piotnetforms_ajax_form_builder"),r.append("post_id",d.find('input[name="post_id"]').val()),r.append("form_id",d.find('input[name="form_id"]').val()),r.append("fields",JSON.stringify(n)),r.append("referrer",window.location.href),r.append("remote_ip",t(document).find('input[name="remote_ip"][data-piotnetforms-hidden-form-id="'+s+'"]').val()),d.find(".piotnetforms-message").removeClass("visible"),t.ajax({url:t("[data-piotnetforms-ajax-url]").data("piotnetforms-ajax-url"),type:"POST",data:r,processData:!1,contentType:!1,success:function(e){if(d.css({opacity:1}),d.removeClass("piotnetforms-waiting"),t(document).find('[data-piotnetforms-id="'+s+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),-1!==e.indexOf(",")){var o=e.split(",");d.find(".piotnetforms-message").each((function(){if(""!=o[3]){var t=i.html().replace("[post_url]",'<a href="'+o[3]+'">'+o[3]+"</a>");i.html(t)}})),""!=o[1]?(d.find(".piotnetforms-alert--mail .piotnetforms-message-success").addClass("visible"),d.find("[data-piotnetforms-trigger-success]").trigger("click")):(d.find(".piotnetforms-alert--mail .piotnetforms-message-danger").addClass("visible"),t(document).find('[data-piotnetforms-id="'+s+'"]').closest(".piotnetforms-fields-wrapper").css({opacity:1}),i.closest(".piotnetforms-fields-wrapper").css({opacity:1}),d.find("[data-piotnetforms-trigger-failed]").trigger("click"),""!=o[5]&&d.find(".piotnetforms-alert--mail .piotnetforms-message-danger").html(o[5].replace(/###/g,",")))}}}))}t(document).on("click","[data-piotnetforms-submit-form-id]",(function(){e(t(this))})),t(".ct-modal [data-piotnetforms-submit-form-id]").click((function(){e(t(this))})),t("#piotnetforms").closest("span.ct-span").css({display:"block"})}));