{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external {\"this\":\"regeneratorRuntime\"}","webpack:///../node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack:///external {\"this\":[\"wp\",\"data\"]}","webpack:///../node_modules/@babel/runtime/helpers/slicedToArray.js","webpack:///../node_modules/@babel/runtime/helpers/defineProperty.js","webpack:///../node_modules/@babel/runtime/helpers/asyncToGenerator.js","webpack:///./js/utils/constants.ts","webpack:///external {\"this\":\"lodash\"}","webpack:///./js/utils/element.ts","webpack:///../node_modules/@babel/runtime/helpers/classCallCheck.js","webpack:///../node_modules/@babel/runtime/helpers/createClass.js","webpack:///external {\"this\":[\"wp\",\"blocks\"]}","webpack:///../node_modules/@babel/runtime/helpers/objectWithoutProperties.js","webpack:///./js/utils/data.ts","webpack:///../node_modules/uuid/v4.js","webpack:///./js/utils/dom.ts","webpack:///./js/utils/editor.ts","webpack:///external {\"this\":[\"wp\",\"url\"]}","webpack:///../node_modules/@babel/runtime/helpers/getPrototypeOf.js","webpack:///../node_modules/@babel/runtime/helpers/typeof.js","webpack:///../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","webpack:///../node_modules/@babel/runtime/helpers/inherits.js","webpack:///../node_modules/@babel/runtime/helpers/arrayWithHoles.js","webpack:///../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","webpack:///../node_modules/@babel/runtime/helpers/nonIterableRest.js","webpack:///../node_modules/@babel/runtime/helpers/setPrototypeOf.js","webpack:///./js/utils/cache.ts","webpack:///../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack:///../node_modules/@babel/runtime/helpers/iterableToArray.js","webpack:///../node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack:///../node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","webpack:///../node_modules/uuid/lib/rng-browser.js","webpack:///../node_modules/uuid/lib/bytesToUuid.js","webpack:///./js/utils/ajax.ts","webpack:///../node_modules/@babel/runtime/helpers/assertThisInitialized.js","webpack:///external {\"this\":\"CSL\"}","webpack:///./js/utils/processor.ts","webpack:///../node_modules/string-hash/index.js","webpack:///./js/stores/data/controls.ts","webpack:///./js/stores/data/actions.ts","webpack:///./js/stores/data/reducer.ts","webpack:///./js/stores/data/resolvers.ts","webpack:///./js/stores/data/selectors.ts","webpack:///./js/stores/data/index.ts","webpack:///./js/stores/ui/actions.ts","webpack:///./js/stores/ui/reducer.ts","webpack:///./js/stores/ui/selectors.ts","webpack:///./js/stores/ui/index.ts","webpack:///./js/stores/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","this","arrayWithoutHoles","iterableToArray","nonIterableSpread","arr","arrayWithHoles","iterableToArrayLimit","nonIterableRest","obj","configurable","writable","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","error","done","Promise","then","fn","self","args","arguments","apply","err","undefined","CSL_DATE_KEYS","isCslDateKey","includes","CSL_NUMBER_KEYS","isCslNumberKey","CSL_PERSON_KEYS","isCslPersonKey","CSL_STRING_KEYS","isCslStringKey","CSL_KEYS","isCslKey","ZERO_WIDTH_SPACE","CitationElement","items","citation","document","createElement","className","id","dataset","JSON","stringify","contentEditable","outerHTML","el","parse","reflist","legacyClassNames","selector","map","cls","classNames","attributes","_cons","FootnoteElement","note","footnote","index","marker","markers","createMarker","length","instance","Constructor","TypeError","_defineProperties","target","props","descriptor","protoProps","staticProps","objectWithoutPropertiesLoose","source","excluded","getOwnPropertySymbols","sourceSymbolKeys","indexOf","propertyIsEnumerable","clone","data","firstTruthyValue","paths","fallback","path","val","swapWith","a","b","list","item","splice","slice","rng","bytesToUuid","options","buf","offset","Array","rnds","random","ii","createSelector","selectors","element","entries","k","v","join","getJSONScriptData","type","script","querySelector","Error","innerHTML","INVALID_BLOCK_TYPES","getEditorDOM","excludeInvalid","doc","filteredBlocks","getEditorBlocks","filter","block","isValid","getEditedPostContent","parseBibAttributes","entryspacing","hangingindent","maxoffset","linespacing","secondFieldAlign","stripListItem","container","child","content","toRemove","children","classList","contains","forEach","removeChild","trim","_getPrototypeOf","setPrototypeOf","getPrototypeOf","__proto__","_typeof2","iterator","constructor","_typeof","assertThisInitialized","subClass","superClass","isArray","toString","_arr","_n","_d","_e","_s","_i","next","push","_setPrototypeOf","AbstractCache","daysTilExpiration","PREFIX","VERSION","KEY","_cache","storageIsAvailable","top","localStorage","createFallbackStorage","ITEM_KEY","EXPIRES","Date","now","keys","startsWith","removeItem","cache","storage","window","setItem","_value","Map","size","clear","getItem","delete","set","expires","localeCache","parser","DOMParser","style","xml","parseFromString","styleNode","localeId","getAttribute","fetch","response","ok","statusText","text","locale","styleCache","styleId","cached","arr2","iter","from","sourceKeys","getRandomValues","crypto","msCrypto","rnds8","Uint8Array","Math","byteToHex","substr","bth","fetchAjax","action","body","ajaxurl","method","headers","_wpnonce","_abt_nonce","credentials","ReferenceError","Processor","sys","retrieveItem","getItemById","retrieveLocale","lang","engine","opt","development_extensions","wrap_url_and_doi","citations","rebuildProcessorState","html","sortedItems","registry","citationById","makeBibliography","meta","entry_ids","citationreg","str","hash","charCodeAt","FETCH_CITATION_STYLES","json","FETCH_LOCALE","fetchItem","FETCH_STYLE","SAVE_STATE","state","post_id","addReference","addReferences","removeFootnote","removeFootnotes","removeReference","removeReferences","updateReference","removeAllCitations","parseCitations","parseFootnotes","setStyle","save","setBibliography","setFootnotes","updateEditorCitations","itemIds","removedItems","querySelectorAll","parentNode","toDelete","reduce","idsToDelete","existingIds","getItems","filteredItemIds","resetBlocks","itemIsCited","getCitedItems","findIndex","getStyle","kind","styleXml","processor","getCitationsByIndex","bibliography","getCurrentPostId","getSerializedState","_abt_state","autosave","blocksList","getBlocks","bibliographyBlock","find","updateBlockAttributes","clientId","insertBlock","removeBlock","getFootnotes","footnoteBlockIndex","bibliographyBlockIndex","node","firstElementChild","hasChildren","INITIAL_STATE","citationStyles","renamed","styles","references","newItems","getCitationStyles","citationID","citationItems","properties","noteIndex","flatMap","uniq","compact","appendChild","textContent","getUncitedItems","getSortedItems","order","issued","year","month","toJSON","title","left","right","actions","controls","reducer","resolvers","clearSelectedItems","setIdentifierKind","setSidebarSortMode","setSidebarSortOrder","toggleItemSelected","ARD_INITIAL_STATE","identifierKind","SIDEBAR_INITIAL_STATE","selectedItems","sortMode","sortOrder","getIdentifierKind","addReferenceDialog","getSelectedItems","sidebar","getSidebarSortMode","getSidebarSortOrder","ui"],"mappings":"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","file":"bundle/editor-stores.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 138);\n","(function() { module.exports = this[\"regeneratorRuntime\"]; }());","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","(function() { module.exports = this[\"wp\"][\"data\"]; }());","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport const enum IdentifierKind {\n    DOI = 'doi',\n    PMID = 'pmid',\n    PMCID = 'pmcid',\n}\n\nconst CSL_DATE_KEYS: readonly CSL.DateFieldKey[] = [\n    'accessed',\n    'container',\n    'event-date',\n    'issued',\n    'original-date',\n    'submitted',\n];\nexport function isCslDateKey(key: any): key is CSL.DateFieldKey {\n    return CSL_DATE_KEYS.includes(key);\n}\n\nconst CSL_NUMBER_KEYS: readonly CSL.NumberFieldKey[] = [\n    'chapter-number',\n    'collection-number',\n    'edition',\n    'issue',\n    'number-of-pages',\n    'number-of-volumes',\n    'volume',\n];\nexport function isCslNumberKey(key: any): key is CSL.NumberFieldKey {\n    return CSL_NUMBER_KEYS.includes(key);\n}\n\nconst CSL_PERSON_KEYS: readonly CSL.PersonFieldKey[] = [\n    'author',\n    'collection-editor',\n    'composer',\n    'container-author',\n    'director',\n    'editor',\n    'editorial-director',\n    'illustrator',\n    'interviewer',\n    'original-author',\n    'recipient',\n    'reviewed-author',\n    'translator',\n];\nexport function isCslPersonKey(key: any): key is CSL.PersonFieldKey {\n    return CSL_PERSON_KEYS.includes(key);\n}\n\nconst CSL_STRING_KEYS: readonly CSL.StringFieldKey[] = [\n    'DOI',\n    'ISBN',\n    'ISSN',\n    'PMCID',\n    'PMID',\n    'URL',\n    'abstract',\n    'annote',\n    'archive',\n    'archive-place',\n    'archive_location',\n    'authority',\n    'call-number',\n    'citation-label',\n    'citation-number',\n    'collection-title',\n    'container-title',\n    'container-title-short',\n    'dimensions',\n    'event',\n    'event-place',\n    'first-reference-note-number',\n    'genre',\n    'journalAbbreviation',\n    'jurisdiction',\n    'keyword',\n    'language',\n    'locator',\n    'medium',\n    'note',\n    'number',\n    'original-publisher',\n    'original-publisher-place',\n    'original-title',\n    'page',\n    'page-first',\n    'publisher',\n    'publisher-place',\n    'references',\n    'reviewed-title',\n    'scale',\n    'section',\n    'shortTitle',\n    'source',\n    'status',\n    'title',\n    'title-short',\n    'version',\n    'year-suffix',\n];\nexport function isCslStringKey(key: any): key is CSL.StringFieldKey {\n    return CSL_STRING_KEYS.includes(key);\n}\n\nconst CSL_KEYS: ReadonlyArray<keyof CSL.Data> = [\n    'id',\n    'type',\n    ...CSL_DATE_KEYS,\n    ...CSL_NUMBER_KEYS,\n    ...CSL_PERSON_KEYS,\n    ...CSL_STRING_KEYS,\n];\nexport function isCslKey(key: any): key is keyof CSL.Data {\n    return CSL_KEYS.includes(key);\n}\n\nexport const ZERO_WIDTH_SPACE = '\\u200b';\n\n// vim: set fdm=indent fdl=0:\n","(function() { module.exports = this[\"lodash\"]; }());","import uuid from 'uuid/v4';\n\nimport { ZERO_WIDTH_SPACE } from 'utils/constants';\nimport { createSelector } from 'utils/dom';\n\ninterface ABTElement {\n    readonly className: string;\n    readonly legacyClassNames: readonly string[];\n    readonly selector: string;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    create(...args: any): string;\n}\n\n@staticImplements<ABTElement>()\nexport abstract class CitationElement {\n    static readonly className = 'abt-citation';\n    static readonly legacyClassNames: readonly string[] = [\n        CitationElement.className,\n        'abt_cite',\n    ];\n    static readonly selector = createSelector(\n        ...CitationElement.legacyClassNames.map(cls => ({\n            classNames: [cls],\n            attributes: {\n                id: true,\n            },\n        })),\n    );\n\n    static create(items: string[]): string {\n        const citation = document.createElement('span');\n        citation.className = CitationElement.className;\n        citation.id = uuid();\n        citation.dataset.items = JSON.stringify(items);\n        citation.contentEditable = 'false';\n        return citation.outerHTML;\n    }\n\n    static getItems(el: HTMLElement): string[] {\n        return JSON.parse(el.dataset.items || el.dataset.reflist || '[]');\n    }\n}\n\n@staticImplements<ABTElement>()\nexport abstract class FootnoteElement {\n    static readonly className = 'abt-footnote';\n    static readonly legacyClassNames: readonly string[] = [\n        FootnoteElement.className,\n    ];\n    static readonly selector = createSelector(\n        ...FootnoteElement.legacyClassNames.map(cls => ({\n            classNames: [cls],\n            attributes: {\n                id: true,\n            },\n        })),\n    );\n\n    static create(note: string): string {\n        const footnote = document.createElement('span');\n        footnote.className = FootnoteElement.className;\n        footnote.id = uuid();\n        footnote.dataset.note = note;\n        footnote.contentEditable = 'false';\n        return footnote.outerHTML;\n    }\n\n    static createMarker(index: number, marker = ''): string {\n        const markers = ['*', '†', '‡', '§', '¶', '#'];\n        return index >= 0\n            ? FootnoteElement.createMarker(\n                  index - markers.length,\n                  marker + markers[index % markers.length],\n              )\n            : `<sup>${ZERO_WIDTH_SPACE}${marker}${ZERO_WIDTH_SPACE}</sup>`;\n    }\n}\n\n// helper for strict types of static properties\nfunction staticImplements<T>() {\n    return (_cons: T) => void 0;\n}\n","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","(function() { module.exports = this[\"wp\"][\"blocks\"]; }());","var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose\");\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutProperties;","import { get } from 'lodash';\n\ntype Widen<T> = T extends string ? string : T extends number ? number : T;\n\nexport function clone<T>(data: T): T {\n    if (data === undefined) {\n        return data;\n    }\n    return JSON.parse(JSON.stringify(data));\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport function firstTruthyValue<T extends Record<string, any>, U>(obj: T, paths: string[], fallback: Widen<U>): Widen<U>; // prettier-ignore\nexport function firstTruthyValue<T extends Record<string, any>, U>(obj: T, paths: string[]): U | undefined; // prettier-ignore\nexport function firstTruthyValue<T extends Record<string, any>, U>(\n    obj: T,\n    paths: string[],\n    fallback?: Widen<U>,\n) {\n    for (const path of paths) {\n        const val = get(obj, path);\n        if (val) {\n            return val;\n        }\n    }\n    return fallback;\n}\n/* eslint-enable @typescript-eslint/no-explicit-any */\n\nexport function swapWith<T>(arr: T[], a: number, b: number): T[] {\n    const list = [...arr];\n    const item = list.splice(a, 1);\n    return [...list.slice(0, b), ...item, ...list.slice(b)];\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","interface SelectorData {\n    element?: keyof HTMLElementTagNameMap;\n    id?: string;\n    classNames?: string[];\n    attributes?: Record<string, string | number | boolean>;\n}\n\nexport function createSelector(...selectors: SelectorData[]): string {\n    return selectors\n        .map(({ element, id, classNames = [], attributes = {} }) => {\n            let selector = '';\n            if (element) {\n                selector += `${element}`;\n            }\n            if (id) {\n                selector += `#${id}`;\n            }\n            for (const cls of classNames) {\n                selector += `.${cls}`;\n            }\n            for (const [k, v] of Object.entries(attributes)) {\n                if (typeof v === 'boolean') {\n                    selector += v ? `[${k}]` : '';\n                } else {\n                    selector += `[${k}=\"${v}\"]`;\n                }\n            }\n            return selector;\n        })\n        .join();\n}\n\nexport function getJSONScriptData<T>(id: string): T {\n    const selector = createSelector({\n        element: 'script',\n        id,\n        attributes: { type: 'application/json' },\n    });\n    const script = document.querySelector<HTMLScriptElement>(selector);\n    if (!script) {\n        throw new Error(`Unable to retrieve JSON data using ID \"${id}\"`);\n    }\n    return JSON.parse(script.innerHTML);\n}\n","import { serialize } from '@wordpress/blocks';\nimport { select } from '@wordpress/data';\n\nimport Processor from 'utils/processor';\n\nconst INVALID_BLOCK_TYPES = ['core/freeform', 'core/html'];\n\nexport function getEditorDOM(excludeInvalid = false): HTMLDivElement {\n    const doc = document.createElement('div');\n    if (excludeInvalid) {\n        const filteredBlocks = select('core/editor')\n            .getEditorBlocks()\n            .filter(\n                block =>\n                    !INVALID_BLOCK_TYPES.includes(block.name) && block.isValid,\n            );\n        doc.innerHTML = serialize(filteredBlocks);\n    } else {\n        doc.innerHTML = select('core/editor').getEditedPostContent();\n    }\n    return doc;\n}\n\nexport function parseBibAttributes({\n    entryspacing,\n    hangingindent,\n    maxoffset,\n    linespacing,\n    secondFieldAlign,\n}: { [k in keyof Processor.BibMeta]?: string }) {\n    return {\n        ...(entryspacing\n            ? { 'data-entryspacing': `${entryspacing}` }\n            : undefined),\n        ...(hangingindent\n            ? { 'data-hangingindent': `${hangingindent}` }\n            : undefined),\n        ...(maxoffset ? { 'data-maxoffset': `${maxoffset}` } : undefined),\n        ...(linespacing ? { 'data-linespacing': `${linespacing}` } : undefined),\n        ...(secondFieldAlign\n            ? { 'data-second-field-align': secondFieldAlign }\n            : undefined),\n    };\n}\n\nexport function stripListItem(item: Element | string): string {\n    if (typeof item === 'string') {\n        const container = document.createElement('div');\n        container.innerHTML = item;\n        const child = container.querySelector('.csl-entry');\n        if (child) {\n            item = child;\n        } else {\n            throw new Error(\n                'Outer HTML of item must be a div with className \"csl-entry\"',\n            );\n        }\n    }\n    const content = item;\n    let toRemove: Element[] = [];\n    for (const el of item.children) {\n        if (el.classList.contains('csl-indent')) {\n            break;\n        }\n        if (el.classList.contains('csl-left-margin')) {\n            toRemove = [...toRemove, el];\n            continue;\n        }\n        if (el.classList.contains('csl-right-inline')) {\n            el.outerHTML = el.innerHTML;\n        }\n    }\n    toRemove.forEach(el => content.removeChild(el));\n    return content.innerHTML.trim();\n}\n","(function() { module.exports = this[\"wp\"][\"url\"]; }());","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","var _typeof = require(\"../helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nmodule.exports = _nonIterableRest;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","import { omit } from 'lodash';\n\ninterface CacheJSON<T> {\n    [k: string]: {\n        expires: number;\n        data: Record<string, T>;\n    };\n}\n\ninterface StorageFallback extends Storage {\n    _value: Map<string, string>;\n}\n\nabstract class AbstractCache<T> {\n    private readonly PREFIX = 'ABT_CACHE_';\n    private readonly VERSION = 'v1.0';\n    private readonly EXPIRES: number;\n    private readonly ITEM_KEY: string;\n    private readonly KEY = `${this.PREFIX}${this.VERSION}`;\n    private readonly _cache = this.storageIsAvailable()\n        ? top.localStorage\n        : this.createFallbackStorage();\n\n    constructor(key: string, daysTilExpiration = 30) {\n        const ONE_DAY = 86400000;\n        this.ITEM_KEY = key;\n        this.EXPIRES = Date.now() + ONE_DAY * daysTilExpiration;\n        const { KEY, PREFIX } = this;\n\n        // Purge old cache versions\n        Object.keys(this._cache)\n            .filter(k => k.startsWith(PREFIX) && k !== KEY)\n            .forEach(k => this._cache.removeItem(k));\n    }\n\n    abstract async fetchItem(key: string): Promise<T>;\n\n    getItem(key: string): T | null {\n        return this.cache[key] || null;\n    }\n    removeItem(key: string): void {\n        this.cache = omit(this.cache, key);\n    }\n    setItem(key: string, value: T): void {\n        this.cache = {\n            ...this.cache,\n            [key]: value,\n        };\n    }\n\n    private get cache(): Record<string, T> {\n        const { EXPIRES: expires, ITEM_KEY, KEY } = this;\n        const value: CacheJSON<T> = JSON.parse(\n            this._cache.getItem(KEY) || '{}',\n        );\n        let item = value[ITEM_KEY];\n        if (!item || item.expires < Date.now()) {\n            item = {\n                expires,\n                data: {},\n            };\n            this._cache.setItem(\n                KEY,\n                JSON.stringify({\n                    ...value,\n                    [ITEM_KEY]: { ...item },\n                }),\n            );\n        }\n        return { ...item.data };\n    }\n    private set cache(data: Record<string, T>) {\n        const { ITEM_KEY, KEY } = this;\n        const value: CacheJSON<T> = JSON.parse(\n            this._cache.getItem(KEY) || '{}',\n        );\n        const item = value[ITEM_KEY];\n        this._cache.setItem(\n            KEY,\n            JSON.stringify({ ...value, [ITEM_KEY]: { ...item, data } }),\n        );\n    }\n\n    private storageIsAvailable(): boolean {\n        const TEST_KEY = '__storage_test__';\n        try {\n            const storage = window.localStorage;\n            storage.setItem(TEST_KEY, 'test');\n            storage.removeItem(TEST_KEY);\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    private createFallbackStorage(): StorageFallback {\n        return {\n            _value: new Map(),\n            get length() {\n                return this._value.size;\n            },\n            clear() {\n                this._value.clear();\n            },\n            getItem(key) {\n                return this._value.get(key) || null;\n            },\n            key(index) {\n                return [...this._value.keys()][index] || null;\n            },\n            removeItem(key) {\n                this._value.delete(key);\n            },\n            setItem(key, value) {\n                this._value.set(key, value);\n            },\n        };\n    }\n}\n\nexport const localeCache = new (class extends AbstractCache<string> {\n    private parser = new DOMParser();\n\n    async fetchItem(style: string): Promise<string> {\n        const xml = this.parser.parseFromString(style, 'application/xml');\n        const styleNode = xml.querySelector('style');\n        if (xml.querySelector('parsererror')) {\n            throw new Error('Invalid style XML');\n        }\n        if (!styleNode) {\n            throw new Error('CSL style is not valid');\n        }\n        const localeId = styleNode.getAttribute('default-locale') || 'en-US';\n        const response = await fetch(\n            `https://raw.githubusercontent.com/citation-style-language/locales/master/locales-${localeId}.xml`,\n        );\n        if (!response.ok) {\n            throw new Error(response.statusText);\n        }\n        const locale = await response.text();\n        this.setItem(localeId, locale);\n        return locale;\n    }\n})('locales');\n\nexport const styleCache = new (class extends AbstractCache<string> {\n    async fetchItem(styleId: string): Promise<string> {\n        const cached = this.getItem(styleId);\n        if (cached !== null) {\n            return cached;\n        }\n        const response = await fetch(\n            `https://raw.githubusercontent.com/citation-style-language/styles/master/${styleId}.csl`,\n        );\n        if (!response.ok) {\n            throw new Error(response.statusText);\n        }\n        const style = await response.text();\n        this.setItem(styleId, style);\n        return style;\n    }\n})('styles');\n","function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nmodule.exports = _nonIterableSpread;","function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutPropertiesLoose;","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","/* eslint-disable @typescript-eslint/camelcase */\nimport { addQueryArgs } from '@wordpress/url';\n\ndeclare const _abt_nonce: string;\ndeclare const ajaxurl: string;\n\nexport async function fetchAjax(\n    action: string,\n    body?: Record<string, string | number | boolean>,\n): Promise<Response> {\n    return fetch(ajaxurl, {\n        method: 'POST',\n        headers: {\n            'Content-type': 'application/x-www-form-urlencoded',\n        },\n        body: addQueryArgs(undefined, {\n            _wpnonce: _abt_nonce,\n            action,\n            ...body,\n        }).slice(1),\n        credentials: 'same-origin',\n    });\n}\n","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","(function() { module.exports = this[\"CSL\"]; }());","import { select } from '@wordpress/data';\nimport { Bibliography as RawBib, Bibmeta, Citation, Engine } from 'citeproc';\nimport { flatten, zipWith } from 'lodash';\n\nimport { localeCache } from 'utils/cache';\n\nnamespace Processor {\n    export interface BibItem {\n        content: string;\n        id: string;\n    }\n\n    export type BibMeta = Partial<\n        Pick<\n            Bibmeta,\n            'entryspacing' | 'hangingindent' | 'linespacing' | 'maxoffset'\n        > & {\n            secondFieldAlign: Bibmeta['second-field-align'];\n        }\n    >;\n\n    export interface Bibliography {\n        items: BibItem[];\n        meta: BibMeta;\n    }\n\n    export interface CitationMeta {\n        /**\n         * ID of the citation HTMLElement.\n         */\n        id: string;\n        /**\n         * Parsed citation HTML to set as the citation HTMLElement innerHTML.\n         */\n        html: string;\n        /**\n         * A JSON stringified list of the sorted item ids in the citation.\n         */\n        sortedItems: string;\n    }\n}\nclass Processor {\n    private static instance: Processor | null = null;\n    private style!: string;\n    private engine!: Engine;\n\n    private sys: Engine['sys'] = {\n        retrieveItem(id: string): CSL.Data {\n            const item = select('abt/data').getItemById(id);\n            if (!item) {\n                throw new Error(\n                    `CSL Data could not be found for item ID \"${id}\"`,\n                );\n            }\n            return item;\n        },\n        retrieveLocale(lang: string) {\n            const locale = localeCache.getItem(lang);\n            if (!locale) {\n                throw new Error(\n                    `Requested locale \"${lang}\" was not prefetched`,\n                );\n            }\n            return locale;\n        },\n    };\n\n    /* eslint-disable @typescript-eslint/camelcase */\n    constructor(style: string) {\n        const { instance } = Processor;\n        if (instance) {\n            if (instance.style !== style) {\n                instance.style = style;\n                instance.engine = new Engine(instance.sys, instance.style);\n                instance.engine.opt.development_extensions.wrap_url_and_doi = true;\n            }\n            return instance;\n        } else {\n            Processor.instance = this;\n            this.style = style;\n            this.engine = new Engine(this.sys, this.style);\n            this.engine.opt.development_extensions.wrap_url_and_doi = true;\n        }\n    }\n    /* eslint-enable @typescript-eslint/camelcase */\n\n    parseCitations(citations: Citation[]): Processor.CitationMeta[] {\n        return this.engine\n            .rebuildProcessorState(citations)\n            .map(([id, , html]) => {\n                const sortedItems = JSON.stringify(\n                    this.registry.citationById[id].sortedItems.map(\n                        ([ref]) => ref.id,\n                    ),\n                );\n                return {\n                    id,\n                    html,\n                    sortedItems,\n                };\n            });\n    }\n\n    get bibliography(): Processor.Bibliography {\n        let data: RawBib | false;\n        try {\n            data = this.engine.makeBibliography();\n            if (!data) {\n                return { items: [], meta: {} };\n            }\n        } catch {\n            return { items: [], meta: {} };\n        }\n        const [meta, html] = data;\n        const {\n            entryspacing,\n            hangingindent,\n            linespacing,\n            maxoffset,\n            ['second-field-align']: secondFieldAlign,\n        } = meta;\n        return {\n            meta: {\n                entryspacing,\n                hangingindent,\n                linespacing,\n                maxoffset,\n                secondFieldAlign: secondFieldAlign\n                    ? secondFieldAlign\n                    : undefined,\n            },\n            items: zipWith(flatten(meta.entry_ids), html, (id, content) => ({\n                id,\n                content,\n            })),\n        };\n    }\n\n    private get registry() {\n        return this.engine.registry.citationreg;\n    }\n}\n\nexport default Processor;\n","\"use strict\";\n\nfunction hash(str) {\n  var hash = 5381,\n      i    = str.length;\n\n  while(i) {\n    hash = (hash * 33) ^ str.charCodeAt(--i);\n  }\n\n  /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n   * integers. Since we want the results to be always positive, convert the\n   * signed int to an unsigned by doing an unsigned bitshift. */\n  return hash >>> 0;\n}\n\nmodule.exports = hash;\n","/* eslint-disable @typescript-eslint/camelcase */\nimport { Action, select } from '@wordpress/data';\n\nimport { fetchAjax } from 'utils/ajax';\nimport { localeCache, styleCache } from 'utils/cache';\n\nimport { StyleJSON } from './';\nimport { StyleKind } from './constants';\n\nconst enum CtrlActions {\n    FETCH_CITATION_STYLES = 'FETCH_CITATION_STYLES',\n    FETCH_LOCALE = 'FETCH_LOCALE',\n    FETCH_STYLE = 'FETCH_STYLE',\n    SAVE_STATE = 'SAVE_STATE',\n}\n\nexport function fetchCitationStyles() {\n    return {\n        type: CtrlActions.FETCH_CITATION_STYLES,\n    };\n}\n\nexport function fetchLocale(style: string) {\n    return {\n        type: CtrlActions.FETCH_LOCALE,\n        style,\n    };\n}\n\nexport function fetchStyle() {\n    const { value, kind } = select('abt/data').getStyle();\n    if (kind === StyleKind.CUSTOM) {\n        return value;\n    }\n    return {\n        type: CtrlActions.FETCH_STYLE,\n        id: value,\n    };\n}\n\nexport function saveState() {\n    const id = select('core/editor').getCurrentPostId();\n    const post = select('abt/data').getSerializedState();\n    return {\n        type: CtrlActions.SAVE_STATE,\n        id,\n        state: post.meta._abt_state,\n    };\n}\n\nconst controls = {\n    async FETCH_CITATION_STYLES(): Promise<StyleJSON> {\n        const response = await fetchAjax('get_style_json');\n        return response.json();\n    },\n    async FETCH_LOCALE({ style }: Action): Promise<string> {\n        return localeCache.fetchItem(style);\n    },\n    async FETCH_STYLE({ id }: Action): Promise<string> {\n        return styleCache.fetchItem(id);\n    },\n    async SAVE_STATE({ id, state }: Action) {\n        const response = await fetchAjax('update_abt_state', {\n            post_id: id,\n            state,\n        });\n        return response.json();\n    },\n};\n\nexport default controls;\n","import { createBlock, parse } from '@wordpress/blocks';\nimport { dispatch, select } from '@wordpress/data';\n\nimport { ZERO_WIDTH_SPACE } from 'utils/constants';\nimport { createSelector } from 'utils/dom';\nimport { getEditorDOM } from 'utils/editor';\nimport { CitationElement, FootnoteElement } from 'utils/element';\nimport Processor from 'utils/processor';\n\nimport { Style } from './';\nimport { Actions } from './constants';\nimport { fetchLocale, fetchStyle, saveState } from './controls';\n\nexport function* addReference(data: CSL.Data) {\n    yield addReferences([data]);\n}\n\nexport function* addReferences(data: CSL.Data[]) {\n    yield {\n        type: Actions.ADD_REFERENCES,\n        data,\n    };\n    yield save();\n}\n\nexport function* removeFootnote(id: string) {\n    yield removeFootnotes([id]);\n}\n\nexport function* removeFootnotes(itemIds: string[]) {\n    const doc = getEditorDOM();\n    let removedItems = 0;\n    for (const footnote of doc.querySelectorAll(FootnoteElement.selector)) {\n        if (itemIds.includes(`${footnote.id}-ref`) && footnote.parentNode) {\n            footnote.parentNode.removeChild(footnote);\n            removedItems++;\n        }\n    }\n    if (removedItems > 0) {\n        yield save();\n    }\n}\n\nexport function* removeReference(id: string) {\n    yield removeReferences([id]);\n}\n\nexport function* removeReferences(itemIds: string[]) {\n    const doc = getEditorDOM();\n    const toDelete = [\n        ...doc.querySelectorAll<HTMLSpanElement>(CitationElement.selector),\n    ].reduce(\n        (idsToDelete, citation) => {\n            const existingIds = CitationElement.getItems(citation);\n            const filteredItemIds = existingIds.filter(\n                id => !itemIds.includes(id),\n            );\n            if (filteredItemIds.length === 0 && citation.parentNode) {\n                citation.parentNode.removeChild(citation);\n            } else {\n                citation.dataset.items = JSON.stringify(filteredItemIds);\n            }\n            return idsToDelete.filter(id => !existingIds.includes(id));\n        },\n        [...itemIds],\n    );\n\n    yield dispatch('core/block-editor').resetBlocks(parse(doc.innerHTML));\n    if (toDelete.length > 0) {\n        yield {\n            type: Actions.REMOVE_REFERENCES,\n            itemIds: toDelete,\n        };\n        yield save();\n    }\n}\n\nexport function* updateReference(data: CSL.Data) {\n    const itemIsCited =\n        select('abt/data')\n            .getCitedItems()\n            .findIndex(item => item.id === data.id) >= 0;\n    yield {\n        type: Actions.UPDATE_REFERENCE,\n        data,\n    };\n    if (itemIsCited) {\n        yield parseCitations();\n    }\n    yield save();\n}\n\nexport function* removeAllCitations() {\n    const doc = getEditorDOM();\n    for (const el of doc.querySelectorAll(CitationElement.selector)) {\n        if (el.parentNode) {\n            el.parentNode.removeChild(el);\n        }\n    }\n    yield dispatch('core/block-editor').resetBlocks(parse(doc.innerHTML));\n}\n\nexport function* parseCitations() {\n    const styleXml: string = yield fetchStyle();\n    yield fetchLocale(styleXml);\n    const processor = new Processor(styleXml);\n    const citations = processor.parseCitations(\n        select('abt/data').getCitationsByIndex(),\n    );\n    yield setBibliography(processor.bibliography);\n    yield updateEditorCitations(citations);\n}\n\nexport function* parseFootnotes() {\n    const doc = getEditorDOM();\n    doc.querySelectorAll(FootnoteElement.selector).forEach((footnote, i) => {\n        footnote.innerHTML = FootnoteElement.createMarker(i);\n    });\n    yield dispatch('core/block-editor').resetBlocks(parse(doc.innerHTML));\n    yield setFootnotes();\n}\n\nexport function* setStyle(style: Style) {\n    yield {\n        type: Actions.SET_STYLE,\n        style,\n    };\n    yield parseCitations();\n    yield save();\n}\n\nfunction* save() {\n    yield saveState();\n    yield dispatch('core/editor').autosave();\n}\n\nfunction* setBibliography({ items, meta }: Processor.Bibliography) {\n    const blocksList = select('core/block-editor').getBlocks();\n    const bibliographyBlock = blocksList.find(\n        block => block.name === 'abt/bibliography',\n    );\n    if (items.length > 0 && bibliographyBlock) {\n        yield dispatch('core/block-editor').updateBlockAttributes(\n            bibliographyBlock.clientId,\n            { ...meta, items },\n        );\n    } else if (items.length > 0 && !bibliographyBlock) {\n        yield dispatch('core/block-editor').insertBlock(\n            createBlock('abt/bibliography', {\n                ...meta,\n                items,\n            }),\n            blocksList.length,\n            undefined,\n            false,\n        );\n    } else if (items.length === 0 && bibliographyBlock) {\n        yield dispatch('core/block-editor').removeBlock(\n            bibliographyBlock.clientId,\n        );\n    }\n}\n\nfunction* setFootnotes() {\n    const items = select('abt/data').getFootnotes();\n    const blocksList = select('core/block-editor').getBlocks();\n    const footnoteBlockIndex = blocksList.findIndex(\n        ({ name }) => name === 'abt/footnotes',\n    );\n    const bibliographyBlockIndex = blocksList.findIndex(\n        ({ name }) => name === 'abt/bibliography',\n    );\n    if (items.length > 0 && footnoteBlockIndex >= 0) {\n        yield dispatch('core/block-editor').updateBlockAttributes(\n            blocksList[footnoteBlockIndex].clientId,\n            { items },\n        );\n    } else if (items.length > 0 && footnoteBlockIndex === -1) {\n        yield dispatch('core/block-editor').insertBlock(\n            createBlock('abt/footnotes', {\n                items,\n            }),\n            bibliographyBlockIndex > 0\n                ? bibliographyBlockIndex\n                : blocksList.length,\n            undefined,\n            false,\n        );\n    } else if (items.length === 0 && footnoteBlockIndex >= 0) {\n        yield dispatch('core/block-editor').removeBlock(\n            blocksList[footnoteBlockIndex].clientId,\n        );\n    }\n}\n\nfunction* updateEditorCitations(citations: Processor.CitationMeta[]) {\n    const doc = getEditorDOM();\n    for (const { html, id, sortedItems } of citations) {\n        const node = doc.querySelector<HTMLElement>(\n            createSelector(\n                ...CitationElement.legacyClassNames.map(cls => ({\n                    classNames: [cls],\n                    attributes: { id },\n                })),\n            ),\n        );\n        if (node) {\n            node.innerHTML = html;\n            node.dataset.items = sortedItems;\n            if (node.firstElementChild) {\n                node.dataset.hasChildren = 'true';\n                node.firstElementChild.innerHTML =\n                    ZERO_WIDTH_SPACE +\n                    node.firstElementChild.innerHTML +\n                    ZERO_WIDTH_SPACE;\n            } else {\n                delete node.dataset.hasChildren;\n                node.innerHTML = ZERO_WIDTH_SPACE + html + ZERO_WIDTH_SPACE;\n            }\n        }\n    }\n    yield dispatch('core/block-editor').resetBlocks(parse(doc.innerHTML));\n}\n","import { Action, combineReducers } from '@wordpress/data';\nimport hash from 'string-hash';\n\nimport { getJSONScriptData } from 'utils/dom';\n\nimport { SavedState, State } from './';\nimport { Actions } from './constants';\n\nconst INITIAL_STATE: State = {\n    citationStyles: {\n        renamed: {},\n        styles: [],\n    },\n    ...getJSONScriptData<SavedState>('abt-editor-state'),\n};\n\nexport function citationStyles(\n    state = INITIAL_STATE.citationStyles,\n    action: Action,\n): State['citationStyles'] {\n    switch (action.type) {\n        case Actions.SET_CITATION_STYLES: {\n            return action.styles;\n        }\n        default:\n            return state;\n    }\n}\n\nexport function references(\n    state = INITIAL_STATE.references,\n    action: Action,\n): State['references'] {\n    switch (action.type) {\n        case Actions.ADD_REFERENCES: {\n            const newItems = (action.data as CSL.Data[])\n                .map(({ id, ...data }) => ({\n                    ...data,\n                    id: `${hash(JSON.stringify(data))}`,\n                }))\n                .filter(\n                    ({ id }) => state.findIndex(item => item.id === id) === -1,\n                );\n            return newItems.length > 0 ? [...state, ...newItems] : state;\n        }\n        case Actions.REMOVE_REFERENCES: {\n            return state.filter(({ id }) => !action.itemIds.includes(id));\n        }\n        case Actions.UPDATE_REFERENCE: {\n            const index = state.findIndex(({ id }) => id === action.data.id);\n            return index === -1\n                ? [...state, action.data]\n                : [\n                      ...state.slice(0, index),\n                      action.data,\n                      ...state.slice(index + 1),\n                  ];\n        }\n        default:\n            return state;\n    }\n}\n\nexport function style(\n    state = INITIAL_STATE.style,\n    action: Action,\n): State['style'] {\n    switch (action.type) {\n        case Actions.SET_STYLE:\n            return action.style;\n        default:\n            return state;\n    }\n}\n\nexport default combineReducers({\n    citationStyles,\n    references,\n    style,\n});\n","import { Actions } from './constants';\nimport { fetchCitationStyles } from './controls';\n\nexport function* getCitationStyles() {\n    const styles = yield fetchCitationStyles();\n    return {\n        type: Actions.SET_CITATION_STYLES,\n        styles,\n    };\n}\n","import { Citation } from 'citeproc';\nimport lodash, { differenceWith, get, orderBy, partial } from 'lodash';\n\nimport { clone, firstTruthyValue } from 'utils/data';\nimport { getEditorDOM } from 'utils/editor';\nimport { CitationElement, FootnoteElement } from 'utils/element';\n\nimport { State } from './';\n\nexport function getCitationStyles(state: State): State['citationStyles'] {\n    return clone(state.citationStyles);\n}\n\nexport function getStyle(state: State): State['style'] {\n    return clone(state.style);\n}\n\nexport function getCitationsByIndex(state: State): Citation[] {\n    const doc = getEditorDOM(true);\n    const citations = [\n        ...doc.querySelectorAll<HTMLElement>(CitationElement.selector),\n    ];\n    return citations.map((el, index) => {\n        const citationID = el.id;\n        const citationItems = CitationElement.getItems(el).reduce(\n            (arr, id) => {\n                const item = getItemById(state, id);\n                return item !== undefined ? [...arr, { id, item }] : arr;\n            },\n            [] as Citation['citationItems'],\n        );\n        return {\n            citationID,\n            citationItems,\n            properties: {\n                index,\n                noteIndex: 0,\n            },\n        };\n    });\n}\n\nexport function getCitedItems(state: State): CSL.Data[] {\n    const doc = getEditorDOM(true);\n    return lodash([\n        ...doc.querySelectorAll<HTMLElement>(CitationElement.selector),\n    ])\n        .flatMap(CitationElement.getItems)\n        .uniq()\n        .map(partial(getItemById, state))\n        .compact()\n        .value();\n}\n\nexport function getFootnotes() {\n    const doc = getEditorDOM();\n    const container = document.createElement('div');\n    const marker = document.createElement('div');\n    const content = document.createElement('div');\n    marker.className = 'abt-footnotes-item__marker';\n    content.className = 'abt-footnotes-item__content';\n    container.appendChild(marker);\n    container.appendChild(content);\n    return [...doc.querySelectorAll<HTMLElement>(FootnoteElement.selector)].map(\n        footnote => {\n            marker.innerHTML = footnote.innerHTML;\n            content.textContent = footnote.dataset.note || '';\n            return {\n                id: `${footnote.id}-ref`,\n                content: container.innerHTML,\n            };\n        },\n    );\n}\n\nexport function getItems(state: State, kind?: 'cited' | 'uncited'): CSL.Data[] {\n    switch (kind) {\n        case 'cited':\n            return getCitedItems(state);\n        case 'uncited':\n            return getUncitedItems(state);\n        default:\n            return clone(state.references);\n    }\n}\n\nexport function getSortedItems(\n    state: State,\n    mode: 'date' | 'publication' | 'title' = 'title',\n    order: 'asc' | 'desc' = 'asc',\n    kind?: 'cited' | 'uncited',\n): CSL.Data[] {\n    return orderBy(\n        getItems(state, kind),\n        item => {\n            switch (mode) {\n                case 'date': {\n                    const [year, month = 0, day = 1]: number[] = get(\n                        item.issued,\n                        '[date-parts][0]',\n                        [-5000],\n                    );\n                    return new Date(year, month, day).toJSON();\n                }\n                case 'publication':\n                    return firstTruthyValue(\n                        item,\n                        [\n                            'journalAbbreviation',\n                            'container-title-short',\n                            'container-title',\n                            'publisher',\n                        ],\n                        '~',\n                    );\n                case 'title':\n                default:\n                    return item.title || '~';\n            }\n        },\n        order,\n    );\n}\n\nexport function getItemById(state: State, id: string): CSL.Data | undefined {\n    return clone(state.references.find(item => item.id === id));\n}\n\nexport function getSerializedState({ references, style }: State) {\n    return {\n        meta: {\n            // eslint-disable-next-line @typescript-eslint/camelcase\n            _abt_state: JSON.stringify({ references, style }),\n        },\n    };\n}\n\nexport function getUncitedItems(state: State): CSL.Data[] {\n    return differenceWith(\n        state.references,\n        getCitedItems(state),\n        (left, right) => left.id === right.id,\n    );\n}\n","import * as actions from './actions';\nimport { StyleKind } from './constants';\nimport controls from './controls';\nimport reducer from './reducer';\nimport * as resolvers from './resolvers';\nimport * as selectors from './selectors';\n\nexport interface Style {\n    kind: StyleKind;\n    value: string;\n    label: string;\n    shortTitle?: string;\n}\n\nexport interface StyleJSON {\n    renamed: Record<string, string>;\n    styles: Style[];\n}\n\nexport interface SavedState {\n    references: CSL.Data[];\n    style: Style;\n}\n\nexport interface State extends SavedState {\n    citationStyles: StyleJSON;\n}\n\nexport const name = 'abt/data';\n\nexport const config = {\n    actions,\n    controls,\n    reducer,\n    resolvers,\n    selectors,\n};\n\nexport default [name, config] as [string, typeof config];\n","import { IdentifierKind } from 'utils/constants';\n\nimport { Actions } from './constants';\n\nexport function clearSelectedItems() {\n    return {\n        type: Actions.CLEAR_SELECTED_ITEMS,\n    };\n}\n\nexport function setIdentifierKind(kind: IdentifierKind) {\n    return {\n        type: Actions.SET_IDENTIFIER_KIND,\n        kind,\n    };\n}\n\nexport function setSidebarSortMode(mode: 'date' | 'publication' | 'title') {\n    return {\n        type: Actions.SET_SIDEBAR_SORT_MODE,\n        mode,\n    };\n}\n\nexport function setSidebarSortOrder(order: 'asc' | 'desc') {\n    return {\n        type: Actions.SET_SIDEBAR_SORT_ORDER,\n        order,\n    };\n}\n\nexport function toggleItemSelected(id: string) {\n    return {\n        type: Actions.TOGGLE_ITEM_SELECTED,\n        id,\n    };\n}\n","import { Action, combineReducers } from '@wordpress/data';\n\nimport { IdentifierKind } from 'utils/constants';\n\nimport { State } from './';\nimport { Actions } from './constants';\n\nconst ARD_INITIAL_STATE: State['addReferenceDialog'] = {\n    identifierKind: IdentifierKind.DOI,\n};\n\nexport function addReferenceDialog(\n    state = ARD_INITIAL_STATE,\n    action: Action,\n): State['addReferenceDialog'] {\n    switch (action.type) {\n        case Actions.SET_IDENTIFIER_KIND: {\n            return {\n                ...state,\n                identifierKind: action.kind,\n            };\n        }\n        default:\n            return state;\n    }\n}\n\nconst SIDEBAR_INITIAL_STATE: State['sidebar'] = {\n    selectedItems: [],\n    sortMode: 'title',\n    sortOrder: 'asc',\n};\n\nexport function sidebar(\n    state = SIDEBAR_INITIAL_STATE,\n    action: Action,\n): State['sidebar'] {\n    switch (action.type) {\n        case Actions.CLEAR_SELECTED_ITEMS: {\n            return {\n                ...state,\n                selectedItems: [],\n            };\n        }\n        case Actions.SET_SIDEBAR_SORT_MODE: {\n            return {\n                ...state,\n                sortMode: action.mode,\n            };\n        }\n        case Actions.SET_SIDEBAR_SORT_ORDER: {\n            return {\n                ...state,\n                sortOrder: action.order,\n            };\n        }\n        case Actions.TOGGLE_ITEM_SELECTED: {\n            return {\n                ...state,\n                selectedItems: state.selectedItems.includes(action.id)\n                    ? state.selectedItems.filter(id => id !== action.id)\n                    : [...state.selectedItems, action.id],\n            };\n        }\n        default:\n            return state;\n    }\n}\n\nexport default combineReducers({\n    addReferenceDialog,\n    sidebar,\n});\n","import { State } from './';\n\nexport function getIdentifierKind(state: State) {\n    return state.addReferenceDialog.identifierKind;\n}\n\nexport function getSelectedItems(state: State) {\n    return [...state.sidebar.selectedItems];\n}\n\nexport function getSidebarSortMode(state: State) {\n    return state.sidebar.sortMode;\n}\n\nexport function getSidebarSortOrder(state: State) {\n    return state.sidebar.sortOrder;\n}\n","import { IdentifierKind } from 'utils/constants';\n\nimport * as actions from './actions';\nimport reducer from './reducer';\nimport * as selectors from './selectors';\n\nexport interface State {\n    sidebar: {\n        selectedItems: string[];\n        sortMode: 'date' | 'publication' | 'title';\n        sortOrder: 'asc' | 'desc';\n    };\n    addReferenceDialog: {\n        identifierKind: IdentifierKind;\n    };\n}\n\nexport const name = 'abt/ui';\n\nexport const config = {\n    actions,\n    reducer,\n    selectors,\n};\n\nexport default [name, config] as [string, typeof config];\n","import { registerStore } from '@wordpress/data';\n\nimport dataStore from './data';\nimport uiStore from './ui';\n\nregisterStore(...dataStore);\nregisterStore(...uiStore);\n"],"sourceRoot":""}