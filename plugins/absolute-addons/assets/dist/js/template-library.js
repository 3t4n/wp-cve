"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var r=_superPropBase(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:a):o.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var a,r=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;a=Reflect.construct(r,arguments,o)}else a=r.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}!function(e,t,a){e(document).ready((function(){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return elementorCommon.translate(e,null,t,a.i18n)},o="elementor-add-section",n="elementor-add-absp-button",i='<div class="',l="-drag-title",s=i+o+"-area-button "+n+'" title="'+r("browse_libs")+'"> <i class="absp-lib-logo eicon-plus"></i> </div>',c=e("#tmpl-"+o);c.length&&c.html(c.html().replace(i+o+l,s+i+o+l));var p=-1,u=Backbone,d=u.Collection,m=u.Model,f=u.Radio,b=Marionette,g=b.Behavior,h=b.ItemView,y=b.CompositeView,v=b.TemplateCache,w=b.Renderer,k={desktop:"100%",tab:"768px",mobile:"360px"},C={text:{callback:function(e){return e=e.toLowerCase(),this.get("title").toLowerCase().indexOf(e)>=0||_.any(this.get("tags"),(function(t){return t.toLowerCase().indexOf(e)>=0}))}},tags:{callback:function(e){return _.any(this.get("tags"),(function(t){return t.indexOf(e)>=0}))}},type:{callback:function(e){return this.get("type")===e}},subtype:{},favorite:{callback:function(e){return this.get("favorite")}}},L=m.extend({defaults:{template_id:0,title:"",type:"",thumbnail:"",url:"",tags:[],isPro:!1,favorite:!1,views:0,downloads:0}}),P=d.extend({model:L}),O=g.extend({ui:{insertButton:".absp-templates-modal__insert-button"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){AbspLibrary.insertTemplate({model:this.view.model})}}),x=h.extend({id:"elementor-template-library-templates-empty",template:"#tmpl-absp-templates-modal__empty",ui:{title:".elementor-template-library-blank-title",message:".elementor-template-library-blank-message"},modesStrings:{empty:{title:r("sync_error"),message:r("sync_again")},noResults:{title:r("no_result"),message:r("search_different")},noFavorites:{title:r("no_favorite"),message:r("make_favorite")}},getCurrentMode:function(){return AbspLibrary.getFilter("text")?"noResults":AbspLibrary.getFilter("favorite")?"noFavorites":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),F=h.extend({template:"#tmpl-absp-templates-modal__template",className:"absp-templates-modal__template",ui:{previewButton:".absp-templates-modal__preview-button, .absp-templates-modal__template-preview",favoriteButton:".absp-template-library-template-favorite-label"},events:{"click @ui.previewButton":"onPreviewButtonClick","click @ui.favoriteButton":"onFavoriteButtonClick"},behaviors:{insertTemplate:{behaviorClass:O}},onPreviewButtonClick:function(){AbspLibrary.showPreviewView(this.model)},onFavoriteButtonClick:function(){var e=this.model,t=e.get("favorite");e.set("favorite",!t),AbspLibrary.toggleFavorite(e.get("template_id"),!t)}}),B=y.extend({template:"#tmpl-absp-templates-modal__templates",id:"absp-templates-modal__templates",childViewContainer:".absp-templates-modal__templates-list",emptyView:function(){return new x},ui:{templatesWindow:".absp-templates-modal__templates-window",textFilter:"#absp-templates-modal__search",tagsFilter:"#absp-templates-modal__filter-tags",filterBar:"#absp-templates-modal__toolbar-filter",favouriteFilter:"#absp-template-library-filter-my-favorites"},events:{"input @ui.textFilter":"onTextFilterInput","click @ui.tagsFilter li":"onTagsFilterClick","click @ui.favouriteFilter":"onShowFavorites"},getChildView:function(){return F},initialize:function(){this.listenTo(AbspLibrary.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=AbspLibrary.getFilterTerms(),a=!0;return _.each(t,(function(t,r){var o=AbspLibrary.getFilter(r);if(o&&t.callback){var n=t.callback.call(e,o);return n||(a=!1),n}})),a},setMasonrySkin:function(){var e=this,t=new elementorModules.utils.Masonry({container:e.$childViewContainer,items:e.$childViewContainer.children(),columnsCount:3});e.$childViewContainer.imagesLoaded(t.run.bind(t))},onRenderCollection:function(){this.setMasonrySkin(),this.updatePerfectScrollbar()},onTextFilterInput:function(){var e=this;_.defer((function(){AbspLibrary.setFilter("text",e.ui.textFilter.val())}))},onShowFavorites:function(e){e.preventDefault(),AbspLibrary.setFilter("favorite",e.target.classList.toggle("active"))},onTagsFilterClick:function(t){var a=e(t.currentTarget),o=a.data("tag");AbspLibrary.setFilter("tags",o),a.addClass("active").siblings().removeClass("active"),o=o?AbspLibrary.getTags()[o]:r("Filter"),this.ui.filterBar.find(".absp-templates-modal__filter-btn").html(o)},updatePerfectScrollbar:function(){var e=this;e.perfectScrollbar||(e.perfectScrollbar=new PerfectScrollbar(e.ui.templatesWindow[0],{suppressScrollX:!0}),e.perfectScrollbar.isRtl=!1,e.perfectScrollbar.update())},setTagsFilterHover:function(){var e=this,t=e.ui.filterBar.find(".absp-templates-modal__filter-btn i");e.ui.filterBar.hoverIntent((function(){e.ui.tagsFilter.css("display","block"),t.addClass("eicon-caret-down").removeClass("eicon-caret-right")}),(function(){e.ui.tagsFilter.css("display","none"),t.addClass("eicon-caret-right").removeClass("eicon-caret-down")}),{sensitivity:50,interval:150,timeout:100})},onRender:function(){this.setTagsFilterHover(),this.updatePerfectScrollbar()}}),T=h.extend({template:"#tmpl-absp-templates-modal__header-menu",id:"elementor-template-library-header-menu",className:"absp-templates-modal__header-menu",templateHelpers:function(){return AbspLibrary.getTabs()},ui:{items:"> .elementor-component-tab"},events:{"click @ui.items":"onTabItemClick"},onTabItemClick:function(t){var a=e(t.currentTarget);a.addClass("elementor-active").siblings().removeClass("elementor-active"),AbspLibrary.setFilter("type",a.data("tab"))}}),M=h.extend({template:"#tmpl-absp-templates-modal__header-menu-responsive",id:"elementor-template-library-header-menu-responsive",className:"absp-templates-modal__header-menu-responsive",ui:{items:"> .elementor-component-tab"},events:{"click @ui.items":"onTabItemClick"},onTabItemClick:function(t){var a=e(t.currentTarget);a.addClass("elementor-active").siblings().removeClass("elementor-active"),AbspLibrary.channels.tabs.trigger("change:device",a.data("tab"),a)}}),A=h.extend({template:"#tmpl-absp-templates-modal__header-back",id:"elementor-template-library-header-preview-back",className:"absp-templates-modal__header-back",events:function(){return{click:"goBack"}},goBack:function(){return AbspLibrary.showBlocksView()}}),V=h.extend({template:"#tmpl-absp-templates-modal__header-insert",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:O}}}),S=h.extend({template:"#tmpl-absp-templates-modal__loading",id:"absp-templates-modal__loading"}),R=h.extend({template:"#tmpl-absp-templates-modal__header-logo",className:"absp-templates-modal__header-logo",templateHelpers:function(){return{title:this.getOption("title")}}}),j=h.extend({template:"#tmpl-absp-templates-modal__header-actions",id:"elementor-template-library-header-actions",ui:{sync:"#absp-templates-modal__header-sync i"},events:{"click @ui.sync":"syncLibrary"},syncLibrary:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),AbspLibrary.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),AbspLibrary.updateBlocksView()},forceUpdate:!0,forceSync:!0})}}),D=h.extend({template:"#tmpl-absp-templates-modal__preview",className:"absp-templates-modal__preview",ui:{iframe:"> iframe"},onRender:function(){var e=this;e.ui.iframe.attr("src",e.getOption("url")).hide(),e.$el.append((new S).render().el),e.ui.iframe.on("load",(function(){e.$el.find("#absp-templates-modal__loading").remove(),e.ui.iframe.show()}))}}),I=function(t){_inherits(n,elementorModules.common.views.modal.Layout);var o=_createSuper(n);function n(){return _classCallCheck(this,n),o.apply(this,arguments)}return _createClass(n,[{key:"getModalOptions",value:function(){return{id:"absp-templates-library-modal",hide:{onOutsideClick:!1,onEscKeyPress:!0,onBackgroundClick:!1}}}},{key:"getTemplateActionButton",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"footer",o=t.isPro&&!a.has_pro?"pro":"insert";"footer"===r&&(t.position="footer"),"pro"===o&&(t.proLink="https://absoluteplugins.com/wordpress-plugins/absolute-addons/pricing/"+"?utm_source=template-library&utm_medium=template-library&utm_campaign=get-pro&utm_content=library-".concat(r,"-get-pro"));var n=v.get("#tmpl-absp-templates-modal__".concat(o,"-button"));return w.render(n,e.extend({},{slug:o,position:r},t))}},{key:"showLogo",value:function(e){this.getHeaderView().logoArea.show(new R(e))}},{key:"showDefaultHeader",value:function(){this.showLogo({title:r("library_name")});var e=this.getHeaderView();e.tools.show(new j),e.menuArea.show(new T)}},{key:"showPreviewView",value:function(e){var t=this.getHeaderView();t.menuArea.show(new M),t.logoArea.show(new A),t.tools.show(new V({model:e})),this.modalContent.show(new D({url:e.get("url")}))}},{key:"showBlocksView",value:function(e){this.modalContent.show(new B({collection:e}))}},{key:"showLoadingView",value:function(){_get(_getPrototypeOf(n.prototype),"showLoadingView",this).call(this)}},{key:"hideLoadingView",value:function(){_get(_getPrototypeOf(n.prototype),"hideLoadingView",this).call(this)}},{key:"showModal",value:function(){_get(_getPrototypeOf(n.prototype),"showModal",this).call(this)}},{key:"hideModal",value:function(){_get(_getPrototypeOf(n.prototype),"hideModal",this).call(this)}}]),n}();t.AbspLibrary=new function(){var a,i,l,s,c=this;function u(){t.elementor.$previewContents.on("click.onAddTemplateButton","."+n,c.showModal.bind(c)),c.channels.tabs.on("change:device",(function(t,a){e(".absp-templates-modal__preview").css("width",k[t]||k.desktop)}))}c.channels={tabs:f.channel("tabs"),templates:f.channel("templates")},c.updateBlocksView=function(){c.setFilter("tags","",!1),c.setFilter("text","",!1),c.getModal().showBlocksView(l)},c.setFilter=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c.channels.templates.reply("filter:"+e,t),a&&c.channels.templates.trigger("filter:change")},c.getFilter=function(e){return c.channels.templates.request("filter:"+e)},c.getFilterTerms=function(){return C},c.showModal=function(t){var a=e(t.target).closest("."+o).next(".elementor-element").data("id");a?_.each(elementor.documents.getCurrent().container.children,(function(e,t){e.id===a&&(p=t)})):p=-1,c.getModal().showModal(),c.showBlocksView()},c.closeModal=function(){return c.getModal().hideModal()},c.getModal=function(){return a||(a=new I),a},c.init=function(){elementor.loaded?u():elementor.on("preview:loaded",u.bind(this))},c.getTabs=function(){return{tabs:{section:{title:r("Blocks"),active:!0}}}},c.getTags=function(){return i},c.showBlocksView=function(){c.getModal().showDefaultHeader(),c.setFilter("tags","",!1),c.setFilter("text","",!1),e("#elementor-template-library-header-menu").find('[data-tab="'+c.getFilter("type")+'"]').addClass("elementor-active").siblings().removeClass("elementor-active"),c.loadTemplates((function(){return c.getModal().showBlocksView(l)}))},c.showPreviewView=function(e){return c.getModal().showPreviewView(e)},c.loadTemplates=function(e){c.requestLibraryData({onBeforeUpdate:c.getModal().showLoadingView.bind(c.getModal()),onUpdate:function(){c.getModal().hideLoadingView(),e&&"function"==typeof e&&e()}})},c.requestLibraryData=function(e){if(!l||e.forceUpdate){e.onBeforeUpdate&&e.onBeforeUpdate();var t={data:{},success:function(t){l=new P(t.templates),t.tags&&(i=t.tags),e.onUpdate&&e.onUpdate()}};e.forceSync&&(t.data.sync=!0),elementorCommon.ajax.addRequest("absp_library_data",t)}else e.onUpdate&&e.onUpdate()},c.requestTemplateData=function(t,a){var r={unique_id:t,data:{edit_mode:!0,display:!0,template_id:t}};a&&e.extend(!0,r,a),elementorCommon.ajax.addRequest("absp_template_data",r)},c.toggleFavorite=function(e,t){var a={unique_id:e,data:{template_id:e,favorite:t}};return elementorCommon.ajax.addRequest("absp_toggle_favorite",a)},c.insertTemplate=function(e){var t=elementor.config.document.remoteLibrary.autoImportSettings,a=e.model,r=a.withPageSettings,o=void 0===r?null:r;t&&(o=!0),AbspLibrary.getModal().showLoadingView(),AbspLibrary.requestTemplateData(a.get("template_id"),{success:function(e){AbspLibrary.getModal().hideLoadingView(),AbspLibrary.getModal().hideModal();var t={};-1!==p&&(t.at=p),t.withPageSettings=o,$e.run("document/elements/import",{model:a,data:e,options:t}),p=-1},error:function(e){AbspLibrary.showErrorDialog(e)},complete:function(){AbspLibrary.getModal().hideLoadingView()}})},c.showErrorDialog=function(e){var t="";"string"==typeof e?t+="<div>"+e+"</div>":e.hasOwnProperty("responseText")?t+="<div>"+e.responseText+"</div>":e.hasOwnProperty("message")?t+="<div>"+e.message+"</div>":"object"===_typeof(e)?_.each(e,(function(e){"string"==typeof e?e.hasOwnProperty("message")&&(t+="<div>"+e.message+"</div>"):e.hasOwnProperty("message")?t+="<div>"+e.message+"</div>":console.warn(e)})):t="<div><b>&#60;"+r("unknown_err")+"&#62;</b></div>",t='<div id="elementor-template-library-error-info">'+t+"</div>",c.getErrorDialog().setMessage(r("ajax_err",[t])).show()},c.getErrorDialog=function(){return s||(s=elementorCommon.dialogsManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:r("an_err")})),s}},AbspLibrary.init(),AbspLibrary.__=r}))}(jQuery,window,AbspTemplateLibraryData);