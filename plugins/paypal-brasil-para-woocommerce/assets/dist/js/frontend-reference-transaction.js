/*! For license information please see frontend-reference-transaction.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/frontend/frontend-reference-transaction/frontend-reference-transaction-api.ts":(e,t,a)=>{a.r(t),a.d(t,{paymentReferenceTransaction:()=>n});var r=a("./src/frontend/frontend-shared.ts");const n={create:()=>new Promise(((e,t)=>{r.PaypalPayments.makeRequest("billing-agreement-token",{nonce:paypal_brasil_settings.nonce,user_id:paypal_brasil_settings.current_user_id}).done((function(t){e(t.data.token_id)})).fail((function(e){t(e.responseJSON)}))})),approve:e=>{paypal_brasil_settings.is_order_pay_page?(jQuery("form#order_review").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r.PaypalPayments.makeRequest("save-billing-agreement",{billing_agreement_token:e.billingToken}).always((function(){document.location.reload()}))):(jQuery("[name=paypal_brasil_billing_agreement_token]").val(e.billingToken),r.PaypalPayments.triggerUpdateCheckout())},error:e=>{r.PaypalPayments.triggerUpdateCheckout(),e&&(r.PaypalPayments.setNotices(e.data.error_notice),r.PaypalPayments.scrollTop())},cancel:()=>{r.PaypalPayments.triggerUpdateCheckout(),r.PaypalPayments.setNotices(paypal_brasil_reference_transaction_settings.cancel_message),r.PaypalPayments.scrollTop()}}},"./src/frontend/frontend-shared.ts":(e,t,a)=>{a.r(t),a.d(t,{PaypalPayments:()=>r});class r{static scrollTop(){jQuery("html, body").animate({scrollTop:0},300)}static setNotices(e){jQuery(".woocommerce-notices-wrapper:first").html(e)}static makeRequest(e,t){const a={async:!0,crossDomain:!0,url:r.replaceVars(paypal_brasil_settings.paypal_brasil_handler_url,{ACTION:e}),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)};return jQuery.ajax(a)}static showDefaultButton(){jQuery("#paypal-brasil-button-container .default-submit-button").show(),jQuery("#paypal-brasil-button-container .paypal-submit-button").hide()}static showPaypalButton(){jQuery("#paypal-brasil-button-container .default-submit-button").hide(),jQuery("#paypal-brasil-button-container .paypal-submit-button").show()}static isPaypalPaymentsSelected(){return!!jQuery("#payment_method_paypal-brasil-spb-gateway:checked").length}static triggerUpdateCheckout(){jQuery(document.body).trigger("update_checkout")}static triggerUpdateCart(){jQuery(document.body).trigger("wc_update_cart")}static submitForm(){jQuery("form.woocommerce-checkout, form#order_review").submit()}static replaceVars(e,t){let a=e;for(let e in t)t.hasOwnProperty(e)&&(a=a.replace(new RegExp("{"+e+"}","g"),t[e]));return a}}}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{a.r({});var e=a("./src/frontend/frontend-shared.ts"),t=a("./src/frontend/frontend-reference-transaction/frontend-reference-transaction-api.ts");class r extends e.PaypalPayments{constructor(){super();const e=jQuery("body"),t=jQuery("form.woocommerce-checkout, form#order_review");e.on("updated_checkout",this.updateCheckoutButton),t.on("change","[name=payment_method]",this.updateCheckoutButton),t.on("change",".paypal-brasil-billing-agreement-option-radio",this.updateCheckoutButton),e.on("updated_checkout",this.renderPayPalButton),this.insertUuid(),e.on("updated_checkout",this.insertUuid),paypal_brasil_settings.is_order_pay_page&&jQuery("body").trigger("updated_checkout")}insertUuid(){const e=paypal_brasil_reference_transaction_settings.uuid;jQuery("#paypal-brasil-uuid").val(e)}updateCheckoutButton(){e.PaypalPayments.isPaypalPaymentsSelected()&&r.isCreateBillingAgreementSelected()?e.PaypalPayments.showPaypalButton():e.PaypalPayments.showDefaultButton()}static isCreateBillingAgreementSelected(){return!jQuery(".paypal-brasil-billing-agreement-option-radio:checked").val()}renderPayPalButton(){document.getElementById("paypal-button").innerHTML="",paypal.Buttons({locale:"pt_BR",style:{size:"responsive",color:paypal_brasil_settings.style.color,shape:paypal_brasil_settings.style.format,label:"pay"},createBillingAgreement:t.paymentReferenceTransaction.create,onApprove:t.paymentReferenceTransaction.approve,onError:t.paymentReferenceTransaction.error,onCancel:t.paymentReferenceTransaction.cancel}).render("#paypal-button")}}new r})(),a.r(r)})();
//# sourceMappingURL=frontend-reference-transaction.js.map