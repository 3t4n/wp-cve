!function i(s,a,n){function l(e,t){if(!a[e]){if(!s[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(c)return c(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}o=a[e]={exports:{}},s[e][0].call(o.exports,function(t){return l(s[e][1][t]||t)},o,o.exports,i,s,a,n)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<n.length;t++)l(n[t]);return l}({1:[function(t,e,i){!function(o){!function(){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t,c=(t="undefined"!=typeof window?window.jQuery:void 0!==o?o.jQuery:null)&&t.__esModule?t:{default:t};const s=("undefined"!=typeof window?window.peepsodata:void 0!==o?o.peepsodata:null).location.api_key;let e=null;i.default=class{constructor(){return e=e||this}search(e){return new Promise((o,i)=>{this.autocompleteService().then(t=>{t.getPlacePredictions({input:e},(t,e)=>{"OK"===e?(console.log(t),o(t.map(this.mapData))):i(e)})})})}geocode(t){return new Promise((o,i)=>{this.loadAPI().then(()=>{(new google.maps.Geocoder).geocode({address:t},(t,e)=>{"OK"===e?o(this.mapData(t[0])):i(e)})})})}mapData(t){let{place_id:e,geometry:o}=t,i=t.formatted_address||t.description,[s,a=""]=i.split(/,\s(.+)?/),n,l;return o&&(n=o.location.toJSON(),l=o.viewport.toJSON()),{id:e,name:s,description:a,location:n,viewport:l}}render(t,e){let o=(0,c.default)(t).show(),i=o.data("psMap"),s=o.data("psMapMarker"),{name:a,location:n,viewport:l}=e;i||o.data("psMap",i=new google.maps.Map(t,{center:n,disableDefaultUI:!0,draggable:!1,scrollwheel:!1,zoom:15})),s||o.data("psMapMarker",s=new google.maps.Marker({map:i,position:n,title:a})),i.setCenter(n),i.fitBounds(l),s.setPosition(n)}loadAPI(){return new Promise((t,e)=>{let o,i;this.loaded?t():(this.queue=this.queue||[],this.queue.push({resolve:t,reject:e}),this.loading||(this.loading=!0,i=_.uniqueId("psCallback"),(o=document.createElement("script")).type="text/javascript",o.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(s?"&key="+s:"")+"&callback="+i,window[i]=()=>{for(this.loaded=!0,this.loading=!1;this.queue.length;)this.queue.shift().resolve();delete window[i]},document.body.appendChild(o)))})}autocompleteService(){return new Promise((e,t)=>{this.loadAPI().then(()=>{var t="_cacheAutocompleteService";this[t]=this[t]||new google.maps.places.AutocompleteService,e(this[t])})})}placesService(){return new Promise((o,t)=>{this.loadAPI().then(()=>{var t="_cachePlacesService",e=document.createElement("div");document.body.appendChild(e),this[t]=this[t]||new google.maps.places.PlacesService(e),o(this[t])})})}placeDetail(a){return new Promise((i,s)=>{this.placesService().then(t=>{let o="_cachePlaceDetail";this[o]=this[o]||{},this[o][a]?i(this[o][a]):t.getDetails({placeId:a},(t,e)=>{"OK"===e?(t=this.mapData(t),this[o][a]=t,i(t)):s(e)})})})}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(o,t,e){!function(e){!function(){"use strict";var i=(t="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&t.__esModule?t:{default:t},t="undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null;o("./google-maps"),o("./location"),o("./postbox"),t.observer.addFilter("human_friendly_extras",function(t,e,o){return!e&&o&&(e=(0,i.default)(o).find(".ps-js-activity-extras [data-preview]")).length&&t.push(e.data("preview")),t},20,3)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./google-maps":1,"./location":3,"./postbox":4}],3:[function(t,e,o){!function(o){!function(){"use strict";var t,p,i,h,u=(t="undefined"!=typeof window?window.peepsodata:void 0!==o?o.peepsodata:null)&&t.__esModule?t:{default:t};function e(){this.coords=null,this.$places_container=null,this.$input_search=null,this.marker=null,this.map=null,this.selected_place=null,this._search_service=null,this._latLang=null,this.last_selected_place=null,this.location_selected=!1,this.can_submit=!1}t=window,p=jQuery,t.pslocation=(i=t,h=p,e.prototype.init=function(){var i,o;_.isNull(this.$postbox)||(i=this,peepso.observer.addFilter("peepso_postbox_can_submit",function(t){return t.soft.push(i.can_submit),t},30,1),this.$container=this.$postbox.find("#location-tab"),h(this.$postbox).on("click","#location-tab a",function(){i.toggle_input()}),this.$input_search=h("[name=postbox_loc_search]",this.$postbox),this.$dropdown=h("#pslocation",this.$postbox).on("click",function(t){t.stopPropagation()}),this.$postboxcontainer=this.$postbox.$textarea.parent(),this.$places_container=h(".ps-js-postbox-locations",this.$dropdown),o=null,this.$input_search.on("keyup",function(){var t=this,e=(clearTimeout(o),h('<div class="ps-postbox__location-item ps-postbox__location-item--loading ps-js-postbox-location-item">'+h("#pslocation-search-loading").html()+"</div>"));i.$places_container.html(e),o=setTimeout(function(){i.location_search(h(t).val())},1500)}),peepso.observer.addFilter("postbox_req_"+this.$postbox.guid,function(t,e){return i.postbox_request(t,e)},10,1),this.$postbox.on("postbox.post_cancel postbox.post_saved",function(t,e,o){i.postbox_cancel_saved(e,o)}),this.$select_location=h(".ps-js-location-action .ps-js-add-location",this.$dropdown),this.$remove_location=h(".ps-js-location-action .ps-js-remove-location",this.$dropdown),this.$select_location.on("click",function(t){t.preventDefault(),i.on_select_location()}),this.$remove_location.on("click",function(t){t.preventDefault(),i.on_remove_location()}),h(this.$postbox).on("peepso.interaction-hide","#location-tab a",function(){i.$dropdown.hide(),i.$container.removeClass("ps-postbox__menu-item--open")}),peepso.observer.addFilter("peepso_postbox_addons_update",function(t){return i.location_selected&&t.unshift("<b><i class=ps-icon-map-marker></i>"+i.location_selected+"</b>"),t},10,1))},e.prototype.postbox_request=function(t,e){return null!==this.selected_place&&(t.location={name:this.selected_place.name,latitude:this.selected_place.geometry.location.lat(),longitude:this.selected_place.geometry.location.lng()}),t},e.prototype.postbox_cancel_saved=function(t,e){this.$dropdown.hide(),this.$input_search.val(""),this.$remove_location.hide(),this.$select_location.show(),this.$postboxcontainer.find("span#postlocation").remove(),this.$container.removeClass("active");var o=this.$container.find(".ps-js-interaction-toggle");o.attr("data-tooltip-original")&&(o.attr("data-tooltip",o.attr("data-tooltip-original")),o.removeAttr("data-tooltip-original")),this.selected_place=null,this.location_selected=!1,this.can_submit=!1,this.$postbox.on_change()},e.prototype.set_postbox=function(t){this.$postbox=t},e.prototype.location_search=function(t,o){var i=this;_.isEmpty(this.map)&&(this._latLang=new google.maps.LatLng(0,0),this.draw_map(this._latLang)),_.isEmpty(t)?this.draw_map(this._latLang):this.get_search_service().textSearch({query:t,location:this._latLang,radius:5e4},function(t,e){i.set_places(t,e),i.$select_location.is(":visible")||i.$places_container.find(".ps-js-postbox-location-item").first().trigger("click"),typeof Function==typeof o&&o()})},e.prototype.on_select_location=function(){null===this.selected_place&&(this.selected_place=this.last_selected_place),this.$select_location.hide(),this.$remove_location.show(),this.$dropdown.hide(),this.$container.addClass("active"),this.$container.removeClass("ps-postbox__menu-item--open");var t=this.$container.find(".ps-js-interaction-toggle");t.attr("data-tooltip-original")||t.attr("data-tooltip-original",t.attr("data-tooltip")),t.attr("data-tooltip",this.selected_place.name),this.location_selected="",this.selected_place&&(this.location_selected=this.selected_place.name),this.can_submit=!0,this.$postbox.on_change()},e.prototype.on_remove_location=function(){this.$select_location.show(),this.$remove_location.hide(),this.selected_place=null,this.$postboxcontainer.find("span#postlocation").remove(),this.$dropdown.hide(),this.$container.removeClass("active"),this.$container.removeClass("ps-postbox__menu-item--open");var t=this.$container.find(".ps-js-interaction-toggle");t.attr("data-tooltip-original")&&(t.attr("data-tooltip",t.attr("data-tooltip-original")),t.removeAttr("data-tooltip-original")),this.location_selected=!1,this.can_submit=!1,this.$postbox.on_change()},e.prototype.toggle_input=function(){var t;this.$dropdown.is(":visible")?(this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),jQuery(document).off("mouseup.ps-postbox-location")):(this.$dropdown.show(),this.$container.addClass("ps-postbox__menu-item--open"),setTimeout(h.proxy(function(){jQuery(document).off("mouseup.ps-postbox-location").on("mouseup.ps-postbox-location",h.proxy(function(t){0===this.$container.has(t.target).length&&(this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),jQuery(document).off("mouseup.ps-postbox-location"))},this))},this),1)),this.$input_search.val(""),this.location=null,this.$dropdown.is(":visible")&&(t=this).load_library(function(){t.shown()}.bind(t))},e.prototype.shown=function(){var o=this;this.$input_search.focus(),!1!==_.isEmpty(this.map)&&this.detect_location().done(function(t,e){o.draw_default_map(t,e)}).fail(function(){o.draw_default_map()})},e.prototype.draw_default_map=function(t,e){t&&e?(t=new google.maps.LatLng(t,e),this.draw_map(t)):(this.$postbox.find(".ps-js-postbox-map").show(),this.$input_search.removeAttr("disabled"),this.$input_search.focus())},e.prototype.draw_map=function(t,e){var o,i;!1===_.isBoolean(e)&&(e=!0),!1!=t instanceof google.maps.LatLng&&(i=this.$postbox.find(".ps-js-postbox-map"),h("#pslocation .ps-postbox-loading",this.$postbox).hide(),i.show(),this.$input_search.removeAttr("disabled"),t={center:(o=this)._latLang=t,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0},peepso.observer.applyFilters("ps_location_before_draw_map",h("#pslocation",this.$postbox)),_.isEmpty(this.map)?(this.map=new google.maps.Map(i.get(0),t),this.marker=new google.maps.Marker({position:t.center,map:this.map,title:"You are here (more or less)"})):this.set_map_center(this._latLang),e)&&(i={location:this._latLang,types:["establishment"],rankBy:google.maps.places.RankBy.DISTANCE},this.get_search_service().nearbySearch(i,function(t,e){o.set_places(t,e),o.$select_location.is(":visible")||o.$places_container.find(".ps-js-postbox-location-item").first().trigger("click")}))},e.prototype.get_search_service=function(){return _.isEmpty(this.search_service)&&(this._search_service=new google.maps.places.PlacesService(this.map)),this._search_service},e.prototype.set_places=function(t,e){var o=this;if(this.$places_container.find(".ps-js-postbox-location-item").remove(),e===google.maps.places.PlacesServiceStatus.OK)for(var i=0;i<t.length;i++)this.add_place(t[i]);h(".ps-js-postbox-location-item",this.$places_container).on("click",function(){h(".ps-js-location-action",this.$dropdown).show(),o.$select_location.show(),o.$remove_location.hide()})},e.prototype.add_place=function(t){var e,o;_.isEmpty(t.formatted_address)||(t.vicinity=t.formatted_address),_.isEmpty(t.vicinity)||(e=this,(o=h('<div class="ps-postbox__location-item ps-js-postbox-location-item"></div>')).append("<p>"+t.name+"</p>"),o.append("<span>"+t.vicinity+"</span>"),this.$places_container.append(o),o.on("click",function(){e.set_map_center(t.geometry.location),e.$input_search.val(t.name),e.selected_place=t,e.last_selected_place=e.selected_place}))},e.prototype.set_map_center=function(t){this.map.setCenter(t),this.marker.setPosition(t)},e.prototype.load_library=function(t){var e,o;this.gmap_is_loaded?t():(this.load_library_callbacks||(this.load_library_callbacks=[]),this.load_library_callbacks.push(t),this.gmap_is_loading||(this.gmap_is_loading=!0,t=document.createElement("script"),e=u.default.location.api_key,o=this,t.type="text/javascript",t.src="https://maps.googleapis.com/maps/api/js?libraries=places"+(e?"&key="+e:"")+"&callback=ps_gmap_callback",i.ps_gmap_callback=function(){for(o.gmap_is_loaded=!0,o.gmap_is_loading=!1;o.load_library_callbacks.length;)o.load_library_callbacks.shift()();delete i.ps_gmap_callback},document.body.appendChild(t)))},e.prototype.show_map=function(i,s,t){peepso.lightbox([{content:'<div class="ps-location__map ps-js-mapct" />'}],{simple:!0,nofulllink:!0,afterchange:h.proxy(function(o){this.load_library(function(){var t=o.$container.find(".ps-js-mapct"),e=new google.maps.LatLng(i,s),t=new google.maps.Map(t[0],{center:e,zoom:14});new google.maps.Marker({position:e,map:t})})},this)})},e.prototype.init_location_search=function(i){var s,a,n,t,l,c,p,r,e,d;i.data("location-search")||(i.data("location-search",1),t=u.default.location.template_selector,(s=h(t)).children(".ps-js-location"),a=s.find(".ps-js-location-map"),n=s.find(".ps-js-location-list"),t=s.find(".ps-js-close"),l=s.find(".ps-js-select"),c=s.find(".ps-js-remove"),p=s.find(".ps-js-location-loading"),r=s.find(".ps-js-location-result"),e=s.find(".ps-js-location-placeholder"),d=s.find(".ps-js-location-listitem").get(0).outerHTML,i.on("input.ps-location",h.proxy(_.debounce(function(t){t=t.target.value;t&&(e&&(e.remove(),e=null),r.hide(),p.show(),s.show(),this.search(t).done(function(t){for(var e,o=[],i=0;i<t.length;i++)e=(e=t[i].description).split(/,\s(.+)?/),e=d.replace("{place_id}",t[i].place_id).replace("{name}",e[0]).replace("{description}",e[1]||"&nbsp;"),o.push(e);n.html(o.join("")),p.hide(),r.show(),s.show()}))},200),this)),i.on("blur.ps-location",h.proxy(function(t){s.hide(),l.hide(),i.val(i.data("location")||""),i.data("location")&&c.show()},this)),i.on("focus.ps-location",h.proxy(function(t){n.find(".ps-location-selected").removeClass("ps-location-selected"),s.show()},this)),n.on("mousedown","a.ps-js-location-listitem",h.proxy(function(t){var e=h(t.currentTarget),o=(e.find(".ps-js-location-listitem-name").text(),e.data("place-id"));t.preventDefault(),t.stopPropagation(),e.addClass("ps-location-selected"),e.siblings().removeClass("ps-location-selected"),l.show(),c.hide(),a.show(),this._gmap_get_place_detail(o).done(h.proxy(function(t){var e=t.formatted_address,o=t.geometry.location;i.data("tmp-location",e).data("tmp-latitude",o.lat()).data("tmp-longitude",o.lng()),this._gmap_render_map(a[0],t)},this))},this)),t.on("mousedown",function(){i.trigger("blur.ps-location")}),l.on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),i.data("location",i.data("tmp-location")),i.data("latitude",i.data("tmp-latitude")),i.data("longitude",i.data("tmp-longitude")),i.val(i.data("location")),l.hide(),c.show(),i.trigger("blur.ps-location")}),c.on("mousedown",function(t){t.preventDefault(),t.stopPropagation(),i.removeData("location").removeData("latitude").removeData("longitude").val(""),n.find(".ps-location-selected").removeClass("ps-location-selected"),c.hide(),a.hide()}),s.insertAfter(i))},e.prototype.search=function(e){return h.Deferred(h.proxy(function(o){this._gmap_get_autocomplete_service().done(function(t){t.getPlacePredictions({input:e},function(t,e){"OK"===e&&o.resolve(t)})})},this))},e.prototype.detect_location=function(){var t=this;return h.Deferred(function(o){"https:"!==i.location.protocol?o.reject():t.detect_location_by_device().done(function(t,e){o.resolve(t,e)}).fail(function(){t.detect_location_by_gmap_api().done(function(t,e){o.resolve(t,e)}).fail(function(){t.detect_location_by_ip().done(function(t,e){o.resolve(t,e)}).fail(function(){o.reject()})})})})},e.prototype.detect_location_by_device=function(){return h.Deferred(h.proxy(function(e){navigator.geolocation.getCurrentPosition(function(t){e.resolve(t.coords.latitude,t.coords.longitude)},function(){e.reject()},{timeout:1e4})},this))},e.prototype.detect_location_by_gmap_api=function(){return h.Deferred(h.proxy(function(e){var t=u.default.location.api_key;this._client_location?e.resolve(this._client_location):t?h.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+t,function(t){e.resolve(t.location.lat,t.location.lng)}).fail(function(t){e.reject(t)}):e.reject()},this))},e.prototype.detect_location_by_ip=function(){return h.Deferred(h.proxy(function(o){var i;h.ajax({url:"https://ipapi.co/jsonp",dataType:"jsonp",success:function(t){var e=t.latitude,t=t.longitude;e&&t&&(i=!0,o.resolve(e,t))},complete:function(){i||o.reject()}})},this))},e.prototype._gmap_load_library=function(){return h.Deferred(h.proxy(function(t){this.load_library(function(){t.resolve()})},this))},e.prototype._gmap_get_autocomplete_service=function(){return h.Deferred(h.proxy(function(t){this._gmap_autocomplete_service?t.resolve(this._gmap_autocomplete_service):this._gmap_load_library().done(h.proxy(function(){this._gmap_autocomplete_service=new google.maps.places.AutocompleteService,t.resolve(this._gmap_autocomplete_service)},this))},this))},e.prototype._gmap_render_map=function(t,e){var o,i,s;e.geometry?(o=e.geometry.location,i=e.geometry.viewport):o=new google.maps.LatLng(e.latitude,e.longitude),e=(t=h(t).show()).data("ps-map"),s=t.data("ps-map-marker"),e||(e=new google.maps.Map(t[0],{center:o,zoom:15,draggable:!1,scrollwheel:!1,disableDefaultUI:!0}),t.data("ps-map",e)),s||(s=new google.maps.Marker({position:o,map:e,title:"You are here (more or less)"}),t.data("ps-map-marker",s)),e.setCenter(o),s.setPosition(o),i?e.fitBounds(i):e.setZoom(15)},e.prototype._gmap_get_place_service=function(){return h.Deferred(h.proxy(function(e){this._gmap_place_service?e.resolve(this._gmap_place_service):this._gmap_load_library().done(h.proxy(function(){var t=document.createElement("div");document.body.appendChild(t),this._gmap_place_service=new google.maps.places.PlacesService(t),e.resolve(this._gmap_place_service)},this))},this))},e.prototype._gmap_get_place_detail=function(i){return h.Deferred(h.proxy(function(o){this._gmap_place_cache&&this._gmap_place_cache[i]?o.resolve(this._gmap_place_cache[i]):this._gmap_get_place_service().done(h.proxy(function(t){t.getDetails({placeId:i},h.proxy(function(t,e){"OK"===e?(this._gmap_place_cache||(this._gmap_place_cache={}),this._gmap_place_cache[i]=t,o.resolve(t)):o.reject(e)},this))},this))},this))},peepso.observer.addFilter("peepso_postbox_addons",function(t){return t.push(new e),t},10,1),new e),peepso.observer.addFilter("photo_create_album",function(t){var e=t.popup.find(".ps-js-location");return pslocation.init_location_search(e),t},10,1),p(function(){peepso.observer.addFilter("profile_field_save",function(t,e){if(e.hasClass("ps-js-field-location")){e=e.data();if(e.location&&e.latitude&&e.longitude)return JSON.stringify({name:e.location,latitude:e.latitude,longitude:e.longitude})}return t},10,2),peepso.observer.addAction("profile_field_save_register",function(t){var e,o;t.hasClass("ps-js-field-location")&&(e=t.data()).location&&e.latitude&&e.longitude&&(o=p('<input type="hidden" name="'+t.attr("name")+'" />'),t.removeAttr("name"),o.insertAfter(t),o.val(JSON.stringify({name:e.location,latitude:e.latitude,longitude:e.longitude})))},10,1),p(".ps-js-field-location").each(function(){pslocation.init_location_search(p(this))})}),p(function(){var t,e=p(".ps-js-album-location"),i=e.find(".ps-js-album-location-text"),s=e.find(".ps-js-album-location-empty"),a=e.find(".ps-js-album-location-editor"),n=e.find(".ps-js-album-location-edit"),l=e.find(".ps-js-album-location-remove"),c=(a.find(".ps-js-submit"),a.find("input").eq(0));n.click(function(){a.is(":visible")||(i.hide(),s.hide(),n.hide(),l.hide(),a.show(),c.data("original-value",t=c.val()),c.focus().val("").val(t),pslocation.init_location_search(c),a.off("click input"),a.on("click",".ps-js-cancel",function(){c.val(t),a.off("click").hide(),n.show(),(t?(i.show(),l):s).show()}),a.on("click",".ps-js-submit",p.proxy(function(t){var e=c.data(),o={user_id:u.default.userid,post_id:e.postId,type_extra_field:"location","location[name]":e.location,"location[latitude]":e.latitude,"location[longitude]":e.longitude,_wpnonce:p("#_wpnonce_set_album_location").val()};peepso.postJson("photosajax.set_album_extra_field",o,function(t){t.success&&(a.off("click").hide(),c.val(e.location),i.find("span").html(e.location),i.show(),s.hide(),n.show(),l.show())})},this)))}),l.click(function(){var t=l.data(),t={user_id:u.default.userid,post_id:t.postId,type_extra_field:"location",location:"",_wpnonce:p("#_wpnonce_set_album_location").val()};peepso.postJson("photosajax.set_album_extra_field",t,function(t){t.success&&(c.val(""),i.find("span").html(""),i.hide(),s.show(),l.hide())})})})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,o){"use strict";function i(){this.__constructor.apply(this,arguments)}var s,a,n,l;s=jQuery,a=s,n=".ps-postbox-location",i.prototype={__constructor:function(t){var e=peepsodata.location&&peepsodata.location.template_postbox||"";this.postbox=t,this.$container=t.$el.find("#location-tab"),this.$toggle=this.$container.find(".ps-js-postbox-toggle"),this.$dropdown=this.$container.find(".ps-js-postbox-location").html(e),this.$input=this.$dropdown.find("input[type=text]"),this.$loading=this.$dropdown.find(".ps-js-location-loading"),this.$result=this.$dropdown.find(".ps-js-location-result"),this.$map=this.$dropdown.find(".ps-js-location-map"),this.$select=this.$dropdown.find(".ps-js-select"),this.$remove=this.$dropdown.find(".ps-js-remove"),this.listItemTemplate=peepso.template(this.$dropdown.find(".ps-js-location-fragment").text()),this.$toggle.on("click"+n,a.proxy(this.onToggle,this)),this.$input.on("input"+n,a.proxy(this.onInput,this)),this.$result.on("mousedown"+n,".ps-js-location-listitem",a.proxy(this.onSelectItem,this)),this.$result.on("click"+n,".ps-js-location-listitem",t=>t.preventDefault()),this.$select.on("mousedown"+n,a.proxy(this.onSelect,this)),this.$remove.on("mousedown"+n,a.proxy(this.onRemove,this)),t.addAction("update",this.update,10,2,this),t.addFilter("render_addons",this.render,10,1,this),t.addFilter("data",this.filterData,10,1,this),t.addFilter("data_validate",this.validate,10,2,this)},show:function(){this.$dropdown.show(),this.$container.addClass("ps-postbox__menu-item--open"),setTimeout(()=>{a(document).off("mouseup.ps-postbox-location").on("mouseup.ps-postbox-location",t=>{0===this.$container.has(t.target).length&&this.hide()})},1),this._needUpdate&&(this._needUpdate=!1,this._selected?(this.$select.hide(),this.$remove.show(),this.$result.empty(),this.$map.children().show(),this.$toggle.addClass("active"),this.updateList([{place_id:"",name:this._selected.name,description:this._selected.description}]),this.updateMap({latitude:this._selected.latitude,longitude:this._selected.longitude,zoom:this._selected.zoom})):(this.$select.hide(),this.$remove.hide(),this.$result.empty(),this.$map.children().hide(),this.$toggle.removeClass("active"),this.updateList([])))},hide:function(){this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),a(document).off("mouseup.ps-postbox-location")},toggle:function(){this.$dropdown.is(":visible")?this.hide():this.show()},search:function(t){this.$result.empty().append(this.$loading),pslocation.search(t).done(a.proxy(function(t){for(var e,o=[],i=0;i<t.length;i++)e=(e=t[i].description).split(/,\s(.+)?/),o.push({place_id:t[i].place_id,name:e[0],description:e[1]});this.$loading.detach(),this.updateList(o)},this))},filterData:function(t){return this._selected?t.location=this._selected:t.location="",t},validate:function(t,e){return!!this._selected||t},render:function(t){var e;return this._selected&&(e='<i class="gcis gci-map-marker-alt"></i>',e+="<strong>"+this._selected.name+"</strong>",t.push(e)),t},update:function(t){(t=t&&t.data||{}).location?(this._selected={name:t.location.name,description:t.location.description,latitude:t.location.latitude,longitude:t.location.longitude,zoom:t.location.zoom},this.$input.data("location",t.location.name),this.$input.data("latitude",t.location.latitude),this.$input.data("longitude",t.location.longitude),this.$input.val(t.location.name),this.$toggle.addClass("active")):(this._selected=!1,this.$toggle.removeClass("active")),this._needUpdate=!0,this.postbox.doAction("refresh")},updateList:function(t){for(var e=[],o=0;o<t.length;o++)e.push(this.listItemTemplate(t[o]));this.$result.html(e.join(""))},updateMap:function(t){pslocation._gmap_load_library().done(a.proxy(function(){pslocation._gmap_render_map(this.$map[0],t)},this))},select:function(t,e,o){},remove:function(){},destroy:function(){this.$toggle.off("click")},onToggle:_.throttle(function(t){t.preventDefault(),t.stopPropagation();t=a(t.target);this.$dropdown.is(t)||this.$dropdown.find(t).length||this.toggle()},200),onInput:function(){var t=this.$input.val().trim();t&&(this.$result.empty().append(this.$loading),this._onInput(t))},_onInput:_.debounce(function(t){this.search(t)},200),onSelectItem:function(t){t.preventDefault(),t.stopPropagation();var t=a(t.currentTarget),e=t.data("place-id");t.addClass("ps-location-selected"),t.siblings().removeClass("ps-location-selected"),this.$select.show(),this.$remove.hide(),this.$map.children().show(),pslocation._gmap_get_place_detail(e).done(a.proxy(function(t){var e=t.name,o=t.geometry.location;this.$input.data("tmp-location",e).data("tmp-latitude",o.lat()).data("tmp-longitude",o.lng()),pslocation._gmap_render_map(this.$map[0],t)},this))},onSelect:function(t){t.preventDefault(),t.stopPropagation();var t=this.$input.data("tmp-location"),e=this.$input.data("tmp-latitude"),o=this.$input.data("tmp-longitude");this.$input.data("location",t),this.$input.data("latitude",e),this.$input.data("longitude",o),this.$input.val(t),this.$select.hide(),this.$remove.show(),this.$map.children().show(),this.$toggle.addClass("active"),this._selected={name:t,latitude:e,longitude:o},this.hide(),this.postbox.doAction("refresh")},onRemove:function(t){t.preventDefault(),t.stopPropagation(),this.$input.removeData("location").removeData("latitude").removeData("longitude").val(""),this.$select.hide(),this.$remove.hide(),this.$map.children().hide(),this.$toggle.removeClass("active"),this.$result.children().each(function(){var t=a(this);t.data("place-id")||t.remove()}),this._selected=!1,this.hide(),this.postbox.doAction("refresh")}},l=i,peepso.observer.addAction("postbox_init",function(t){new l(t)},10,1)},{}]},{},[2]);