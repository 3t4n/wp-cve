!function s(i,n,r){function d(t,o){if(!n[t]){if(!i[t]){var e="function"==typeof require&&require;if(!o&&e)return e(t,!0);if(a)return a(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}e=n[t]={exports:{}},i[t][0].call(e.exports,function(o){return d(i[t][1][o]||o)},e,e.exports,s,i,n,r)}return n[t].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)d(r[o]);return d}({1:[function(o,t,e){"use strict";function s(){this.__constructor.apply(this,arguments)}var i,n,r,d,a,p,h,l;function c(){this.$postbox=null,this.$container=null,this.$mood=null,this.$mood_remove=null,this.$mood_dropdown_toggle=null,this.mood_selected=!1,this.can_submit=!1}i=jQuery,r=(n=i)("#mood-text-string").text(),d=!1,a=".ps-postbox-moods",s.prototype={__constructor:function(o){this.postbox=o,this.$container=o.$el.find("#mood-tab"),this.$toggle=this.$container.find(".ps-js-postbox-toggle"),this.$dropdown=this.$container.find(".ps-js-postbox-mood"),this.$remove=this.$dropdown.find("button"),this.$toggle.on("click"+a,n.proxy(this.toggle,this)),this.$dropdown.on("click"+a,".ps-js-mood-item",n.proxy(this.select,this)),this.$remove.on("click"+a,n.proxy(this.remove,this)),this._mapMoods(),o.addAction("update",this.update,10,2,this),o.addFilter("render_addons",this.render,10,1,this),o.addFilter("data",this.filterData,10,1,this),o.addFilter("data_validate",this.validate,10,2,this)},show:function(){this.$dropdown.show(),this.$container.addClass("ps-postbox__menu-item--open"),setTimeout(()=>{n(document).off("mouseup.ps-postbox-moods").on("mouseup.ps-postbox-moods",o=>{0===this.$container.has(o.target).length&&this.hide()})},1)},hide:function(){this.$dropdown.hide(),this.$container.removeClass("ps-postbox__menu-item--open"),n(document).off("mouseup.ps-postbox-moods")},toggle:function(){this.$dropdown.is(":visible")?this.hide():this.show()},filterData:function(o){return this._selected?o.mood=this._selected.value:o.mood="",o},validate:function(o,t){return!!this._selected||o},select:function(o){o=n(o.currentTarget);o.length&&(this._selected={value:o.data("option-value"),label:o.data("option-display-value"),className:o.find("i").attr("class")},this.$toggle.addClass("active"),this.$remove.show(),this.postbox.doAction("refresh"),this.hide())},remove:function(){this._selected=!1,this.$toggle.removeClass("active"),this.$remove.hide(),this.postbox.doAction("refresh"),this.hide()},update:function(o){(o=o&&o.data||{}).mood?(this._selected={value:o.mood,label:d[o.mood].label,className:d[o.mood].icon},this.$toggle.addClass("active"),this.$remove.show()):(this._selected=!1,this.$toggle.removeClass("active"),this.$remove.hide()),this.postbox.doAction("refresh")},render:function(o){var t;return this._selected&&(t='<i class="'+this._selected.className+'"></i>',t+="<b> "+r+this._selected.label+"</b>",o.push(t)),o},_mapMoods:function(){d||this.$dropdown.find("a.ps-js-mood-item").each(function(){var o=n(this),t=o.find("i"),e=o.data("option-value"),o=o.data("option-display-value"),t=t.attr("class");(d=d||{})[e]={icon:t,label:o}})}},p=s,peepso.observer.addAction("postbox_init",function(o){new p(o)},10,1),peepso.observer.addFilter("human_friendly_extras",function(o,t,e){return t||!e||(e=i(e).find(".ps-js-activity-extras .ps-post__mood")).length&&(e=function(o){o=o.split(" ");for(var t=0;t<o.length;t++)o[t]=o[t][0].toUpperCase()+o[t].slice(1);return o.join(" ")}(e.text().trim()),o.push(e)),o},10,3),jQuery||$,h=peepso,l=h,c.prototype.set_postbox=function(o){this.$postbox=o},c.prototype.init=function(){var e;_.isUndefined(this.$postbox)||(e=this,l.observer.addFilter("peepso_postbox_can_submit",function(o){return o.soft.push(e.can_submit),o},20,1),this.$container=this.$postbox.find("#mood-tab"),this.$mood=jQuery("#postbox-mood",this.$postbox),this.$mood_dropdown_toggle=jQuery("#mood-tab .ps-js-interaction-wrapper > a",this.$postbox),this.$mood_remove=jQuery("#postbox-mood-remove",this.$postbox),this.$mood.on("click","a.ps-js-mood-item",function(o){e.select_mood(o)}),this.$mood_remove.on("click",function(){e.remove_mood()}),this.$mood_dropdown_toggle.on("click",function(){return e.$mood.is(":visible")?(e.$mood.hide(),e.$container.removeClass("ps-postbox__menu-item--open"),void jQuery(document).off("mouseup.ps-postbox-moods")):(e.$mood.show(),e.$container.addClass("ps-postbox__menu-item--open"),void setTimeout(function(){jQuery(document).off("mouseup.ps-postbox-moods").on("mouseup.ps-postbox-moods",function(o){0===e.$container.has(o.target).length&&(e.$mood.hide(),e.$container.removeClass("ps-postbox__menu-item--open"),jQuery(document).off("mouseup.ps-postbox-moods"))})},1))}),this.$mood_dropdown_toggle.on("peepso.interaction-hide",function(){e.$mood.hide(),e.$container.removeClass("ps-postbox__menu-item--open")}),this.$postbox.on("postbox.post_cancel postbox.post_saved",function(){e.remove_mood()}),l.observer.addFilter("postbox_req_"+this.$postbox.guid,function(o){return e.set_mood(o)},10,1),l.observer.addFilter("peepso_postbox_addons_update",function(o){var t;return e.mood_selected&&(t='<i class="ps-emoticon '+(t=e.mood_selected)[0]+'"></i> <b>'+t[1]+"</b>",o.push(t)),o},10,1))},c.prototype.select_mood=function(o){var t=jQuery(o.target).closest("a"),e=jQuery("#mood-tab",this.$postbox),s=jQuery("#postbox-mood-input",this.$postbox),i=(e.find("a"),t.closest("#postbox-mood")),o=(this.$postbox.$textarea.parent(),t.find("i").attr("class")),e=jQuery("#mood-text-string").text()+t.attr("data-option-display-value");s.val(t.attr("data-option-value")),this.$mood_remove.show(),i.hide(),this.$container.addClass("active"),this.$container.removeClass("ps-postbox__menu-item--open");i=this.$container.find(".ps-js-interaction-toggle"),t=(t=t.attr("data-option-display-value")).charAt(0).toUpperCase()+t.slice(1);i.attr("data-tooltip-original")||i.attr("data-tooltip-original",i.attr("data-tooltip")),i.attr("data-tooltip",t),this.mood_selected=[o,e],this.can_submit=!0,this.$postbox.on_change()},c.prototype.remove_mood=function(){jQuery("span#postmood",this.$postbox.$textarea.parent()).remove(),jQuery("#postbox-mood-input",this.$postbox).val(""),this.$container.removeClass("active"),this.$container.removeClass("ps-postbox__menu-item--open");var o=this.$container.find(".ps-js-interaction-toggle");o.attr("data-tooltip-original")&&(o.attr("data-tooltip",o.attr("data-tooltip-original")),o.removeAttr("data-tooltip-original")),this.$mood_remove.hide(),this.$mood.hide(),this.mood_selected=!1,this.can_submit=!1,this.$postbox.on_change()},c.prototype.set_mood=function(o){return void 0===o.mood&&(o.mood=""),o.mood=jQuery("#postbox-mood-input",this.$postbox).val(),o},l.observer.addFilter("peepso_postbox_addons",function(o){return o.push(new c),o},10,1)},{}]},{},[1]);