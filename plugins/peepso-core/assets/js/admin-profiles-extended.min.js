!function(p){var o,n,a=p(".ps-js-fields-container"),e=p(".ps-js-field-new"),s=p('<div class="ps-dropdown__menu" />'),t=window.peepsofieldtypes||{};function i(){a.find(".ps-js-options").sortable({handle:".ps-js-option-handle",update:_.throttle(function(){l(p(this).closest(".ps-js-field").data("id"))},3e3)})}function l(e){var t=a.find(".ps-js-field").filter('[data-id="'+e+'"]'),o=t.find(".ps-js-options").children(".ps-js-fieldconf").find("input[type=text]"),s=t.find(".ps-js-options").siblings(".ps-js-loading"),i={};i.id=e,i.prop="select_options",i.value={},i.json=1,o.each(function(){var e=p(this);i.value[e.data("prop-key")]=e.val()}),i.value=JSON.stringify(i.value),s.stop().show(),n[e]&&n[e].ret&&n[e].ret.abort(),n[e]=peepso.postJson("adminConfigFields.set_meta",i,function(e){s.stop().fadeOut()})}(a.length||e.length)&&(o="",_.each(t,function(e,t){o+='<a href="#" data-value="'+t+'">'+e+"</a>"}),s.append(o),s.insertAfter(e),e.off("click").on("click",function(e){var t="click.ps-extended-profile",o=p(document);e.preventDefault(),e.stopPropagation(),o.off(t),s.is(":visible")?s.hide():(s.show(),o.one(t,function(){s.hide()}))}),s.on("click","a",function(e){var t=p(this).data("value");e.preventDefault(),e.stopPropagation(),peepso.postJson("adminextendedprofiles.add_field",{type:t},function(e){s.hide(),e.success&&(a.append(e.data.html),i(),p("html, body").animate({scrollTop:p(document).height()},"fast"))})}),a.on("click",".ps-js-field-delete",function(e){var o;e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to delete this field?")&&(o=p(this).data("id"),peepso.postJson("adminextendedprofiles.delete_field",{id:o},function(e){var t;e.success&&(t=a.children("[data-id="+o+"]")).slideUp("fast",function(){t.remove()})}))}),a.on("click",".ps-js-field-duplicate",function(e){e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to duplicate this field?")&&(e=p(this).data("id"),peepso.postJson("adminextendedprofiles.duplicate_field",{id:e},function(e){e.success?(console.log(11),a.append(e.data.html),i(),p("html, body").animate({scrollTop:p(document).height()},"fast")):e.errors&&(console.log(22),alert(e.errors[0]))}))}),a.on("click",".ps-js-option-new",function(e){for(var t=p(this).closest(".ps-js-field"),o=t.find(".ps-js-option-template"),s=t.find("[data-prop-name=select_options]"),i=o.html(),n=t.data("id"),a="option_"+n+"_",d=1;;d++)if(s.filter('[data-prop-key="'+a+d+'"]').length<1){a+=d;break}i=(i=i.replace(/___val___/g,"")).replace(/___key___/g,a),o.before(i),t.find('input[data-prop-key="'+a+'"]').focus(),l(n)}),a.on("click",".ps-js-option-delete",function(e){var t;e.preventDefault(),e.stopPropagation(),confirm("Are you sure want to delete this option?")&&(t=(e=p(this)).closest(".ps-js-field").data("id"),e.closest(".ps-js-fieldconf").remove(),l(t))}),a.on("click",".ps-js-reset-privacy",function(e){var t,o,s;e.preventDefault(),e.stopPropagation(),(t=p(this)).data("progress")||(t.data("progress",1).css({opacity:.5}),e=t.closest(".ps-js-fieldconf"),o=e.find("select"),s=e.find(".ps-js-progress"),o.attr("readonly","readonly"),s.find("i").stop().hide(),s.find("img").show(),peepso.postJson("adminExtendedProfiles.reset_privacy",{id:o.data("parent-id")},function(e){s.find("img").hide(),s.find("i").show().delay(800).fadeOut(),o.removeAttr("readonly"),t.removeData("progress").css({opacity:""})}))}),i(),n={})}(jQuery);