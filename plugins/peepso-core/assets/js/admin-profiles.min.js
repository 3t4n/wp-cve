!function(f){var i,e=f(".ps-js-fields-container");e.on("input",".ps-js-field input[type=text]",function(){f(this).closest(".ps-js-fieldconf").find(".ps-js-btn").show()}).on("keydown",".ps-js-field input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),f(this).closest(".ps-js-fieldconf").find(".ps-js-save").click())}).find(".ps-js-field input[type=text]").each(function(){f(this).data("original-value",this.value)}),e.on("click",".ps-js-field .ps-js-cancel",function(){var e=f(this).closest(".ps-js-fieldconf"),t=e.find(".ps-js-btn"),e=e.find("input[type=text]");t.hide(),e.val(e.data("original-value"))}),e.on("click",".ps-js-field .ps-js-save",function(){var e=f(this).closest(".ps-js-fieldconf"),t=e.find(".ps-js-btn"),i=e.find("input[type=text]"),a=e.find(".ps-js-progress"),s="adminConfigFields.set_"+("meta"===i.data("prop-type")?"meta":"prop"),n={id:i.data("parent-id")||void 0,prop:i.data("prop-name")||void 0,key:i.data("prop-key")||void 0,value:i.val()};if("validation"===n.prop){var o,d,l=n.key.match(/^[a-z]+(min|max)_value$/),p=!1;if(l&&(""===n.value.trim()||isNaN(n.value)||+n.value<0?p=peepsoadminprofilesdata.number_invalid:(d=n.key.replace(l[1],"min"===l[1]?"max":"min"),e=(o=e.closest(".ps-tab__content")).find('[data-prop-key="'+d+'"]'),o.find('[data-prop-key="'+d.replace("_value","")+'"]')[0].checked&&(e=e.data("original-value")||e.val(),"min"===l[1]&&+e<+n.value?p=(p=peepsoadminprofilesdata.min_invalid).replace(/%d/g,+e):"max"===l[1]&&+e>+n.value&&(p=(p=peepsoadminprofilesdata.max_invalid).replace(/%d/g,+e))))),p)return void alert(p)}a.find("img").show(),i.attr("readonly","readonly"),peepso.postJson(s,n,function(e){a.find("img").hide(),a.find("i").show().delay(800).fadeOut(),i.removeAttr("readonly"),e.success&&(t.hide(),i.data("original-value",n.value),"post_title"==i.data("prop-name")&&f("#field-"+n.id+"-box-title").html(n.value))})}),e.on("click","input[type=checkbox]",function(){var e,t,i,a,s,n,o=f(this),d=o.closest(".ps-js-fieldconf").find(".ps-js-progress"),l=o[0].checked,p=!1,r="adminConfigFields.set_"+("meta"===o.data("prop-type")?"meta":"prop"),c={id:o.data("parent-id")||void 0,prop:o.data("prop-name")||void 0,key:o.data("prop-key")||void 0,value:l?o.val():o.data("disabled-value")};!l||"validation"!==c.prop||(e=c.key.match(/^[a-z]+(min|max)$/))&&(s=c.key.replace(e[1],"min"===e[1]?"max":"min"),a=(t=o.closest(".ps-tab__content")).find('[data-prop-key="'+s+'"]'),s=t.find('[data-prop-key="'+s+'_value"]'),a[0].checked&&(n=s.data("original-value")||s.val(),("min"===e[1]&&+n<+c.value||"max"===e[1]&&+n>+c.value)&&(p=!0)),p&&(t=t.find('[data-prop-key="'+c.key+'_value"]'),i=t.nextAll(".ps-js-save"),t.val(n))),d.find("i").stop().hide(),d.find("img").show(),o.attr("readonly","readonly"),peepso.postJson(r,c,function(e){d.find("img").hide(),d.find("i").show().delay(800).fadeOut(),o.removeAttr("readonly"),e.success&&(p&&i.trigger("click"),$value_container_id="#"+o[0].id+"-value-container",$container_id="#"+o[0].id+"-container",l?f($value_container_id).fadeIn(500):f($value_container_id).fadeOut(500),"validation"===c.prop&&"required"===c.key?(e=f("#field-"+c.id+"-required-mark"),l?e.removeClass("hidden"):e.addClass("hidden")):"post_status"===c.prop&&(l?o.closest(".postbox").removeClass("postbox-muted"):o.closest(".postbox").addClass("postbox-muted")))})}),e.on("change","select",_.throttle(function(){var t=f(this),i=t.closest(".ps-js-fieldconf").find(".ps-js-progress"),e="adminConfigFields.set_"+("meta"===t.data("prop-type")?"meta":"prop"),a={id:t.data("parent-id")||void 0,prop:t.data("prop-name")||void 0,key:t.data("prop-key")||void 0,value:t.val()};i.find("i").stop().hide(),i.find("img").show(),t.attr("readonly","readonly"),peepso.postJson(e,a,function(e){i.find("img").hide(),i.find("i").show().delay(800).fadeOut(),t.removeAttr("readonly"),e.success})},1e3)),e.sortable({handle:".ps-js-handle",update:_.throttle(function(){var e=[];f(".ps-js-fields-container .postbox").each(function(){e.push(f(this).data("id"))}),peepso.postJson("adminConfigFields.set_order",{fields:JSON.stringify(e)},function(e){})},3e3)}),e.on("click",".ps-js-field-toggle",function(){var e=f(this),t=e.closest(".postbox"),i=t.find(".ps-js-field"),a=t.data("id");i.is(":visible")?i.slideUp("fast",function(){e.removeClass("fa-compress").addClass("fa-expand"),s(),n(a,0)}):i.slideDown("fast",function(){e.removeClass("fa-expand").addClass("fa-compress"),s(),n(a,1)})}),e.on("click",".ps-js-field-title",function(e){e.target===e.currentTarget&&f(this).closest(".ps-postbox__title").find(".ps-js-field-toggle").click()}),e.on("mousedown",".ps-postbox__title",function(e){var t=f(e.currentTarget);i=setTimeout(function(){t.addClass("ps-js-mousedown")},200)}).on("mouseup mouseleave",".ps-postbox__title",function(e){clearTimeout(i),f(e.currentTarget).removeClass("ps-js-mousedown")}),f(".ps-js-field-expand-all").on("click",function(){e.find(".ps-js-field").slideDown("fast",function(){t(1)})}),f(".ps-js-field-collapse-all").on("click",function(){e.find(".ps-js-field").slideUp("fast",function(){t(0)})});var t=_.debounce(function(e){var t=f(".ps-js-fields-container").children(".postbox");0===e?t.find(".ps-js-field-toggle").removeClass("fa-compress").addClass("fa-expand"):t.find(".ps-js-field-toggle").removeClass("fa-expand").addClass("fa-compress"),s(e),n("all",e)},200);function s(e){var t,i,a=f(".ps-js-field-toggle-all"),s=a.find("span").first(),n=a.find("span").last();void 0===e&&(e=i=t=0,f(".ps-js-fields-container").find(".ps-js-field").each(function(){t++,f(this).is(":visible")&&i++}),t<=i&&(e=1)),0==+e?(a.data("status",0),n.html(a.data("expand-text")),s.removeClass("fa-compress").addClass("fa-expand")):(a.data("status",1),n.html(a.data("collapse-text")),s.removeClass("fa-expand").addClass("fa-compress"))}s();var a={},n=_.debounce(function(e,t){var i=[];"all"!==e?i=[e]:f(".ps-js-fields-container").children(".postbox").each(function(){i.push(f(this).data("id"))}),a[e]&&a[e].ret&&a[e].ret.abort(),a[e]=peepso.postJson("adminConfigFields.set_admin_box_status",{id:JSON.stringify(i),status:t},function(e){})},500);f(".ps-js-field-new").on("click",function(){var t,e="no-plugin-warning",i=f("#"+e);i.length||(t=window.peepsoadminprofilesdata||{},(i=f(t.popup_template)).prop("id",e),i.appendTo(document.body),i.on("click",".button-link",function(){i.hide()}),i.on("click",".button-primary",function(e){e.preventDefault(),e.stopPropagation(),i.hide(),window.open(t.plugin_url)})),i.show()}),e.on("click",".ps-tabs a",function(){var e=f(this),t=e.closest(".ps-tabs").find(".active");return t.removeClass("active"),e.addClass("active"),f(t.attr("href")).hide(),f(e.attr("href")).show(),!1}),e.on("click",".ps-postbox__title .fa-edit",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),i=e.find(".ps-postbox__title-editor"),a=i.find("input[type=text]"),s=(a.nextAll(".ps-js-save"),a.data("prop-title-is-default")),e=a.val();t.hide(),i.show(),a.data("original-value",e).focus(),a.val(s?"":e).trigger("input")}),e.on("click",".ps-js-field-title-text",function(){f(this).closest(".ps-postbox__title").find(".fa-edit").click()}),e.on("click",".ps-postbox__title .ps-js-cancel",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),i=e.find(".ps-postbox__title-editor"),e=i.find("input[type=text]");e.val(e.data("original-value")),i.hide(),t.show()}),e.on("click",".ps-postbox__title .ps-js-save",function(){var e=f(this).closest(".ps-postbox__title"),t=e.find(".ps-postbox__title-label"),i=e.find(".ps-postbox__title-editor"),a=i.find("input[type=text]"),s=e.find(".ps-js-progress"),e="adminConfigFields.set_"+("meta"===a.data("prop-type")?"meta":"prop"),n={id:a.data("parent-id")||void 0,prop:a.data("prop-name")||void 0,key:a.data("prop-key")||void 0,value:a.val()};s.find("img").show(),a.attr("readonly","readonly"),peepso.postJson(e,n,function(e){s.find("img").hide(),s.find("i").show().delay(800).fadeOut(),a.removeAttr("readonly"),e.success&&(i.hide(),t.show(),a.data("original-value",n.value),a.data("prop-title-is-default",!1),f("#field-"+n.id+"-box-title").html(n.value))})}),e.on("keydown",".ps-postbox__title input[type=text]",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),f(this).nextAll(".ps-js-save").click())}).on("input",".ps-postbox__title input[type=text]",function(e){var t=f(this).nextAll(".ps-js-save");this.value.trim()?t.removeAttr("disabled"):t.attr("disabled","disabled")}),e.on("focus",".ps-js-focusguard",function(){var e=f(this),t=e.closest(".ps-js-options").children(".ps-js-fieldconf");("last"===e.data("tag")?t.find("input").first():t.find("input").last()).focus()}),e.on("change","select[data-prop-name=date_range_min]",function(e){var t=f(this),i=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_max]");+i.val()<+t.val()&&i.val(t.val()).trigger("change")}),e.on("change","select[data-prop-name=date_range_max]",function(e){var t=f(this),i=t.closest(".ps-tab__content").find("select[data-prop-name=date_range_min]");+i.val()>+t.val()&&i.val(t.val()).trigger("change")}),f(function(){f(".ps-settings__bar").addClass("ps-settings__bar--static"),f(window).scroll(function(){var e=f(".ps-settings__bar");50<f(this).scrollTop()?e.removeClass("ps-settings__bar--static"):e.addClass("ps-settings__bar--static")})}),e.on("click","input[data-prop-name=user_registration]",function(e){console.log("user_registration");var t=f(this).closest(".ps-tab__content"),i=t.find("input[data-prop-name=user_registration_only]"),a=t.find("input[data-prop-name=user_admin_editable_only]"),t=t.find("input[data-prop-name=user_admin_visible_only]");this.checked?(a.is(":checked")&&a.trigger("click"),t.is(":checked")&&t.trigger("click")):i.is(":checked")&&i.trigger("click")}),e.on("click","input[data-prop-name=user_registration_only]",function(e){console.log("user_registration_only");var t=f(this).closest(".ps-tab__content"),i=t.find("input[data-prop-name=user_registration]"),a=t.find("input[data-prop-name=user_admin_editable_only]"),t=t.find("input[data-prop-name=user_admin_visible_only]");this.checked&&(i.is(":checked")||i.trigger("click"),a.is(":checked")&&a.trigger("click"),t.is(":checked")&&t.trigger("click"))}),e.on("click","input[data-prop-name=user_admin_editable_only]",function(e){console.log("user_admin_editable_only");var t=f(this).closest(".ps-tab__content"),i=t.find("input[data-prop-name=user_admin_visible_only]"),a=t.find("input[data-prop-name=user_registration]"),t=t.find("input[data-prop-name=user_registration_only]");this.checked?(a.is(":checked")&&a.trigger("click"),t.is(":checked")&&t.trigger("click")):i.is(":checked")&&i.trigger("click")}),e.on("click","input[data-prop-name=user_admin_visible_only]",function(e){console.log("user_admin_visible_only");var t=f(this).closest(".ps-tab__content"),i=t.find("input[data-prop-name=user_admin_editable_only]"),a=t.find("input[data-prop-name=user_registration]"),t=t.find("input[data-prop-name=user_registration_only]");this.checked&&(i.is(":checked")||i.trigger("click"),a.is(":checked")&&a.trigger("click"),t.is(":checked")&&t.trigger("click"))})}(jQuery);