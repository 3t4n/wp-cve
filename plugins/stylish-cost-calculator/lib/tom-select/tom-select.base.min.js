var global,factory;function _array_like_to_array(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _assert_this_initialized(self1){if(void 0===self1)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return self1}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _get_prototype_of(o){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_set_prototype_of(subClass,superClass)}function _instanceof(left,right){return null!=right&&"undefined"!=typeof Symbol&&right[Symbol.hasInstance]?!!right[Symbol.hasInstance](left):left instanceof right}function _set_prototype_of(o,p){return(_set_prototype_of=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _type_of(obj){return obj&&"undefined"!=typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array(o,minLen){if(o){if("string"==typeof o)return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}}function _create_super(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var call,result,Super=_get_prototype_of(Derived);if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(call=result)&&("object"===_type_of(call)||"function"==typeof call)?call:_assert_this_initialized(this)}}global=this,factory=function(){var unicode_map,multi_char_reg,forEvents=function(events,callback){events.split(/\s+/).forEach(function(event){callback(event)})},generator=function(code_points){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_step_value,code_point_min,code_point_max,i,composed,folded,err;return function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}(this,function(_state){switch(_state.label){case 0:_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,_state.label=1;case 1:_state.trys.push([1,8,9,10]),_iterator=code_points[Symbol.iterator](),_state.label=2;case 2:var arr;if(_iteratorNormalCompletion=(_step=_iterator.next()).done)return[3,7];code_point_min=(_step_value=function(arr){if(Array.isArray(arr))return arr}(arr=_step.value)||function(arr,i){var _s,_e,_i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}(arr,2)||_unsupported_iterable_to_array(arr,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],code_point_max=_step_value[1],i=code_point_min,_state.label=3;case 3:if(!(i<=code_point_max))return[3,6];if((folded=asciifold(composed=String.fromCharCode(i)))==composed.toLowerCase()||folded.length>max_char_length||0==folded.length)return[3,5];return[4,{folded:folded,composed:composed,code_point:i}];case 4:_state.sent(),_state.label=5;case 5:return i++,[3,3];case 6:return _iteratorNormalCompletion=!0,[3,2];case 7:return[3,10];case 8:return err=_state.sent(),_didIteratorError=!0,_iteratorError=err,[3,10];case 9:try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}return[7];case 10:return[2]}})},getSettings=function(input,settings_user){var tagName,options,optionsMap,group_count,readData,addOption,addGroup,settings=Object.assign({},defaults,settings_user),attr_data=settings.dataAttr,field_label=settings.labelField,field_value=settings.valueField,field_disabled=settings.disabledField,field_optgroup=settings.optgroupField,field_optgroup_label=settings.optgroupLabelField,field_optgroup_value=settings.optgroupValueField,tag_name=input.tagName.toLowerCase(),placeholder=input.getAttribute("placeholder")||input.getAttribute("data-placeholder");if(!placeholder&&!settings.allowEmptyOption){var option=input.querySelector('option[value=""]');option&&(placeholder=option.textContent)}var settings_element={placeholder:placeholder,options:[],optgroups:[],items:[],maxItems:null};return"select"===tag_name?(options=settings_element.options,optionsMap={},group_count=1,readData=function(el){var data=Object.assign({},el.dataset),json=attr_data&&data[attr_data];return"string"==typeof json&&json.length&&(data=Object.assign(data,JSON.parse(json))),data},addOption=function(option,group){var value=hash_key(option.value);if(null!=value&&(value||settings.allowEmptyOption)){if(optionsMap.hasOwnProperty(value)){if(group){var arr=optionsMap[value][field_optgroup];arr?Array.isArray(arr)?arr.push(group):optionsMap[value][field_optgroup]=[arr,group]:optionsMap[value][field_optgroup]=group}}else{var option_data=readData(option);option_data[field_label]=option_data[field_label]||option.textContent,option_data[field_value]=option_data[field_value]||value,option_data[field_disabled]=option_data[field_disabled]||option.disabled,option_data[field_optgroup]=option_data[field_optgroup]||group,option_data.$option=option,optionsMap[value]=option_data,options.push(option_data)}option.selected&&settings_element.items.push(value)}},addGroup=function(optgroup){var id,optgroup_data;(optgroup_data=readData(optgroup))[field_optgroup_label]=optgroup_data[field_optgroup_label]||optgroup.getAttribute("label")||"",optgroup_data[field_optgroup_value]=optgroup_data[field_optgroup_value]||group_count++,optgroup_data[field_disabled]=optgroup_data[field_disabled]||optgroup.disabled,settings_element.optgroups.push(optgroup_data),id=optgroup_data[field_optgroup_value],iterate(optgroup.children,function(option){addOption(option,id)})},settings_element.maxItems=input.hasAttribute("multiple")?null:1,iterate(input.children,function(child){"optgroup"===(tagName=child.tagName.toLowerCase())?addGroup(child):"option"===tagName&&addOption(child)})):function(){var data_raw=input.getAttribute(attr_data);if(data_raw)settings_element.options=JSON.parse(data_raw),iterate(settings_element.options,function(opt){settings_element.items.push(opt[field_value])});else{var value=input.value.trim()||"";if(!settings.allowEmptyOption&&!value.length)return;var values=value.split(settings.delimiter);iterate(values,function(value){var option={};option[field_label]=value,option[field_value]=value,settings_element.options.push(option)}),settings_element.items=values}}(),Object.assign({},defaults,settings_element,settings_user)},MicroEvent=function(){function MicroEvent(){_class_call_check(this,MicroEvent),this._events=void 0,this._events={}}return _create_class(MicroEvent,[{key:"on",value:function(events,fct){var _this=this;forEvents(events,function(event){var event_array=_this._events[event]||[];event_array.push(fct),_this._events[event]=event_array})}},{key:"off",value:function(events,fct){var _this=this,n=arguments.length;if(0===n){this._events={};return}forEvents(events,function(event){if(1===n){delete _this._events[event];return}var event_array=_this._events[event];void 0!==event_array&&(event_array.splice(event_array.indexOf(fct),1),_this._events[event]=event_array)})}},{key:"trigger",value:function(events){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var self1=this;forEvents(events,function(event){var event_array=self1._events[event];void 0!==event_array&&event_array.forEach(function(fct){fct.apply(self1,args)})})}}]),MicroEvent}(),arrayToPattern=function(chars){return(chars=chars.filter(Boolean)).length<2?chars[0]||"":1==maxValueLength(chars)?"["+chars.join("")+"]":"(?:"+chars.join("|")+")"},sequencePattern=function(array){if(!hasDuplicates(array))return array.join("");var pattern="",prev_char_count=0,prev_pattern=function(){prev_char_count>1&&(pattern+="{"+prev_char_count+"}")};return array.forEach(function(char,i){if(char===array[i-1]){prev_char_count++;return}prev_pattern(),pattern+=char,prev_char_count=1}),prev_pattern(),pattern},setToPattern=function(chars){return arrayToPattern(toArray(chars))},hasDuplicates=function(array){return new Set(array).size!==array.length},escape_regex=function(str){return(str+"").replace(RegExp("([\\$\\(\\)\\*\\+\\.\\?\\[\\]\\^\\{\\|\\}\\\\])","gu"),"\\$1")},maxValueLength=function(array){return array.reduce(function(longest,value){return Math.max(longest,unicodeLength(value))},0)},unicodeLength=function(str){return toArray(str).length},toArray=function(p){return Array.from(p)},allSubstrings=function(input){if(1===input.length)return[[input]];var result=[];return allSubstrings(input.substring(1)).forEach(function(subresult){var tmp=subresult.slice(0);tmp[0]=input.charAt(0)+tmp[0],result.push(tmp),(tmp=subresult.slice(0)).unshift(input.charAt(0)),result.push(tmp)}),result},code_points=[[0,65535]],max_char_length=3,latin_convert={},latin_condensed={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"\xe6ǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"\xf8ǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"\xdfȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"\xfe",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(var latin in latin_condensed)for(var unicode=latin_condensed[latin]||"",i=0;i<unicode.length;i++)latin_convert[unicode.substring(i,i+1)]=latin;var convert_pat=RegExp(Object.keys(latin_convert).join("|")+"|[̀-ͯ\xb7ʾʼ]","gu"),initialize=function(_code_points){void 0===unicode_map&&(unicode_map=generateMap(_code_points||code_points))},normalize=function(str){var form=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NFKD";return str.normalize(form)},asciifold=function(str){return toArray(str).reduce(function(result,char){return result+_asciifold(char)},"")},_asciifold=function(str){return str=normalize(str).toLowerCase().replace(convert_pat,function(char){return latin_convert[char]||""}),normalize(str,"NFC")},generateSets=function(code_points){var unicode_sets={},addMatching=function(folded,to_add){var folded_set=unicode_sets[folded]||new Set,patt=RegExp("^"+setToPattern(folded_set)+"$","iu");to_add.match(patt)||(folded_set.add(escape_regex(to_add)),unicode_sets[folded]=folded_set)},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=generator(code_points)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var value=_step.value;addMatching(value.folded,value.folded),addMatching(value.folded,value.composed)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return unicode_sets},generateMap=function(code_points){var unicode_sets=generateSets(code_points),unicode_map={},multi_char=[];for(var folded in unicode_sets){var set=unicode_sets[folded];set&&(unicode_map[folded]=setToPattern(set)),folded.length>1&&multi_char.push(escape_regex(folded))}return multi_char.sort(function(a,b){return b.length-a.length}),multi_char_reg=RegExp("^"+arrayToPattern(multi_char),"u"),unicode_map},mapSequence=function(strings){var min_replacement=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,chars_replaced=0;return(strings=strings.map(function(str){return unicode_map[str]&&(chars_replaced+=str.length),unicode_map[str]||str}),chars_replaced>=min_replacement)?sequencePattern(strings):""},substringsToPattern=function(str){var min_replacement=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return min_replacement=Math.max(min_replacement,str.length-1),arrayToPattern(allSubstrings(str).map(function(sub_pat){return mapSequence(sub_pat,min_replacement)}))},sequencesToPattern=function(sequences){var all=!(arguments.length>1)||void 0===arguments[1]||arguments[1],min_replacement=sequences.length>1?1:0;return arrayToPattern(sequences.map(function(sequence){for(var seq=[],len=all?sequence.length():sequence.length()-1,j=0;j<len;j++)seq.push(substringsToPattern(sequence.substrs[j]||"",min_replacement));return sequencePattern(seq)}))},inSequences=function(needle_seq,sequences){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=sequences[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _ret=function(){var seq=_step.value;if(seq.start!=needle_seq.start||seq.end!=needle_seq.end||seq.substrs.join("")!==needle_seq.substrs.join(""))return"continue";var needle_parts=needle_seq.parts;return seq.parts.filter(function(part){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=needle_parts[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var needle_part=_step.value;if(needle_part.start===part.start&&needle_part.substr===part.substr)break;if(1!=part.length&&1!=needle_part.length&&(part.start<needle_part.start&&part.end>needle_part.start||needle_part.start<part.start&&needle_part.end>part.start))return!0}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1}).length>0?"continue":{v:!0}}();if("object"===_type_of(_ret))return _ret.v}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1},Sequence=function(){function Sequence(){_class_call_check(this,Sequence),this.parts=[],this.substrs=[],this.start=0,this.end=0}return _create_class(Sequence,[{key:"add",value:function(part){part&&(this.parts.push(part),this.substrs.push(part.substr),this.start=Math.min(part.start,this.start),this.end=Math.max(part.end,this.end))}},{key:"last",value:function(){return this.parts[this.parts.length-1]}},{key:"length",value:function(){return this.parts.length}},{key:"clone",value:function(position,last_piece){var clone=new Sequence,parts=JSON.parse(JSON.stringify(this.parts)),last_part=parts.pop(),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=parts[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var part=_step.value;clone.add(part)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var last_substr=last_piece.substr.substring(0,position-last_part.start),clone_last_len=last_substr.length;return clone.add({start:last_part.start,end:last_part.start+clone_last_len,length:clone_last_len,substr:last_substr}),clone}}]),Sequence}(),getPattern=function(str){initialize(),str=asciifold(str);for(var pattern="",sequences=[new Sequence],i=0;i<str.length;i++)!function(i){var match=str.substring(i).match(multi_char_reg),char=str.substring(i,i+1),match_str=match?match[0]:null,overlapping=[],added_types=new Set,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=sequences[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var sequence=_step.value,last_piece=sequence.last();if(!last_piece||1==last_piece.length||last_piece.end<=i){if(match_str){var len=match_str.length;sequence.add({start:i,end:i+len,length:len,substr:match_str}),added_types.add("1")}else sequence.add({start:i,end:i+1,length:1,substr:char}),added_types.add("2")}else if(match_str){var clone=sequence.clone(i,last_piece),len1=match_str.length;clone.add({start:i,end:i+len1,length:len1,substr:match_str}),overlapping.push(clone)}else added_types.add("3")}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(overlapping.length>0){overlapping=overlapping.sort(function(a,b){return a.length()-b.length()});var _iteratorNormalCompletion1=!0,_didIteratorError1=!1,_iteratorError1=void 0;try{for(var _step1,_iterator1=overlapping[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=!0){var clone1=_step1.value;inSequences(clone1,sequences)||sequences.push(clone1)}}catch(err){_didIteratorError1=!0,_iteratorError1=err}finally{try{_iteratorNormalCompletion1||null==_iterator1.return||_iterator1.return()}finally{if(_didIteratorError1)throw _iteratorError1}}return}if(i>0&&1==added_types.size&&!added_types.has("3")){pattern+=sequencesToPattern(sequences,!1);var new_seq=new Sequence,old_seq=sequences[0];old_seq&&new_seq.add(old_seq.last()),sequences=[new_seq]}}(i);return pattern+=sequencesToPattern(sequences,!0)},getAttr=function(obj,name){if(obj)return obj[name]},getAttrNesting=function(obj,name){if(obj){for(var part,names=name.split(".");(part=names.shift())&&(obj=obj[part]););return obj}},scoreValue=function(value,token,weight){var score,pos;return value?(value+="",null==token.regex||-1===(pos=value.search(token.regex)))?0:(score=token.string.length/value.length,0===pos&&(score+=.5),score*weight):0},propToArray=function(obj,key){var value=obj[key];if("function"==typeof value)return value;value&&!Array.isArray(value)&&(obj[key]=[value])},iterate$1=function(object,callback){if(Array.isArray(object))object.forEach(callback);else for(var key in object)object.hasOwnProperty(key)&&callback(object[key],key)},Sifter=function(){function Sifter(items,settings){_class_call_check(this,Sifter),this.items=void 0,this.settings=void 0,this.items=items,this.settings=settings||{diacritics:!0}}return _create_class(Sifter,[{key:"tokenize",value:function(query,respect_word_boundaries,weights){var field_regex,_this=this;if(!query||!query.length)return[];var tokens=[],words=query.split(/\s+/);return weights&&(field_regex=RegExp("^("+Object.keys(weights).map(escape_regex).join("|")+"):(.*)$")),words.forEach(function(word){var field_match,field=null,regex=null;field_regex&&(field_match=word.match(field_regex))&&(field=field_match[1],word=field_match[2]),word.length>0&&(regex=_this.settings.diacritics?getPattern(word)||null:escape_regex(word))&&respect_word_boundaries&&(regex="\\b"+regex),tokens.push({string:word,regex:regex?RegExp(regex,"iu"):null,field:field})}),tokens}},{key:"getScoreFunction",value:function(query,options){var search=this.prepareSearch(query,options);return this._getScoreFunction(search)}},{key:"_getScoreFunction",value:function(search){var tokens=search.tokens,token_count=tokens.length;if(!token_count)return function(){return 0};var fields=search.options.fields,weights=search.weights,field_count=fields.length,getAttrFn=search.getAttrFn;if(!field_count)return function(){return 1};var scoreObject=1===field_count?function(token,data){var field=fields[0].field;return scoreValue(getAttrFn(data,field),token,weights[field]||1)}:function(token,data){var sum=0;if(token.field){var value=getAttrFn(data,token.field);!token.regex&&value?sum+=1/field_count:sum+=scoreValue(value,token,1)}else iterate$1(weights,function(weight,field){sum+=scoreValue(getAttrFn(data,field),token,weight)});return sum/field_count};return 1===token_count?function(data){return scoreObject(tokens[0],data)}:"and"===search.options.conjunction?function(data){var score,sum=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=tokens[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var token=_step.value;if((score=scoreObject(token,data))<=0)return 0;sum+=score}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return sum/token_count}:function(data){var sum=0;return iterate$1(tokens,function(token){sum+=scoreObject(token,data)}),sum/token_count}}},{key:"getSortFunction",value:function(query,options){var search=this.prepareSearch(query,options);return this._getSortFunction(search)}},{key:"_getSortFunction",value:function(search){var implicit_score,sort_flds=[],self1=this,options=search.options,sort=!search.query&&options.sort_empty?options.sort_empty:options.sort;if("function"==typeof sort)return sort.bind(this);var get_field=function(name,result){return"$score"===name?result.score:search.getAttrFn(self1.items[result.id],name)};if(sort){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=sort[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var s=_step.value;(search.query||"$score"!==s.field)&&sort_flds.push(s)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}if(search.query){implicit_score=!0;var _iteratorNormalCompletion1=!0,_didIteratorError1=!1,_iteratorError1=void 0;try{for(var _step1,_iterator1=sort_flds[Symbol.iterator]();!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=!0){var fld=_step1.value;if("$score"===fld.field){implicit_score=!1;break}}}catch(err){_didIteratorError1=!0,_iteratorError1=err}finally{try{_iteratorNormalCompletion1||null==_iterator1.return||_iterator1.return()}finally{if(_didIteratorError1)throw _iteratorError1}}implicit_score&&sort_flds.unshift({field:"$score",direction:"desc"})}else sort_flds=sort_flds.filter(function(fld){return"$score"!==fld.field});return sort_flds.length?function(a,b){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var result,field,_step,_iterator=sort_flds[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var a1,b1,sort_fld=_step.value;if(field=sort_fld.field,result=("desc"===sort_fld.direction?-1:1)*(a1=get_field(field,a),b1=get_field(field,b),"number"==typeof a1&&"number"==typeof b1?a1>b1?1:a1<b1?-1:0:(a1=asciifold(a1+"").toLowerCase())>(b1=asciifold(b1+"").toLowerCase())?1:b1>a1?-1:0))return result}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return 0}:null}},{key:"prepareSearch",value:function(query,optsUser){var weights={},options=Object.assign({},optsUser);if(propToArray(options,"sort"),propToArray(options,"sort_empty"),options.fields){propToArray(options,"fields");var fields=[];options.fields.forEach(function(field){"string"==typeof field&&(field={field:field,weight:1}),fields.push(field),weights[field.field]="weight"in field?field.weight:1}),options.fields=fields}return{options:options,query:query.toLowerCase().trim(),tokens:this.tokenize(query,options.respect_word_boundaries,weights),total:0,items:[],weights:weights,getAttrFn:options.nesting?getAttrNesting:getAttr}}},{key:"search",value:function(query,options){options=(search=this.prepareSearch(query,options)).options,query=search.query;var score,search,fn_score=options.score||this._getScoreFunction(search);query.length?iterate$1(this.items,function(item,id){score=fn_score(item),(!1===options.filter||score>0)&&search.items.push({score:score,id:id})}):iterate$1(this.items,function(_,id){search.items.push({score:1,id:id})});var fn_sort=this._getSortFunction(search);return fn_sort&&search.items.sort(fn_sort),search.total=search.items.length,"number"==typeof options.limit&&(search.items=search.items.slice(0,options.limit)),search}}]),Sifter}(),iterate=function(object,callback){if(Array.isArray(object))object.forEach(callback);else for(var key in object)object.hasOwnProperty(key)&&callback(object[key],key)},getDom=function(query){if(query.jquery)return query[0];if(_instanceof(query,HTMLElement))return query;if(isHtmlString(query)){var tpl=document.createElement("template");return tpl.innerHTML=query.trim(),tpl.content.firstChild}return document.querySelector(query)},isHtmlString=function(arg){return!!("string"==typeof arg&&arg.indexOf("<")>-1)},triggerEvent=function(dom_el,event_name){var event=document.createEvent("HTMLEvents");event.initEvent(event_name,!0,!1),dom_el.dispatchEvent(event)},applyCSS=function(dom_el,css){Object.assign(dom_el.style,css)},addClasses=function(elmts){for(var _len=arguments.length,classes=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)classes[_key-1]=arguments[_key];var norm_classes=classesArray(classes);(elmts=castAsArray(elmts)).map(function(el){norm_classes.map(function(cls){el.classList.add(cls)})})},removeClasses=function(elmts){for(var _len=arguments.length,classes=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)classes[_key-1]=arguments[_key];var norm_classes=classesArray(classes);(elmts=castAsArray(elmts)).map(function(el){norm_classes.map(function(cls){el.classList.remove(cls)})})},classesArray=function(args){var classes=[];return iterate(args,function(_classes){"string"==typeof _classes&&(_classes=_classes.trim().split(/[\11\12\14\15\40]/)),Array.isArray(_classes)&&(classes=classes.concat(_classes))}),classes.filter(Boolean)},castAsArray=function(arg){return Array.isArray(arg)||(arg=[arg]),arg},parentMatch=function(target,selector,wrapper){if(!wrapper||wrapper.contains(target))for(;target&&target.matches;){if(target.matches(selector))return target;target=target.parentNode}},getTail=function(list){var direction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return direction>0?list[list.length-1]:list[0]},nodeIndex=function(el,amongst){if(!el)return -1;amongst=amongst||el.nodeName;for(var i=0;el=el.previousElementSibling;)el.matches(amongst)&&i++;return i},setAttr=function(el,attrs){iterate(attrs,function(val,attr){null==val?el.removeAttribute(attr):el.setAttribute(attr,""+val)})},replaceNode=function(existing,replacement){existing.parentNode&&existing.parentNode.replaceChild(replacement,existing)},highlight=function(element,regex){if(null!==regex){if("string"==typeof regex){if(!regex.length)return;regex=RegExp(regex,"i")}var highlightText=function(node){var match=node.data.match(regex);if(match&&node.data.length>0){var spannode=document.createElement("span");spannode.className="highlight";var middlebit=node.splitText(match.index);middlebit.splitText(match[0].length);var middleclone=middlebit.cloneNode(!0);return spannode.appendChild(middleclone),replaceNode(middlebit,spannode),1}return 0},highlightChildren=function(node){1===node.nodeType&&node.childNodes&&!/(script|style)/i.test(node.tagName)&&("highlight"!==node.className||"SPAN"!==node.tagName)&&Array.from(node.childNodes).forEach(function(element){highlightRecursive(element)})},highlightRecursive=function(node){return 3===node.nodeType?highlightText(node):(highlightChildren(node),0)};highlightRecursive(element)}},removeHighlight=function(el){var elements=el.querySelectorAll("span.highlight");Array.prototype.forEach.call(elements,function(el){var parent=el.parentNode;parent.replaceChild(el.firstChild,el),parent.normalize()})},KEY_SHORTCUT="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey",defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(query){return query.length>0},render:{}},hash_key=function(value){return null==value?null:get_hash(value)},get_hash=function(value){return"boolean"==typeof value?value?"1":"0":value+""},escape_html=function(str){return(str+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},loadDebounce=function(fn,delay){var timeout;return function(value,callback){var self1=this;timeout&&(self1.loading=Math.max(self1.loading-1,0),clearTimeout(timeout)),timeout=setTimeout(function(){timeout=null,self1.loadedSearches[value]=!0,fn.call(self1,value,callback)},delay)}},debounce_events=function(self1,types,fn){var trigger=self1.trigger,event_args={};self1.trigger=function(){var type=arguments[0];if(-1===types.indexOf(type))return trigger.apply(self1,arguments);event_args[type]=arguments},fn.apply(self1,[]),self1.trigger=trigger;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var type,_step,_iterator=types[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)(type=_step.value)in event_args&&trigger.apply(self1,event_args[type])}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}},preventDefault=function(evt){var stop=arguments.length>1&&void 0!==arguments[1]&&arguments[1];evt&&(evt.preventDefault(),stop&&evt.stopPropagation())},addEvent=function(target,type,callback,options){target.addEventListener(type,callback,options)},isKeyDown=function(key_name,evt){return!!evt&&!!evt[key_name]&&1==(evt.altKey?1:0)+(evt.ctrlKey?1:0)+(evt.shiftKey?1:0)+(evt.metaKey?1:0)},getId=function(el,id){return el.getAttribute("id")||(el.setAttribute("id",id),id)},addSlashes=function(str){return str.replace(/[\\"']/g,"\\$&")},append=function(parent,node){node&&parent.append(node)},instance_i=0,TomSelect1=function(_MicroPlugin){_inherits(TomSelect1,_MicroPlugin);var _super=_create_super(TomSelect1);function TomSelect1(input_arg,user_settings){_class_call_check(this,TomSelect1),(_this=_super.call(this)).control_input=void 0,_this.wrapper=void 0,_this.dropdown=void 0,_this.control=void 0,_this.dropdown_content=void 0,_this.focus_node=void 0,_this.order=0,_this.settings=void 0,_this.input=void 0,_this.tabIndex=void 0,_this.is_select_tag=void 0,_this.rtl=void 0,_this.inputId=void 0,_this._destroy=void 0,_this.sifter=void 0,_this.isOpen=!1,_this.isDisabled=!1,_this.isRequired=void 0,_this.isInvalid=!1,_this.isValid=!0,_this.isLocked=!1,_this.isFocused=!1,_this.isInputHidden=!1,_this.isSetup=!1,_this.ignoreFocus=!1,_this.ignoreHover=!1,_this.hasOptions=!1,_this.currentResults=void 0,_this.lastValue="",_this.caretPos=0,_this.loading=0,_this.loadedSearches={},_this.activeOption=null,_this.activeItems=[],_this.optgroups={},_this.options={},_this.userOptions={},_this.items=[],instance_i++;var _this,dir,control_input,input=getDom(input_arg);if(input.tomselect)throw Error("Tom Select already initialized on this element");input.tomselect=_assert_this_initialized(_this),dir=(window.getComputedStyle&&window.getComputedStyle(input,null)).getPropertyValue("direction");var settings=getSettings(input,user_settings);_this.settings=settings,_this.input=input,_this.tabIndex=input.tabIndex||0,_this.is_select_tag="select"===input.tagName.toLowerCase(),_this.rtl=/rtl/i.test(dir),_this.inputId=getId(input,"tomselect-"+instance_i),_this.isRequired=input.required,_this.sifter=new Sifter(_this.options,{diacritics:settings.diacritics}),settings.mode=settings.mode||(1===settings.maxItems?"single":"multi"),"boolean"!=typeof settings.hideSelected&&(settings.hideSelected="multi"===settings.mode),"boolean"!=typeof settings.hidePlaceholder&&(settings.hidePlaceholder="multi"!==settings.mode);var filter=settings.createFilter;"function"!=typeof filter&&("string"==typeof filter&&(filter=new RegExp(filter)),_instanceof(filter,RegExp)?settings.createFilter=function(input){return filter.test(input)}:settings.createFilter=function(value){return _this.settings.duplicates||!_this.options[value]}),_this.initializePlugins(settings.plugins),_this.setupCallbacks(),_this.setupTemplates();var wrapper=getDom("<div>"),control=getDom("<div>"),dropdown=_this._render("dropdown"),dropdown_content=getDom('<div role="listbox" tabindex="-1">'),classes=_this.input.getAttribute("class")||"",inputMode=settings.mode;return(addClasses(wrapper,settings.wrapperClass,classes,inputMode),addClasses(control,settings.controlClass),append(wrapper,control),addClasses(dropdown,settings.dropdownClass,inputMode),settings.copyClassesToDropdown&&addClasses(dropdown,classes),addClasses(dropdown_content,settings.dropdownContentClass),append(dropdown,dropdown_content),getDom(settings.dropdownParent||wrapper).appendChild(dropdown),isHtmlString(settings.controlInput))?(control_input=getDom(settings.controlInput),iterate$1(["autocorrect","autocapitalize","autocomplete"],function(attr){input.getAttribute(attr)&&setAttr(control_input,_define_property({},attr,input.getAttribute(attr)))}),control_input.tabIndex=-1,control.appendChild(control_input),_this.focus_node=control_input):settings.controlInput?(control_input=getDom(settings.controlInput),_this.focus_node=control_input):(control_input=getDom("<input/>"),_this.focus_node=control),_this.wrapper=wrapper,_this.dropdown=dropdown,_this.dropdown_content=dropdown_content,_this.control=control,_this.control_input=control_input,_this.setup(),_this}return _create_class(TomSelect1,[{key:"setup",value:function(){var self1=this,settings=self1.settings,control_input=self1.control_input,dropdown=self1.dropdown,dropdown_content=self1.dropdown_content,wrapper=self1.wrapper,control=self1.control,input=self1.input,focus_node=self1.focus_node,passive_event={passive:!0},listboxId=self1.inputId+"-ts-dropdown";setAttr(dropdown_content,{id:listboxId}),setAttr(focus_node,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":listboxId});var control_id=getId(focus_node,self1.inputId+"-ts-control"),query="label[for='"+self1.inputId.replace(/['"\\]/g,"\\$&")+"']",label=document.querySelector(query),label_click=self1.focus.bind(self1);if(label){addEvent(label,"click",label_click),setAttr(label,{for:control_id});var label_id=getId(label,self1.inputId+"-ts-label");setAttr(focus_node,{"aria-labelledby":label_id}),setAttr(dropdown_content,{"aria-labelledby":label_id})}wrapper.style.width=input.style.width,self1.plugins.names.length&&addClasses([wrapper,dropdown],"plugin-"+self1.plugins.names.join(" plugin-")),(null===settings.maxItems||settings.maxItems>1)&&self1.is_select_tag&&setAttr(input,{multiple:"multiple"}),settings.placeholder&&setAttr(control_input,{placeholder:settings.placeholder}),!settings.splitOn&&settings.delimiter&&(settings.splitOn=RegExp("\\s*"+escape_regex(settings.delimiter)+"+\\s*")),settings.load&&settings.loadThrottle&&(settings.load=loadDebounce(settings.load,settings.loadThrottle)),self1.control_input.type=input.type,addEvent(dropdown,"mousemove",function(){self1.ignoreHover=!1}),addEvent(dropdown,"mouseenter",function(e){var target_match=parentMatch(e.target,"[data-selectable]",dropdown);target_match&&self1.onOptionHover(e,target_match)},{capture:!0}),addEvent(dropdown,"click",function(evt){var option=parentMatch(evt.target,"[data-selectable]");option&&(self1.onOptionSelect(evt,option),preventDefault(evt,!0))}),addEvent(control,"click",function(evt){var target_match=parentMatch(evt.target,"[data-ts-item]",control);if(target_match&&self1.onItemSelect(evt,target_match)){preventDefault(evt,!0);return}""==control_input.value&&(self1.onClick(),preventDefault(evt,!0))}),addEvent(focus_node,"keydown",function(e){return self1.onKeyDown(e)}),addEvent(control_input,"keypress",function(e){return self1.onKeyPress(e)}),addEvent(control_input,"input",function(e){return self1.onInput(e)}),addEvent(focus_node,"blur",function(e){return self1.onBlur(e)}),addEvent(focus_node,"focus",function(e){return self1.onFocus(e)}),addEvent(control_input,"paste",function(e){return self1.onPaste(e)});var doc_mousedown=function(evt){var target=evt.composedPath()[0];if(!wrapper.contains(target)&&!dropdown.contains(target)){self1.isFocused&&self1.blur(),self1.inputState();return}target==control_input&&self1.isOpen?evt.stopPropagation():preventDefault(evt,!0)},win_scroll=function(){self1.isOpen&&self1.positionDropdown()};addEvent(document,"mousedown",doc_mousedown),addEvent(window,"scroll",win_scroll,passive_event),addEvent(window,"resize",win_scroll,passive_event),this._destroy=function(){document.removeEventListener("mousedown",doc_mousedown),window.removeEventListener("scroll",win_scroll),window.removeEventListener("resize",win_scroll),label&&label.removeEventListener("click",label_click)},this.revertSettings={innerHTML:input.innerHTML,tabIndex:input.tabIndex},input.tabIndex=-1,input.insertAdjacentElement("afterend",self1.wrapper),self1.sync(!1),settings.items=[],delete settings.optgroups,delete settings.options,addEvent(input,"invalid",function(){self1.isValid&&(self1.isValid=!1,self1.isInvalid=!0,self1.refreshState())}),self1.updateOriginalInput(),self1.refreshItems(),self1.close(!1),self1.inputState(),self1.isSetup=!0,input.disabled?self1.disable():self1.enable(),self1.on("change",this.onChange),addClasses(input,"tomselected","ts-hidden-accessible"),self1.trigger("initialize"),!0===settings.preload&&self1.preload()}},{key:"setupOptions",value:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],optgroups=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],_this=this;this.addOptions(options),iterate$1(optgroups,function(optgroup){_this.registerOptionGroup(optgroup)})}},{key:"setupTemplates",value:function(){var field_label=this.settings.labelField,field_optgroup=this.settings.optgroupLabelField;this.settings.render=Object.assign({},{optgroup:function(data){var optgroup=document.createElement("div");return optgroup.className="optgroup",optgroup.appendChild(data.options),optgroup},optgroup_header:function(data,escape){return'<div class="optgroup-header">'+escape(data[field_optgroup])+"</div>"},option:function(data,escape){return"<div>"+escape(data[field_label])+"</div>"},item:function(data,escape){return"<div>"+escape(data[field_label])+"</div>"},option_create:function(data,escape){return'<div class="create">Add <strong>'+escape(data.input)+"</strong>&hellip;</div>"},no_results:function(){return'<div class="no-results">No results found</div>'},loading:function(){return'<div class="spinner"></div>'},not_loading:function(){},dropdown:function(){return"<div></div>"}},this.settings.render)}},{key:"setupCallbacks",value:function(){var key,fn,callbacks={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(key in callbacks)(fn=this.settings[callbacks[key]])&&this.on(key,fn)}},{key:"sync",value:function(){var get_settings=!(arguments.length>0)||void 0===arguments[0]||arguments[0],settings=get_settings?getSettings(this.input,{delimiter:this.settings.delimiter}):this.settings;this.setupOptions(settings.options,settings.optgroups),this.setValue(settings.items||[],!0),this.lastQuery=null}},{key:"onClick",value:function(){if(this.activeItems.length>0){this.clearActiveItems(),this.focus();return}this.isFocused&&this.isOpen?this.blur():this.focus()}},{key:"onMouseDown",value:function(){}},{key:"onChange",value:function(){triggerEvent(this.input,"input"),triggerEvent(this.input,"change")}},{key:"onPaste",value:function(e){var _this=this,self1=this;if(self1.isInputHidden||self1.isLocked){preventDefault(e);return}self1.settings.splitOn&&setTimeout(function(){var pastedText=self1.inputValue();pastedText.match(self1.settings.splitOn)&&iterate$1(pastedText.trim().split(self1.settings.splitOn),function(piece){hash_key(piece)&&(_this.options[piece]?self1.addItem(piece):self1.createItem(piece))})},0)}},{key:"onKeyPress",value:function(e){if(this.isLocked){preventDefault(e);return}var character=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&"multi"===this.settings.mode&&character===this.settings.delimiter){this.createItem(),preventDefault(e);return}}},{key:"onKeyDown",value:function(e){if(this.ignoreHover=!0,this.isLocked){9!==e.keyCode&&preventDefault(e);return}switch(e.keyCode){case 65:if(isKeyDown(KEY_SHORTCUT,e)&&""==this.control_input.value){preventDefault(e),this.selectAll();return}break;case 27:this.isOpen&&(preventDefault(e,!0),this.close()),this.clearActiveItems();return;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.activeOption){var next=this.getAdjacent(this.activeOption,1);next&&this.setActiveOption(next)}preventDefault(e);return;case 38:if(this.activeOption){var prev=this.getAdjacent(this.activeOption,-1);prev&&this.setActiveOption(prev)}preventDefault(e);return;case 13:this.canSelect(this.activeOption)?(this.onOptionSelect(e,this.activeOption),preventDefault(e)):this.settings.create&&this.createItem()?preventDefault(e):document.activeElement==this.control_input&&this.isOpen&&preventDefault(e);return;case 37:this.advanceSelection(-1,e);return;case 39:this.advanceSelection(1,e);return;case 9:this.settings.selectOnTab&&(this.canSelect(this.activeOption)&&(this.onOptionSelect(e,this.activeOption),preventDefault(e)),this.settings.create&&this.createItem()&&preventDefault(e));return;case 8:case 46:this.deleteSelection(e);return}this.isInputHidden&&!isKeyDown(KEY_SHORTCUT,e)&&preventDefault(e)}},{key:"onInput",value:function(e){if(!this.isLocked){var value=this.inputValue();this.lastValue!==value&&(this.lastValue=value,this.settings.shouldLoad.call(this,value)&&this.load(value),this.refreshOptions(),this.trigger("type",value))}}},{key:"onOptionHover",value:function(evt,option){this.ignoreHover||this.setActiveOption(option,!1)}},{key:"onFocus",value:function(e){var wasFocused=this.isFocused;if(this.isDisabled){this.blur(),preventDefault(e);return}this.ignoreFocus||(this.isFocused=!0,"focus"===this.settings.preload&&this.preload(),wasFocused||this.trigger("focus"),this.activeItems.length||(this.showInput(),this.refreshOptions(!!this.settings.openOnFocus)),this.refreshState())}},{key:"onBlur",value:function(e){if(!1!==document.hasFocus()){var self1=this;if(self1.isFocused){self1.isFocused=!1,self1.ignoreFocus=!1;var deactivate=function(){self1.close(),self1.setActiveItem(),self1.setCaret(self1.items.length),self1.trigger("blur")};self1.settings.create&&self1.settings.createOnBlur?self1.createItem(null,deactivate):deactivate()}}}},{key:"onOptionSelect",value:function(evt,option){var value,self1=this;!(option.parentElement&&option.parentElement.matches("[data-disabled]"))&&(option.classList.contains("create")?self1.createItem(null,function(){self1.settings.closeAfterSelect&&self1.close()}):void 0!==(value=option.dataset.value)&&(self1.lastQuery=null,self1.addItem(value),self1.settings.closeAfterSelect&&self1.close(),!self1.settings.hideSelected&&evt.type&&/click/.test(evt.type)&&self1.setActiveOption(option)))}},{key:"canSelect",value:function(option){return!!(this.isOpen&&option&&this.dropdown_content.contains(option))}},{key:"onItemSelect",value:function(evt,item){return!this.isLocked&&"multi"===this.settings.mode&&(preventDefault(evt),this.setActiveItem(item,evt),!0)}},{key:"canLoad",value:function(value){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(value))}},{key:"load",value:function(value){if(this.canLoad(value)){addClasses(this.wrapper,this.settings.loadingClass),this.loading++;var callback=this.loadCallback.bind(this);this.settings.load.call(this,value,callback)}}},{key:"loadCallback",value:function(options,optgroups){this.loading=Math.max(this.loading-1,0),this.lastQuery=null,this.clearActiveOption(),this.setupOptions(options,optgroups),this.refreshOptions(this.isFocused&&!this.isInputHidden),this.loading||removeClasses(this.wrapper,this.settings.loadingClass),this.trigger("load",options,optgroups)}},{key:"preload",value:function(){var classList=this.wrapper.classList;classList.contains("preloaded")||(classList.add("preloaded"),this.load(""))}},{key:"setTextboxValue",value:function(){var value=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",input=this.control_input;input.value!==value&&(input.value=value,triggerEvent(input,"update"),this.lastValue=value)}},{key:"getValue",value:function(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}},{key:"setValue",value:function(value,silent){var _this=this;debounce_events(this,silent?[]:["change"],function(){_this.clear(silent),_this.addItems(value,silent)})}},{key:"setMaxItems",value:function(value){0===value&&(value=null),this.settings.maxItems=value,this.refreshState()}},{key:"setActiveItem",value:function(item,e){var eventName,i,begin,end,swap,last;if("single"!==this.settings.mode){if(!item){this.clearActiveItems(),this.isFocused&&this.showInput();return}if("click"===(eventName=e&&e.type.toLowerCase())&&isKeyDown("shiftKey",e)&&this.activeItems.length){for(last=this.getLastActive(),(begin=Array.prototype.indexOf.call(this.control.children,last))>(end=Array.prototype.indexOf.call(this.control.children,item))&&(swap=begin,begin=end,end=swap),i=begin;i<=end;i++)item=this.control.children[i],-1===this.activeItems.indexOf(item)&&this.setActiveItemClass(item);preventDefault(e)}else"click"===eventName&&isKeyDown(KEY_SHORTCUT,e)||"keydown"===eventName&&isKeyDown("shiftKey",e)?item.classList.contains("active")?this.removeActiveItem(item):this.setActiveItemClass(item):(this.clearActiveItems(),this.setActiveItemClass(item));this.hideInput(),this.isFocused||this.focus()}}},{key:"setActiveItemClass",value:function(item){var last_active=this.control.querySelector(".last-active");last_active&&removeClasses(last_active,"last-active"),addClasses(item,"active last-active"),this.trigger("item_select",item),-1==this.activeItems.indexOf(item)&&this.activeItems.push(item)}},{key:"removeActiveItem",value:function(item){var idx=this.activeItems.indexOf(item);this.activeItems.splice(idx,1),removeClasses(item,"active")}},{key:"clearActiveItems",value:function(){removeClasses(this.activeItems,"active"),this.activeItems=[]}},{key:"setActiveOption",value:function(option){var scroll=!(arguments.length>1)||void 0===arguments[1]||arguments[1];option!==this.activeOption&&(this.clearActiveOption(),option&&(this.activeOption=option,setAttr(this.focus_node,{"aria-activedescendant":option.getAttribute("id")}),setAttr(option,{"aria-selected":"true"}),addClasses(option,"active"),scroll&&this.scrollToOption(option)))}},{key:"scrollToOption",value:function(option,behavior){if(option){var content=this.dropdown_content,height_menu=content.clientHeight,scrollTop=content.scrollTop||0,height_item=option.offsetHeight,y=option.getBoundingClientRect().top-content.getBoundingClientRect().top+scrollTop;y+height_item>height_menu+scrollTop?this.scroll(y-height_menu+height_item,behavior):y<scrollTop&&this.scroll(y,behavior)}}},{key:"scroll",value:function(scrollTop,behavior){var content=this.dropdown_content;behavior&&(content.style.scrollBehavior=behavior),content.scrollTop=scrollTop,content.style.scrollBehavior=""}},{key:"clearActiveOption",value:function(){this.activeOption&&(removeClasses(this.activeOption,"active"),setAttr(this.activeOption,{"aria-selected":null})),this.activeOption=null,setAttr(this.focus_node,{"aria-activedescendant":null})}},{key:"selectAll",value:function(){var self1=this;if("single"!==self1.settings.mode){var activeItems=self1.controlChildren();activeItems.length&&(self1.hideInput(),self1.close(),self1.activeItems=activeItems,iterate$1(activeItems,function(item){self1.setActiveItemClass(item)}))}}},{key:"inputState",value:function(){this.control.contains(this.control_input)&&(setAttr(this.control_input,{placeholder:this.settings.placeholder}),this.activeItems.length>0||!this.isFocused&&this.settings.hidePlaceholder&&this.items.length>0?(this.setTextboxValue(),this.isInputHidden=!0):(this.settings.hidePlaceholder&&this.items.length>0&&setAttr(this.control_input,{placeholder:""}),this.isInputHidden=!1),this.wrapper.classList.toggle("input-hidden",this.isInputHidden))}},{key:"hideInput",value:function(){this.inputState()}},{key:"showInput",value:function(){this.inputState()}},{key:"inputValue",value:function(){return this.control_input.value.trim()}},{key:"focus",value:function(){var self1=this;self1.isDisabled||(self1.ignoreFocus=!0,self1.control_input.offsetWidth?self1.control_input.focus():self1.focus_node.focus(),setTimeout(function(){self1.ignoreFocus=!1,self1.onFocus()},0))}},{key:"blur",value:function(){this.focus_node.blur(),this.onBlur()}},{key:"getScoreFunction",value:function(query){return this.sifter.getScoreFunction(query,this.getSearchOptions())}},{key:"getSearchOptions",value:function(){var settings=this.settings,sort=settings.sortField;return"string"==typeof settings.sortField&&(sort=[{field:settings.sortField}]),{fields:settings.searchField,conjunction:settings.searchConjunction,sort:sort,nesting:settings.nesting}}},{key:"search",value:function(query){var result,calculateScore,self1=this,options=this.getSearchOptions();if(self1.settings.score&&"function"!=typeof(calculateScore=self1.settings.score.call(self1,query)))throw Error('Tom Select "score" setting must be a function that returns a function');return query!==self1.lastQuery?(self1.lastQuery=query,result=self1.sifter.search(query,Object.assign(options,{score:calculateScore})),self1.currentResults=result):result=Object.assign({},self1.currentResults),self1.settings.hideSelected&&(result.items=result.items.filter(function(item){var hashed=hash_key(item.id);return!(hashed&&-1!==self1.items.indexOf(hashed))})),result}},{key:"refreshOptions",value:function(){var i,j,k,n,optgroup,optgroups,html,has_create_option,active_group,create,triggerDropdown=!(arguments.length>0)||void 0===arguments[0]||arguments[0],groups={},groups_order=[],self1=this,query=self1.inputValue(),same_query=query===self1.lastQuery||""==query&&null==self1.lastQuery,results=self1.search(query),active_option=null,show_dropdown=self1.settings.shouldOpen||!1,dropdown_content=self1.dropdown_content;for(same_query&&(active_option=self1.activeOption)&&(active_group=active_option.closest("[data-group]")),n=results.items.length,"number"==typeof self1.settings.maxOptions&&(n=Math.min(n,self1.settings.maxOptions)),n>0&&(show_dropdown=!0),i=0;i<n;i++){var item=results.items[i];if(item){var opt_value=item.id,option=self1.options[opt_value];if(void 0!==option){var opt_hash=get_hash(opt_value),option_el=self1.getOption(opt_hash,!0);for(self1.settings.hideSelected||option_el.classList.toggle("selected",self1.items.includes(opt_hash)),j=0,k=(optgroups=Array.isArray(optgroup=option[self1.settings.optgroupField]||"")?optgroup:[optgroup])&&optgroups.length;j<k;j++){optgroup=optgroups[j],self1.optgroups.hasOwnProperty(optgroup)||(optgroup="");var group_fragment=groups[optgroup];void 0===group_fragment&&(group_fragment=document.createDocumentFragment(),groups_order.push(optgroup)),j>0&&(setAttr(option_el=option_el.cloneNode(!0),{id:option.$id+"-clone-"+j,"aria-selected":null}),option_el.classList.add("ts-cloned"),removeClasses(option_el,"active"),self1.activeOption&&self1.activeOption.dataset.value==opt_value&&active_group&&active_group.dataset.group===optgroup.toString()&&(active_option=option_el)),group_fragment.appendChild(option_el),groups[optgroup]=group_fragment}}}}self1.settings.lockOptgroupOrder&&groups_order.sort(function(a,b){var grp_a=self1.optgroups[a],grp_b=self1.optgroups[b];return(grp_a&&grp_a.$order||0)-(grp_b&&grp_b.$order||0)}),html=document.createDocumentFragment(),iterate$1(groups_order,function(optgroup){var group_fragment=groups[optgroup];if(group_fragment&&group_fragment.children.length){var group_heading=self1.optgroups[optgroup];if(void 0!==group_heading){var group_options=document.createDocumentFragment();append(group_options,self1.render("optgroup_header",group_heading)),append(group_options,group_fragment),append(html,self1.render("optgroup",{group:group_heading,options:group_options}))}else append(html,group_fragment)}}),dropdown_content.innerHTML="",append(dropdown_content,html),self1.settings.highlight&&(removeHighlight(dropdown_content),results.query.length&&results.tokens.length&&iterate$1(results.tokens,function(tok){highlight(dropdown_content,tok.regex)}));var add_template=function(template){var content=self1.render(template,{input:query});return content&&(show_dropdown=!0,dropdown_content.insertBefore(content,dropdown_content.firstChild)),content};if(self1.loading?add_template("loading"):self1.settings.shouldLoad.call(self1,query)?0===results.items.length&&add_template("no_results"):add_template("not_loading"),(has_create_option=self1.canCreate(query))&&(create=add_template("option_create")),self1.hasOptions=results.items.length>0||has_create_option,show_dropdown){if(results.items.length>0){if(active_option||"single"!==self1.settings.mode||void 0==self1.items[0]||(active_option=self1.getOption(self1.items[0])),!dropdown_content.contains(active_option)){var active_index=0;create&&!self1.settings.addPrecedence&&(active_index=1),active_option=self1.selectable()[active_index]}}else create&&(active_option=create);triggerDropdown&&!self1.isOpen&&(self1.open(),self1.scrollToOption(active_option,"auto")),self1.setActiveOption(active_option)}else self1.clearActiveOption(),triggerDropdown&&self1.isOpen&&self1.close(!1)}},{key:"selectable",value:function(){return this.dropdown_content.querySelectorAll("[data-selectable]")}},{key:"addOption",value:function(data){var user_created=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(data))return this.addOptions(data,user_created),!1;var key=hash_key(data[this.settings.valueField]);return!(null===key||this.options.hasOwnProperty(key))&&(data.$order=data.$order||++this.order,data.$id=this.inputId+"-opt-"+data.$order,this.options[key]=data,this.lastQuery=null,user_created&&(this.userOptions[key]=user_created,this.trigger("option_add",key,data)),key)}},{key:"addOptions",value:function(data){var user_created=arguments.length>1&&void 0!==arguments[1]&&arguments[1],_this=this;iterate$1(data,function(dat){_this.addOption(dat,user_created)})}},{key:"registerOption",value:function(data){return this.addOption(data)}},{key:"registerOptionGroup",value:function(data){var key=hash_key(data[this.settings.optgroupValueField]);return null!==key&&(data.$order=data.$order||++this.order,this.optgroups[key]=data,key)}},{key:"addOptionGroup",value:function(id,data){var hashed_id;data[this.settings.optgroupValueField]=id,(hashed_id=this.registerOptionGroup(data))&&this.trigger("optgroup_add",hashed_id,data)}},{key:"removeOptionGroup",value:function(id){this.optgroups.hasOwnProperty(id)&&(delete this.optgroups[id],this.clearCache(),this.trigger("optgroup_remove",id))}},{key:"clearOptionGroups",value:function(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}},{key:"updateOption",value:function(value,data){var item_new,index_item,value_old=hash_key(value),value_new=hash_key(data[this.settings.valueField]);if(null!==value_old){var data_old=this.options[value_old];if(void 0!=data_old){if("string"!=typeof value_new)throw Error("Value must be set in option data");var option=this.getOption(value_old),item=this.getItem(value_old);if(data.$order=data.$order||data_old.$order,delete this.options[value_old],this.uncacheValue(value_new),this.options[value_new]=data,option){if(this.dropdown_content.contains(option)){var option_new=this._render("option",data);replaceNode(option,option_new),this.activeOption===option&&this.setActiveOption(option_new)}option.remove()}item&&(-1!==(index_item=this.items.indexOf(value_old))&&this.items.splice(index_item,1,value_new),item_new=this._render("item",data),item.classList.contains("active")&&addClasses(item_new,"active"),replaceNode(item,item_new)),this.lastQuery=null}}}},{key:"removeOption",value:function(value,silent){value=get_hash(value),this.uncacheValue(value),delete this.userOptions[value],delete this.options[value],this.lastQuery=null,this.trigger("option_remove",value),this.removeItem(value,silent)}},{key:"clearOptions",value:function(filter){var boundFilter=(filter||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();var selected={};iterate$1(this.options,function(option,key){boundFilter(option,key)&&(selected[key]=option)}),this.options=this.sifter.items=selected,this.lastQuery=null,this.trigger("option_clear")}},{key:"clearFilter",value:function(option,value){return this.items.indexOf(value)>=0}},{key:"getOption",value:function(value){var create=arguments.length>1&&void 0!==arguments[1]&&arguments[1],hashed=hash_key(value);if(null===hashed)return null;var option=this.options[hashed];if(void 0!=option){if(option.$div)return option.$div;if(create)return this._render("option",option)}return null}},{key:"getAdjacent",value:function(option,direction){var all,type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"option";if(!option)return null;all="item"==type?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(var i=0;i<all.length;i++)if(all[i]==option){if(direction>0)return all[i+1];return all[i-1]}return null}},{key:"getItem",value:function(item){if("object"==typeof item)return item;var value=hash_key(item);return null!==value?this.control.querySelector('[data-value="'.concat(addSlashes(value),'"]')):null}},{key:"addItems",value:function(values,silent){var self1=this,items=Array.isArray(values)?values:[values],last_item=(items=items.filter(function(x){return -1===self1.items.indexOf(x)}))[items.length-1];items.forEach(function(item){self1.isPending=item!==last_item,self1.addItem(item,silent)})}},{key:"addItem",value:function(value,silent){var _this=this;debounce_events(this,silent?[]:["change","dropdown_close"],function(){var item,wasFull,inputMode=_this.settings.mode,hashed=hash_key(value);if((!hashed||-1===_this.items.indexOf(hashed)||("single"===inputMode&&_this.close(),"single"!==inputMode&&_this.settings.duplicates))&&null!==hashed&&_this.options.hasOwnProperty(hashed)&&("single"===inputMode&&_this.clear(silent),!("multi"===inputMode&&_this.isFull()))){if(item=_this._render("item",_this.options[hashed]),_this.control.contains(item)&&(item=item.cloneNode(!0)),wasFull=_this.isFull(),_this.items.splice(_this.caretPos,0,hashed),_this.insertAtCaret(item),_this.isSetup){if(!_this.isPending&&_this.settings.hideSelected){var option=_this.getOption(hashed),next=_this.getAdjacent(option,1);next&&_this.setActiveOption(next)}_this.isPending||_this.settings.closeAfterSelect||_this.refreshOptions(_this.isFocused&&"single"!==inputMode),!1!=_this.settings.closeAfterSelect&&_this.isFull()?_this.close():_this.isPending||_this.positionDropdown(),_this.trigger("item_add",hashed,item),_this.isPending||_this.updateOriginalInput({silent:silent})}(!_this.isPending||!wasFull&&_this.isFull())&&(_this.inputState(),_this.refreshState())}})}},{key:"removeItem",value:function(){var i,idx,item=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,silent=arguments.length>1?arguments[1]:void 0;if(item=this.getItem(item)){var value=item.dataset.value;i=nodeIndex(item),item.remove(),item.classList.contains("active")&&(idx=this.activeItems.indexOf(item),this.activeItems.splice(idx,1),removeClasses(item,"active")),this.items.splice(i,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(value)&&this.removeOption(value,silent),i<this.caretPos&&this.setCaret(this.caretPos-1),this.updateOriginalInput({silent:silent}),this.refreshState(),this.positionDropdown(),this.trigger("item_remove",value,item)}}},{key:"createItem",value:function(){var output,_obj,input=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,callback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};3==arguments.length&&(callback=arguments[2]),"function"!=typeof callback&&(callback=function(){});var self1=this,caret=self1.caretPos;if(input=input||self1.inputValue(),!self1.canCreate(input))return callback(),!1;self1.lock();var created=!1,create=function(data){if(self1.unlock(),!data||"object"!=typeof data)return callback();var value=hash_key(data[self1.settings.valueField]);if("string"!=typeof value)return callback();self1.setTextboxValue(),self1.addOption(data,!0),self1.setCaret(caret),self1.addItem(value),callback(data),created=!0};return"function"==typeof self1.settings.create?output=self1.settings.create.call(this,input,create):(_define_property(_obj={},self1.settings.labelField,input),_define_property(_obj,self1.settings.valueField,input),output=_obj),created||create(output),!0}},{key:"refreshItems",value:function(){this.lastQuery=null,this.isSetup&&this.addItems(this.items),this.updateOriginalInput(),this.refreshState()}},{key:"refreshState",value:function(){this.refreshValidityState();var isFull=this.isFull(),isLocked=this.isLocked;this.wrapper.classList.toggle("rtl",this.rtl);var wrap_classList=this.wrapper.classList;wrap_classList.toggle("focus",this.isFocused),wrap_classList.toggle("disabled",this.isDisabled),wrap_classList.toggle("required",this.isRequired),wrap_classList.toggle("invalid",!this.isValid),wrap_classList.toggle("locked",isLocked),wrap_classList.toggle("full",isFull),wrap_classList.toggle("input-active",this.isFocused&&!this.isInputHidden),wrap_classList.toggle("dropdown-active",this.isOpen),wrap_classList.toggle("has-options",0===Object.keys(this.options).length),wrap_classList.toggle("has-items",this.items.length>0)}},{key:"refreshValidityState",value:function(){this.input.validity&&(this.isValid=this.input.validity.valid,this.isInvalid=!this.isValid)}},{key:"isFull",value:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}},{key:"updateOriginalInput",value:function(){var option,label,opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},self1=this,empty_option=self1.input.querySelector('option[value=""]');if(self1.is_select_tag){var AddSelected=function(option_el,value,label){return option_el||(option_el=getDom('<option value="'+escape_html(value)+'">'+escape_html(label)+"</option>")),option_el!=empty_option&&self1.input.append(option_el),selected.push(option_el),(option_el!=empty_option||has_selected>0)&&(option_el.selected=!0),option_el},selected=[],has_selected=self1.input.querySelectorAll("option:checked").length;self1.input.querySelectorAll("option:checked").forEach(function(option_el){option_el.selected=!1}),0==self1.items.length&&"single"==self1.settings.mode?AddSelected(empty_option,"",""):self1.items.forEach(function(value){label=(option=self1.options[value])[self1.settings.labelField]||"",selected.includes(option.$option)?AddSelected(self1.input.querySelector('option[value="'.concat(addSlashes(value),'"]:not(:checked)')),value,label):option.$option=AddSelected(option.$option,value,label)})}else self1.input.value=self1.getValue();self1.isSetup&&!opts.silent&&self1.trigger("change",self1.getValue())}},{key:"open",value:function(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.isOpen=!0,setAttr(this.focus_node,{"aria-expanded":"true"}),this.refreshState(),applyCSS(this.dropdown,{visibility:"hidden",display:"block"}),this.positionDropdown(),applyCSS(this.dropdown,{visibility:"visible",display:"block"}),this.focus(),this.trigger("dropdown_open",this.dropdown))}},{key:"close",value:function(){var setTextboxValue=!(arguments.length>0)||void 0===arguments[0]||arguments[0],trigger=this.isOpen;setTextboxValue&&(this.setTextboxValue(),"single"===this.settings.mode&&this.items.length&&this.hideInput()),this.isOpen=!1,setAttr(this.focus_node,{"aria-expanded":"false"}),applyCSS(this.dropdown,{display:"none"}),this.settings.hideSelected&&this.clearActiveOption(),this.refreshState(),trigger&&this.trigger("dropdown_close",this.dropdown)}},{key:"positionDropdown",value:function(){if("body"===this.settings.dropdownParent){var context=this.control,rect=context.getBoundingClientRect(),top=context.offsetHeight+rect.top+window.scrollY,left=rect.left+window.scrollX;applyCSS(this.dropdown,{width:rect.width+"px",top:top+"px",left:left+"px"})}}},{key:"clear",value:function(silent){var self1=this;self1.items.length&&(iterate$1(self1.controlChildren(),function(item){self1.removeItem(item,!0)}),self1.showInput(),silent||self1.updateOriginalInput(),self1.trigger("clear"))}},{key:"insertAtCaret",value:function(el){var caret=this.caretPos,target=this.control;target.insertBefore(el,target.children[caret]||null),this.setCaret(caret+1)}},{key:"deleteSelection",value:function(e){direction=e&&8===e.keyCode?-1:1,selection={start:(input=this.control_input).selectionStart||0,length:(input.selectionEnd||0)-(input.selectionStart||0)};var rm_items=[];if(this.activeItems.length)caret=nodeIndex(getTail(this.activeItems,direction)),direction>0&&caret++,iterate$1(this.activeItems,function(item){return rm_items.push(item)});else if((this.isFocused||"single"===this.settings.mode)&&this.items.length){var input,direction,selection,caret,rm_item,items=this.controlChildren();direction<0&&0===selection.start&&0===selection.length?rm_item=items[this.caretPos-1]:direction>0&&selection.start===this.inputValue().length&&(rm_item=items[this.caretPos]),void 0!==rm_item&&rm_items.push(rm_item)}if(!this.shouldDelete(rm_items,e))return!1;for(preventDefault(e,!0),void 0!==caret&&this.setCaret(caret);rm_items.length;)this.removeItem(rm_items.pop());return this.showInput(),this.positionDropdown(),this.refreshOptions(!1),!0}},{key:"shouldDelete",value:function(items,evt){var values=items.map(function(item){return item.dataset.value});return!!values.length&&("function"!=typeof this.settings.onDelete||!1!==this.settings.onDelete(values,evt))}},{key:"advanceSelection",value:function(direction,e){var last_active,adjacent;this.rtl&&(direction*=-1),!this.inputValue().length&&(isKeyDown(KEY_SHORTCUT,e)||isKeyDown("shiftKey",e)?(adjacent=(last_active=this.getLastActive(direction))?last_active.classList.contains("active")?this.getAdjacent(last_active,direction,"item"):last_active:direction>0?this.control_input.nextElementSibling:this.control_input.previousElementSibling)&&(adjacent.classList.contains("active")&&this.removeActiveItem(last_active),this.setActiveItemClass(adjacent)):this.moveCaret(direction))}},{key:"moveCaret",value:function(direction){}},{key:"getLastActive",value:function(direction){var last_active=this.control.querySelector(".last-active");if(last_active)return last_active;var result=this.control.querySelectorAll(".active");if(result)return getTail(result,direction)}},{key:"setCaret",value:function(new_pos){this.caretPos=this.items.length}},{key:"controlChildren",value:function(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}},{key:"lock",value:function(){this.isLocked=!0,this.refreshState()}},{key:"unlock",value:function(){this.isLocked=!1,this.refreshState()}},{key:"disable",value:function(){this.input.disabled=!0,this.control_input.disabled=!0,this.focus_node.tabIndex=-1,this.isDisabled=!0,this.close(),this.lock()}},{key:"enable",value:function(){this.input.disabled=!1,this.control_input.disabled=!1,this.focus_node.tabIndex=this.tabIndex,this.isDisabled=!1,this.unlock()}},{key:"destroy",value:function(){var revertSettings=this.revertSettings;this.trigger("destroy"),this.off(),this.wrapper.remove(),this.dropdown.remove(),this.input.innerHTML=revertSettings.innerHTML,this.input.tabIndex=revertSettings.tabIndex,removeClasses(this.input,"tomselected","ts-hidden-accessible"),this._destroy(),delete this.input.tomselect}},{key:"render",value:function(templateName,data){var id,html;if("function"!=typeof this.settings.render[templateName]||!(html=this.settings.render[templateName].call(this,data,escape_html)))return null;if(html=getDom(html),"option"===templateName||"option_create"===templateName?data[this.settings.disabledField]?setAttr(html,{"aria-disabled":"true"}):setAttr(html,{"data-selectable":""}):"optgroup"===templateName&&(id=data.group[this.settings.optgroupValueField],setAttr(html,{"data-group":id}),data.group[this.settings.disabledField]&&setAttr(html,{"data-disabled":""})),"option"===templateName||"item"===templateName){var value=get_hash(data[this.settings.valueField]);setAttr(html,{"data-value":value}),"item"===templateName?(addClasses(html,this.settings.itemClass),setAttr(html,{"data-ts-item":""})):(addClasses(html,this.settings.optionClass),setAttr(html,{role:"option",id:data.$id}),data.$div=html,this.options[value]=data)}return html}},{key:"_render",value:function(templateName,data){var html=this.render(templateName,data);if(null==html)throw"HTMLElement expected";return html}},{key:"clearCache",value:function(){iterate$1(this.options,function(option){option.$div&&(option.$div.remove(),delete option.$div)})}},{key:"uncacheValue",value:function(value){var option_el=this.getOption(value);option_el&&option_el.remove()}},{key:"canCreate",value:function(input){return this.settings.create&&input.length>0&&this.settings.createFilter.call(this,input)}},{key:"hook",value:function(when,method,new_fn){var self1=this,orig_method=self1[method];self1[method]=function(){var result,result_new;return("after"===when&&(result=orig_method.apply(self1,arguments)),result_new=new_fn.apply(self1,arguments),"instead"===when)?result_new:("before"===when&&(result=orig_method.apply(self1,arguments)),result)}}}]),TomSelect1}((MicroEvent.plugins={},function(Interface1){_inherits(_class,Interface1);var _super=_create_super(_class);function _class(){for(var _this,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _class_call_check(this,_class),(_this=_super.call.apply(_super,[this].concat(function(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}(args)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(args)||_unsupported_iterable_to_array(args)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))).plugins={names:[],settings:{},requested:{},loaded:{}},_this}return _create_class(_class,[{key:"initializePlugins",value:function(plugins){var key,name,self1=this,queue=[];if(Array.isArray(plugins))plugins.forEach(function(plugin){"string"==typeof plugin?queue.push(plugin):(self1.plugins.settings[plugin.name]=plugin.options,queue.push(plugin.name))});else if(plugins)for(key in plugins)plugins.hasOwnProperty(key)&&(self1.plugins.settings[key]=plugins[key],queue.push(key));for(;name=queue.shift();)self1.require(name)}},{key:"loadPlugin",value:function(name){var plugins=this.plugins,plugin=MicroEvent.plugins[name];if(!MicroEvent.plugins.hasOwnProperty(name))throw Error('Unable to find "'+name+'" plugin');plugins.requested[name]=!0,plugins.loaded[name]=plugin.fn.apply(this,[this.plugins.settings[name]||{}]),plugins.names.push(name)}},{key:"require",value:function(name){var plugins=this.plugins;if(!this.plugins.loaded.hasOwnProperty(name)){if(plugins.requested[name])throw Error('Plugin has circular dependency ("'+name+'")');this.loadPlugin(name)}return plugins.loaded[name]}}],[{key:"define",value:function(name,fn){MicroEvent.plugins[name]={name:name,fn:fn}}}]),_class}(MicroEvent)));return TomSelect1.define("dropdown_input",function(){var self1=this;self1.settings.shouldOpen=!0,self1.hook("before","setup",function(){self1.focus_node=self1.control,addClasses(self1.control_input,"dropdown-input");var div=getDom('<div class="dropdown-input-wrap">');div.append(self1.control_input),self1.dropdown.insertBefore(div,self1.dropdown.firstChild);var placeholder=getDom('<input class="items-placeholder" tabindex="-1" />');placeholder.placeholder=self1.settings.placeholder||"",self1.control.append(placeholder)}),self1.on("initialize",function(){self1.control_input.addEventListener("keydown",function(evt){switch(evt.keyCode){case 27:self1.isOpen&&(preventDefault(evt,!0),self1.close()),self1.clearActiveItems();return;case 9:self1.focus_node.tabIndex=-1}return self1.onKeyDown.call(self1,evt)}),self1.on("blur",function(){self1.focus_node.tabIndex=self1.isDisabled?-1:self1.tabIndex}),self1.on("dropdown_open",function(){self1.control_input.focus()});var orig_onBlur=self1.onBlur;self1.hook("instead","onBlur",function(evt){if(!evt||evt.relatedTarget!=self1.control_input)return orig_onBlur.call(self1)}),addEvent(self1.control_input,"blur",function(){return self1.onBlur()}),self1.hook("before","close",function(){self1.isOpen&&self1.focus_node.focus({preventScroll:!0})})})}),TomSelect1},"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).TomSelect=factory();