"use strict";var CBChangeMailSender=window.CBChangeMailSender||{};CBChangeMailSender.Admin=CBChangeMailSender.Admin||{},CBChangeMailSender.Admin.SMTP=CBChangeMailSender.Admin.SMTP||function(s,i){var l={},_={init:function(){i(_.ready)},ready:function(){_.initVars(),_.bindActions()},initVars:function(){l={$stepInstall:i("section.step-install"),$stepInstallNum:i("section.step-install .num img"),$stepSetup:i("section.step-setup"),$stepSetupNum:i("section.step-setup .num img")}},bindActions:function(){l.$stepInstall.on("click","button",_.stepInstallClick),l.$stepSetup.on("click","button",_.gotoURL)},stepInstallClick:function(){var e=i(this),a=e.attr("data-action"),t=e.attr("data-plugin"),n="";if(!e.hasClass("disabled")){switch(a){case"activate":n="cb_change_mail_sender_activate_smtp",e.text(cb_change_mail_sender_admin_smtp.activating);break;case"install":n="cb_change_mail_sender_install_smtp",e.text(cb_change_mail_sender_admin_smtp.installing);break;case"goto-url":return void(s.location.href=e.attr("data-url"));default:return}e.addClass("disabled"),_.showSpinner(l.$stepInstallNum);t={action:n,nonce:cb_change_mail_sender_admin_smtp.nonce,plugin:t};i.post(cb_change_mail_sender_admin_smtp.ajaxurl,t).done(function(t){_.stepInstallDone(t,e,a)}).always(function(){_.hideSpinner(l.$stepInstallNum)})}},showSpinner:function(t){t.siblings(".loader").removeClass("hidden")},stepInstallDone:function(t,e,a){var n;("install"===a?t.success&&t.data.is_activated:t.success)?(l.$stepInstallNum.attr("src",l.$stepInstallNum.attr("src").replace("step-1.","step-complete.")),e.addClass("grey").removeClass("button-primary").text(cb_change_mail_sender_admin_smtp.activated),_.stepInstallPluginStatus()):(a=(t="install"===a&&t.success&&!t.data.is_activated||"activate"===a)?cb_change_mail_sender_admin_smtp.manual_activate_url:cb_change_mail_sender_admin_smtp.manual_install_url,n=t?cb_change_mail_sender_admin_smtp.error_could_not_activate:cb_change_mail_sender_admin_smtp.error_could_not_install,t=t?cb_change_mail_sender_admin_smtp.plugins_page:cb_change_mail_sender_admin_smtp.download_now,e.removeClass("grey disabled").text(t).attr("data-action","goto-url").attr("data-url",a),e.after('<p class="error">'+n+"</p>"))},stepInstallPluginStatus:function(){i.post(cb_change_mail_sender_admin_smtp.ajaxurl,{action:"cb_change_mail_sender_smtp_page_check_plugin_status",nonce:cb_change_mail_sender_admin_smtp.nonce}).done(_.stepInstallPluginStatusDone)},stepInstallPluginStatusDone:function(t){t.success&&(l.$stepSetup.removeClass("grey"),l.$stepSetupBtn=l.$stepSetup.find("button"),l.$stepSetupBtn.removeClass("grey disabled").addClass("button-primary"),0<t.data.setup_status?(l.$stepSetupNum.attr("src",l.$stepSetupNum.attr("src").replace("step-2.svg","step-complete.svg")),l.$stepSetupBtn.attr("data-url",cb_change_mail_sender_admin_smtp.smtp_settings_url).text(cb_change_mail_sender_admin_smtp.smtp_settings)):l.$stepSetupBtn.attr("data-url",cb_change_mail_sender_admin_smtp.smtp_wizard_url).text(cb_change_mail_sender_admin_smtp.smtp_wizard))},hideSpinner:function(t){t.siblings(".loader").addClass("hidden")},gotoURL:function(){var t=i(this);t.hasClass("disabled")||(s.location.href=t.attr("data-url"))}};return _}((document,window),jQuery),CBChangeMailSender.Admin.SMTP.init();