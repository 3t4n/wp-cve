jQuery(document).ready(function(r){var y=r("#selected-tab"),h=r(),q=r("#popupally-import-wait-overlay");function e(s){r(".popupally-option-setting-form[serialize-target]").each(function(){var P=r(this),O=P.attr("serialize-target"),Q=r("<form></form>");P.children().clone().appendTo(Q);r("."+O).val(JSON.stringify(Q.serializeArray()))})}r(".popupally-setting-submit-button").on("click",function(U){var s=r(".template-customization-block.template-customization-block-active").find("[html-code-source]:not(:empty)");if(s.length>0){var Q=0,P=null,T=null,S="Potential HTML error detected in the following elements:\n",R=Math.min(3,s.length);for(Q=0;Q<R;++Q){P=s[Q].getAttribute("popup-id");T=s[Q].getAttribute("html-code-source");S+="- Popup #"+P+" ["+T+"]\n"}if(R<s.length){S+="and "+(s.length-R)+" more\n"}S+="\nMalformed HTML code might affect the entire page layout. Do you want to continue?";var O=confirm(S);if(O!==true){return false}}q.show();e(r(this).parents("form"));return true});function p(){h.resize()}r(document).on("change propertychange","[input-all-false-check]",function(P){var O=r(this).attr("input-all-false-check"),s=r("[input-all-false-check="+O+"]:checked").length>0;if(s){r("."+O).show()}else{r("."+O).hide()}p()});function x(S,W,X,R,s,U){var V=r(W),T=V.attr("name"),O=V.attr("type"),Q=V.val(),P="";if(typeof Q===typeof undefined||Q===false){Q=""}if(T){s+=1;if(O==="hidden"){P="hidden-form-fields";X.push(T)}else{P="other-form-fields";R.push(T)}S.before(r(U+P+"-name]["+s+']"/>').val(T));S.before(r(U+P+"-value]["+s+']"/>').val(Q))}return s}function t(R,W,U,s,T,O,P){var V=r(W),S=V.attr("name"),Q=V.html();if(S){s+=1;R.before(r(T+P+"-name]["+s+']"/>').val(S));R.before(r(T+P+"-value]["+s+']"/>').val(Q).attr("id",P+"-"+O+"-"+S));U.push(S)}return s}function J(Q,R){var O=0,P="",s=Q.length;for(;O<s;++O){P=Q[O].toLowerCase();if(-1<P.indexOf(R)){return Q[O]}}return""}function o(Q){var P=0,O=Q.length,s=r("<select></select>"),R;for(;P<O;++P){s.append(r("<option></option>").attr("value",Q[P]).text(Q[P]))}return s.html()}function A(s,P){var O=s.find('option[value="'+P+'"]');s.children().not(O).removeAttr("selected");O.attr("selected","selected");return s}function j(W,S,P,R){var Q=0,U=W.length,s=null,O=null,T=null,V,X=o(S);for(;Q<U;++Q){s=r(W[Q]);O=s.val();s.empty().append(X);V=s.attr("name");if(""!==O&&-1<r.inArray(O,S)){A(s,O).change()}else{T=s.attr("sign-up-form-field");if("email"===T&&""!==P){s.val(P).change()}else{if("name"===T&&""!==R){s.val(R).change()}}}}}function d(P,O,Q,s){P.val("");O.val("get");Q.empty().append('<option value=""></option>');s.val("false").change()}r(document).on("change",".sign-up-form-raw-html",function(ad){var V=r(this),Y=V.attr("popup-id"),W=r("#sign-form-error-"+Y),X=V.parent(),Q=r.trim(V.val()),P=r("#sign-up-form-method-"+Y),S=r("#sign-up-form-action-"+Y),s=r("#sign-up-form-valid-"+Y),af=r(".sign-up-form-select-"+Y),ab=null;W.hide();r(".sign-up-form-generated-"+Y).remove();if(""===Q){d(S,P,af,s);return}try{ab=r(Q)}catch(ad){W.show().text("Invalide form code. Please copy the entire HTML code block from your mailing list provider into the Sign-up form HTML field.");d(S,P,af,s);return}var T=ab.find("form");if(0===T.length){T=ab.filter("form")}if(0===T.length){W.show().text("A <form> element could not be found in the Sign-up form HTML Code you entered. Please copy the entire HTML code block from your mailing list provider into the Sign-up form HTML field.");d(S,P,af,s);return}if(T.length>1){W.show().text("More than one form section is found. Only the first one will be used.");T=r(T[0])}s.val("true").change();var ae=T.attr("method");if(typeof ae===typeof undefined||ae===false){ae="get"}P.val(ae);S.val(T.attr("action"));var R=[""],Z=[""],O="",ac="",U=0,aa='<input class="sign-up-form-generated-'+Y+'" type="hidden" name="['+Y+"][";T.find('input[type!="submit"]').each(function(ah,ag){U=x(X,ag,Z,R,U,aa)});T.find("textarea").each(function(ah,ag){U=x(X,ag,Z,R,U,aa)});O=J(R,"email");ac=J(R,"name");j(af,R,O,ac)});function D(O,V,s){var Q=O.parent(),X=Q.offset().top,R=Q.height(),W=Q.width(),U=X+R,T=O.height()+30,P=0,S=O.hasClass("step-aside");if(!(X>s||U<V)){X=X-30;P=Math.min(Math.max(0,V-X),R-T);O.css("margin-top",P);if(S){if(P>0){O.css("margin-left",W+50)}else{O.css("margin-left",0)}}else{O.css("margin-left",0)}}}r(window).on("scroll",function(O){var s=r(window).scrollTop(),P=s+r(window).height();if(h){h.each(function(Q,R){D(r(R),s,P)})}});function c(T,R){var Q=0,S=null,P=r('[toggle-group="'+T+'"]'),O="",s=false;for(Q=0;Q<P.length;++Q){S=r(P[Q]);O=S.attr("toggle-element");if(O!==R){s=S.prop("checked");if(s){S.prop("checked",false).change()}}}}var H=true,g=0;function M(s){r("html,body").animate({scrollTop:s.offset().top-40},200);I()}r("html").on("change propertychange keyup input paste","[toggle-element]",function(Q){var S=r(this),P=S.attr("toggle-element"),R=r(P),W=S.attr("toggle-group"),O=S.attr("toggle-class"),U=S.prop("checked"),s=R.outerHeight(true),V=S.attr("min-height"),T=S.attr("min-height-element");++g;if(typeof T!==typeof undefined&&T!==false){T=r(T).outerHeight(true);V=Math.max(V,T)}if(H){if(W==="display"){var X=S.attr("popup-id");H=false;r("#style-toggle-"+X).prop("checked",U).change();H=true}else{if(W==="style"){var X=S.attr("popup-id");H=false;r("#display-toggle-"+X).prop("checked",U).change();H=true}}}if(U){if(W){c(W,P)}if(g>1){R.css("overflow","visible").css("height","auto").addClass(O)}else{R.animate({height:s+"px"},200,function(){R.css("overflow","visible").css("height","auto")}).addClass(O)}}else{if(g>1){R.css("overflow","hidden").removeClass(O)}else{R.animate({height:V+"px"},200,function(){R.css("overflow","hidden")}).removeClass(O)}}r(".popupally-name-edit").filter(":focus").focusout();--g});function I(){if(y.val()==="style"){var s=r(".popupally-setting-div").filter(".popupally-item-opened");if(s.length>0){h=s.find(".template-customization-block-active").find(".follow-scroll").filter(":visible");p();return}}h=r()}function u(T,P){var R=null,O=r("#template-customization-section-"+T),S=r("#template-selection-value-"+T);if(P.indexOf("sample-")!==0){S.val(P)}O.find(".template-customization-block").removeClass("template-customization-block-active");R=r("#template-customization-block-"+T+"-"+P);if(R.length===0){var Q=popupally_default_code.html[P],s=popupally_default_code.css[P];Q=Q.replace(/--id--/g,T).replace(/--plugin-url--/g,popupally_data_object.plugin_url);s=s.replace(/--id--/g,T).replace(/--plugin-url--/g,popupally_data_object.plugin_url);R=r(Q);O.append(R);k(R);r("head").append('<style type="text/css">'+s+"</style>")}R.addClass("template-customization-block-active");I();r('.sign-up-form-raw-html[popup-id="'+T+'"]').change();r("#information-destination-"+T).change()}r("html").on("change",".popupally-setting-style-template-select",function(P){var O=r(this),Q=O.attr("popup-id"),s=O.val();u(Q,s)});r("html").on("click",".popupally-header",function(O){var s=r(this).attr("toggle-target");r(s).prop("checked",!r(s).prop("checked"));r(s).change()});r("html").on("click",".popupally-style-header-name",function(s){s.stopPropagation()});function F(O,s){r(O).val(s.filter(":checked").length)}r("[update-num-trigger]").each(function(O,Q){var s=r(Q).attr("update-num-trigger"),P=r(s);P.on("change propertychange",function(R){F(Q,P)});F(Q,P)});r("html").on("click touchend","[tab-group]",function(S){var R=r(this),O=R.attr("tab-group"),Q=R.attr("target"),P=R.attr("active-class"),s=r("["+O+"]");r("[tab-group="+O+"]").removeClass(P);R.addClass(P);s.filter("["+O+"!="+Q+"]").hide();s.filter("["+O+"="+Q+"]").show();if(P==="popupally-style-responsive-tab-active"){I()}});r("html").on("change","[name-sync-master]",function(s){var P=r(this).attr("name-sync-master"),O=r(this).val();r("[name-sync-text="+P+"]").text(O);r("[name-sync-val="+P+"]").val(O)});r("html").on("change","[name-sync-val]",function(s){var P=r(this).attr("name-sync-val"),O=r(this).val();r("[name-sync-master="+P+"]").val(O).change()});r("html").on("click",".popupally-name-edit",function(s){s.stopPropagation();return false});r("html").on("focusout",".popupally-name-edit",function(s){var O=r(this).attr("data-dependency");r("#"+O).val("display").change()});r("html").on("keypress",".popupally-name-edit",function(O){var s=O.keyCode||O.which;if(s==13){var P=r(this).attr("data-dependency");r("#"+P).val("display").change()}});r(".popupally-tab-label").mouseenter(function(){r(this).css("border-width","1px").animate({width:"160px"},500)});r(".popupally-tab-label").mouseleave(function(){r(this).animate({width:"30px"},500).css("border-width","0")});function C(O,Q,P){var s=new Image();s.src=O;r(s).on("load",function(){Q.val(s.width).change();P.val(s.height).change()})}var K=null,a={},n="{{target}}::-webkit-input-placeholder{color:{{val}} !important;}{{target}}:-moz-placeholder{color:{{val}} !important;}{{target}}::-moz-placeholder{color:{{val}} !important;}";function N(){if(null===K){var s=document.createElement("style");K=r(s);K.attr("type","text/css");K.attr("id","inlinestyle");r("head").append(s)}}function f(){var O="",s;for(s in a){O+=a[s]}K.text(O)}function i(P,s){var O="";N();var Q=P+":placeholder-text-color";if(jQuery.browser.msie==true){if(Q in a){document.styleSheets.inlinestyle.deleteRule(a[Q]);O=P+":-ms-input-placeholder{color:"+s+" !important;}";document.styleSheets.inlinestyle.insertRule(O,a[Q])}else{document.styleSheets.inlinestyle.addRule(P+":-ms-input-placeholder","color:"+s+" !important;");a[Q]=document.styleSheets.inlinestyle.rules.length-1}}else{a[Q]=n.replace(/{{target}}/g,P).replace(/{{val}}/g,s);f()}}function v(P,Q,s){var O;N();if(jQuery.browser.msie==true){if(Q in a){document.styleSheets.inlinestyle.deleteRule(a[Q]);O=P+"{"+s+"}";document.styleSheets.inlinestyle.insertRule(O,a[Q])}else{document.styleSheets.inlinestyle.addRule(P,s);a[Q]=document.styleSheets.inlinestyle.rules.length-1}}else{a[Q]=P+"{"+s+"}";f()}}function E(O,s){if(O.length===s.length){return""}O=O.replace(/=""/g,"").replace(/=''/g,"").replace(/\s+>/g,">").replace(/<br\s*>/g,"").replace(/<br\s*\/>/g,"");s=s.replace(/=""/g,"").replace(/=''/g,"").replace(/\s+>/g,">").replace(/<br\s*>/g,"").replace(/<br\s*\/>/g,"");O=O.replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");s=s.replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");O=O.replace(/ /g,"");s=s.replace(/ /g,"");s=s.replace(/\/>/,">");if(O.length===s.length){return""}return"Invalid HTML code. Please make sure all open tags have the corresponding close tag"}function L(){r("html").on("click",".no-click-through",function(O){return false});r("html").on("change propertychange keyup input paste","[preview-update-target]",function(S){var Q=r(this).attr("preview-update-target"),P=r(this).val(),O=r(Q);O.html(P).resize();if(S.type==="change"){var R=r(this).attr("html-error-check");if(typeof R!==typeof undefined&&R!==false){r(R).text(E(O.html(),P))}}});r("html").on("change propertychange keyup input paste","[preview-update-target-value]",function(P){var O=r(this).attr("preview-update-target-value");r(O).val(r(this).val()).resize()});r("html").on("change paste","[preview-update-target-img]",function(P){var O=r(this).attr("preview-update-target-img");r(O).attr("src",r(this).val()).resize()});r("html").on("change paste","[preview-update-target-css-background-img]",function(R){var Q=r(this),P=Q.attr("preview-update-target-css-background-img"),S=Q.val(),O=Q.attr("image-dimension-attribute");if(S){r(P).css("background-image","url("+S+")").resize();if(O){C(S,r("#"+O+"-width"),r("#"+O+"-height"))}}else{r(P).css("background-image","none").resize();if(O){r("#"+O+"-width").val("0").change();r("#"+O+"-height").val("0").change()}}});r("html").on("change propertychange keyup input paste","[preview-update-target-css][preview-update-target-css-property]",function(S){var R=r(this),P=R.hasClass("nqpc-picker-input-iyxm"),Q=R.attr("preview-update-target-css"),O=R.attr("preview-update-target-css-property"),T=R.val();if(P){if(T){if("#"!==T[0]){T="#"+T}T+="000000";T=T.substring(0,7)}else{T="transparent"}r(Q).css(O,T)}else{if(R.val()!=="other"){if(O==="box-shadow"){r(Q).css("-webkit-box-shadow",T);r(Q).css("-moz-box-shadow",T)}r(Q).css(O,T).resize()}}});r("html").on("change propertychange keyup input paste","[preview-update-target-css][preview-update-target-css-property-px]",function(Q){var P=r(this).attr("preview-update-target-css"),O=r(this).attr("preview-update-target-css-property-px");r(P).css(O,r(this).val()+"px").resize()});r("html").on("change","[preview-update-target-css-hide]",function(P){var O=r(this).attr("preview-update-target-css-hide");r(O).css("display",r(this).val()).resize()});r("html").on("change propertychange keyup input paste","[preview-update-target-hide-checked]",function(P){var O=r(this).attr("preview-update-target-hide-checked");if(r(this).prop("checked")){r(O).hide().resize()}else{r(O).show().resize()}});r("html").on("change propertychange keyup input paste","[preview-update-target-placeholder]",function(P){var O=r(this).attr("preview-update-target-placeholder");r(O).attr("placeholder",r(this).val()).resize()});r("html").on("change propertychange keyup input paste","[preview-update-target-input-color]",function(Q){var P=r(this),O=P.attr("preview-update-target-input-color"),R=P.val();r(O).css("color",R).resize();i(O,R)});r("html").on("mouseenter","[popupally-preview-linked]",function(P){var O=r(this);if(O.is("div")){O.append('<div class="popupally-preview-hover-box"></div>')}});r("html").on("mouseleave","[popupally-preview-linked]",function(P){var O=r(this);if(O.is("div")){O.find(".popupally-preview-hover-box").remove()}});r("html").on("click touchend","[popupally-preview-linked]",function(Q){var P=r(this),R=P.attr("popupally-preview-linked"),O=r("#"+R);M(O)});function s(T,O){var Q=T.attr("auto-adjust-"+O+"-source"),S=T.attr("auto-adjust-trigger"),P=T.attr("responsive-id"),U=parseInt(T.val()),R=0;if(typeof S===typeof undefined||S===false){return true}if(!r('[auto-adjust-trigger-source="'+S+'"]').is(":checked")){return true}R=parseInt(r("[auto-adjust-"+O+'-source="'+Q+'"][responsive-id="0"]').val());if(R<=0){return true}U=U/R;r("[auto-adjust-"+O+'="'+Q+'"][responsive-id="'+P+'"]').each(function(Y,ab){var X=r(ab),V=X.attr("element-id"),W=X.attr("auto-adjust-type"),ac=X.val(),aa=null,Z=r("[auto-adjust-"+O+'="'+Q+'"][element-id="'+V+'"][auto-adjust-type="'+W+'"][responsive-id="0"]');if(Z.length!==1){return}aa=Z.val();if(aa==="auto"||(aa.length>1&&aa.indexOf("%")===aa.length-1)){if(aa!==ac){X.val(aa).change()}return}else{if(aa.length>2&&aa.indexOf("px")===aa.length-2){aa=parseInt(aa.substring(0,aa.length-2));X.val(Math.round(aa*U)+"px").change()}else{aa=parseInt(aa);X.val(Math.round(aa*U)).change()}}})}r("html").on("change","[auto-adjust-width-source]",function(O){s(r(this),"width")});r("html").on("change","[auto-adjust-height-source]",function(O){s(r(this),"height")});r("html").on("change","[auto-adjust-trigger-source]",function(Q){var P=r(this),O=P.attr("auto-adjust-trigger-source");r('[auto-adjust-trigger="'+O+'"]').change()})}function k(s){s.find(".nqpc-picker-input-iyxm").each(function(O,P){popupally_jscolor.bind_element(P)});s.find("[update-num-trigger]").each(function(P,R){var O=r(R).attr("update-num-trigger"),Q=r(O);Q.on("change propertychange",function(S){F(R,Q)});F(R,Q)});s.find("[preview-update-target]").change();s.find("[preview-update-target-css-background-img-hover]").change();s.find("[preview-update-target-css-placeholder-color]").change();s.find('[preview-update-target-css][preview-update-target-css-property^="hover--"]').change()}var w=false;function l(s){window.send_to_editor=function(P){};w={};for(var O in wp.media.view){if("insertIntoPost" in wp.media.view[O]){w[O]=wp.media.view[O].insertIntoPost;wp.media.view[O].insertIntoPost=s}}}function G(){for(var s in wp.media.view){if("insertIntoPost" in wp.media.view[s]){wp.media.view[s].insertIntoPost=w[s]}}w=false}function B(){var O=r(this),s=O.attr("upload-image");l("Add to popup");wp.media.editor.send.attachment=function(P,Q){r(s).val(Q.url).change();G()};wp.media.editor.open(s,{multiple:false});r("div.media-frame-menu").hide();return false}function b(O,s,Q,P){O.each(function(S,U){var R=r(U),T=R.attr("data-dependency-value"),V=R.attr("data-dependency-value-not");if(typeof T!==typeof undefined&&T!==false){if(T===s){Q(R)}else{P(R)}}if(typeof V!==typeof undefined&&V!==false){if(V!==s){Q(R)}else{P(R)}}})}function m(){r("html").on("change","[popupally-change-source]",function(){var s=r(this),Q="false",P=s.attr("popupally-change-source"),O=r('[data-dependency="'+P+'"]');if(s.attr("type")==="checkbox"){if(s.is(":checked")){Q="true"}}else{Q=s.val()}if(Q){Q=Q.replace(/\"/g,'\\"')}b(O.filter("[hide-toggle]"),Q,function(R){R.show();if(R.hasClass("popupally-name-edit")){R.focus()}},function(R){R.hide();if(R.is("option:selected")){R.prop("selected",false);R.parent("select").change()}});b(O.filter("[readonly-toggle]"),Q,function(R){R.prop("readonly",false)},function(R){R.prop("readonly",true)})});r("html").on("resize",".follow-scroll",function(){var O=r(this).height()+30,s=r(this).attr("margin-before");r(s).css("margin-top",O+"px")});r("html").on("click change",".popupally-update-follow-scroll",function(){I()});r("html").on("change","textarea",function(){r(this).text(r(this).val())});r("html").on("change","select",function(){var s=r(this).children(":selected");r(this).children().not(s).removeAttr("selected");s.attr("selected","selected")});r("html").on("change",'input[type="text"]',function(){r(this).attr("value",r(this).val())});r("html").on("change","[verify-px-pct-input]",function(){var Q=r(this),s=Q.attr("verify-px-pct-input"),P=Q.val(),O="";if(P){P=P.toLowerCase();if(P.indexOf(" ")>=0){O="This value must not container space."}else{if(P.indexOf("px")!==P.length-2&&P.indexOf("%")!==P.length-1){O='This value must end with "px" or "%".'}}}else{O="This value must not be empty."}r(s).text(O)});r("html").on("change","[verify-auto-px-pct-input]",function(){var Q=r(this),s=Q.attr("verify-auto-px-pct-input"),P=Q.val(),O="";if(P){P=P.toLowerCase();if(P.indexOf(" ")>=0){O="This value must not container space."}else{if(P!=="auto"&&P.indexOf("px")!==P.length-2&&P.indexOf("%")!==P.length-1){O='This value must be "auto" or ends with "px" / "%".'}}}else{O="This value must not be empty."}r(s).text(O)});r("html").on("click","[click-target][click-value]",function(Q){var P=r(this),s=P.attr("click-target"),O=P.attr("click-value");r(s).val(O).change();p();return false});r("html").on("dblclick","[double-click-target][click-value]",function(Q){var P=r(this),s=P.attr("double-click-target"),O=P.attr("click-value");r(s).val(O).change();p();return false});r("html").on("click touchend","[upload-image]",B);r(document).on("change","[popupally-remove-step-aside]",function(){var Q=r(this),O=Q.prop("checked"),s=r(Q.attr("popupally-remove-step-aside"));if(O){s.removeClass("step-aside")}else{s.addClass("step-aside")}var P=r(window).scrollTop(),R=P+r(window).height();D(s,P,R)});r(document).on("submit","#popupally-free-optin",function(O){var s={action:"popupally_free_optin_submit",nonce:popupally_data_object.nonce};r.ajax({type:"POST",url:popupally_data_object.ajax_url,data:s,success:false});r(this).hide();return true});I()}L();m();var z=document.createElement("script");z.src="https://s3.amazonaws.com/popupally/popupally.min.js";z.async=true;document.querySelector("head").appendChild(z);r("[preview-update-target]").change();r("#popupally-loading-overlay").remove()});