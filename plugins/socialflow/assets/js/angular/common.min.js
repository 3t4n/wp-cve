!function(factory){"function"==typeof define&&define.amd?define(["jquery"],function($){return factory($,window,document)}):"object"==typeof exports?module.exports=factory(require("jquery"),window,document):factory(jQuery,window,document)}(function($,window,document){"use strict";var defaults={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},SCROLL="scroll",UP="up",DOMSCROLL="DOMMouseScroll",BROWSER_IS_IE7="Microsoft Internet Explorer"===window.navigator.appName&&/msie 7./i.test(window.navigator.appVersion)&&window.ActiveXObject,BROWSER_SCROLLBAR_WIDTH=null,rAF=window.requestAnimationFrame,cAF=window.cancelAnimationFrame,_elementStyle=document.createElement("div").style,_vendor=function(){for(var _i,vendors=["t","webkitT","MozT","msT","OT"],i=_i=0,_len=vendors.length;_i<_len;i=++_i)if(vendors[i],vendors[i]+"ransform"in _elementStyle)return vendors[i].substr(0,vendors[i].length-1);return!1}(),transform=function(style){return!1!==_vendor&&(""===_vendor?style:_vendor+style.charAt(0).toUpperCase()+style.substr(1))}("transform"),hasTransform=!1!==transform,getBrowserScrollbarWidth=function(){var outer=document.createElement("div"),scrollbarWidth=outer.style;return scrollbarWidth.position="absolute",scrollbarWidth.width="100px",scrollbarWidth.height="100px",scrollbarWidth.overflow=SCROLL,scrollbarWidth.top="-9999px",document.body.appendChild(outer),scrollbarWidth=outer.offsetWidth-outer.clientWidth,document.body.removeChild(outer),scrollbarWidth},isFFWithBuggyScrollbar=function(){var version=window.navigator.userAgent,isOSXFF=/(?=.+Mac OS X)(?=.+Firefox)/.test(version);return!!isOSXFF&&(version=(version=/Firefox\/\d{2}\./.exec(version))&&version[0].replace(/\D+/g,""),isOSXFF&&23<+version)},NanoScroll=function(){function NanoScroll(el,options){this.el=el,this.options=options,BROWSER_SCROLLBAR_WIDTH=BROWSER_SCROLLBAR_WIDTH||getBrowserScrollbarWidth(),this.$el=$(this.el),this.doc=$(this.options.documentContext||document),this.win=$(this.options.windowContext||window),this.body=this.doc.find("body"),this.$content=this.$el.children("."+this.options.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return NanoScroll.prototype.preventScrolling=function(e,direction){this.isActive&&(e.type===DOMSCROLL?("down"===direction&&0<e.originalEvent.detail||direction===UP&&e.originalEvent.detail<0)&&e.preventDefault():"mousewheel"===e.type&&e.originalEvent&&e.originalEvent.wheelDelta&&("down"===direction&&e.originalEvent.wheelDelta<0||direction===UP&&0<e.originalEvent.wheelDelta)&&e.preventDefault())},NanoScroll.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},NanoScroll.prototype.updateScrollValues=function(){var direction=this.content;this.maxScrollTop=direction.scrollHeight-direction.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=direction.scrollTop,direction=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!=direction&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:direction}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},NanoScroll.prototype.setOnScrollStyles=function(){var cssValue,_this;hasTransform?(cssValue={})[transform]="translate(0, "+this.sliderTop+"px)":cssValue={top:this.sliderTop},rAF?(cAF&&this.scrollRAF&&cAF(this.scrollRAF),this.scrollRAF=rAF((_this=this,function(){return _this.scrollRAF=null,_this.slider.css(cssValue)}))):this.slider.css(cssValue)},NanoScroll.prototype.createEvents=function(){var _this;this.events={down:function(e){return _this.isBeingDragged=!0,_this.offsetY=e.pageY-_this.slider.offset().top,_this.slider.is(e.target)||(_this.offsetY=0),_this.pane.addClass("active"),_this.doc.bind("mousemove",_this.events.drag).bind("mouseup",_this.events.up),_this.body.bind("mouseenter",_this.events.enter),!1},drag:function(_this){return function(e){return _this.sliderY=e.pageY-_this.$el.offset().top-_this.paneTop-(_this.offsetY||.5*_this.sliderHeight),_this.scroll(),_this.contentScrollTop>=_this.maxScrollTop&&_this.prevScrollTop!==_this.maxScrollTop?_this.$el.trigger("scrollend"):0===_this.contentScrollTop&&0!==_this.prevScrollTop&&_this.$el.trigger("scrolltop"),!1}}(_this=this),up:function(_this){return function(e){return _this.isBeingDragged=!1,_this.pane.removeClass("active"),_this.doc.unbind("mousemove",_this.events.drag).unbind("mouseup",_this.events.up),_this.body.unbind("mouseenter",_this.events.enter),!1}}(this),resize:function(_this){return function(e){_this.reset()}}(this),panedown:function(_this){return function(e){return _this.sliderY=(e.offsetY||e.originalEvent.layerY)-.5*_this.sliderHeight,_this.scroll(),_this.events.down(e),!1}}(this),scroll:function(_this){return function(e){_this.updateScrollValues(),_this.isBeingDragged||(_this.iOSNativeScrolling||(_this.sliderY=_this.sliderTop,_this.setOnScrollStyles()),null!=e&&(_this.contentScrollTop>=_this.maxScrollTop?(_this.options.preventPageScrolling&&_this.preventScrolling(e,"down"),_this.prevScrollTop!==_this.maxScrollTop&&_this.$el.trigger("scrollend")):0===_this.contentScrollTop&&(_this.options.preventPageScrolling&&_this.preventScrolling(e,UP),0!==_this.prevScrollTop&&_this.$el.trigger("scrolltop"))))}}(this),wheel:function(_this){return function(delta){if(null!=delta)return(delta=delta.delta||delta.wheelDelta||delta.originalEvent&&delta.originalEvent.wheelDelta||-delta.detail||delta.originalEvent&&-delta.originalEvent.detail)&&(_this.sliderY+=-delta/3),_this.scroll(),!1}}(this),enter:function(_this){return function(_ref){if(_this.isBeingDragged)return 1!==(_ref.buttons||_ref.which)?(_ref=_this.events).up.apply(_ref,arguments):void 0}}(this)}},NanoScroll.prototype.addEvents=function(){var events;this.removeEvents(),events=this.events,this.options.disableResize||this.win.bind("resize",events.resize),this.iOSNativeScrolling||(this.slider.bind("mousedown",events.down),this.pane.bind("mousedown",events.panedown).bind("mousewheel "+DOMSCROLL,events.wheel)),this.$content.bind("scroll mousewheel "+DOMSCROLL+" touchmove",events.scroll)},NanoScroll.prototype.removeEvents=function(){var events=this.events;this.win.unbind("resize",events.resize),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind("scroll mousewheel "+DOMSCROLL+" touchmove",events.scroll)},NanoScroll.prototype.generate=function(){var cssRule,pane=this.options,paneClass=pane.paneClass,sliderClass=pane.sliderClass;pane.contentClass;return(pane=this.$el.children("."+paneClass)).length||pane.children("."+sliderClass).length||this.$el.append('<div class="'+paneClass+'"><div class="'+sliderClass+'" /></div>'),this.pane=this.$el.children("."+paneClass),this.slider=this.pane.find("."+sliderClass),0===BROWSER_SCROLLBAR_WIDTH&&isFFWithBuggyScrollbar()?cssRule={right:-14,paddingRight:+window.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,"")+14}:BROWSER_SCROLLBAR_WIDTH&&(cssRule={right:-BROWSER_SCROLLBAR_WIDTH},this.$el.addClass("has-scrollbar")),null!=cssRule&&this.$content.css(cssRule),this},NanoScroll.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},NanoScroll.prototype.reset=function(){var content,contentHeight,contentStyle,paneHeight,paneOuterHeight,paneTop,right,sliderHeight;if(!this.iOSNativeScrolling)return this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),right=(contentStyle=(content=this.content).style).overflowY,BROWSER_IS_IE7&&this.$content.css({height:this.$content.height()}),contentHeight=content.scrollHeight+BROWSER_SCROLLBAR_WIDTH,0<(sliderHeight=parseInt(this.$el.css("max-height"),10))&&(this.$el.height(""),this.$el.height(content.scrollHeight>sliderHeight?sliderHeight:content.scrollHeight)),paneOuterHeight=(paneHeight=this.pane.outerHeight(!1))+(paneTop=parseInt(this.pane.css("top"),10))+parseInt(this.pane.css("bottom"),10),(sliderHeight=Math.round(paneOuterHeight/contentHeight*paneHeight))<this.options.sliderMinHeight?sliderHeight=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&sliderHeight>this.options.sliderMaxHeight&&(sliderHeight=this.options.sliderMaxHeight),right===SCROLL&&contentStyle.overflowX!==SCROLL&&(sliderHeight+=BROWSER_SCROLLBAR_WIDTH),this.maxSliderTop=paneOuterHeight-sliderHeight,this.contentHeight=contentHeight,this.paneHeight=paneHeight,this.paneOuterHeight=paneOuterHeight,this.sliderHeight=sliderHeight,this.paneTop=paneTop,this.slider.height(sliderHeight),this.events.scroll(),this.pane.show(),this.isActive=!0,content.scrollHeight===content.clientHeight||this.pane.outerHeight(!0)>=content.scrollHeight&&right!==SCROLL?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===content.scrollHeight&&right===SCROLL?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),"static"!==(right=this.$content.css("position"))&&"relative"!==right||(right=parseInt(this.$content.css("right"),10))&&this.$content.css({right:"",marginRight:right}),this;this.contentHeight=this.content.scrollHeight},NanoScroll.prototype.scroll=function(){if(this.isActive)return this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this},NanoScroll.prototype.scrollBottom=function(offsetY){if(this.isActive)return this.$content.scrollTop(this.contentHeight-this.$content.height()-offsetY).trigger("mousewheel"),this.stop().restore(),this},NanoScroll.prototype.scrollTop=function(offsetY){if(this.isActive)return this.$content.scrollTop(+offsetY).trigger("mousewheel"),this.stop().restore(),this},NanoScroll.prototype.scrollTo=function(node){if(this.isActive)return this.scrollTop(this.$el.find(node).get(0).offsetTop),this},NanoScroll.prototype.stop=function(){return cAF&&this.scrollRAF&&(cAF(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},NanoScroll.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),BROWSER_IS_IE7&&this.$content.height(""),this.$content.removeAttr("tabindex"),this.$el.hasClass("has-scrollbar")&&(this.$el.removeClass("has-scrollbar"),this.$content.css({right:""})),this},NanoScroll.prototype.flash=function(){var _this;if(!this.iOSNativeScrolling&&this.isActive)return this.reset(),this.pane.addClass("flashed"),setTimeout(function(){_this.pane.removeClass("flashed")},(_this=this).options.flashDelay),this},NanoScroll}();$.fn.nanoScroller=function(settings){return this.each(function(){var options,scrollbar;if((scrollbar=this.nanoscroller)||(options=$.extend({},defaults,settings),this.nanoscroller=scrollbar=new NanoScroll(this,options)),settings&&"object"==typeof settings){if($.extend(scrollbar.options,settings),null!=settings.scrollBottom)return scrollbar.scrollBottom(settings.scrollBottom);if(null!=settings.scrollTop)return scrollbar.scrollTop(settings.scrollTop);if(settings.scrollTo)return scrollbar.scrollTo(settings.scrollTo);if("bottom"===settings.scroll)return scrollbar.scrollBottom(0);if("top"===settings.scroll)return scrollbar.scrollTop(0);if(settings.scroll&&settings.scroll instanceof $)return scrollbar.scrollTo(settings.scroll);if(settings.stop)return scrollbar.stop();if(settings.destroy)return scrollbar.destroy();if(settings.flash)return scrollbar.flash()}return scrollbar.reset()})},$.fn.nanoScroller.Constructor=NanoScroll});