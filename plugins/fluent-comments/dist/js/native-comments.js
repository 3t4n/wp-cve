document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("flc_comment_form");if(e){var t={init:function(e){this.commentForm=e,this.textArea=e.querySelector(".flc_content_textarea"),this.initTextArea(),this.registerFormSubmit(),this.initChildForm()},toggleLoading:function(e){e.classList.toggle("flc_loading"),e.disabled=!e.disabled},maybeGetSecurityToken:function(){var e=this;if(console.log("maybeGetSecurityToken",window._fluent_comment_s_token),window._fluent_comment_s_token)return!1;setTimeout((function(){if(e.commentForm.classList.contains("flc_tokenizing"))return!1;e.commentForm.classList.add("flc_tokenizing");var t=e.commentForm.querySelector('input[name="comment_post_ID"]').value,n=new XMLHttpRequest;n.open("POST",window.fluentCommentPublic.ajaxurl,!0),n.responseType="json";var o=e;n.onload=function(){200===this.status?window._fluent_comment_s_token=this.response.token:window._fluent_comment_s_token=null,o.commentForm.classList.remove("flc_tokenizing")};var r=new FormData;r.append("action","fluent_comment_comment_token"),r.append("comment_post_ID",t),r.append("comment_time",Date.now()),n.send(r)}),2e3)},initTextArea:function(){var e=this;this.textArea&&(this.textArea.addEventListener("focus",(function(){e.maybeGetSecurityToken(),e.commentForm.querySelector(".flc_comment_meta").style.display="block"})),this.textArea.addEventListener("input",(function(){e.resizeTextArea()})))},resizeTextArea:function(){var e=this.textArea;e.style.height="76px",e.scrollHeight<300?e.style.height=e.scrollHeight+"px":e.style.height="300px"},closeForm:function(e){if(e.querySelector(".flc_content_textarea").value="",e.querySelector(".flc_content_textarea").style.height="76px",e.querySelector(".flc_comment_meta").style.display="hidden",document.getElementById("comment_parent").value=0,this.parent_comment_id){var t=document.createDocumentFragment();t.appendChild(document.getElementById("respond"));var n=document.getElementById("comments");n.parentNode.insertBefore(t,n)}},registerFormSubmit:function(){var e=this;document.getElementById("flc_comment_form").addEventListener("submit",(function(t){t.preventDefault();var n=t.target.querySelector(".flc_button");e.toggleLoading(n),t.target.querySelectorAll(".error.text-danger").forEach((function(e){e.remove()}));var o=t.target,r=new FormData(t.target);r.append("_fluent_comment_s_token",window._fluent_comment_s_token),r.append("comment_time",Date.now());var i=new XMLHttpRequest;i.open("POST",window.fluentCommentPublic.ajaxurl,!0),i.responseType="json";var m=e;i.onload=function(){if(200===this.status)m.appendComment(this.response.comment_preview),m.closeForm(o);else{var e=this.response.error;if((!e&&this.response.message||e&&403===this.response.data.status)&&(e=this.response.message),e){var t=document.createElement("div");t.classList.add("error","text-danger"),t.innerHTML=e,o.appendChild(t)}else for(var r in this.response){var i=document.getElementById("flt_"+r);if(i){var a=document.createElement("div");a.classList.add("error","text-danger"),a.innerHTML=Object.values(this.response[r])[0],i.parentNode.insertBefore(a,i.nextSibling),i.parentNode.parentNode.classList.add("is-error")}}}m.toggleLoading(n),console.log("OK"),window._fluent_comment_s_token=!1,m.maybeGetSecurityToken()},i.send(r)}))},appendComment:function(e,t){this.parent_comment_id?document.getElementById("comment-"+this.parent_comment_id).insertAdjacentHTML("beforeend",e):document.querySelector(".flc_comment-list").insertAdjacentHTML("afterbegin",e)},initChildForm:function(){var e=this;window.initChildComment=function(t){var n=t.dataset.comment_id;e.parent_comment_id=n,document.getElementById("comment_parent").value=n;var o=document.createDocumentFragment();o.appendChild(document.getElementById("respond")),document.getElementById("comment-"+n).appendChild(o),setTimeout((function(){e.textArea.focus()}),500)}}};t.init(e)}}));