jQuery(function(e){e("#restrictions_data .bulk_toggle_wrapper").css("visibility","hidden"),e.fn.csp_scripts=function(){e(this).sw_select2(),e(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var t=e("#restrictions_data"),i=t.find(".bulk_toggle_wrapper"),o=t.find(".wc-metaboxes"),n=o.find(".woocommerce_restrictions__boarding"),c=t.find(".toolbar"),s=o.find(".woocommerce_restriction").length;function r(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}""===wc_restrictions_admin_params.post_id?(t.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),e(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),e(".column-wc_actions a").on("mousedown",function(){e(this).triggerHandler("mouseleave")}),t.on("click",".wc-metabox > h3",function(){e(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),e(this).next(".wc-metabox-content").stop().slideToggle(300)}),t.sw_select2(),e(".wc-metabox",t).each(function(){var t=e(this),i=t.find(".wc-metabox-content");t.hasClass("closed")&&i.hide()})):t.sw_select2(),t.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var t=e(this),i=t.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),n=t.closest(".woocommerce_restriction"),c=n.data("restriction_id"),s=n.data("index");if(n[0].className.indexOf("woocommerce_restriction--added")>-1)return r(t,i),!1;t.addClass("woocommerce-input-toggle--loading");var a={action:"woocommerce_toggle_restriction",value:i.val(),post_id:wc_restrictions_admin_params.post_id,hash:o.attr("data-hash"),index:s,restriction_id:c,security:wc_restrictions_admin_params.toggle_restriction_nonce};return e.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:a,method:"POST",dataType:"json",complete:function(){t.removeClass("woocommerce-input-toggle--loading")},success:function(e){e.errors.length>0?window.alert(e.errors.join("\n\n")):(r(t,i),o.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(t){var i=e(this).closest(".wc-metabox");i.find("*").off(),i.remove(),m(),e("#restrictions_data .pro-validation").is(":visible")&&e("#restrictions_data .pro-validation").hide(),t.preventDefault()}),t.on("keyup","input.short_description",function(){e(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(e(this).val())}).on("click",".expand_all",function(){return o.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").show(),t.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return o.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").hide(),t.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries, select.csp_billing_countries",function(){var t,i,o=e(this),n=o.hasClass("csp_shipping_countries")?"shipping":"billing",c=(t=o.selectSW("data"),i=[],e.each(t,function(e,t){i.push({key:t.id,value:t.text})}),i),s=o.closest(".condition_content, .woocommerce_restriction_form"),r="shipping"===n?s.find("select.csp_shipping_states"):s.find("select.csp_billing_states"),a=r.find(":selected"),d=[],l="shipping"===n?wc_restrictions_admin_params.shipping_states_data:wc_restrictions_admin_params.billing_states_data,_=[];a.each(function(){d.push(e(this).val())}),e.each(c,function(t,i){var o=[],n=i.key,c=i.value,s=l[n]||!1;if(!s)return!0;e.each(s,function(t,i){var s=n+":"+t;o.push({id:s,text:c+" â€” "+i,selected:-1!==e.inArray(s,d)})}),_.push({text:c,children:o})}),r.children().remove(),r.selectSW({data:_})}).on("click",".wccsp_select_all",function(){var t=e(this).closest(".select-field");return t.find("select option").prop("selected","selected"),t.find("select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){var t=e(this).closest(".select-field");return t.find("select option").prop("selected",!1),t.find("select").trigger("change"),!1}).on("click","button.add_restriction",function(){var n=e("select.restriction_type",t).val(),c=o.find(".woocommerce_restriction_"+n),r=o.find(".woocommerce_restriction");if(""===n)return!1;t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var a={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:s,restriction_id:n,applied_count:c.length,count:r.length,security:wc_restrictions_admin_params.add_restriction_nonce};return s++,setTimeout(function(){e.post(wc_restrictions_admin_params.wc_ajax_url,a,function(n){if(n.errors.length>0)window.alert(n.errors.join("\n\n"));else if(s>=2&&e("#restrictions_data .wc-metabox")[0])e("#restrictions_data .inside").find(".pro-validation").slideDown(),e("#restrictions_data .options_group").find(".pro-validation").slideDown();else{e("#restrictions_data .sort-item").hide(),t.trigger("woocommerce_before_restriction_add",n),o.append(n.markup);var c=o.find(".woocommerce_restriction").last();c.csp_scripts(),c.data("conditions_count",0),i.removeClass("disabled")}t.unblock(),t.trigger("woocommerce_restriction_added",n)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){n.length&&(n.hide(),c.removeClass("restriction_data--empty"))}).on("change","input.show_excluded_in_checkout",function(){var t=e(this),i=t.is(":checked"),o=t.closest(".woocommerce_restriction_data").find(".show-excluded-checked");i?o.show():o.hide()});var a,d={},l={};function _(e,t){var i=!1;return"object"==typeof l[e]&&"function"==typeof l[e][t]?i=l[e][t]:(i=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===l[e]&&(l[e]={}),l[e][t]=i),i}function m(){var t=!1;o.find(".woocommerce_restriction").each(function(i,o){e(".position",o).val(i),e(".restriction_title_index",o).html(i+1),t=!0}),t?i.removeClass("disabled"):i.addClass("disabled")}o.find(".woocommerce_restriction").each(function(){var t=e(this).find(".restriction_conditions .condition_row").length;e(this).data("conditions_count",t)}),t.on("mousedown",".condition_remove .trash",function(){e(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(t){return t.preventDefault(),e(this).closest(".condition_row").remove(),!0}).on("change",".condition_modifier select",function(){var t=e(this),i=e(t).data("zero_config_mods");if(i){var o=t.val(),n=t.closest(".condition_row_inner").find(".condition_value"),c=n.filter(".condition--disabled"),s=n.not(".condition--disabled");i.indexOf(o)>-1?(c.show(),s.hide()):(c.hide(),s.show())}}).on("change",".condition_add select.condition_type",function(){var t=e(this),i=t.val();if("add_condition"===i)return!1;var o=t.closest(".woocommerce_restriction"),n=o.data("restriction_id"),c=parseInt(o.data("index")),s=parseInt(o.data("conditions_count")),r=function(e){var t=!1;"function"==typeof d[e]?t=d[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),d[e]=t);return t}(n),a=_(n,i);if(!r||!a)return!1;var l=r({condition_index:s,condition_content:a({restriction_index:c,condition_index:s})});o.data("conditions_count",s+1),o.find(".restriction_conditions_list").append(l);var m=o.find(".restriction_conditions_list .condition_row").last();return m.find('.condition_type option[value="'+i+'"]').prop("selected","selected"),m.csp_scripts(),t.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var t=e(this),i=t.val(),o=t.closest(".woocommerce_restriction"),n=o.data("restriction_id"),c=parseInt(o.data("index")),s=t.closest(".condition_row"),r=parseInt(s.data("condition_index")),a=_(n,i);if(!a)return!1;var d=a({restriction_index:c,condition_index:r});s.find(".condition_content").html(d).addClass("added");var l=s.find(".added");return l.csp_scripts(),l.removeClass("added"),!1}),(a=o.find(".woocommerce_restriction").get()).sort(function(t,i){var o=parseInt(e(t).attr("data-index")),n=parseInt(e(i).attr("data-index"));return o<n?-1:o>n?1:0}),e(a).each(function(e,t){o.append(t)}),m(),o.sortable({items:".woocommerce_restriction",disabled:!0,cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),m()}})});