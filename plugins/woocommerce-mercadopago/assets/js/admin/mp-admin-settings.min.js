function clearMessage(){document.querySelector(".mp-alert").remove()}function clearElement(e){document.getElementById(e).remove()}function mpMsgElement(e,t,s,n,a,o){const c=document.getElementById(e),i=document.createElement("div");i.className="mp-card-info",i.id=e.concat("-card-info");const d=document.createElement("div");d.className="mp-alert-color-".concat(o);const m=document.createElement("div");m.className="mp-card-body-payments mp-card-body-size";const l=document.createElement("div");l.className="mp-icon-badge-warning";const p=document.createElement("span");p.className="mp-text-title",p.appendChild(document.createTextNode(t));const r=document.createElement("span");r.className="mp-helper-test",r.appendChild(document.createTextNode(s));const u=document.createElement("div");if(u.appendChild(p),void 0!==n){const e=document.createElement("a");e.href=n,e.className="mp-settings-blue-text",e.appendChild(document.createTextNode(a)),e.setAttribute("target","_blank"),r.appendChild(e)}c.appendChild(i),u.appendChild(r),m.appendChild(l),m.appendChild(u),i.appendChild(d),i.appendChild(m),"alert"===o&&setTimeout(clearElement,1e4,i.id)}function selectTestMode(e){const t=document.getElementById("mp-mode-badge"),s=document.getElementById("mp-orange-badge"),n=document.getElementById("mp-icon-badge"),a=document.getElementById("mp-helper-test"),o=document.getElementById("mp-helper-prod"),c=document.getElementById("mp-title-helper-prod"),i=document.getElementById("mp-title-helper-test"),d=document.getElementById("mp-mode-badge-test"),m=document.getElementById("mp-mode-badge-prod");if(e)t.classList.remove("mp-settings-prod-mode-alert"),t.classList.add("mp-settings-test-mode-alert"),s.classList.remove("mp-settings-alert-payment-methods-green"),s.classList.add("mp-settings-alert-payment-methods-orange"),n.classList.remove("mp-settings-icon-success"),n.classList.add("mp-settings-icon-warning"),mpVerifyAlertTestMode(),a.style.display="block",o.style.display="none",i.style.display="block",c.style.display="none",d.style.display="block",m.style.display="none";else{const e=document.getElementById("mp-red-badge").parentElement;t.classList.remove("mp-settings-test-mode-alert"),t.classList.add("mp-settings-prod-mode-alert"),e.style.display="none",s.classList.remove("mp-settings-alert-payment-methods-orange"),s.classList.add("mp-settings-alert-payment-methods-green"),n.classList.remove("mp-settings-icon-warning"),n.classList.add("mp-settings-icon-success"),a.style.display="none",o.style.display="block",i.style.display="none",c.style.display="block",d.style.display="none",m.style.display="block"}}function mpVerifyAlertTestMode(){return!document.querySelector('input[name="mp-test-prod"]').checked||""!==document.getElementById("mp-public-key-test").value&&""!==document.getElementById("mp-access-token-test").value?(document.getElementById("mp-red-badge").parentElement.style.display="none",!1):(document.getElementById("mp-red-badge").parentElement.style.display="flex",!0)}function mpShowMessage(e,t,s){const n=document.createElement("div");let a="",o="";switch(s){case"credentials":a=document.querySelector(".mp-message-credentials"),o=document.querySelector(".mp-heading-credentials");break;case"store":a=document.querySelector(".mp-message-store"),o=document.querySelector(".mp-heading-store");break;case"payment":a=document.querySelector(".mp-message-payment"),o=document.querySelector(".mp-heading-payment");break;case"test_mode":a=document.querySelector(".mp-message-test-mode"),o=document.querySelector(".mp-heading-test-mode");break;default:a="",o=""}n.className="error"===t?"mp-alert mp-alert-danger mp-text-center mp-card-body":"mp-alert mp-alert-success mp-text-center mp-card-body",n.appendChild(document.createTextNode(e)),a.insertBefore(n,o),setTimeout(clearMessage,3e3)}function mpValidateCredentialsTips(){const e=document.getElementById("mp-settings-icon-credentials");jQuery.post(ajaxurl,{action:"mp_validate_credentials_tips",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.remove("mp-settings-icon-credentials"),e.classList.add("mp-settings-icon-success")):e.classList.remove("mp-settings-icon-success")})).fail((function(){e.classList.remove("mp-settings-icon-success")}))}function mpValidateStoreTips(){const e=document.getElementById("mp-settings-icon-store");jQuery.post(ajaxurl,{action:"mp_validate_store_tips",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.remove("mp-settings-icon-store"),e.classList.add("mp-settings-icon-success")):e.classList.remove("mp-settings-icon-success")})).fail((function(){e.classList.remove("mp-settings-icon-success")}))}function mpValidatePaymentTips(){const e=document.getElementById("mp-settings-icon-payment");jQuery.post(ajaxurl,{action:"mp_validate_payment_tips",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.remove("mp-settings-icon-payment"),e.classList.add("mp-settings-icon-success")):e.classList.remove("mp-settings-icon-success")})).fail((function(){e.classList.remove("mp-settings-icon-success")}))}function mpGoToNextStep(e,t,s,n){const a=document.getElementById(e),o=document.getElementById(s),c=document.getElementById(t),i=document.getElementById(n);if(a.style.display="none",c.style.display="block",o.classList.remove("mp-arrow-up"),i.classList.add("mp-arrow-up"),window.melidata&&window.melidata.client&&window.melidata.client.addStoreConfigurationsStepTimer)switch(t){case"mp-step-2":window.melidata.client.addStoreConfigurationsStepTimer({step:"business"});break;case"mp-step-3":window.melidata.client.addStoreConfigurationsStepTimer({step:"payment_methods",sendOnClose:!0});break;case"mp-step-4":window.melidata.client.addStoreConfigurationsStepTimer({step:"mode"})}}function mpContinueToNextStep(){document.getElementById("mp-payment-method-continue").addEventListener("click",(function(){mpGoToNextStep("mp-step-3","mp-step-4","mp-payments-arrow-up","mp-modes-arrow-up")}))}function mpGetRequirements(){jQuery.post(ajaxurl,{action:"mp_get_requirements",nonce:mercadopago_settings_admin_js_params.nonce},(function(e){const t={ssl:document.getElementById("mp-req-ssl"),gd_ext:document.getElementById("mp-req-gd"),curl_ext:document.getElementById("mp-req-curl")};for(let s in t){const n=t[s];n.style="",e.data[s]||(n.classList.remove("mp-settings-icon-success"),n.classList.add("mp-settings-icon-warning"))}}))}function mpGetPaymentMethods(){jQuery.post(ajaxurl,{action:"mp_get_payment_methods",nonce:mercadopago_settings_admin_js_params.nonce},(function(e){const t=document.getElementById("mp-payment");document.querySelectorAll(".mp-settings-payment-block").forEach((e=>{e.remove()})),e.data.reverse().forEach((e=>{t.insertAdjacentElement("afterend",createMpPaymentMethodComponent(e))})),window.melidata&&window.melidata.client&&window.melidata.client.stepPaymentMethodsCallback&&window.melidata.client.stepPaymentMethodsCallback()}))}function createMpPaymentMethodComponent(e){const t="yes"===e.enabled?"mp-settings-badge-active":"mp-settings-badge-inactive",s="yes"===e.enabled?e.badge_translator.yes:e.badge_translator.no,n=document.createElement("div");return n.appendChild(getPaymentMethodComponent(e,t,s)),n}function getPaymentMethodComponent(e,t,s){const n=`\n    <a href="${e.link}" class="mp-settings-link mp-settings-font-color">\n      <div class="mp-block mp-block-flex mp-settings-payment-block mp-settings-align-div">\n        <div class="mp-settings-align-div">\n          <div class="mp-settings-icon">\n            <img src="${e.icon}" alt="mp gateway icon" />\n          </div>\n\n          <span class="mp-settings-subtitle-font-size mp-settings-margin-title-payment">\n            <b>${e.title_gateway}</b> - ${e.description}\n          </span>\n\n          <span class="${t}">${s}</span>\n        </div>\n\n        <div class="mp-settings-title-align">\n        <span class="mp-settings-text-payment">Configurar</span>\n          <div class="mp-settings-icon-config"></div>\n        </div>\n      </div>\n    </a>\n  `;return(new DOMParser).parseFromString(n,"text/html").firstChild}function mpSettingsAccordionStart(){let e;const t=document.getElementsByClassName("mp-settings-title-align");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("active");{let e=null;for(let t=0;t<this.childNodes.length;t++)if(this.childNodes[t]?.classList?.contains("mp-settings-margin-left")){e=this.childNodes[t];break}e?.childNodes[1]?.classList?.toggle("mp-arrow-up")}const e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"}))}function mpSettingsAccordionOptions(){const e=document.getElementById("mp-advanced-options"),t=document.getElementById("block-two");e.addEventListener("click",(function(){this.classList.toggle("active");const s=this.nextElementSibling;"block"===s.style.display?s.style.display="none":s.style.display="block",e.classList.contains("active")||t.classList.contains("mp-settings-flex-start")?(e.textContent=mercadopago_settings_admin_js_params.hide_advanced_text,t.classList.remove("mp-settings-flex-start")):(t.classList.toggle("mp-settings-flex-start"),e.textContent=mercadopago_settings_admin_js_params.show_advanced_text)}))}function mpValidateCredentials(){document.getElementById("mp-access-token-prod").addEventListener("change",(function(){const e=this;jQuery.post(ajaxurl,{is_test:!1,access_token:this.value,action:"mp_update_access_token",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.add("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):(e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative"))})).fail((function(){e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative")}))})),document.getElementById("mp-access-token-test").addEventListener("change",(function(){const e=this;""===this.value?(e.classList.remove("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):jQuery.post(ajaxurl,{is_test:!0,access_token:this.value,action:"mp_update_access_token",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.add("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):(e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative"))})).fail((function(){e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative")}))})),document.getElementById("mp-public-key-prod").addEventListener("change",(function(){const e=this;jQuery.post(ajaxurl,{is_test:!1,public_key:this.value,action:"mp_update_public_key",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.add("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):(e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative"))})).fail((function(){e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative")}))})),document.getElementById("mp-public-key-test").addEventListener("change",(function(){const e=this;""===this.value?(e.classList.remove("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):jQuery.post(ajaxurl,{is_test:!0,public_key:this.value,action:"mp_update_public_key",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?(e.classList.add("mp-credential-feedback-positive"),e.classList.remove("mp-credential-feedback-negative")):(e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative"))})).fail((function(){e.classList.remove("mp-credential-feedback-positive"),e.classList.add("mp-credential-feedback-negative")}))}))}function mpUpdateOptionCredentials(){document.getElementById("mp-btn-credentials").addEventListener("click",(function(){document.getElementById("msg-info-credentials").childNodes.length>=1&&document.querySelector(".mp-card-info").remove(),jQuery.post(ajaxurl,{public_key_prod:document.getElementById("mp-public-key-prod").value,public_key_test:document.getElementById("mp-public-key-test").value,access_token_prod:document.getElementById("mp-access-token-prod").value,access_token_test:document.getElementById("mp-access-token-test").value,action:"mp_update_option_credentials",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(e){if(mpGetPaymentMethods(),e.success)mpVerifyAlertTestMode(),mpShowMessage(e.data,"success","credentials"),mpValidateCredentialsTips(),setTimeout((()=>{mpGoToNextStep("mp-step-1","mp-step-2","mp-credentials-arrow-up","mp-store-info-arrow-up")}),3e3);else{const t=document.querySelectorAll('input[name="mp-test-prod"]'),{message:s,subtitle:n,link:a,linkMsg:o,type:c,test_mode:i}=e?.data;mpMsgElement("msg-info-credentials",s,n,a,o,c),"no"===i?(t[1].checked=!0,selectTestMode(!1)):(t[0].checked=!0,selectTestMode(!0))}})).fail((function(e){mpShowMessage(e?.data,"error","credentials")}))}))}function mpUpdateStoreInformation(){document.getElementById("mp-store-info-save").addEventListener("click",(function(){jQuery.post(ajaxurl,{store_url_ipn:document.querySelector("#mp-store-url-ipn").value,store_url_ipn_options:document.querySelector("#mp-store-url-ipn-options").checked?"yes":"no",store_categories:document.getElementById("mp-store-categories").value,store_category_id:document.getElementById("mp-store-category-id").value,store_integrator_id:document.getElementById("mp-store-integrator-id").value,store_identificator:document.getElementById("mp-store-identification").value,store_debug_mode:document.querySelector("#mp-store-debug-mode:checked")?.value,action:"mp_update_store_information",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(e){e.success?(mpValidateStoreTips(),mpShowMessage(e.data,"success","store"),setTimeout((()=>{mpGoToNextStep("mp-step-2","mp-step-3","mp-store-info-arrow-up","mp-payments-arrow-up")}),3e3)):mpShowMessage(e.data,"error","store")})).fail((function(e){mpShowMessage(e?.data,"error","store")}))}))}function mpUpdateTestMode(){const e=document.querySelectorAll('input[name="mp-test-prod"]');e[0].addEventListener("change",(function(){e[0].checked&&selectTestMode(!0)})),e[1].addEventListener("change",(function(){e[1].checked&&selectTestMode(!1)})),document.getElementById("mp-store-mode-save").addEventListener("click",(function(){jQuery.post(ajaxurl,{input_mode_value:document.querySelector('input[name="mp-test-prod"]:checked').value,input_verify_alert_test_mode:mpVerifyAlertTestMode()?"yes":"no",action:"mp_update_test_mode",nonce:mercadopago_settings_admin_js_params.nonce},(function(){})).done((function(t){t.success?mpShowMessage(t.data,"success","test_mode"):(e[0].checked&&(document.getElementById("mp-red-badge").parentElement.style.display="flex"),mpShowMessage(t.data,"error","test_mode"))})).fail((function(e){mpShowMessage(e.data,"error","test_mode")}))}))}function mp_settings_screen_load(){mpGetRequirements(),mpGetPaymentMethods(),mpSettingsAccordionStart(),mpSettingsAccordionOptions(),mpValidateCredentials(),mpValidateCredentialsTips(),mpValidateStoreTips(),mpValidatePaymentTips(),mpVerifyAlertTestMode(),mpUpdateOptionCredentials(),mpUpdateStoreInformation(),mpUpdateTestMode(),mpContinueToNextStep()}