!function(e){e.blockUI.defaults=e.extend(e.blockUI.defaults,{message:"Loading ...",css:{padding:0,margin:0,width:"100%",top:"50%",left:"0%",textAlign:"center",color:"#000",border:"none",backgroundColor:"transparent",cursor:"default",fontSize:"16px",lineHeight:"24px",height:"24px",marginTop:"-12px"},overlayCSS:{backgroundColor:"#f9f9fa",opacity:.6,cursor:"default"}}),window.top==window.self&&(window.top.location.href=wp_paint_meta.wp_admin_url),window.wpp_enable_color_memory=function(){window.MP_GUI.GUI_colors._change_color=window.MP_GUI.GUI_colors.change_color,window.MP_GUI.GUI_colors.change_color=function(e,o,i,a){window.MP_GUI.GUI_colors._change_color(e,o,i,a),window.MP_GUI.Helper.setCookie("selected_color",e)}},window.wpp_canvas_to_image=function(e,o,i){var a,t=e.width,n=e.height,r=e.getContext("2d");if(i){a=r.getImageData(0,0,t,n);var p=r.globalCompositeOperation;r.globalCompositeOperation="destination-over",r.fillStyle=i,r.fillRect(0,0,t,n)}var l=e.toDataURL(o);return i&&(r.clearRect(0,0,t,n),r.putImageData(a,0,0),r.globalCompositeOperation=p),l},window.wpp_open_url=function(o,i){if(""!=o){if(void 0===i)i=window.State.Base_layers;var a=o.replace(/^.*[\\\/]/,""),t=o.substring(o.lastIndexOf("/")+1).split(/\?|\#/)[0].split(".").pop().toLowerCase(),n={jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png"},r="";void 0!==n[t]&&(r=n[t]),e("#wpp-image-data").data("imageExtension",t),e("#wpp-image-data").data("imageMimeType",r);var p=new Image;p.crossOrigin="Anonymous",p.onload=function(){var o=Number(p.width),t=Number(p.height),n=o*t,r=wp_paint_meta.max_resolution/t,l=wp_paint_meta.max_resolution/o;if(n>wp_paint_meta.max_resolution){var g=p.width/p.height;g>1?(o=r,(t=Math.round(r/g))>Number(l)&&(t=l,o=Math.round(l*g))):(t=l,(o=Math.round(g*l))>Number(r)&&(o=r,t=Math.round(r/g)))}var w={name:a,type:"image",link:p,width:o,height:t,width_original:p.width,height_original:p.height};i.insert(w),i.autoresize(o,t),e("#wpp-loading").remove()},p.onerror=function(e){alertify.error("Sorry, image could not be loaded. Try copy image and paste it.")},p.src=o}},window.addEventListener("load",(function(o){window.MP_GUI.load_modules(),window.MP_GUI.load_default_values(),null==window.MP_GUI.Helper.getCookie("toggle_info")&&window.MP_GUI.Helper.setCookie("toggle_info",0),null==window.MP_GUI.Helper.getCookie("toggle_colors")&&window.MP_GUI.Helper.setCookie("toggle_colors",0),null==window.MP_GUI.Helper.getCookie("toggle_details")&&window.MP_GUI.Helper.setCookie("toggle_details",0);var i=window.MP_GUI.Helper.getCookie("selected_color");AppConfig.COLOR=i&&i.match(/^#((0x){0,1}|#{0,1})([0-9A-F]{8}|[0-9A-F]{6})$/gi)?i:"#333333",AppConfig.TRANSPARENCY=!0,AppConfig.TOOLS=AppConfig.TOOLS.filter((function(e){return-1==["media","animation","clone"].indexOf(e.name)})),AppConfig.themes=["light","dark","green"],window.MP_GUI.render_main_gui(),window.MP_Layers.init(),wp_paint_meta&&wp_paint_meta.attachment_url&&window.wpp_open_url(wp_paint_meta.attachment_url),window.wpp_enable_color_memory(),AppConfig.mp_version=wp_paint_meta.wpp_version,e("#wpp-save-image-button").on("click",(function(){var o=document.createElement("canvas"),i=o.getContext("2d"),a=window.MP_Layers.get_dimensions(),t=a.width,n=a.height;o.width=t,o.height=n,window.MP_Layers.convert_layers_to_canvas(i);var r=e("#wpp-image-data").data("imageExtension"),p=e("#wpp-image-data").data("imageMimeType"),l="";-1!=e.inArray(r,["jpg","jpeg"])&&(l="#FFFFFF");var g=window.wpp_canvas_to_image(o,p,l);e("#wpp-image-data").val(g),e("#wpp-save-image-form").submit()})),e("#wpp-save-image-form").on("submit",(function(){e.blockUI({message:"Please wait ... Saving Image ..."})})),e("#wpp-restore-image-form").on("submit",(function(){e.blockUI({message:"Please wait ... Restoring Original Image ..."})}))}),!1)}(jQuery);
