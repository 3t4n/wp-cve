/*  
 * Ape Gallery			
 * Author:            	Wp Gallery Ape 
 * Author URI:        	https://wpape.net/
 * License:           	GPL-2.0+
 */
!function(e){function t(e){var t=jQuery(r),a={action:"wpape_gallery_get_images_from_ids",idstring:e};jQuery.post(ajaxurl,a,function(e){t.html(e);var a=t.find("img").length;if(a<=10)t.addClass("items10");else if(a<=20)t.addClass("items20");else if(a<=30)t.addClass("items30");else t.addClass("items50")})}var a,l,i,n,o="gallery-library",r=document.getElementById("ape_gallery_images_preview"),s=document.getElementsByClassName("wpapeGalleryFieldImagesButton");if(0!=s.length){s=s[0];i=document.getElementById(s.getAttribute("data-id"));t(l=i.value);n=""==l?[]:l.split(",");r.addEventListener("click",function(e){e.preventDefault();if(e.target.matches("img"))s.click()});var d=function(e){if(!a){if(n.length>0)o="gallery-edit";(a=new wp.media.view.emWpGallery({multiple:!0,state:o,library:{order:"ASC",orderby:"title",type:"image",search:null,uploadedTo:null,multiple:!0}})).on("ready",function(){if(0!=n.length){var e=a.state().get("library");wp.media.query({post__in:n}).more().then();n.forEach(function(t){attachment=wp.media.attachment(t);if(void 0!=attachment.attributes)attachment.attributes.sizes={medium:{url:apeGalleryFieldGallery.iconUrl}};attachment.fetch();e.add(attachment?[attachment]:[])})}});a.on("open",function(){if(0!=n.length&&"gallery-edit"!=o){a.setState("gallery-edit");a.options.state="gallery-edit";o="gallery-edit"}});a.on("insert",function(){var e=a.state().get("selection");console.log(e)});a.on("update",function(e){var o,r=a.state();if(o=e||r.get("selection")){var s=o.toJSON();if(0!=s.length){n=[];for(var d=0;d<s.length;d++)n.push(s[d].id);l=n.join(",");console.log("idsList",l);t(l);i.value=l;console.log("gallery array",n)}}else console.log("return selection")});a.open()}else a.open()};s.addEventListener("click",d)}else console.log("button not found ")}(jQuery);