var ESE_load_data_after_click_search_box = false, ESE_waiting_search_running = null, ESE_set_click_if_user_click_to_search = false, ESE_input_s_id = ''; ESE_delay_for_search = parseInt(ESE_delay_for_search); if (ESE_delay_for_search < 200) { ESE_delay_for_search = 200; } else if (ESE_delay_for_search > 5000) { ESE_delay_for_search = 5000; } function ESE_settime_running_echbay_search(key, jd) { clearTimeout(ESE_waiting_search_running); ESE_waiting_search_running = setTimeout(function () { ESE_settimeout_running_echbay_search(key, jd); }, ESE_delay_for_search); } function ESE_settimeout_running_echbay_search(key, jd) { if (key != '') { key = ESE_non_mark_seo(key); } var search_result = jQuery('div[data-id="' + jd + '"] li'); if (key.length > 1) { search_result.hide().each(function () { if (a != '') { var a = jQuery(this).attr('data-key') || ''; if (a != '' && a.split(key).length > 1) { jQuery(this).show(); jQuery('.echbay-search-everything-padding li[data-parent-type="' + jQuery(this).attr('data-type') + '"]').show() } } }); } else { jQuery('.echbay-search-everything-padding li').show() } } function ESE_javascript_running(i) { if (typeof i != 'number') { i = 50; } else if (i < 0) { console.log('[EchBay Search Everything] jQuery not found'); return false; } if (typeof jQuery != 'function') { setTimeout(function () { ESE_javascript_running(i - 1); }, 200); return false; } console.log('[EchBay Search Everything] active'); jQuery('form input[name="s"], form input[name="q"], form input[type="search"]').addClass('echbay-input-search-everything'); jQuery('.echbay-input-search-everything').click(function () { if (ESE_load_data_after_click_search_box == false) { ESE_load_data_after_click_search_box = true; console.log('[EchBay Search Everything] load site data'); jQuery('form').each(function () { if (jQuery('.echbay-input-search-everything', this).length > 0) { var jd = jQuery('.echbay-input-search-everything', this).attr('id') || ''; if (jd == '') { jd = 'ese-id' + Math.random().toString(32) + Math.random().toString(32); jd = jd.replace(/\./g, '_'); jQuery('.echbay-input-search-everything', this).attr({ id: jd }); } jQuery(this).append('<div data-id="' + jd + '" class="echbay-search-everything"><div class="echbay-search-everything-margin"></div></div>'); } }); (function (d, o, rc) { var a = d.createElement(o), m = d.getElementsByTagName(o)[0]; a.async = 1; a.src = rc; m.parentNode.insertBefore(a, m) })(document, 'script', ESE_cache_file_url); jQuery('body').append('<link rel="stylesheet" href="' + ESE_plugin_url + 'guest.css?v=' + ESE_search_version + '" type="text/css" />'); ESE_input_s_id = jQuery(this).attr('id') || ''; setTimeout(function () { jQuery('div[data-id="' + ESE_input_s_id + '"]').show(); }, 200); ESE_javascript_load_data(); } }); } function ESE_non_mark_seo(str) { if (typeof g_func != 'undefined' && g_func.non_mark_seo == 'function') { str = g_func.non_mark_seo(str); return str.replace(/[^0-9a-zA-Z]/g, ''); } str = str.toLowerCase(); str = str.replace(/\u00e0|\u00e1|\u1ea1|\u1ea3|\u00e3|\u00e2|\u1ea7|\u1ea5|\u1ead|\u1ea9|\u1eab|\u0103|\u1eb1|\u1eaf|\u1eb7|\u1eb3|\u1eb5/g, "a"); str = str.replace(/\u00e8|\u00e9|\u1eb9|\u1ebb|\u1ebd|\u00ea|\u1ec1|\u1ebf|\u1ec7|\u1ec3|\u1ec5/g, "e"); str = str.replace(/\u00ec|\u00ed|\u1ecb|\u1ec9|\u0129/g, "i"); str = str.replace(/\u00f2|\u00f3|\u1ecd|\u1ecf|\u00f5|\u00f4|\u1ed3|\u1ed1|\u1ed9|\u1ed5|\u1ed7|\u01a1|\u1edd|\u1edb|\u1ee3|\u1edf|\u1ee1/g, "o"); str = str.replace(/\u00f9|\u00fa|\u1ee5|\u1ee7|\u0169|\u01b0|\u1eeb|\u1ee9|\u1ef1|\u1eed|\u1eef/g, "u"); str = str.replace(/\u1ef3|\u00fd|\u1ef5|\u1ef7|\u1ef9/g, "y"); str = str.replace(/\u0111/g, "d"); str = str.replace(/\s/g, "-"); str = str.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'|\"|\&|\#|\[|\]|~|$|_/g, ""); str = str.replace(/-+-/g, "-"); str = str.replace(/^\-+|\-+$/g, ""); for (var i = 0; i < 5; i++) { str = str.replace(/--/g, '-'); } str = (function (s) { var str = '', re = /^\w+$/, t = ''; for (var i = 0; i < s.length; i++) { t = s.substr(i, 1); if (t == '-' || t == '+' || re.test(t) == true) { str += t; } } return str; })(str); return str.replace(/[^0-9a-zA-Z]/g, ''); } function ESE_number_only(str) { if (typeof str == 'undefined' || str == '') { return 0; } str = str.toString().replace(/[^0-9]/g, ''); if (str == '') { return 0; } return str; } function ESE_get_num_margin_padding(str) { var a = ESE_number_only(str); console.log(a); if (a > 0) { return 0 - a; } return 0; } var ESE_javascript_show_data = false; function ESE_javascript_load_data(i) { if (typeof i != 'number') { i = 50; } else if (i < 0) { console.log('[EchBay Search Everything] eb_ese_site_js_data not found'); return false; } if (typeof eb_ese_site_js_data == 'undefined') { setTimeout(function () { ESE_javascript_load_data(i - 1); }, 200); return false; } if (ESE_javascript_show_data === true) { console.log('ESE_javascript_load_data has active'); return false; } ESE_javascript_show_data = true; if (eb_ese_site_js_data.length == 0) { console.log('[EchBay Search Everything] eb_ese_site_js_data empty'); return false; } jQuery('.echbay-input-search-everything').attr({ autocomplete: 'off' }).click(function () { if (ESE_set_click_if_user_click_to_search === true) { return false; } ESE_set_click_if_user_click_to_search = true; ESE_input_s_id = jQuery(this).attr('id') || ''; if (ESE_input_s_id == '') { console.log('id not found'); return false; } jQuery('.echbay-search-everything').hide(); jQuery('div[data-id="' + ESE_input_s_id + '"]').show(); }).focus(function () { jQuery(this).click(); }).blur(function () { ESE_set_click_if_user_click_to_search = false; setTimeout(function () { jQuery('div[data-id="' + ESE_input_s_id + '"]').fadeOut(); }, 200); }).keyup(function (e) { if (e.keyCode == 13) { return false; } ESE_settime_running_echbay_search(jQuery(this).val() || '', ESE_input_s_id); }); jQuery('#wpadminbar .echbay-input-search-everything').off('click').off('focus').off('blur').off('keyup'); jQuery('#wpadminbar form .echbay-search-everything').remove(); var str = '', menu_url = '', post_type = '', post_show = ''; for (var i = 0; i < eb_ese_site_js_data.length; i++) { var arr_node = eb_ese_site_js_data[i]; for (var j = 0; j < arr_node.length; j++) { if (j == 0) { if (typeof arr_node[j].taxonomy != 'undefined') { post_type = arr_node[j].taxonomy; post_show = arr_node[j].taxonomy; } else { post_type = 'post'; post_show = arr_node[j].post_type; } str += '<li data-show="1" data-parent-type="' + post_show + '" class="ese-posttype-taxonomy">' + arr_node[j].name + '</li>'; } else { menu_url = ESE_web_link + '/?'; if (post_type == 'post') { menu_url += 'p=' + arr_node[j].id; } else if (post_type == 'category') { menu_url += 'cat=' + arr_node[j].id; } else { menu_url += 'taxonomy=' + post_type + '&cat=' + arr_node[j].id; } if (typeof arr_node[j].sku == 'undefined') { arr_node[j].sku = ''; } str += '<li data-key="' + ESE_non_mark_seo(arr_node[j].ten + arr_node[j].sku) + '" data-type="' + post_show + '"><a href="' + menu_url + '">' + arr_node[j].ten + '</a></li>'; } } } jQuery('.echbay-search-everything-margin').html('<div class="echbay-search-everything-padding"><ul>' + str + '</ul></div>'); /* jQuery('form').each(function() { if ( jQuery('.echbay-input-search-everything', this).length > 0 ) { var apadding = jQuery(this).height(), awidth = jQuery(this).width(); jQuery('.echbay-search-everything-margin', this).css({ 'top': apadding + 'px' }).width( awidth ); } }); */ } ESE_javascript_running(); 