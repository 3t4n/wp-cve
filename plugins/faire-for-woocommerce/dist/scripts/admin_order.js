!function(){"use strict";var r;(r=window.jQuery)(document).ready((function(){var e=r("#btn_faire_accept_order"),d=r("#faire_order_shipping_method"),i=r("#faire_tracking_code"),a=r("#faire_shipping_cost"),o=r("#faire_manage_order_msg"),n=r("#btn_faire_add_order_shipping_method"),t=r("#btn_faire_backorder_products"),c=r("#faire_backorder_products_msg"),s=function(){return window.location.reload(),!1},f=function(r){return{faireOrderId:r.data("faire_order_id"),shopOrderId:r.data("wc_order_id")}},l=function(e,d,i){var a=faireAdminOrder.ajaxUrl,n=faireAdminOrder.nonce,t=faireAdminOrder.updatingOrderStatus,c=faireAdminOrder.updatingOrderStatusFailed;o.html(t),r.post(a,{nonce:n,action:"update_order_status",order_id:e,status:d},(function(r){return i(r)})).fail((function(){o.html(c),console.error(c)}))},p=function(){var r=!d.val();n.prop("disabled",r),i.prop("disabled",r),i.val("")};p(),d.on("change",(function(){p()})),e.on("click",(function(d){var i=faireAdminOrder.ajaxUrl,a=faireAdminOrder.nonce,n=faireAdminOrder.acceptingOrder,t=faireAdminOrder.acceptingOrderFailed;d.preventDefault();var c=f(r(this)),p=c.faireOrderId,_=c.shopOrderId;p&&_&&(e.prop("disabled")||(e.prop("disabled",!0),o.html(n),r.post(i,{action:"accept_faire_order",nonce:a,order_id:p},(function(r){l(_,"processing",s),console.log(r)})).fail((function(r){o.html(t),e.prop("disabled",!1),console.error(r),console.error(p),console.error(t)}))))})),n.on("click",(function(e){var t=faireAdminOrder.ajaxUrl,c=faireAdminOrder.nonce,p=faireAdminOrder.shippingCostRequired,_=faireAdminOrder.shipmentTrackingCodeRequired,u=faireAdminOrder.settingOrderShipment,m=faireAdminOrder.setOrderShipmentFailed;e.preventDefault();var O=f(r(this)),h=O.faireOrderId,v=O.shopOrderId;if(h&&v&&!n.prop("disabled")){n.prop("disabled",!0);var b=d.val();if(b){a.next(".wc_error_tip").length&&a.val("");var g=a.val().trim();if(!g)return o.html(p),void n.prop("disabled",!1);var k=i.val().trim();if(!k)return o.html(_),void n.prop("disabled",!1);o.html(u),r.post(t,{nonce:c,action:"set_order_shipment",order_id:h,carrier:b,tracking_code:k,maker_cost_cents:g},(function(r){l(v,"completed",s),console.log(r)})).fail((function(r){o.html(m),n.prop("disabled",!1),console.error(r),console.error(h),console.error(m)}))}}}));var _=function(r,e,d){return!!r&&(d.html(e),t.prop("disabled",!1),!0)};t.on("click",(function(e){var d=faireAdminOrder.ajaxUrl,i=faireAdminOrder.nonce,a=faireAdminOrder.orderProductsBackorderQtyUnset,o=faireAdminOrder.orderProductsBackorderDateUnset,n=faireAdminOrder.orderProductsBackorderDateMin,p=faireAdminOrder.orderProductsBackordering,u=faireAdminOrder.orderProductsBackorderSuccess,m=faireAdminOrder.orderProductsBackorderFailed;e.preventDefault();var O=f(r(this)),h=O.faireOrderId,v=O.shopOrderId;if(h&&v&&!t.prop("disabled")){t.prop("disabled",!0);var b=r(this).data("tomorrow_date"),g=r(".faire_backorder_product_data"),k={},A=[],w=0,I=0,S=0;g.each((function(){var e=parseInt(r(this).find("#backorder_products_qty").val()),d=r(this).find("#backorder_products_date").val();e<=0&&w++,d||I++,d<b&&S++,k[r(this).data("faire_item_id")]={available_quantity:e,discontinued:!1,backordered_until:d?new Date(d).toISOString():""},e>0&&A.push({item_id:parseInt(r(this).data("wc_item_id")),backordered:e})})),_(w,a,c)||_(I,o,c)||_(S,n,c)||(c.html(p),r.post(d,{nonce:i,action:"backorder_products",wc_order_id:v,items_data:A,faire_order_id:h,availabilities:k},(function(){c.html(u),l(v,"faire-backordered",s)})).fail((function(r){var e=void 0===r.responseJSON||void 0===r.responseJSON.data?m:r.responseJSON.data;c.html(e),console.error(r)})).always((function(){return t.prop("disabled",!1)})))}}))}))}();