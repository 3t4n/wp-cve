jQuery(document).ready(function(e){var a={settings_groups:["accounts","coupon","vatnumber","emails","email-notify","receipt","accounting","automation","vat-override","eusafa","advanced"],$additional_account_table:e(".wc-szamlazz-settings–inline-table-accounts"),$notes_table:e(".wc-szamlazz-settings-notes"),$automations_table:e(".wc-szamlazz-settings-automations"),$vat_overrides_table:e(".wc-szamlazz-settings-vat-overrides"),$eusafa_table:e(".wc-szamlazz-settings-eusafas"),$advanced_table:e(".wc-szamlazz-settings-advanced-options"),activation_nonce:"",init:function(){this.init_toggle_groups(),this.toggle_sections(),e(".wc-szamlazz-settings-section-title").on("click",this.toggle_section),this.activation_nonce=e(".wc-szamlazz-settings-sidebar").data("nonce"),e("#woocommerce_wc_szamlazz_pro_email").keypress(this.submit_pro_on_enter),e("#wc_szamlazz_activate_pro").on("click",this.submit_activate_form),e("#wc_szamlazz_deactivate_pro").on("click",this.submit_deactivate_form),e("#wc_szamlazz_validate_pro").on("click",this.submit_validate_form),e(".wc-szamlazz-settings-widget-rating .button-secondary").on("click",this.hide_rate_request),e(".wc-szamlazz-settings-widget-addons .button-secondary").on("click",this.hide_addons),e(".wc_szamlazz_receipt_templates_preview").tipTip({content:'<div class="wc_szamlazz_receipt_templates_preview_image"></div>',fadeIn:50,fadeOut:50,delay:200,enter:function(){e("#tiptip_holder").css({"max-width":"270px"}),e("#tiptip_content").addClass("wc_szamlazz_tiptip_wider")},exit:function(){e("#tiptip_holder").css({"max-width":"200px"}),e("#tiptip_content").removeClass("wc_szamlazz_tiptip_wider")}});var t=e("#wc_szamlazz_load_email_ids_nonce").data("nonce");["invoice","proform","deposit","void","delivery"].forEach(function(a){e("#woocommerce_wc_szamlazz_email_attachment_"+a).parent().block({message:null,overlayCSS:{background:"#F5F5F5 url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})});var o={action:"wc_szamlazz_get_email_ids",nonce:t};e.post(ajaxurl,o,function(a){a.data.forEach(function(a){var t=e("#woocommerce_wc_szamlazz_email_attachment_"+a.field);a.options.forEach(function(e){var a=new Option(e.label,e.id,!1,e.selected);t.append(a).trigger("change")}),t.parent().unblock()})}),this.$additional_account_table.find("tfoot a").on("click",this.add_now_account_row),this.$additional_account_table.on("click","a.delete-row",this.delete_account_row),this.$additional_account_table.on("change","select",this.change_account_select_class),this.$additional_account_table.find("tbody tr").length<1&&this.add_now_account_row();var n=["notes","vat_overrides","eusafas","automations","advanced_options"];[this.$notes_table,this.$vat_overrides_table,this.$eusafa_table,this.$automations_table,this.$advanced_table].forEach(function(t,o){var i=n[o],s=i.slice(0,-1);s=s.replace("_","-"),t.on("change","select.condition",{group:i},a.change_x_condition),t.on("change","select.wc-szamlazz-settings-repeat-select",function(){a.reindex_x_rows(i)}),t.on("click",".add-row",{group:i},a.add_new_x_condition_row),t.on("click",".delete-row",{group:i},a.delete_x_condition_row),t.on("change","input.condition",{group:i},a.toggle_x_condition),t.on("click",".delete-"+s,{group:i},a.delete_x_row),e(".wc-szamlazz-settings-"+s+"-add a:not([data-disabled]").on("click",{group:i,table:t},a.add_new_x_row),t.find("ul.conditions[data-options]").each(function(){var a=e(this).data("options"),t=e(this);a.forEach(function(a){var o=e("#wc_szamlazz_"+i+"_condition_sample_row").html();(o=e(o)).find("select.condition").val(a.category),o.find("select.comparison").val(a.comparison),o.find("select.value").removeClass("selected"),o.find('select[data-condition="'+a.category+'"]').val(a.value).addClass("selected").attr("disabled",!1),t.append(o)})}),t.find(".wc-szamlazz-settings-"+s).length<1&&e(".wc-szamlazz-settings-"+s+"-add a:not([data-disabled]").trigger("click"),a.reindex_x_rows(i)})},init_toggle_groups:function(){e.each(a.settings_groups,function(a,t){var o=e(".wc-szamlazz-toggle-group-"+t),n=e(".wc-szamlazz-toggle-group-"+t+"-item").parents("tr"),i=e(".wc-szamlazz-toggle-group-"+t+"-item-hide").parents("tr"),s=e(".wc-szamlazz-toggle-group-"+t+"-cell-hide"),c=e(".wc-szamlazz-toggle-group-"+t+"-cell-show"),r=o.is(":checked");"emails"==t&&e(".wc-szamlazz-toggle-group-"+t+":checked").length&&(r=!0),r?(n.show(),i.hide(),s.hide(),c.show()):(n.hide(),i.show(),s.show(),c.hide()),o.change(function(a){a.preventDefault();var o=e(this).is(":checked");"emails"==t&&e(".wc-szamlazz-toggle-group-"+t+":checked").length&&(o=!0),o?(n.show(),i.hide(),s.hide(),c.show()):(n.hide(),i.show(),s.show(),c.hide())})})},submit_pro_on_enter:function(a){if(13==a.which)return e("#wc_szamlazz_activate_pro").click(),!1},submit_activate_form:function(){var t=e("#woocommerce_wc_szamlazz_pro_key").val(),o=e(this).parents(".wc-szamlazz-settings-widget"),n={action:"wc_szamlazz_license_activate",key:t,nonce:a.activation_nonce};return o.block({message:null,overlayCSS:{background:"#ffffff url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.find(".wc-szamlazz-settings-widget-pro-notice").hide(),e.post(ajaxurl,n,function(e){e.success?window.location.reload():(o.find(".wc-szamlazz-settings-widget-pro-notice p").html(e.data.message),o.find(".wc-szamlazz-settings-widget-pro-notice").show(),o.unblock())}),!1},submit_deactivate_form:function(){var t=e(this).parents(".wc-szamlazz-settings-widget"),o={action:"wc_szamlazz_license_deactivate",nonce:a.activation_nonce};return t.block({message:null,overlayCSS:{background:"#ffffff url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),t.find(".notice").hide(),e.post(ajaxurl,o,function(e){e.success?window.location.reload():(t.find(".notice p").html(e.data.message),t.find(".notice").show(),t.unblock())}),!1},submit_validate_form:function(){var t=e(this).parents(".wc-szamlazz-settings-widget"),o={action:"wc_szamlazz_license_validate",nonce:a.activation_nonce};return t.block({message:null,overlayCSS:{background:"#ffffff url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),t.find(".notice").hide(),e.post(ajaxurl,o,function(e){window.location.reload()}),!1},hide_rate_request:function(){var a=e(this).data("nonce"),t=e(this).parents(".wc-szamlazz-settings-widget"),o={action:"wc_szamlazz_hide_rate_request",nonce:a};t.block({message:null,overlayCSS:{background:"#ffffff url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajaxurl,o,function(e){t.slideUp()})},hide_addons:function(){var a=e(this).data("nonce"),t=e(this).parents(".wc-szamlazz-settings-widget"),o={action:"wc_szamlazz_hide_addons",nonce:a};t.block({message:null,overlayCSS:{background:"#ffffff url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),e.post(ajaxurl,o,function(e){t.slideUp()})},toggle_section:function(){e(this).toggleClass("open");var a=[];e(".wc-szamlazz-settings-section-title.open").each(function(){a.push(e(this).find("h3").attr("id"))}),localStorage.setItem("wc_szamlazz_settings_open_sections",JSON.stringify(a))},toggle_sections:function(){var a=JSON.parse(localStorage.getItem("wc_szamlazz_settings_open_sections"));a?a.forEach(function(a){e("#"+a).parent().addClass("open")}):(e("#woocommerce_wc_szamlazz_section_auth").parent().addClass("open"),e("#woocommerce_wc_szamlazz_section_invoice").parent().addClass("open"))},add_now_account_row:function(){var t=e("#wc_szamlazz_additional_accounts_sample_row").html();return a.$additional_account_table.find("tbody").append(t),a.reindex_account_rows(),!1},delete_account_row:function(){e(this).closest("tr").remove();return a.reindex_account_rows(),a.$additional_account_table.find("tbody tr").length<1&&a.add_now_account_row(),!1},reindex_account_rows:function(){e("#wc_szamlazz_additional_accounts_sample_row").html();return a.$additional_account_table.find("tbody tr").each(function(a){e(this).find("input, select").each(function(){var t=e(this).data("name");t=t.replace("X",a),e(this).attr("name",t)})}),!1},change_account_select_class:function(){0===this.selectedIndex?e(this).addClass("placeholder"):e(this).removeClass("placeholder")},change_x_condition:function(a){var t=e(this).val();e(this).parent().find("select.value").removeClass("selected").prop("disabled",!0),e(this).parent().find('select.value[data-condition="'+t+'"]').addClass("selected").prop("disabled",!1)},add_new_x_condition_row:function(t){var o=e("#wc_szamlazz_"+t.data.group+"_condition_sample_row").html();return e(this).closest("ul").append(o),a.reindex_x_rows(t.data.group),!1},delete_x_condition_row:function(t){return e(this).parent().remove(),a.reindex_x_rows(t.data.group),!1},reindex_x_rows:function(a){a=a.replace("_","-");return e(".wc-szamlazz-settings-"+a).find(".wc-szamlazz-settings-repeat-item").each(function(t){if(e(this).find("textarea, select, input").each(function(){var a=e(this).data("name");a=a.replace("X",t),e(this).attr("name",a)}),e(this).find("li").each(function(a){e(this).find("select").each(function(){var o=e(this).data("name");o=(o=o.replace("Y",a)).replace("X",t),e(this).attr("name",o)})}),e(this).find(".wc-szamlazz-settings-repeat-select").each(function(){var a=e(this).val(),t=e(this).find("option:selected").text();e(this).parent().find("label span").text(t),e(this).parent().find("label span").text(t),e(this).parent().find("label i").removeClass().addClass(a)}),"automations"==a){var o=e(this).find(".wc-szamlazz-settings-automation-document").val();e(this).find(".wc-szamlazz-settings-automation-option").show(),"delivery"==o?e(this).find(".wc-szamlazz-settings-automation-option:not(:last)").hide():"paid"==o&&e(this).find(".wc-szamlazz-settings-automation-option:not(:first)").hide()}if("advanced-options"==a){var n=e(this).find(".wc-szamlazz-settings-advanced-option-property").val();e(this).find(".wc-szamlazz-settings-advanced-option-option").hide(),e(this).find(".property-value").prop("disabled",!0),e(this).find(".wc-szamlazz-settings-advanced-option-option.option-"+n).show(),e(this).find(".wc-szamlazz-settings-advanced-option-option.option-"+n+" .property-value").prop("disabled",!1)}}),!1},add_new_x_row:function(t){var o=t.data.group,n=t.data.table,i=o.slice(0,-1),s=e("#wc_szamlazz_"+i+"_sample_row").html(),c=e("#wc_szamlazz_"+o+"_condition_sample_row").html();return(s=e(s)).find("ul").append(c),n.append(s),a.reindex_x_rows(o),!1},toggle_x_condition:function(t){var o=t.data.group,n=e(this).is(":checked"),i=e(this).closest(".wc-szamlazz-settings-repeat-item").find("ul.conditions");if(n){if(i.find("li").length<1){var s=e("#wc_szamlazz_"+o+"_condition_sample_row").html();i.append(s)}i.show()}else i.hide();if("notes"==o){var c=e(this).closest(".wc-szamlazz-settings-note").find(".wc-szamlazz-settings-note-if-append");n?c.show():c.hide()}if("automations"==o){var r=e(this).closest(".wc-szamlazz-settings-automation").find(".wc-szamlazz-settings-automation-if");n?r.show():r.hide()}a.reindex_x_rows(t.data.group)},delete_x_row:function(t){return e(this).closest(".wc-szamlazz-settings-repeat-item").remove(),a.reindex_x_rows(t.data.group),!1}},t={prefix:"wc_szamlazz_",prefix_id:"#wc_szamlazz_",prefix_class:".wc-szamlazz-",$metaboxContent:e("#wc_szamlazz_metabox .inside"),$disabledState:e(".wc-szamlazz-metabox-disabled"),$optionsContent:e(".wc-szamlazz-metabox-generate-options"),$autoMsg:e(".wc-szamlazz-metabox-auto-msg"),$generateContent:e(".wc-szamlazz-metabox-generate"),$optionsButton:e("#wc_szamlazz_invoice_options"),$generateButtonInvoice:e("#wc_szamlazz_invoice_generate"),$previewButton:e("#wc_szamlazz_invoice_preview"),$generateButtonReceipt:e("#wc_szamlazz_receipt_generate"),$receiptRowVoidNote:e(".wc-szamlazz-metabox-receipt-void-note"),$invoiceRow:e(".wc-szamlazz-metabox-invoices-invoice"),$receiptRow:e(".wc-szamlazz-metabox-invoices-receipt"),$proformRow:e(".wc-szamlazz-metabox-invoices-proform"),$deliveryRow:e(".wc-szamlazz-metabox-invoices-delivery"),$depositRow:e(".wc-szamlazz-metabox-invoices-deposit"),$voidedRow:e(".wc-szamlazz-metabox-invoices-void"),$correctedRow:e(".wc-szamlazz-metabox-invoices-corrected"),$voidedReceiptRow:e(".wc-szamlazz-metabox-invoices-void_receipt"),$completeRow:e(".wc-szamlazz-metabox-rows-data-complete"),$voidRow:e(".wc-szamlazz-metabox-rows-data-void"),$correctRow:e(".wc-szamlazz-metabox-rows-data-correct"),$messages:e(".wc-szamlazz-metabox-messages"),$reverseReceiptButton:e("#wc_szamlazz_reverse_receipt"),nonce:e(".wc-szamlazz-metabox-content").data("nonce"),order:e(".wc-szamlazz-metabox-content").data("order"),$uploadDocumentButton:e(".wc-szamlazz-invoice-upload"),is_receipt:!1,init:function(){this.$optionsButton.on("click",this.show_options),e(this.prefix_class+"invoice-toggle").on("click",this.toggle_invoice),this.$previewButton.on("click",this.show_preview),this.$generateButtonInvoice.on("click",this.generate_invoice),this.$generateButtonReceipt.on("click",this.generate_receipt),this.$completeRow.find("a").on("click",this.mark_completed),this.$voidRow.find("a").on("click",this.void_invoice),this.$correctRow.find("a").on("click",this.correct_invoice),this.$messages.find("a").on("click",this.hide_message),this.$reverseReceiptButton.on("click",this.reverse_receipt),this.$generateButtonReceipt.length&&(this.is_receipt=!0),this.$uploadDocumentButton.on("click",this.show_upload_modal),e("body").on("submit","#wc-szamlazz-modal-upload-form",this.upload_document),e("body").on("change","#wc_szamlazz_document_upload_file",this.on_upload_document_change)},loading_indicator:function(e,a){t.hide_message(),e.block({message:null,overlayCSS:{background:a+" url("+wc_szamlazz_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})},show_options:function(){return t.$optionsButton.toggleClass("active"),t.$optionsContent.slideToggle(),!1},toggle_invoice:function(){var a="";if(e(this).hasClass("off")&&!(a=prompt("Számlakészítés kikapcsolása. Mi az indok?","Ehhez a rendeléshez nem kell számla.")))return!1;var o={action:t.prefix+"toggle_invoice",nonce:t.nonce,order:t.order,note:a};return t.loading_indicator(t.$metaboxContent,"#fff"),e.post(ajaxurl,o,function(e){t.$disabledState.find("span").text(a),t.$metaboxContent.unblock(),"off"==e.data.state?(t.$disabledState.slideDown(),t.$optionsContent.slideUp(),t.$autoMsg.slideUp(),t.$generateContent.slideUp(),t.$voidedRow.slideUp()):(t.$disabledState.slideUp(),t.$autoMsg.slideDown(),t.$generateContent.slideDown())}),!1},show_document_response:function(a){"invoice"==a.data.type&&(t.$autoMsg.slideUp(),t.$generateContent.slideUp(),t.$voidedRow.slideUp(),t.$invoiceRow.find("strong").text(a.data.name),t.$invoiceRow.find("a").attr("href",a.data.link),t.$invoiceRow.slideDown(),t.$completeRow.slideDown(),t.$voidRow.slideDown(),a.data.completed&&(t.$completeRow.find("a").addClass("completed"),t.$completeRow.find("a").text(a.data.completed)),a.data.delivery&&(t.$deliveryRow.find("strong").text(a.data.delivery.name),t.$deliveryRow.find("a").attr("href",a.data.delivery.link),t.$deliveryRow.slideDown())),"proform"==a.data.type&&(e("#wc_szamlazz_invoice_normal").prop("checked",!0),t.$optionsContent.slideUp(),t.$proformRow.find("strong").text(a.data.name),t.$proformRow.find("a").attr("href",a.data.link),t.$proformRow.slideDown(),t.$voidedRow.slideUp()),"delivery"==a.data.type&&(e("#wc_szamlazz_invoice_normal").prop("checked",!0),t.$optionsContent.slideUp(),t.$deliveryRow.find("strong").text(a.data.name),t.$deliveryRow.find("a").attr("href",a.data.link),t.$deliveryRow.slideDown(),t.$voidedRow.slideUp()),"deposit"==a.data.type&&(e("#wc_szamlazz_invoice_normal").prop("checked",!0),t.$optionsContent.slideUp(),t.$depositRow.find("strong").text(a.data.name),t.$depositRow.find("a").attr("href",a.data.link),t.$depositRow.slideDown(),t.$voidedRow.slideUp())},generate_invoice:function(){var a=e(this),o="invoice";if(1!=confirm(a.data("question")))return!1;var n=e("#wc_szamlazz_invoice_account").val(),i=e("#wc_szamlazz_invoice_lang").val(),s=e("#wc_szamlazz_invoice_doc_type").val(),c=e("#wc_szamlazz_invoice_note").val(),r=e("#wc_szamlazz_invoice_deadline").val(),l=e("#wc_szamlazz_invoice_completed").val(),d=e("#wc_szamlazz_invoice_proform").is(":checked"),m=e("#wc_szamlazz_invoice_delivery").is(":checked"),z=e("#wc_szamlazz_invoice_deposit").is(":checked");d&&(o="proform"),m&&(o="delivery"),z&&(o="deposit");var _={action:t.prefix+"generate_invoice",nonce:t.nonce,order:t.order,account:n,lang:i,doc_type:s,note:c,deadline:r,completed:l,type:o};return t.loading_indicator(t.$metaboxContent,"#fff"),e.post(ajaxurl,_,function(e){t.$metaboxContent.unblock(),t.show_messages(e),e.data.error||t.show_document_response(e)}),!1},generate_receipt:function(){var a=e(this);if(1!=confirm(a.data("question")))return!1;var o={action:t.prefix+"generate_receipt",nonce:t.nonce,order:t.order};return t.loading_indicator(t.$metaboxContent,"#fff"),e.post(ajaxurl,o,function(e){t.$metaboxContent.unblock(),t.show_messages(e),e.data.error||(t.$autoMsg.slideUp(),t.$generateContent.slideUp(),t.$receiptRow.find("strong").text(e.data.name),t.$receiptRow.find("a").attr("href",e.data.link),t.$receiptRow.slideDown(),t.$voidRow.slideDown())}),!1},mark_completed_timeout:!1,mark_completed:function(){var a=e(this);if(a.hasClass("completed"))return!1;if(a.hasClass("confirm")){clearTimeout(t.mark_completed_timeout),t.loading_indicator(t.$completeRow,"#fff");var o={action:t.prefix+"mark_completed",nonce:t.nonce,order:t.order};e.post(ajaxurl,o,function(e){t.$completeRow.unblock(),t.show_messages(e),e.data.error?a.fadeOut(function(){a.text(a.data("trigger-value")),a.removeClass("confirm"),a.fadeIn()}):a.fadeOut(function(){a.text(e.data.completed),a.addClass("completed"),a.fadeIn(),a.removeClass("confirm")})})}else t.mark_completed_timeout=setTimeout(function(){a.fadeOut(function(){a.text(a.data("trigger-value")),a.fadeIn(),a.removeClass("confirm")})},5e3),a.addClass("confirm"),a.fadeOut(function(){a.text("Biztos?"),a.fadeIn()});return!1},void_invoice_timeout:!1,void_invoice:function(){var a=e(this);if(a.hasClass("confirm")){clearTimeout(t.void_invoice_timeout),t.loading_indicator(t.$voidRow,"#fff");var o=t.is_receipt?"void_receipt":"void_invoice",n={action:t.prefix+o,nonce:t.nonce,order:t.order};e.post(ajaxurl,n,function(e){t.$voidRow.unblock(),t.show_messages(e),e.data.error||(t.$invoiceRow.slideUp(),t.$completeRow.slideUp(),t.$deliveryRow.slideUp(),t.$depositRow.slideUp(),t.$receiptRow.slideUp(),t.$correctRow.slideUp(),t.$proformRow.slideUp(),t.$voidRow.slideUp(function(){a.text(e.data.completed),a.removeClass("confirm")}),"yes"==wc_szamlazz_params.delete_proform_too&&t.$proformRow.slideUp(),t.$generateContent.slideDown(),t.$autoMsg.slideDown(),t.is_receipt?(t.$voidedReceiptRow.find("strong").text(e.data.name),t.$voidedReceiptRow.find("a").attr("href",e.data.link),t.$voidedReceiptRow.slideDown(),t.$receiptRowVoidNote.slideDown(),t.$generateContent.slideUp()):e.data.name&&(t.$voidedRow.find("strong").text(e.data.name),t.$voidedRow.find("a").attr("href",e.data.link),t.$voidedRow.slideDown())),a.fadeOut(function(){a.text(a.data("trigger-value")),a.fadeIn(),a.removeClass("confirm")})})}else t.void_invoice_timeout=setTimeout(function(){a.fadeOut(function(){a.text(a.data("trigger-value")),a.fadeIn(),a.removeClass("confirm")})},5e3),a.addClass("confirm"),a.fadeOut(function(){a.text(a.data("question")),a.fadeIn()});return!1},correct_invoice_timeout:!1,correct_invoice:function(){var a=e(this);if(a.hasClass("confirm")){clearTimeout(t.correct_invoice_timeout),t.loading_indicator(t.$correctRow,"#fff");t.is_receipt;var o=e("#wc_szamlazz_invoice_account").val(),n=e("#wc_szamlazz_invoice_lang").val(),i=e("#wc_szamlazz_invoice_note").val(),s=e("#wc_szamlazz_invoice_deadline").val(),c=e("#wc_szamlazz_invoice_completed").val(),r={action:t.prefix+"generate_invoice",nonce:t.nonce,order:t.order,account:o,lang:n,note:i,deadline:s,completed:c,type:"corrected"};e.post(ajaxurl,r,function(e){t.$correctRow.unblock(),t.show_messages(e),e.data.error||(t.$voidRow.slideUp(function(){a.text(e.data.completed),a.removeClass("confirm")}),t.$correctRow.slideUp(function(){a.text(e.data.completed),a.removeClass("confirm")}),t.$correctedRow.find("strong").text(e.data.name),t.$correctedRow.find("a").attr("href",e.data.link),t.$correctedRow.slideDown()),a.fadeOut(function(){a.text(a.data("trigger-value")),a.fadeIn(),a.removeClass("confirm")})})}else t.void_invoice_timeout=setTimeout(function(){a.fadeOut(function(){a.text(a.data("trigger-value")),a.fadeIn(),a.removeClass("confirm")})},5e3),a.addClass("confirm"),a.fadeOut(function(){a.text(a.data("question")),a.fadeIn()});return!1},show_messages:function(a){a.data.messages&&a.data.messages.length>0&&(this.$messages.removeClass("wc-szamlazz-metabox-messages-success"),this.$messages.removeClass("wc-szamlazz-metabox-messages-error"),a.data.error?this.$messages.addClass("wc-szamlazz-metabox-messages-error"):this.$messages.addClass("wc-szamlazz-metabox-messages-success"),$ul=this.$messages.find("ul"),$ul.html(""),e.each(a.data.messages,function(a,t){var o=e("<li>");o.append(t),$ul.append(o)}),this.$messages.slideDown())},hide_message:function(){return t.$messages.slideUp(),!1},reverse_receipt:function(){var a={action:t.prefix+"reverse_receipt",nonce:t.nonce,order:t.order};t.loading_indicator(t.$metaboxContent,"#fff"),e.post(ajaxurl,a,function(e){window.location.reload()})},show_preview:function(){var a=e("#wc_szamlazz_invoice_note").val(),t=e("#wc_szamlazz_invoice_deadline").val(),o=e("#wc_szamlazz_invoice_completed").val(),n=e("#wc_szamlazz_invoice_account").val(),i=e(this).data("url"),s={note:a,deadline:t,completed:o,account:n};return i+="&"+e.param(s),e(this).attr("href",i),!0},show_upload_modal:function(){return e(this).WCBackboneModal({template:"wc-szamlazz-modal-upload",variable:{order_id:t.order}}),e("#wc_szamlazz_mark_paid_date").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,maxDate:0}),!1},on_upload_document_change:function(a){var t=a.target;if(t.files.length>0){var o=t.files[0].name.split(".").slice(0,-1).join(".");e(".wc-szamlazz-modal-upload #wc_szamlazz_document_upload_name").val(o)}},upload_document:function(a){a.preventDefault();var o=e(this),i=window.FormData?new FormData(o[0]):null,s=(null!==i||o.serialize(),e(".wc-szamlazz-modal-upload #wc_szamlazz_document_upload_name").val()),c=e(".wc-szamlazz-modal-upload #wc_szamlazz_document_upload_file").val(),r=!0;return i.append("action","wc_szamlazz_upload_document"),i.append("nonce",t.nonce),i.append("order",t.order),s||(r=!1,e("#wc_szamlazz_document_upload_name").parent().addClass("validate"),setTimeout(function(){e("#wc_szamlazz_document_upload_name").parent().removeClass("validate")},1e3)),c||(r=!1,e("#wc_szamlazz_document_upload_file").parent().addClass("validate"),setTimeout(function(){e("#wc_szamlazz_document_upload_file").parent().removeClass("validate")},1e3)),r&&(t.loading_indicator(e(".wc-szamlazz-modal-upload-form"),"#fff"),e.ajax({type:"POST",url:ajaxurl,contentType:!1,processData:!1,dataType:"JSON",status:200,data:i,success:function(a){console.log(a),n.show_messages(a,"uploader-results"),e(".wc-szamlazz-modal-upload-form").unblock(),t.show_document_response(a),e(".modal-close-link").trigger("click")}})),!1}};e(".wc-szamlazz-notice .wc-szamlazz-hide-notice").on("click",function(a){a.preventDefault();var t=e(this).closest(".wc-szamlazz-notice");if(e(t).find(".wc-szamlazz-wait").remove(),e(t).append('<div class="wc-szamlazz-wait"></div>'),e(".wc-szamlazz-notice.updating").length>0){var o=e(this);return setTimeout(function(){o.triggerHandler("click")},100),!1}e(t).addClass("updating"),e.post(ajaxurl,{action:"wc_szamlazz_hide_notice",security:e(this).data("nonce"),notice:e(this).data("notice"),remind:e(this).hasClass("remind-later")?"yes":"no"},function(){e(t).removeClass("updating"),e(t).fadeOut(100)})});var o={$menu_bar_item:e("#wp-admin-bar-wc-szamlazz-bg-generate-loading"),$link_stop:e("#wc-szamlazz-bg-generate-stop"),$link_refresh:e("#wc-szamlazz-bg-generate-refresh"),finished:!1,nonce:"",init:function(){this.$link_stop.on("click",this.stop),this.$link_refresh.on("click",this.reload_page),this.nonce=this.$link_stop.data("nonce");var e=this.refresh;setTimeout(e,5e3)},reload_page:function(){return location.reload(),!1},stop:function(){var a={action:"wc_szamlazz_bg_generate_stop",nonce:o.nonce};return e.post(ajaxurl,a,function(e){o.mark_stopped()}),!1},refresh:function(){var a={action:"wc_szamlazz_bg_generate_status",nonce:o.nonce};o.finished||e.post(ajaxurl,a,function(e){e.data.finished?o.mark_finished():setTimeout(o.refresh,5e3)})},mark_finished:function(){this.finished=!0,this.$menu_bar_item.addClass("finished")},mark_stopped:function(){this.mark_finished(),this.$menu_bar_item.addClass("stopped")}},n={init:function(){var a=e("#wc-szamlazz-bulk-print");e("#wc-szamlazz-bulk-download");a.on("click",this.printInvoices),a.length&&a.trigger("click"),e("#wpbody").on("click","#doaction",function(){return"wc_szamlazz_bulk_grouped_generate"==e("#bulk-action-selector-top").val()?(n.show_grouped_modal(),!1):"wc_szamlazz_bulk_generator"==e("#bulk-action-selector-top").val()?(n.show_generator_modal(),!1):void 0}),e("#wpbody").on("click","#doaction2",function(){return"wc_szamlazz_bulk_grouped_generate"==e("#bulk-action-selector-bottom").val()?(n.show_grouped_modal(),!1):"wc_szamlazz_bulk_generator"==e("#bulk-action-selector-bottom").val()?(n.show_generator_modal(),!1):void 0}),e(document).on("click","#generate_grouped_invoice",this.generate_grouped_invoices),e(document).on("click","#wc_szamlazz_bulk_generator",this.bulk_generator),e(document).on("change",'.wc-szamlazz-modal-bulk-generator-form input[name="bulk_invoice_extra_type"]',this.toggle_bulk_generator_options);var o=!1;e(window).keydown(function(e){77==e.which&&(o=!0)}).keyup(function(e){77==e.which&&(o=!1)}),e("#wpbody").on("click","a.wc-szamlazz-mark-paid-button",function(){if(e(this).hasClass("paid"))return!1;var a=e(this).data("order"),n=e(this).data("nonce"),i=e.datepicker.formatDate("yy-mm-dd",new Date);if(o){e(this).addClass("paid"),e(this).tipTip({content:"Fizetve: "+i}),e("#tiptip_content").text("Fizetve: "+i);var s={action:t.prefix+"mark_completed",nonce:n,order:a};e.post(ajaxurl,s,function(e){})}else e(this).WCBackboneModal({template:"wc-szamlazz-modal-mark-paid",variable:{order_id:a}}),e("#wc_szamlazz_mark_paid_date").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,maxDate:0});return!1}),e("body").on("click","#wc_szamlazz_mark_paid",function(){var a=e(this).data("order"),o=e(this).data("nonce"),n=e("#wc_szamlazz_mark_paid_date").val(),i={action:t.prefix+"mark_completed",nonce:o,order:a,date:n};return e('a.wc-szamlazz-mark-paid-button[data-order="'+a+'"]').addClass("paid"),e('a.wc-szamlazz-mark-paid-button[data-order="'+a+'"]').tipTip({content:"Fizetve: "+n}),e.post(ajaxurl,i,function(e){}),e(".modal-close-link").trigger("click"),!1})},printInvoices:function(){var a=e(this).data("pdf");if("function"==typeof printJS)return printJS(a),!1},show_grouped_modal:function(){var a=jQuery("#the-list input[name='post[]']:checked"),t=[],o=e("<ul/>");return o.addClass("wc-szamlazz-modal-grouped-generate-list"),e(a).each(function(n){var i=e(a[n]).val(),s=e(a[n]).parents(".type-shop_order").find("a.order-view").text();o.append('<li><label><input type="radio" name="main_order_id" value="'+i+'"> '+s+"</label></li>"),t.push(i)}),0===a.length&&(t=!1),e(this).WCBackboneModal({template:"wc-szamlazz-modal-grouped-generate",variable:{orders:o.prop("outerHTML"),orderIds:t}}),!1},show_generator_modal:function(){var a=jQuery("#the-list input[name='post[]']:checked"),t=[],o=e("<ul/>");return e(a).each(function(n){var i=e(a[n]).val(),s=e(a[n]).parents(".type-shop_order").find("a.order-view").text();o.append("<li>"+s+"</li>"),t.push(i)}),0===a.length&&(t=!1),e(this).WCBackboneModal({template:"wc-szamlazz-modal-bulk-generator",variable:{orders:o.prop("outerHTML"),orderIds:t}}),e("#wc_szamlazz_bulk_invoice_completed").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),!1},generate_grouped_invoices:function(){var a=e(this).data("orders"),o=e(this).data("nonce"),i=e("input[name=main_order_id]:checked",".wc-szamlazz-modal-grouped-generate-list").val();if(!i)return e(".wc-szamlazz-modal-grouped-generate-list").addClass("validate"),setTimeout(function(){e(".wc-szamlazz-modal-grouped-generate-list").removeClass("validate")},1e3),!1;t.loading_indicator(e(".wc-szamlazz-modal-grouped-generate-form"),"#fff");var s={action:t.prefix+"generate_grouped_invoice",nonce:o,orders:a,main_order:i};return e.post(ajaxurl,s,function(a){e(".wc-szamlazz-modal-grouped-generate-form").unblock(),n.show_messages(a,"grouped-generate-results"),a.data.error||(e(".wc-szamlazz-modal-grouped-generate-download").slideDown(),e(".wc-szamlazz-modal-grouped-generate-download-invoice").find("strong").text(a.data.name),e(".wc-szamlazz-modal-grouped-generate-download-invoice").attr("href",a.data.link),e(".wc-szamlazz-modal-grouped-generate-download-order").attr("href",a.data.order_link),e(".wc-szamlazz-modal-grouped-generate-form, .wc-szamlazz-modal-grouped-generate footer").slideUp())}),!1},show_messages:function(a,t){$messages=e(".wc-szamlazz-modal-"+t),a.data.messages&&a.data.messages.length>0&&($messages.removeClass("wc-szamlazz-metabox-messages-success"),$messages.removeClass("wc-szamlazz-metabox-messages-error"),a.data.error?$messages.addClass("wc-szamlazz-metabox-messages-error"):$messages.addClass("wc-szamlazz-metabox-messages-success"),$ul=$messages.find("ul"),$ul.html(""),e.each(a.data.messages,function(a,t){var o=e("<li>");o.append(t),$ul.append(o)}),$messages.slideDown())},bulk_generator:function(){var a=e(this).data("orders"),o=e(this).data("nonce");t.loading_indicator(e(".wc-szamlazz-modal-bulk-generator-form"),"#fff");var i="invoice",s=e("#wc_szamlazz_bulk_invoice_account").val(),c=e("#wc_szamlazz_bulk_invoice_lang").val(),r=e("#wc_szamlazz_bulk_invoice_doc_type").val(),l=e("#wc_szamlazz_bulk_invoice_note").val(),d=e("#wc_szamlazz_bulk_invoice_deadline").val(),m=e("#wc_szamlazz_bulk_invoice_completed").val(),z=e("#wc_szamlazz_bulk_invoice_proform").is(":checked"),_=e("#wc_szamlazz_bulk_invoice_delivery").is(":checked"),u=e("#wc_szamlazz_bulk_invoice_deposit").is(":checked"),p=e("#wc_szamlazz_bulk_invoice_void").is(":checked");z&&(i="proform"),_&&(i="delivery"),u&&(i="deposit"),p&&(i="void");var w={action:t.prefix+"bulk_generator",nonce:o,orders:a,options:{account:s,lang:c,doc_type:r,note:l,deadline:d,completed:m,document_type:i}};return e.post(ajaxurl,w,function(a){e(".wc-szamlazz-modal-bulk-generator-form").unblock(),n.show_messages(a,"bulk-generator-results"),a.data.error||(a.data.generated&&a.data.generated.forEach(function(a){var t="";console.log(a),t=a.error||a.link&&"proform_deleted"==a.link?'<div class="wc-szamlazz-modal-bulk-generator-download-error"><span>'+a.order_number+"</span> <em>"+a.messages[0]+"</em></div>":'<a target="_blank" href="'+a.link+'" class="wc-szamlazz-modal-bulk-generator-download-document document-'+i+'"><span>'+a.order_number+"</span> <strong>"+a.name+"</strong></a>",e(".wc-szamlazz-modal-bulk-generator-download").append(t)}),e(".wc-szamlazz-modal-bulk-generator-form, .wc-szamlazz-modal-bulk-generator footer").slideUp(),e(".wc-szamlazz-modal-bulk-generator-download").slideDown())}),!1},toggle_bulk_generator_options:function(){e("#wc_szamlazz_bulk_invoice_void").is(":checked")?e(".hidden-if-void").hide():e(".hidden-if-void").show()}};if(e("#wc_szamlazz_metabox").length&&t.init(),e("#woocommerce_wc_szamlazz_section_auth").length&&a.init(),e("#wp-admin-bar-wc-szamlazz-bg-generate-loading").length&&o.init(),(e(".wc-szamlazz-bulk-actions").length||e("#tmpl-wc-szamlazz-modal-grouped-generate").length)&&n.init(),e(".wc-szamlazz-notice .wc-szamlazz-migrate-button").on("click",function(a){a.preventDefault();var t=e(this),o=e(this).closest(".wc-szamlazz-notice");o.find(".wc-szamlazz-wait").remove(),o.append('<div class="wc-szamlazz-wait"></div>'),o.addClass("updating"),e.post(ajaxurl,{action:"wc_szamlazz_migrate",security:e(this).data("nonce")},function(){window.location.href=t.attr("href")})}),window.location.search.indexOf("page=wc-admin")>-1){var i=function(e,a){jQuery(e).size()?a():setTimeout(function(){window.requestAnimationFrame(function(){i(e,a)})},100)};i(".woocommerce-quick-links__category",function(){var a=e(".woocommerce-quick-links__item").last(),t=a.parent(),o=a.clone();o.find("div").text("Számlázz.hu"),o.find("a").attr("href",wc_szamlazz_params.settings_link),o.find("svg").html('<path d="M18.3165537,3 L18.3165537,5.83530482 L18.7478807,5.85409233 L18.7478807,5.85409233 L19.0672771,5.86436452 L19.0672771,5.86436452 L19.7246728,5.88095014 L19.7246728,5.88095014 L19.957369,5.88555849 L19.957369,5.88555849 L21,5.9044586 L20.9997502,6.09681268 L20.9997502,6.09681268 L20.9886755,6.41885343 L20.9886755,6.41885343 L20.9362008,7.65648738 L20.9362008,7.65648738 L20.8780175,8.9634171 L20.8780175,8.9634171 L20.650086,14.4243826 L20.650086,14.4243826 L20.5717498,16.2730029 L20.5717498,16.2730029 L20.3578922,21.3918046 L20.3578922,21.3918046 L20.3384187,21.7800918 L20.3384187,21.7800918 L20.3323313,21.8733128 L20.3323313,21.8733128 L20.3296935,21.9010939 L20.3296935,21.9010939 L20.3117135,22 L20.1026137,22 L19.9119896,21.9899033 L19.9119896,21.9899033 L18.713643,21.9349534 L18.713643,21.9349534 L18.3916692,21.9194664 L18.3916692,21.9194664 L17.942755,21.8996968 L17.942755,21.8996968 L17.2579329,21.8718208 L17.2579329,21.8718208 L14.0416941,21.7507541 L14.0416941,21.7507541 L13.3788273,21.7280749 L13.3788273,21.7280749 L13.0619025,21.7181321 L13.0619025,21.7181321 L12.4977009,21.6983977 L12.4977009,21.6983977 L11.8710143,21.6745607 L11.8710143,21.6745607 L7.13933558,21.4829852 L7.13933558,21.4829852 L6.72742515,21.4682029 L6.72742515,21.4682029 L6.34498659,21.456674 L6.34498659,21.456674 L6.09686954,21.4505645 L6.09686954,21.4505645 L5.89034022,21.4470503 L5.89034022,21.4470503 L5.85440059,21.4467977 L5.85440059,21.4467977 L5.49177154,21.4467698 L5.47434656,19.3894449 L3,19.3721565 L3,3 L18.3165537,3 Z M19.8238141,6.95905369 L18.3078412,6.95905369 L18.3078412,19.3894449 L13.632317,19.3895823 L9.98820016,19.3973733 L9.98820016,19.3973733 L8.36208406,19.4064525 L8.36208406,19.4064525 L6.68538238,19.4240218 L6.7048798,19.9075976 L6.7048798,19.9075976 L6.71239317,20.0521423 L6.71239317,20.0521423 L6.7180572,20.1361208 L6.7180572,20.1361208 L6.7238487,20.2060598 L6.7238487,20.2060598 L6.72942774,20.2584179 L6.72942774,20.2584179 L6.73326809,20.2840185 L6.73326809,20.2840185 L6.73558487,20.293747 C6.73631876,20.2959499 6.73701194,20.2970883 6.73765731,20.2970883 C6.73816981,20.2975967 6.73973745,20.2981351 6.74231059,20.2986999 L6.76050919,20.3014077 L6.76050919,20.3014077 L6.79127644,20.3044006 L6.79127644,20.3044006 L6.8864949,20.3109563 L6.8864949,20.3109563 L7.01992206,20.3177971 L7.01992206,20.3177971 L7.18351396,20.3243528 L7.18351396,20.3243528 L7.36922667,20.3300535 L7.36922667,20.3300535 L7.43465634,20.3316652 L7.43465634,20.3316652 L7.78161444,20.3460667 L7.78161444,20.3460667 L9.21066322,20.4003664 L9.21066322,20.4003664 L10.2250487,20.4403366 L10.2250487,20.4403366 L11.5749412,20.4890593 L11.5749412,20.4890593 L12.6100442,20.5256715 L12.6100442,20.5256715 L15.7541802,20.6445517 L15.7541802,20.6445517 L17.8635044,20.7292994 L17.8635044,20.7292994 L18.2537326,20.7473969 L18.2537326,20.7473969 L18.6375199,20.7623221 L18.6375199,20.7623221 L18.9390029,20.7713244 L18.9390029,20.7713244 L19.0222652,20.7725205 L19.0222652,20.7725205 L19.2400774,20.7811647 L19.2749274,20.6515014 L19.2790201,20.5997003 L19.2790201,20.5997003 L19.282907,20.5293203 L19.282907,20.5293203 L19.2863823,20.4450571 L19.2863823,20.4450571 L19.2892403,20.3516065 L19.2892403,20.3516065 L19.2912752,20.2536642 L19.2912752,20.2536642 L19.2920729,20.188193 L19.2920729,20.188193 L19.2930618,20.0503906 L19.2930618,20.0503906 L19.2984588,19.8140891 L19.2984588,19.8140891 L19.3085402,19.4819934 L19.3085402,19.4819934 L19.3291082,18.9073945 L19.3291082,18.9073945 L19.3435441,18.5468843 L19.3840312,17.5893691 L19.3840312,17.5893691 L19.4753146,15.2747953 L19.4753146,15.2747953 L19.5323994,13.8005906 L19.5323994,13.8005906 L19.7569095,8.31912348 L19.7569095,8.31912348 L19.8063892,7.28753412 L19.8063892,7.28753412 L19.8238141,6.95905369 Z M7.33047293,4.06323931 L4.13262343,4.06323931 L4.13262343,18.2743403 L17.0445305,18.2743403 L17.0445305,4.0978162 L11.1751709,4.07190344 L11.1751709,4.07190344 L8.72055293,4.065322 L8.72055293,4.065322 L7.33047293,4.06323931 L7.33047293,4.06323931 Z M5.85769603,7.51228389 L12.357212,7.51228389 L12.357212,8.67060965 L11.1396631,8.66905096 L11.1396631,8.66905096 L10.2119476,8.66619418 L10.2119476,8.66619418 L8.22526542,8.65707189 L8.22526542,8.65707189 L5.85769603,8.64467698 L5.85769603,8.64467698 L5.85769603,7.51228389 Z M14.8260661,5.92195751 L15.3455954,5.92174704 L15.3455954,5.92174704 L15.3455954,7.11464968 L5.85769603,7.11464968 L5.85769603,5.96496815 L11.1234556,5.93422155 L11.1234556,5.93422155 L12.5770286,5.92742741 L12.5770286,5.92742741 L13.8112893,5.9235505 L13.8112893,5.9235505 L14.8260661,5.92195751 L14.8260661,5.92195751 Z"></path>'),t.append(o)})}});