!function(n){wc_novalnet_admin={init:function(){if(n(document.body).on("order-totals-recalculate-complete",(function(e){var t={novalnet_check_order_id:n.trim(n("#post_ID").val()),action:"novalnet_wc_order_recalculate_success"};wc_novalnet_admin.ajax_call(t,"novalnet_order_recalculate_success")})),n("#novalnet_enable_shop_subs").on("change",(function(){n(this).is(":checked")?n("#novalnet_subs_tariff_id, #novalnet_usr_subcl").closest("tr").slideUp("fast"):n("#novalnet_subs_tariff_id, #novalnet_usr_subcl").closest("tr").slideDown("fast")})),n("#novalnet_enable_subs").on("change",(function(){n("#novalnet_enable_subs").is(":checked")?(n("#novalnet_subs_payments, #novalnet_subs_tariff_id, #novalnet_usr_subcl, #novalnet_enable_shop_subs").closest("tr").slideDown("fast"),n("#novalnet_enable_shop_subs").change()):n("#novalnet_subs_payments, #novalnet_subs_tariff_id, #novalnet_usr_subcl, #novalnet_enable_shop_subs").closest("tr").slideUp("fast")})).change(),n("#novalnet_book_order_amount").on("click",(function(){var e=n("#novalnet_book_amount").val().replace(/[^0-9\.]/g,"");return""==e||e<=0?(n(document.body).triggerHandler("wc_add_error_tip",[n("#novalnet_book_amount"),"i18n_decimal_error"]),!1):!!confirm(wc_novalnet_admin_data.amount_booking_confirmation)&&void 0})),n("#novalnet_enable_shop_subs").on("click",(function(){if(n("#novalnet_enable_shop_subs").is(":checked")){if(!confirm(wc_novalnet_admin_data.shopbased_subs_warning))return!1}else if(!confirm(wc_novalnet_admin_data.server_subs_warning))return!1})),n("#webhook_configure").on("click",(function(){if(void 0===n("#novalnet_webhook_url")||""===n("#novalnet_webhook_url").val())return wc_novalnet_admin.handle_webhook_configure({data:{error:wc_novalnet_admin_data.webhook_url_error}}),!1;var e=n.trim(n("#novalnet_webhook_url").val());if(!/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(e))return wc_novalnet_admin.handle_webhook_configure({data:{error:wc_novalnet_admin_data.webhook_url_error}}),!1;if(confirm(wc_novalnet_admin_data.webhook_notice)){wc_novalnet.load_block("mainform");var t={novalnet_api_key:n.trim(n("#novalnet_public_key").val()),novalnet_key_password:n.trim(n("#novalnet_key_password").val()),nn_nonce:n.trim(n("#novalnet_merchant_nonce").val()),novalnet_webhook_url:e,action:"handle_webhook_configure"};return wc_novalnet_admin.ajax_call(t,"webhook_configure"),!1}})).change(),n("#novalnet_test_mode_message").hide(),n("#novalnet_webhook_url_message").hide(),n("#novalnet_public_key").length&&n("#novalnet_key_password").length&&(n("#novalnet_tariff_id, #novalnet_subs_tariff_id").prop("readonly",!0),""!==n.trim(n("#novalnet_public_key").val())&&""!==n.trim(n("#novalnet_key_password").val())&&wc_novalnet_admin.fill_novalnet_details(),n("#novalnet_public_key, #novalnet_key_password").on("input change",(function(e){n(this).next("input[type=text]").focus(),""!==n.trim(n("#novalnet_public_key").val())&&""!==n.trim(n("#novalnet_key_password").val())&&("input"===e.type?null!=e.originalEvent.inputType&&"insertFromPaste"===e.originalEvent.inputType&&wc_novalnet_admin.fill_novalnet_details():wc_novalnet_admin.fill_novalnet_details())})).change(),n("#novalnet_public_key").closest("form").on("submit",(function(e){"false"===wc_novalnet_admin.ajax_complete&&(e.preventDefault(),n(document).ajaxComplete((function(e,t,a){n("#novalnet_public_key").closest("form").submit()})))}))),"undefined"!=typeof wc_novalnet_order_data&&void 0!==wc_novalnet_order_data.disallow_refund_reversal&&"1"===wc_novalnet_order_data.disallow_refund_reversal&&n(".delete_refund").hide(),"undefined"!=typeof wc_novalnet_admin_supported_payment&&(jQuery("#_payment_method >option").each((function(){if(-1==jQuery.inArray(this.value,wc_novalnet_admin_supported_payment)&&-1!=this.value.indexOf("novalnet")&&jQuery('#_payment_method option[value="'+this.value+'"]').hide(),-1!=this.value.indexOf("novalnet_guaranteed")){var n=this.value,e=wc_novalnet_admin_data.guarantee_text[n];jQuery('#_payment_method option[value="'+this.value+'"]').html(e)}})),n("#_billing_country , #_billing_company").on("change",(function(){var e=n("#_billing_country").val();if(NovalnetUtility.isValidCompanyName(n("#_billing_company").val()))var t=wc_novalnet_allowed_countries.b2b;else t=wc_novalnet_allowed_countries.b2c;-1==jQuery.inArray(e,t)?jQuery("#_payment_method >option").each((function(){-1!=this.value.indexOf("novalnet_guaranteed")&&(n("#_payment_method").val(n("#_payment_method option:first").val()),jQuery(".wc_shop_admin_order_novalnet_method").hide(),jQuery('#_payment_method option[value="'+this.value+'"]').hide())})):jQuery("#_payment_method >option").each((function(){-1!=this.value.indexOf("novalnet_guaranteed")&&(jQuery('#_payment_method option[value="'+this.value+'"]').show(),wc_novalnet_admin.validate_form_fields())}))})),n("#_payment_method, #_billing_company, #_transaction_id").on("change",wc_novalnet_admin.validate_form_fields),n(document).on("submit","#"+n("#wc_shop_order_novalnet_payment_method").closest("form").attr("id"),(function(e){var t=jQuery("#_payment_method").val();if(-1!=jQuery.inArray(t,wc_novalnet_admin_supported_payment)&&"0"==n("#novalnet_valid_amount").val()){n("#wc_shop_order_novalnet_payment_method").closest("form").find(":submit").attr("disabled",!0);var a={novalnet_check_post_id:n.trim(n("#post_ID").val()),novalnet_admin_payment:t,action:"check_amount_admin_order"};e.preventDefault(),e.stopImmediatePropagation(),wc_novalnet_admin.ajax_call(a,"admin_shop_order_amount_check")}}))),(void 0!==jQuery("#original_post_status").val()&&"auto-draft"!==jQuery("#original_post_status").val()||void 0!==jQuery("#original_order_status").val()&&"auto-draft"!==jQuery("#original_order_status").val())&&"shop_subscription"!=typenow){var e=n("#_payment_method").val();n("#_payment_method").on("change",(function(t){-1==n(this).val().indexOf("novalnet")&&-1==e.indexOf("novalnet")||(alert(wc_novalnet_admin_data.change_payment_error),n(this).val(e))}))}},ajax_call:function(e,t="merchant_data"){if("XDomainRequest"in window&&null!==window.XDomainRequest){var a=n.param(e),_=new XDomainRequest;_.open("POST",novalnet_server_url),_.onload=function(){"merchant_data"===t?wc_novalnet_admin.handle_merchant_data(this.responseText):"webhook_configure"===t?wc_novalnet_admin.handle_webhook_configure(this.responseText):"admin_shop_order_amount_check"===t?wc_novalnet_admin.admin_shop_order_amount_check(response):"instalment_cancel"===t&&wc_novalnet_admin.handle_instalment_cancel(response)},_.send(a)}else n.ajax({type:"POST",url:ajaxurl,data:e,success:function(n){"merchant_data"===t?wc_novalnet_admin.handle_merchant_data(n):"webhook_configure"===t?wc_novalnet_admin.handle_webhook_configure(n):"admin_shop_order_amount_check"===t?wc_novalnet_admin.admin_shop_order_amount_check(n):"instalment_cancel"===t&&wc_novalnet_admin.handle_instalment_cancel(n)}})},handle_merchant_data:function(e){if(n(".blockUI").remove(),void 0!==(e=e.data).error&&""!==e.error)return n("#novalnet_additional_info-description").html('<div class="error inline notice"><p>'+e.error+"</p></div>"),n("html, body").animate({scrollTop:n("#novalnet_additional_info-description .error").offset().top-200},1e3),n("#novalnet_test_mode_message").hide(),wc_novalnet_admin.null_basic_params(),!1;n("#novalnet_additional_info-description .error").hide();var t=n("#novalnet_tariff_id").val(),a=n("#novalnet_subs_tariff_id").val();for(var _ in"text"==n("#novalnet_tariff_id").prop("type")&&n("#novalnet_tariff_id").replaceWith('<select id="novalnet_tariff_id" style="width:25em;" name= "novalnet_tariff_id" ></select>'),"text"==n("#novalnet_subs_tariff_id").prop("type")&&n("#novalnet_subs_tariff_id").replaceWith('<select id="novalnet_subs_tariff_id" style="width:25em;"  name= "novalnet_subs_tariff_id" ></select>'),n("#novalnet_tariff_id, #novalnet_subs_tariff_id").empty().append(),e.merchant.tariff){var o=e.merchant.tariff[_].type,i=e.merchant.tariff[_].name;"4"!==n.trim(o)&&n("#novalnet_tariff_id").select2().append(n("<option>",{value:n.trim(_),text:n.trim(i)}).attr("tariff_type",n.trim(o))),"4"===n.trim(o)&&(n("#novalnet_subs_tariff_id").select2().append(n("<option>",{value:n.trim(_),text:n.trim(i)})),a===n.trim(_)&&n("#novalnet_subs_tariff_id").val(n.trim(_))),t===n.trim(_)&&(n("#novalnet_tariff_id").val(n.trim(_)),n("#novalnet_tariff_type").val(n.trim(o)))}return n("#novalnet_client_key").val(e.merchant.client_key),wc_novalnet_admin.ajax_complete="true",1===e.merchant.test_mode?n("#novalnet_test_mode_message").show():n("#novalnet_test_mode_message").hide(),void 0!==e.merchant.hook_url&&""!==e.merchant.hook_url?n("#novalnet_webhook_url_message").hide():n("#novalnet_webhook_url_message").show(),n("select#novalnet_tariff_id").on("change",(function(){var e=n("option:selected",this).attr("tariff_type");n("#novalnet_tariff_type").val(n.trim(e))})),!0},fill_novalnet_details:function(){wc_novalnet.load_block("mainform");var e={novalnet_api_key:n.trim(n("#novalnet_public_key").val()),novalnet_key_password:n.trim(n("#novalnet_key_password").val()),nn_nonce:n.trim(n("#novalnet_merchant_nonce").val()),action:"get_novalnet_vendor_details"};wc_novalnet_admin.ajax_call(e)},handle_webhook_configure:function(e){return n(".blockUI").remove(),void 0!==(e=e.data).error&&""!==e.error?n("#novalnet_additional_info-description").html('<div class="error inline notice"><p>'+e.error+"</p></div>"):n("#novalnet_additional_info-description").html('<div class="updated inline notice"><p>'+e.result.status_text+"</p></div>"),n("html, body").animate({scrollTop:n("#novalnet_additional_info-description").offset().top-100},1e3),!1},handle_instalment_cancel:function(e){n(".blockUI").remove(),location.reload(!0)},admin_shop_order_amount_check:function(e){e=e.data,n("#novalnet_valid_amount").val(e.is_amount_valid),void 0!==e.error&&""!==e.error?(n("#wc_shop_order_novalnet_payment_method").closest("form").find(":submit").attr("disabled",!1),wc_novalnet.show_error("#novalnet_admin_order_error",e.error)):n("#"+n("#_payment_method").closest("form").attr("id")).submit()},null_basic_params:function(){wc_novalnet_admin.ajax_complete="true",n("#novalnet_client_key").val(""),n("#novalnet_tariff_id").find("option").remove(),n("#novalnet_tariff_id").append(n("<option>",{value:"",text:wc_novalnet_admin.select_text})),"select"==n("#novalnet_tariff_id").prop("type")&&n("#novalnet_tariff_id").replaceWith('<input type = "text" id="novalnet_tariff_id" style="width:25em;" name= "novalnet_tariff_id" >'),n("#novalnet_subs_tariff_id").find("option").remove(),n("#novalnet_subs_tariff_id").append(n("<option>",{value:"",text:wc_novalnet_admin.select_text}))},show_instalment_refund:function(e){n("#div_refund_link_"+e).toggle()},instalment_amount_refund:function(e){var t=n("#novalnet_instalment_refund_amount_"+e).val(),a=n("#novalnet_instalment_refund_reason_"+e).val(),_=n("#novalnet_instalment_tid_"+e).val();return""===t||"0">=t?(alert(wc_novalnet_admin_data.refund_amount_error),!1):!!window.confirm(woocommerce_admin_meta_boxes.i18n_do_refund)&&(n("#novalnet_instalment_refund_amount").val(t),n("#novalnet_instalment_refund_tid").val(_),n("#novalnet_instalment_refund_reason").val(a),void wc_novalnet_admin.load_block("novalnet-instalment-details",null))},show_instalment_refund:function(e){n("#div_refund_link_"+e).slideDown(),n(".novalnet-instalment-data-row-toggle.refund_button_"+e).not("#div_refund_link_"+e).slideUp("fast")},hide_instalment_refund:function(e){n("#div_refund_link_"+e).slideUp(),n(".novalnet-instalment-data-row-toggle.refund_button_"+e).not("#div_refund_link_"+e).slideDown("fast")},load_block:function(e,t){n("#"+e).block({message:t,overlayCSS:{background:"#fff",opacity:.6}})},toggle_payment_name:function(e,t){var a=e.value;(a=a.toLowerCase())&&(n("input[id*=woocommerce_"+t+"_title], textarea[id*=woocommerce_"+t+"_description], textarea[id*=woocommerce_"+t+"_instructions] ").closest("tr").hide(),n("#woocommerce_"+t+"_title_"+a+", #woocommerce_"+t+"_description_"+a+", #woocommerce_"+t+"_instructions_"+a).closest("tr").show())},toggle_onhold_limit:function(e,t){"authorize"===e.value?(n("#woocommerce_"+t+"_limit").closest("tr").slideDown("fast"),"novalnet_paypal"===t&&n("#novalnet_paypal_notice").html(wc_novalnet_admin_data.paypal_notice)):(n("#woocommerce_"+t+"_limit").closest("tr").slideUp("fast"),"novalnet_paypal"===t&&n("#novalnet_paypal_notice").html(""))},entire_instalment_cancel:function(e){if(confirm("Are you sure want to cancel All instalment")){wc_novalnet.load_block("mainform");e={novalnet_instalment_cancel_tid:n.trim(n("#instalment_cancel_tid").val()),instalment_cancel_order_id:n.trim(n("#instalment_cancel_order_id").val()),novalnet_key_password:n.trim(n("#novalnet_key_password").val()),nn_nonce:n.trim(n("#instalment_security_nonce").val()),cancel_type:"CANCEL_ALL_CYCLES",action:"handle_instalment_cancel"};return wc_novalnet_admin.ajax_call(e,"instalment_cancel"),!1}},stop_upcoming_instalment:function(){if(confirm("Are you sure want to stop upcoming instalment")){wc_novalnet.load_block("mainform");var e={novalnet_instalment_cancel_tid:n.trim(n("#instalment_cancel_tid").val()),instalment_cancel_order_id:n.trim(n("#instalment_cancel_order_id").val()),novalnet_key_password:n.trim(n("#novalnet_key_password").val()),nn_nonce:n.trim(n("#instalment_security_nonce").val()),cancel_type:"CANCEL_REMAINING_CYCLES",action:"handle_instalment_cancel"};return wc_novalnet_admin.ajax_call(e,"instalment_cancel"),!1}},show_instalment_cancel_option:function(){n("#instalment_cancel").hide(),n("#entire_instalment_cancel").show(),n("#stop_upcoming_instalment").show()},validate_form_fields:function(){var e=jQuery("#_payment_method").val(),t=jQuery("#_transaction_id").val();-1!=jQuery.inArray(e,wc_novalnet_admin_supported_payment)?(jQuery(".wc_shop_admin_order_novalnet_method").hide(),jQuery("#wc_shop_order_admin_"+e).show(),-1!=e.indexOf("novalnet_guaranteed")&&(jQuery("#"+e+"_dob_field").show(),NovalnetUtility.isValidCompanyName(n("#_billing_company").val())&&-1!=jQuery("#wc_shop_order_admin_"+e).attr("allow_b2b").indexOf("yes")?jQuery("#"+e+"_dob_field").hide():jQuery("#"+e+"_dob_field").show()),"0"!=t.length?"17"==t.length&&t.match(/^\d+$/)?jQuery(".wc_shop_admin_order_novalnet_method").hide():(alert(wc_novalnet_admin_data.invalid_tid),jQuery("#_transaction_id").val("")):(jQuery("#wc_shop_order_admin_"+e).show(),jQuery("#_payment_method").parent().show(),jQuery("#nn_tid_payment").remove())):jQuery(".wc_shop_admin_order_novalnet_method").hide()}},n(document).ready((function(){wc_novalnet_admin.init()}))}(jQuery);