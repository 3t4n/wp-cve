document.addEventListener("DOMContentLoaded",sheetdb_upd);var sheetdb_template_cache=[],sheetdb_template_slots_cache=[],sheetdb_items=[],sheetdb_slots=[];function sheetdb_upd(){var t=document.querySelectorAll("[data-sheetdb-url]"),e=t.length,s=function(t,s){sheetdb_template_cache[t]||(sheetdb_template_cache[t]=s.innerHTML);var o=s.dataset.sheetdbSearch,a=s.dataset.sheetdbLimit,r=s.dataset.sheetdbOffset,n=s.dataset.sheetdbSortBy,d=s.dataset.sheetdbSortOrder,c=s.dataset.sheetdbSortMethod,h=s.dataset.sheetdbSortDateFormat,l=s.dataset.sheetdbGroupBy,i=s.dataset.sheetdbGroupByWithCount,u=s.dataset.sheetdbSearchMode,b=s.dataset.sheetdbSheet,_=s.dataset.sheetdbNotFoundMessage,p=!1;slot=s.dataset.sheetdbSave,slot&&!sheetdb_slots[slot]&&(sheetdb_slots[slot]=[]);var f=o;if(s.dataset.sheetdbQueryString){var m=new URLSearchParams(window.location.search),y=s.dataset.sheetdbQueryString.split(",");let t=0;y.forEach((e=>{let s=m.get(e),o=e+"="+s;null!=s&&t++,f?f+="&"+o:f=o})),0===t&&(p=!0)}var v=s.dataset.sheetdbUrl;f&&(v=v.endsWith("/")?v:v+"/",u&&"or"==u.toLowerCase()?v+="search_or":v+="search"),s.style.display="none",completed=0,sheetdbMakeSlotTemplateCache(),sheetdbFetchData({URL:v,search:f,limit:a,offset:r,sort_by:n,sort_order:d,sort_method:c,sort_date_format:h,group_by:l,group_by_with_count:i,sheet:b,slot:slot,skip_sheetdb_request:p}).then((function(o){data=o.response,slot=o.current_slot,sheetdb_items[t]=data,completed++;for(var a=[],r=0;r<data.length;r++)a.push(sheetdb_template_cache[t]);var n=[],d=a.map((function(t,e){return n.push(data[e]),sheetdbInterpolateString(t,data[e])}));if(slot)for(var c in n)sheetdb_slots[slot][c],n.hasOwnProperty(c)&&(sheetdb_slots[slot][c]=n[c]);s.innerHTML=d.join(""),s.style.display="",0===o.response.length&&_&&(s.appendChild(document.createElement("p")).innerHTML=_),s.dispatchEvent(new CustomEvent("sheetdb-downloaded")),e==completed&&(sheetdbUpdateSlots(),window.dispatchEvent(new CustomEvent("sheetdb-downloaded")))})).catch((function(t){throw new Error(t)}))};for(let e,o=0;e=t[o];o++)if(null!==e.getAttribute("lazy-loading")){new IntersectionObserver((function(t,a){t.forEach((t=>{t.isIntersecting&&(a.unobserve(t.target),s(o,e))}))}),{root:null,rootMargin:"100px",threshold:.01}).observe(e)}else s(o,e)}function sheetdbFetchData(t){if(1==t.skip_sheetdb_request)return new Promise((function(t,e){return t({response:[]})}));var e=t.URL,s=t.search,o=t.limit,a=t.offset,r=t.sort_by,n=t.sort_order,d=t.sort_method,c=t.sort_date_format,h=t.group_by,l=t.group_by_with_count,i=t.sheet,u=slot,b=[i?"sheet=".concat(i):"",r?"sort_by=".concat(r):"",n?"sort_order=".concat(n):"",d?"sort_method=".concat(d):"",c?"sort_date_format=".concat(c):"",h?"group_by=".concat(h):"",l?"group_by_with_count=".concat(l):"",o?"limit=".concat(o):"",a?"offset=".concat(a):"",s?"".concat(s):""];b=b.filter((function(t){return""!=t}));var _="".concat(e);return(r||n||d||c||h||l||o||a||s||i)&&(_=e.includes("?")?"".concat(e,"&").concat(b.join("&")):"".concat(e,"?").concat(b.join("&"))),new Promise((function(t,e){fetch(_).then((function(t){return t.json()})).then((function(e){return t({response:e,current_slot:u})})).catch((function(t){return e(t)}))}))}function sheetdbInterpolateString(t,e){return t.replace(/{{([^{}]*)}}/g,(function(t,s){var o=e[s];return"string"==typeof o?o:t}))}function sheetdbMakeSlotTemplateCache(){for(var t,e=document.querySelectorAll("[data-sheetdb-slot]"),s=0;t=e[s];s++)sheetdb_template_slots_cache[s]||(sheetdb_template_slots_cache[s]=t.innerHTML)}function sheetdbUpdateSlots(){for(var t,e=document.querySelectorAll("[data-sheetdb-slot]"),s=0;t=e[s];s++){for(var o=t.dataset.sheetdbSlot,a=[],r=0;r<sheetdb_slots[o].length;r++)a.push(sheetdb_template_slots_cache[s]);var n=a.map((function(t,e){return sheetdbInterpolateString(t,sheetdb_slots[o][e])}));t.innerHTML=n.join(""),t.style.display=""}}
