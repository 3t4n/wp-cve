!function(e){"use strict";e(document).ready(function(){t.init()});var t={importData:{},allowPopupClosing:!0,init:function(){var t=this;this.categoriesFilter(),e(".envo-search-input").on("keyup",function(){0<e(this).val().length?(e(".envo-demo-wrap .themes").find(".theme-wrap").hide(),e(".envo-demo-wrap .themes").find('.theme-wrap[data-name*="'+e(this).val().toLowerCase()+'"]').show()):e(".envo-demo-wrap .themes").find(".theme-wrap").show()}),e(".envo-demo-wrap .theme-actions a.button").on("click",function(e){e.stopPropagation()}),e(".envo-open-popup").click(function(n){n.preventDefault();var o=e(this).data("demo-id"),a=e(".preview-"+o),i=e(".preview-all-"+o);a.show(),i.show(),t.getDemoData(o)}),e(document).on("click",".install-now",this.installNow),e(document).on("click",".activate-now",this.activatePlugins),e(document).on("wp-plugin-install-success",this.installSuccess),e(document).on("wp-plugin-installing",this.pluginInstalling),e(document).on("wp-plugin-install-error",this.installError)},categoriesFilter:function(){var t=e(".envo-demo-wrap .themes").find(".theme-wrap"),n="envo-is-fadeout",o=function(){var o=e.Deferred();return t.addClass(n),setTimeout(function(){t.removeClass(n).hide(),o.resolve()},200),o.promise()},a=function(e,n){var o=e?'[data-categories*="'+e+'"]':"div";"all"===e&&(o="div"),t.filter(o).show().addClass("envo-is-fadein"),setTimeout(function(){t.removeClass("envo-is-fadein"),n.resolve()},200)},i=function(t){var n=e.Deferred();return o().done(function(){a(t,n)}),n};e(".envo-navigation-link").on("click",function(t){t.preventDefault(),e(this).parent().siblings().removeClass("active"),e(this).parent().addClass("active");var n=this.hash.slice(1),o=e(".envo-demo-wrap .themes");o.css("min-width",o.outerHeight()),i(n).done(function(){o.removeAttr("style")})})},getDemoData:function(t){var n=this;e.ajax({url:envoDemos.ajaxurl,type:"get",data:{action:"envo_ajax_get_import_data",demo_name:t,security:envoDemos.envo_import_data_nonce},complete:function(t){n.importData=e.parseJSON(t.responseText)}}),e.ajax({url:envoDemos.ajaxurl,type:"get",data:{action:"envo_ajax_get_demo_data",demo_name:t,demo_data_nonce:envoDemos.demo_data_nonce},complete:function(o){n.runPopup(o);var a=e(".preview-"+t),i=e(".preview-all-"+t);a.hide(),i.hide()}})},runPopup:function(t){var n=this,o=e("html").innerWidth();e("html").css("overflow","hidden");var a=e("html").innerWidth();e("html").css("margin-right",a-o),e("#envo-demo-popup-wrap").fadeIn(),e(t.responseText).appendTo(e("#envo-demo-popup-content")),e(".envo-demo-popup-close, .envo-demo-popup-overlay").on("click",function(e){e.preventDefault(),!0===n.allowPopupClosing&&n.closePopup()}),e(".envo-plugins-next").on("click",function(t){t.preventDefault(),e("#envo-demo-plugins").hide(),e("#envo-demo-import-form").show()}),e("#envo-demo-import-form").submit(function(t){t.preventDefault();var o=e(this).find('[name="envo_import_demo"]').val(),a=e(this).find('[name="envo_import_demo_data_nonce"]').val(),i=[];e(this).find("input[type=checkbox]:checked:not(:disabled)").each(function(){!0===e(this).is(":checked")&&i.push(e(this).attr("name"))}),e(this).hide(),e(".envo-loader").show(),n.importContent({demo:o,nonce:a,contentToImport:i,isXML:e("#envo_import_xml").is(":checked")})})},importContent:function(t){var n,o,a=this,i=(Date.now(),{envo_import_demo:t.demo,envo_import_demo_data_nonce:t.nonce});if(this.allowPopupClosing=!1,e(".envo-demo-popup-close").fadeOut(),0===t.contentToImport.length){setTimeout(function(){e(".envo-loader").hide(),e(".envo-last").show()},1e3),e.ajax({url:envoDemos.ajaxurl,type:"post",data:{action:"envo_after_import",envo_import_demo:t.demo,envo_import_demo_data_nonce:t.nonce,envo_import_is_xml:t.isXML},complete:function(e){}}),this.allowPopupClosing=!0,e(".envo-demo-popup-close").fadeIn();return}for(var s in this.importData){var l=e.inArray(this.importData[s].input_name,t.contentToImport);if(-1!==l){n=s,t.contentToImport.splice(l,1),i.action=this.importData[s].action;break}}e(".envo-import-status").append('<p class="envo-importing">'+this.importData[n].loader+"</p>");var r=e.ajax({url:envoDemos.ajaxurl,type:"post",data:i,complete:function(n){clearTimeout(o);var i=!0;if(500===n.status||502===n.status||503===n.status)e(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(envoDemos.content_importing_error+" "+n.status);else if(-1!==n.responseText.indexOf("successful import"))e(".envo-importing").addClass("envo-imported").removeClass("envo-importing");else{var s=e.parseJSON(n.responseText),l="";for(var r in s)l+=s[r],"xml_import_error"===r&&(i=!1);e(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(l),a.allowPopupClosing=!0,e(".envo-demo-popup-close").fadeIn()}!0===i&&a.importContent(t)}});o=setTimeout(function(){r.abort(),a.allowPopupClosing=!0,e(".envo-demo-popup-close").fadeIn(),e(".envo-importing").addClass("envo-importing-failed").removeClass("envo-importing").text(envoDemos.content_importing_error)},9e5)},closePopup:function(){e("html").css({overflow:"","margin-right":""}),e(".preview-icon").hide(),e(".preview-all").hide(),e("#envo-demo-popup-wrap").fadeOut(),setTimeout(function(){e("#envo-demo-popup-content").html("")},600)},installNow:function(t){t.preventDefault();var n=e(t.target),o=e(document);!(n.hasClass("updating-message")||n.hasClass("button-disabled"))&&(wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(t),o.on("credential-modal-cancel",function(){e(".install-now.updating-message").removeClass("updating-message").text(wp.updates.l10n.installNow),wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),wp.updates.installPlugin({slug:n.data("slug")}))},activatePlugins:function(t){t.preventDefault();var n=e(t.target),o=n.data("init");n.data("slug"),!(n.hasClass("updating-message")||n.hasClass("button-disabled"))&&(n.addClass("updating-message button-primary").html(envoDemos.button_activating),e.ajax({url:envoDemos.ajaxurl,type:"POST",data:{action:"envo_ajax_required_plugins_activate",init:o}}).done(function(e){e.success&&n.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(envoDemos.button_active)}))},installSuccess:function(t,n){t.preventDefault();var o=e(".envo-plugin-"+n.slug).find(".button"),a=o.data("init");o.removeClass("install-now installed button-disabled updated-message").addClass("updating-message").html(envoDemos.button_activating),setTimeout(function(){e.ajax({url:envoDemos.ajaxurl,type:"POST",data:{action:"envo_ajax_required_plugins_activate",init:a}}).done(function(e){e.success?o.removeClass("button-primary install-now activate-now updating-message").attr("disabled","disabled").addClass("disabled").text(envoDemos.button_active):o.removeClass("updating-message")})},1200)},pluginInstalling:function(t,n){t.preventDefault(),e(".envo-plugin-"+n.slug).find(".button").addClass("updating-message")},installError:function(t,n){t.preventDefault(),e(".envo-plugin-"+n.slug).removeClass("button-primary").addClass("disabled").html(wp.updates.l10n.installFailedShort)}}}(jQuery);