var quform=function(e,a,n,s){"use strict";var t=e.core,o=t.cache,i=a(window),r=!1,f=null,c=!1,l=!1,g={init:function(){o.get("#qfb-mc-settings-form").submit(function(){return!1}),o.get("#qfb-mc-save-settings").add(o.get("#qfb-fixed-save-button")).click(function(){g.saveSettings()}),o.get("#qfb-mc-settings-verify").click(g.verifyApiKey),a(".qfb-permissions-role-name").click(function(){a(this).closest(".qfb-table-row").find(".qfb-permissions-capability").each(function(){this.checked=!this.checked})}),o.get("#qfb_mc_uninstall_confirm").change(function(){o.get("#qfb-mc-do-uninstall").closest(t.settingWrap)[this.checked?"qfbSlideShow":"qfbSlideHide"]()}),o.get("#qfb-mc-do-uninstall").click(g.uninstallPlugin)},saveSettings:function(){r||(r=!0,o.get("#qfb-settings-save-loading").show().animate({maxWidth:"43px"}),"number"==typeof f&&(clearTimeout(f),f=null),o.get("#qfb-fixed-save-button").removeClass("qfb-saving qfb-saved qfb-save-error").addClass("qfb-saving"),a.ajax({type:"POST",url:s.ajaxUrl,data:{action:"quform_mc_save_settings",_ajax_nonce:n.saveSettingsNonce,options:JSON.stringify(g.getSettings())},dataType:"json"}).done(function(e){"success"===(e=t.sanitiseResponse(e)).type?g.onSaveSuccess():g.onSaveError(e.message)}).fail(function(){g.onSaveError(s.ajaxError)}).always(function(){r=!1,o.get("#qfb-settings-save-loading").css({maxWidth:0}).hide()}))},getSettings:function(){var n={enabled:o.get("#qfb_mc_enabled").is(":checked"),permissions:{}};return a(".qfb-permissions-capability").each(function(){var e=a(this),s=e.data("role"),i=e.data("capability");"undefined"==typeof n.permissions[s]&&(n.permissions[s]={}),n.permissions[s][i]=e.is(":checked")}),n},onSaveSuccess:function(){t.showFixedMessage(n.settingsSaved,"success"),o.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-saved"),f=setTimeout(function(){o.get("#qfb-fixed-save-button").removeClass("qfb-saved")},2e3)},onSaveError:function(e){t.showFixedMessage(n.errorSavingSettings+"<br>"+e,"error"),o.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error"),f=setTimeout(function(){o.get("#qfb-fixed-save-button").removeClass("qfb-save-error")},2e3)},verifyApiKey:function(){var e;c?alert(n.waitVerifying):(e=o.get("#qfb_mc_api_key").val()).length&&(c=!0,o.get("#qfb-mc-settings-verify-loading").show().animate({maxWidth:"43px"}),a.ajax({type:"POST",url:s.ajaxUrl,data:{action:"quform_mc_verify_api_key",_ajax_nonce:n.verifyApiKeyNonce,api_key:e},dataType:"json"}).done(function(e){var s,i;"success"===(e=t.sanitiseResponse(e)).type?g.onVerificationSuccess(e.message):"error"!==e.type&&"invalid"!==e.type||(g.showVerificationMessage(e.message,"error"),"invalid"===e.type&&(o.get("#qfb_mc_api_key_verified").prop("checked",!1),s=o.get(".qfb-license-status"),(i=s.find(".qfb-message-box")).hasClass("qfb-message-box-success")&&s.fadeOut(function(){i.removeClass("qfb-message-box-success").addClass("qfb-message-box-error").find(".qfb-message-box-inner").text(n.unverified),s.fadeIn()})))}).fail(function(){g.onVerificationError(s.ajaxError)}).always(function(){o.get("#qfb-mc-settings-verify-loading").css({maxWidth:0}).hide(),c=!1}))},showVerificationMessage:function(e,s){o.get("#qfb-settings-verify-message").hide(),o.get("#qfb-settings-verify-message").find(".qfb-message-box").removeClass("qfb-message-box-success qfb-message-box-error").addClass("qfb-message-box-"+s),o.get("#qfb-settings-verify-message").find(".qfb-message-box-inner").html(e),o.get("#qfb-settings-verify-message").qfbSlideShow()},onVerificationSuccess:function(e){g.showVerificationMessage(e,"success"),o.get("#qfb_mc_api_key_verified").prop("checked",!0);var s=o.get(".qfb-license-status"),i=s.find(".qfb-message-box");i.hasClass("qfb-message-box-error")&&s.fadeOut(function(){i.removeClass("qfb-message-box-error").addClass("qfb-message-box-success").find(".qfb-message-box-inner").text(n.verified),s.fadeIn()})},onVerificationError:function(e){e=n.errorVerifying+(e?" ("+e+")":""),g.showVerificationMessage(e,"error")},uninstallPlugin:function(){l||(l=!0,o.get("#qfb_mc_uninstall_confirm").is(":checked")&&confirm(n.uninstallAreYouSure)?(o.get("#qfb-mc-uninstall-loading").css({opacity:1}),a.ajax({type:"POST",url:s.ajaxUrl,data:{action:"quform_mc_uninstall_plugin",_ajax_nonce:n.uninstallPluginNonce},dataType:"json"}).done(function(e){"success"===(e=t.sanitiseResponse(e)).type?window.location=n.pluginsUrl:"error"!==e.type&&"invalid"!==e.type||g.onUninstallPluginFail(e.message,"error")}).fail(function(){g.onUninstallPluginFail(s.ajaxError)}).always(function(){o.get("#qfb-mc-uninstall-loading").css({opacity:0}),l=!1})):l=!1)},onUninstallPluginFail:function(e){t.showFixedMessage(n.errorUninstalling+"<br>"+e,"error")}};return a(g.init),i.on("load",g.onWindowLoad),e.settings=g,e}(quform||{},jQuery,quformMailchimpSettingsL10n,quformCoreL10n);