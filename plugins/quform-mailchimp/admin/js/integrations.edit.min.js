var quform=function(e,b,p,r){"use strict";var i,q=e.core,l=q.cache,a=b(window),s=b(document),n=!1,t=!1,c=!1,o=!1,g=!1,f=!1,h={integration:{},savedIntegrationJson:"",currentMergeFieldTags:[],currentLogicSources:[],init:function(e){h.integration=e,l.get("#qfb-mc-integrations-edit-form").submit(function(){return!1}),l.get("#qfb-mc-save-integration").add(l.get("#qfb-fixed-save-button")).click(h.save),h.savedIntegrationJson=JSON.stringify(h.integration),window.onbeforeunload=function(){if(h.update(),h.savedIntegrationJson!==JSON.stringify(h.integration))return p.unsavedChanges},h.syncLists(h.getValue(h.integration,"listId")),l.get("#qfb-mc-integration-list-sync").click(function(){h.syncLists(l.get("#qfb_mc_integration_list").val())}),h.syncFormFields(h.getValue(h.integration,"emailElement")),l.get("#qfb_mc_integration_form").change(function(){h.syncFormFields()}),l.get("#qfb-mc-integration-email-sync").click(function(){h.syncFormFields(l.get("#qfb_mc_integration_email_element").val())}),h.syncMergeFields(h.getValue(h.integration,"formId"),h.getValue(h.integration,"listId"),h.getValue(h.integration,"mergeFields")),l.get("#qfb-mc-merge-add-merge-field").click(function(){l.get("#qfb-mc-integration-merge-fields-empty").hide(),l.get("#qfb-mc-merge-fields").append(h.getMergeFieldHtml(h.getNewMergeField())).show()}),l.get("#qfb-mc-merge-fields").on("click",".qfb-small-add-button",function(){b(this).closest(".qfb-mc-merge-field").after(h.getMergeFieldHtml(h.getNewMergeField()))}),l.get("#qfb-mc-merge-fields").on("click",".qfb-small-remove-button",function(){b(this).closest(".qfb-mc-merge-field").remove(),0===l.get("#qfb-mc-merge-fields").find("> .qfb-mc-merge-field").length&&l.get("#qfb-mc-integration-merge-fields-empty").fadeIn()}),l.get("#qfb_mc_integration_form").add(l.get("#qfb_mc_integration_list")).change(h.resyncMergeFields),l.get("#qfb-mc-integration-merge-fields-sync").click(h.resyncMergeFields),l.get("#qfb-mc-integrations-edit-form").on("click",".qfb-mc-insert-variable",function(e){e.preventDefault(),e.stopPropagation(),h.openInsertVariableMenu(b(this))}),l.get("#qfb-mc-integrations-edit-form").on("click",".qfb-mc-merge-field-value",function(e){e.stopPropagation()}),l.get("#qfb-mc-integrations-edit-form").on("focus",".qfb-mc-merge-field-value",function(){q.isNonEmptyString(b(this).val())||h.openInsertVariableMenu(b(this).siblings(".qfb-mc-insert-variable"))}),h.syncGroups(h.getValue(h.integration,"listId"),h.getValue(h.integration,"groups")),b.fn.select2&&l.get("#qfb_mc_integration_groups").select2({theme:"qfb",language:{noResults:function(){return r.noResultsFound}}}),l.get("#qfb-mc-integration-groups-sync").click(function(){h.syncGroups(l.get("#qfb_mc_integration_list").val(),l.get("#qfb_mc_integration_groups").val()||[])}),l.get("#qfb_mc_integration_list").change(function(){h.syncGroups(l.get("#qfb_mc_integration_list").val(),[])}),l.get("#qfb_mc_integration_logic_enabled").change(function(){l.get("#qfb-mc-logic").closest(q.settingWrap)[l.get("#qfb_mc_integration_logic_enabled").is(":checked")?"qfbSlideShow":"qfbSlideHide"]()}),h.syncLogic(h.getValue(h.integration,"formId"),h.getValue(h.integration,"logicAction"),h.getValue(h.integration,"logicMatch"),h.getValue(h.integration,"logicRules")),l.get("#qfb_mc_integration_form").change(function(){h.resetLogic(),h.resyncLogic()}),l.get("#qfb-mc-integration-logic-sync").click(h.resyncLogic),l.get("#qfb-add-logic-rule").click(function(){l.get("#qfb-mc-logic").find(".qfb-no-logic-rules").remove(),l.get("#qfb-mc-logic").find(".qfb-logic-rules").append(h.buildLogicRule(h.getNewLogicRule()))})},update:function(){h.integration.name=l.get("#qfb_mc_integration_name").val(),h.integration.active=l.get("#qfb_mc_integration_active").is(":checked"),h.integration.formId=l.get("#qfb_mc_integration_form").val(),h.integration.listId=l.get("#qfb_mc_integration_list").val(),h.integration.listName=""===h.integration.listId?"":l.get("#qfb_mc_integration_list").find("option:selected").text(),h.integration.emailElement=l.get("#qfb_mc_integration_email_element").val(),h.integration.doubleOptIn=l.get("#qfb_mc_integration_double_opt_in").is(":checked"),h.integration.mergeFields=[],l.get("#qfb-mc-merge-fields").find("> .qfb-mc-merge-field").each(function(){var e=b(this);h.integration.mergeFields.push({tag:e.find(".qfb-mc-merge-field-tag").val(),value:e.find(".qfb-mc-merge-field-value").val()})}),h.integration.groups=l.get("#qfb_mc_integration_groups").val()||[],h.integration.tags=l.get("#qfb_mc_integration_tags").val(),h.integration.logicEnabled=l.get("#qfb_mc_integration_logic_enabled").is(":checked"),h.integration.logicAction="0"!==l.get("#qfb-mc-logic").find(".qfb-logic-action").val(),h.integration.logicMatch=l.get("#qfb-mc-logic").find(".qfb-logic-match").val()||"all",h.integration.logicRules=h.getLogicRules(l.get("#qfb-mc-logic"))},validate:function(){l.get("#qfb-mc-integrations-edit-form").find(".qfb-validation-error").remove(),l.get("#qfb-mc-integrations-edit-form").find(".qfb-field-error").removeClass("qfb-field-error");var e=[];if(q.isNonEmptyString(h.integration.name)||e.push({scrollTarget:l.get("#qfb_mc_integration_name").closest(q.settingWrap),show:function(){l.get("#qfb_mc_integration_name").addClass("qfb-field-error"),q.addValidationError(l.get("#qfb_mc_integration_name").closest(q.settingInputWrap),r.thisFieldIsRequired)}}),q.isNonEmptyString(h.integration.formId)||e.push({scrollTarget:l.get("#qfb_mc_integration_form").closest(q.settingWrap),show:function(){l.get("#qfb_mc_integration_form").addClass("qfb-field-error"),q.addValidationError(l.get("#qfb_mc_integration_form").closest(q.settingInputWrap),r.thisFieldIsRequired)}}),q.isNonEmptyString(h.integration.listId)||e.push({scrollTarget:l.get("#qfb_mc_integration_list").closest(q.settingWrap),show:function(){l.get("#qfb_mc_integration_list").addClass("qfb-field-error"),q.addValidationError(l.get("#qfb_mc_integration_list").closest(q.settingInputWrap),r.thisFieldIsRequired)}}),q.isNonEmptyString(h.integration.emailElement)||e.push({scrollTarget:l.get("#qfb_mc_integration_email_element").closest(q.settingWrap),show:function(){l.get("#qfb_mc_integration_email_element").addClass("qfb-field-error"),q.addValidationError(l.get("#qfb_mc_integration_email_element").closest(q.settingInputWrap),r.thisFieldIsRequired)}}),l.get("#qfb-mc-merge-fields").find("> .qfb-mc-merge-field").each(function(){h.validateMergeField(b(this),e)}),e.length){q.showFixedMessage(p.correctHighlightedFields,"error");for(var t=0;t<e.length;t++)e[t].show();return q.scrollTo(e[0].scrollTarget),!1}return!0},validateMergeField:function(e,t){var i=e.find(".qfb-mc-merge-field-tag"),n=e.find(".qfb-mc-merge-field-value");q.isNonEmptyString(i.val())||t.push({scrollTarget:e,show:function(){i.addClass("qfb-field-error"),q.addValidationError(i.closest(".qfb-mc-merge-field-column"),r.thisFieldIsRequired)}}),q.isNonEmptyString(n.val())||t.push({scrollTarget:e,show:function(){n.addClass("qfb-field-error"),q.addValidationError(n.closest(".qfb-mc-merge-field-column"),r.thisFieldIsRequired)}})},save:function(){var t;n||(n=!0,h.update(),h.validate()?("number"==typeof i&&(clearTimeout(i),i=null),l.get("#qfb-fixed-save-button").removeClass("qfb-saving qfb-saved qfb-save-error").addClass("qfb-saving"),t=JSON.stringify(h.integration),b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_save_integration",_ajax_nonce:p.saveIntegrationNonce,integration:t},dataType:"json"}).done(function(e){switch((e=q.sanitizeResponse(e)).type){case"success":h.savedIntegrationJson=t,q.showFixedMessage(p.integrationSaved,"success"),l.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-saved"),i=setTimeout(function(){l.get("#qfb-fixed-save-button").removeClass("qfb-saved")},2e3);break;case"error":case"invalid":q.showFixedMessage(p.errorSavingIntegration+"<br>"+e.message,"error"),l.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error")}}).fail(function(){q.showFixedMessage(p.errorSavingIntegration+"<br>"+r.ajaxError,"error"),l.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error")}).always(function(){n=!1})):n=!1)},syncLists:function(o){t||(t=!0,l.get("#qfb_mc_integration_list").hide(),l.get("#qfb-mc-integration-list-error").hide().html(""),l.get("#qfb-mc-integration-list-spinner").show(),b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_get_lists"},dataType:"json"}).done(function(e){if("success"===(e=q.sanitizeResponse(e)).type){for(var t=[new Option(p.pleaseSelect,"")],i=0,n=e.lists.length;i<n;i++)t.push(new Option(e.lists[i].name,e.lists[i].id));l.get("#qfb_mc_integration_list").html(t).show(),q.setSelectVal(l.get("#qfb_mc_integration_list"),o)}else h.onSyncListsFail(e.message)}).fail(function(){h.onSyncListsFail(r.ajaxError)}).always(function(){t=!1,l.get("#qfb-mc-integration-list-spinner").hide()}))},onSyncListsFail:function(e){l.get("#qfb-mc-integration-list-error").html(e).show()},syncFormFields:function(o){if(!c){c=!0,l.get("#qfb_mc_integration_email_element").hide(),l.get("#qfb-mc-integration-email-error").hide().html(""),l.get("#qfb-mc-integration-email-spinner").show();var e=l.get("#qfb_mc_integration_form").val();if(!b.isNumeric(e))return c=!1,void h.onSyncFormFieldsFail(p.pleaseSelectAFormFirst);b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_get_form_email_elements",form_id:e},dataType:"json"}).done(function(e){if("success"===(e=q.sanitizeResponse(e)).type){for(var t=[new Option(p.pleaseSelect,"")],i=0,n=e.elements.length;i<n;i++)t.push(new Option(e.elements[i].label,e.elements[i].name));l.get("#qfb_mc_integration_email_element").html(t).show(),"string"==typeof o&&q.setSelectVal(l.get("#qfb_mc_integration_email_element"),o)}else h.onSyncFormFieldsFail(e.message)}).fail(function(){h.onSyncFormFieldsFail(r.ajaxError)}).always(function(){c=!1,l.get("#qfb-mc-integration-email-spinner").hide()})}},onSyncFormFieldsFail:function(e){l.get("#qfb-mc-integration-email-spinner").hide(),l.get("#qfb-mc-integration-email-error").html(e).show()},syncMergeFields:function(e,t,i){if(!o)return o=!0,l.get("#qfb-mc-merge-fields").hide().html(""),l.get("#qfb-mc-integration-merge-fields-error").hide().html(""),l.get("#qfb-mc-integration-merge-fields-empty").hide(),l.get("#qfb-mc-integration-merge-fields-spinner").show(),b.isNumeric(e)?q.isNonEmptyString(t)?void b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_get_merge_fields",form_id:e,list_id:t},dataType:"json"}).done(function(e){"success"===(e=q.sanitizeResponse(e)).type?(h.currentMergeFieldTags=e.tags,h.rebuildInsertVariableMenuElements(e.elements),h.rebuildMergeFields(i)):h.onSyncMergeFieldsFail(e.message)}).fail(function(){h.onSyncMergeFieldsFail(r.ajaxError)}).always(function(){o=!1,l.get("#qfb-mc-integration-merge-fields-spinner").hide()}):(o=!1,void h.onSyncMergeFieldsFail(p.pleaseSelectAListFirst)):(o=!1,void h.onSyncMergeFieldsFail(p.pleaseSelectAFormFirst))},onSyncMergeFieldsFail:function(e){h.currentMergeFieldTags=[],h.integration.mergeFields=[],l.get("#qfb-mc-integration-merge-fields-spinner").hide(),l.get("#qfb-mc-integration-merge-fields-error").html(e).show()},resyncMergeFields:function(){h.update(),h.syncMergeFields(l.get("#qfb_mc_integration_form").val(),l.get("#qfb_mc_integration_list").val(),h.getValue(h.integration,"mergeFields"))},rebuildMergeFields:function(e){var t=[],i=0,n=e.length;if(0<n){for(;i<n;i++)t.push(h.getMergeFieldHtml(e[i]));l.get("#qfb-mc-merge-fields").html(t).show()}else l.get("#qfb-mc-merge-fields").hide(),l.get("#qfb-mc-integration-merge-fields-empty").show()},getNewMergeField:function(){return{tag:"",value:""}},getMergeFieldHtml:function(e){for(var t=b(p.mergeFieldHtml),i=b('<select class="qfb-mc-merge-field-tag">'),n=[new Option(p.selectAMailchimpTag,"")],o=h.getVariableId(),r=0;r<h.currentMergeFieldTags.length;r++)n.push(new Option(h.currentMergeFieldTags[r].label,h.currentMergeFieldTags[r].tag));return t.find(".qfb-mc-merge-field-column-tag").html(i.html(n)),q.setSelectVal(i,e.tag),t.find(".qfb-mc-merge-field-value").val(e.value).attr("id",o).siblings(".qfb-mc-insert-variable").data("target-id",o),t},getVariableId:function u(){return u.count=u.count||0,"qmc"+ ++u.count},openInsertVariableMenu:function(o){h.closeInsertVariableMenu();var e=l.get("#qfb-mc-insert-variable"),t=e.outerHeight(),i=o.offset().top-a.scrollTop()+o.outerHeight()/2-t/2,n=o.offset().left+o.outerWidth(),r="auto";i<42?i=42:i+t>a.height()-10&&(i="auto",r=10),o.addClass("qfb-mc-active"),e.css({top:i,left:n,bottom:r}).fadeIn(200),l.get("#qfb-mc-integrations-edit-form").one("click.insert-variable",".qfb-mc-variable",function(e){e.preventDefault();var t,i=o.data("target-id"),n=q.toString(b(this).data("tag"))||"";!n.length||(t=b("#"+i)).length&&h.insertAtCursor(t[0],n)}),s.one("click.close-insert-variable",h.closeInsertVariableMenu)},closeInsertVariableMenu:function(){b(".qfb-mc-insert-variable").removeClass("qfb-mc-active"),l.get("#qfb-mc-insert-variable").add(l.get("#qfb-mc-insert-variable-pre-process")).scrollTop(0).hide(),l.get("#qfb-mc-integrations-edit-form").off("click.insert-variable"),s.off("click.close-insert-variable")},insertAtCursor:function(e,t){var i,n,o,r,a;return document.selection?(e.focus(),document.selection.createRange().text=t):e.selectionStart||0===e.selectionStart?(r=e.value,i=e.selectionStart,n=e.selectionEnd,o=e.scrollTop,e.value=r.substring(0,i)+t+r.substring(n,r.length),e.selectionStart=i+t.length,e.selectionEnd=i+t.length,e.scrollTop=o):e.value+=t,e.focus(),document.createEvent?((a=document.createEvent("HTMLEvents")).initEvent("change",!1,!0),e.dispatchEvent(a)):e.fireEvent&&e.fireEvent("onchange"),!0},rebuildInsertVariableMenuElements:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],o=h.shorten(n.label);t.push(b('<div class="qfb-mc-variable">').data({tag:"{element|id:"+n.id+"|"+o+"}",id:n.id}).html([b('<span class="qfb-mc-variable-label">').text(o),b('<span class="qfb-mc-variable-identifier">').text("("+n.identifier+")")]))}l.get("#qfb-mc-insert-variable-element").html(t)},shorten:function(e,t,i){t=t||30,i=i||"...";var n=Math.floor(t/2);return e.length>t&&(e=e.slice(0,n-1)+i+e.slice(-n)),e},getAdminLabel:function(e){return"string"==typeof e.adminLabel&&0<e.adminLabel.length?e.adminLabel:"string"==typeof e.label&&0<e.label.length?e.label:""},getShortenedAdminLabel:function(e){var t=h.shorten(h.getAdminLabel(e));return p.adminLabelElementId.replace("%1$s",t).replace("%2$s",e.identifier)},syncGroups:function(e,a){if(!g){if(g=!0,l.get("#qfb-mc-integration-groups-outer").hide(),l.get("#qfb-mc-integration-groups-error").hide().html(""),l.get("#qfb-mc-integration-groups-spinner").show(),!q.isNonEmptyString(e))return g=!1,void h.onSyncGroupsFail(p.pleaseSelectAListFirst);b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_get_groups",list_id:e},dataType:"json"}).done(function(e){if("success"===(e=q.sanitizeResponse(e)).type){for(var t=[],i=0,n=e.categories.length;i<n;i++){var o=document.createElement("optgroup");o.label=e.categories[i].title;for(var r=0;r<e.categories[i].interests.length;r++)o.appendChild(new Option(e.categories[i].interests[r].name,e.categories[i].interests[r].id));t.push(o)}l.get("#qfb_mc_integration_groups").html(t).val(a).trigger("change"),l.get("#qfb-mc-integration-groups-outer").show()}else h.onSyncGroupsFail(e.message)}).fail(function(){h.onSyncGroupsFail(r.ajaxError)}).always(function(){g=!1,l.get("#qfb-mc-integration-groups-spinner").hide()})}},onSyncGroupsFail:function(e){l.get("#qfb-mc-integration-groups-spinner").hide(),l.get("#qfb-mc-integration-groups-error").html(e).show()},syncLogic:function(e,t,i,n){if(!f){if(f=!0,l.get("#qfb-mc-logic").hide(),l.get("#qfb-mc-logic-error").hide().html(""),l.get("#qfb-mc-integration-logic-spinner").show(),!b.isNumeric(e))return f=!1,void h.onSyncLogicFail(p.pleaseSelectAFormFirst);b.ajax({type:"POST",url:r.ajaxUrl,data:{action:"quform_mc_get_logic_sources",form_id:e},dataType:"json"}).done(function(e){"success"===(e=q.sanitizeResponse(e)).type?(h.currentLogicSources=e.logicSources,h.buildLogic([{text:p.runThisIntegration,value:"1"},{text:p.doNotRunThisIntegration,value:"0"}],[{text:p.ifAllOfTheseRulesMatch,value:"all"},{text:p.ifAnyOfTheseRulesMatch,value:"any"}],n,l.get("#qfb-mc-logic"),t?"1":"0",i)):h.onSyncLogicFail(e.message)}).fail(function(){h.onSyncLogicFail(r.ajaxError)}).always(function(){f=!1,l.get("#qfb-mc-integration-logic-spinner").hide()})}},onSyncLogicFail:function(e){h.resetLogic(),l.get("#qfb-mc-integration-logic-spinner").hide(),l.get("#qfb-mc-logic-error").html(e).show()},buildLogic:function(e,t,i,n,o,r){if(0!==h.currentLogicSources.length){n.empty();var a=b('<div class="qfb-logic-top qfb-settings-row">'),l=b('<div class="qfb-settings-column">'),s=b('<div class="qfb-settings-column">');if(e.length){a.addClass("qfb-settings-row-2");for(var c=b('<select class="qfb-logic-action">'),g=0;g<e.length;g++)c.append(b("<option>",e[g]));q.setSelectVal(c,o),a.append(l.append(c))}for(var f=b('<select class="qfb-logic-match">'),u=0;u<t.length;u++)f.append(b("<option>",t[u]));q.setSelectVal(f,r),a.append(s.append(f)),n.append(a);var d=b('<div class="qfb-logic-rules qfb-cf">');if(i.length)for(var m=0;m<i.length;m++)d.append(h.buildLogicRule(i[m]));else d.append(h.getNoLogicRulesMessage());n.append(d).show()}else n.html(h.buildMessageBox(p.noLogicElements,"warning"))},buildLogicRule:function(e){if(0===h.currentLogicSources.length||"object"!=typeof e)return null;for(var t=b(p.logicRuleHtml).data("rule",e),i=b('<select class="qfb-logic-rule-element">'),n=0;n<h.currentLogicSources.length;n++)i.append(b("<option>",{text:h.getShortenedAdminLabel(h.currentLogicSources[n]),value:h.currentLogicSources[n].id}));q.setSelectVal(i,e.elementId),t.find(".qfb-logic-rule-column-element").html(i);var o=b('<select class="qfb-logic-rule-operator">');return o.append(b("<option>",{text:p.is,value:"eq"})),o.append(b("<option>",{text:p.isNot,value:"neq"})),o.append(b("<option>",{text:p.isEmpty,value:"empty"})),o.append(b("<option>",{text:p.isNotEmpty,value:"not_empty"})),o.append(b("<option>",{text:p.greaterThan,value:"gt"})),o.append(b("<option>",{text:p.lessThan,value:"lt"})),o.append(b("<option>",{text:p.contains,value:"contains"})),o.append(b("<option>",{text:p.startsWith,value:"starts_with"})),o.append(b("<option>",{text:p.endsWith,value:"ends_with"})),q.setSelectVal(o,e.operator),t.find(".qfb-logic-rule-column-operator").html(o),t.find(".qfb-logic-rule-column-value").html(h.buildLogicRuleValues(i.val(),e)),t.on("change",".qfb-logic-rule-element, .qfb-logic-rule-operator",function(){var e={elementId:t.find(".qfb-logic-rule-element").val(),operator:t.find(".qfb-logic-rule-operator").val(),value:"",optionId:null};t.find(".qfb-logic-rule-column-value").html(h.buildLogicRuleValues(i.val(),e))}),t.find(".qfb-small-add-button").click(function(){b(this).closest(".qfb-logic-rule").after(h.buildLogicRule(h.getNewLogicRule()))}),t.find(".qfb-small-remove-button").click(function(){var e=b(this).closest(".qfb-logic-rules");b(this).closest(".qfb-logic-rule").remove(),0===e.find(".qfb-logic-rule").length&&h.getNoLogicRulesMessage().hide().appendTo(e).fadeIn()}),t},buildLogicRuleValues:function(e,t){var i=h.getLogicSourceElementById(parseInt(e,10));if("empty"===t.operator||"not_empty"===t.operator)o=b('<input class="qfb-logic-rule-value" type="hidden">');else if("select"!==i.type&&"radio"!==i.type&&"checkbox"!==i.type&&"multiselect"!==i.type||"eq"!==t.operator&&"neq"!==t.operator)o=b('<input class="qfb-logic-rule-value" type="text">').attr("placeholder",p.enterValue).val(t.value);else{for(var n=0,o=b('<select class="qfb-logic-rule-value">');n<i.options.length;n++)if("select"!==i.type&&"multiselect"!==i.type||"undefined"==typeof i.options[n].options)o.append(b("<option>",{text:h.getShortenedOptionLabel(i.options[n]),value:i.options[n].id}));else{for(var r=b("<optgroup>",{label:h.shorten(i.options[n].label)}),a=0;a<i.options[n].options.length;a++)r.append(b("<option>",{text:h.getShortenedOptionLabel(i.options[n].options[a]),value:i.options[n].options[a].id}));o.append(r)}q.setSelectVal(o,t.optionId)}return o},getLogicSourceElementById:function(e){for(var t=0;t<h.currentLogicSources.length;t++)if(h.currentLogicSources[t].id===e)return h.currentLogicSources[t];return null},getLogicSourceElementOptionById:function(e,t){for(var i=0;i<e.options.length;i++)if("undefined"==typeof e.options[i].options){if(e.options[i].id===t)return e.options[i]}else for(var n=0;n<e.options[i].options.length;n++)if(e.options[i].options[n].id===t)return e.options[i].options[n];return null},getShortenedOptionLabel:function(e){return 0<e.label.length?h.shorten(e.label):h.shorten(e.value)},getLogicRules:function(e){var t=[];return e.find(".qfb-logic-rule").each(function(){t.push(h.getLogicRuleObjectFromValues(b(this)))}),t},getLogicRuleObjectFromValues:function(e){var t,i,n=e.find(".qfb-logic-rule-value"),o=e.find(".qfb-logic-rule-element").val(),r=n.val(),a=null;return n.is("select")&&(!(t=h.getLogicSourceElementById(parseInt(o,10)))||(i=h.getLogicSourceElementOptionById(t,parseInt(r,10)))&&(a=r,r=i.value)),{elementId:o,operator:e.find(".qfb-logic-rule-operator").val(),optionId:a,value:r}},getNewLogicRule:function(){return{elementId:"",operator:"eq",value:"",optionId:null}},getNoLogicRulesMessage:function(){return h.buildMessageBox(p.noLogicRules,"info","qfb-no-logic-rules")},resetLogic:function(){l.get("#qfb-mc-logic").find(".qfb-logic-action").val("1"),l.get("#qfb-mc-logic").find(".qfb-logic-match").val("all"),l.get("#qfb-mc-logic").find(".qfb-logic-rules").empty()},resyncLogic:function(){h.update(),h.syncLogic(h.getValue(h.integration,"formId"),h.getValue(h.integration,"logicAction"),h.getValue(h.integration,"logicMatch"),h.getValue(h.integration,"logicRules"))},buildMessageBox:function(e,t,i){var n=b('<div class="qfb-message-box qfb-message-box-'+(t=t||"info")+'">').append(b('<div class="qfb-message-box-inner">').text(e));return i&&n.addClass(i),n},getValue:function(e,t){return q.getProperty(e,t,q.getProperty(p.defaultIntegrationConfig,t))}};return e.mailchimp=e.mailchimp||{},e.mailchimp.edit=h,e}(quform,jQuery,quformMailchimpIntegrationsEditL10n,quformCoreL10n);