var quform=function(e,t,n,i){"use strict";var o=e.core,a=o.cache,s=t(document),r=!1,c=!1,d={init:function(){"#add"===window.location.hash&&d.showAddNewPopup(),a.get(".qfb-tabs-nav-mailchimp-add-integration").click(function(e){e.preventDefault(),d.showAddNewPopup()}),a.get("#qfb-add-new-mc-integration-popup").find(".qfb-popup-close-button").click(d.hideAddNewPopup),a.get("#qfb-add-new-mc-integration-submit").click(d.addNew),a.get("#qfb-add-new-mc-integration-name").keyup(function(e){13===e.keyCode&&a.get("#qfb-add-new-mc-integration-submit").click()}),a.get("#the-list").find(".column-shortcode input").on("click",function(){t(this).focus().select()}),a.get("#the-list").find(".delete a").click(function(){return confirm(n.singleConfirmDelete)}),t("#doaction").click(function(){return 0<t('input[name="ids[]"]:checked').length&&("delete"===t("#bulk-action-selector-top").val()?confirm(n.pluralConfirmDelete):void 0)}),t("#doaction2").click(function(){return 0<t('input[name="ids[]"]:checked').length&&("delete"===t("#bulk-action-selector-bottom").val()?confirm(n.pluralConfirmDelete):void 0)}),a.get("#qfb-show-mc-integration-table-settings").click(function(){d.showTableSettings()}),a.get("#qfb-mc-integrations-table-settings").find(".qfb-popup-save-button").click(function(){d.saveTableSettings()}),a.get("#qfb-mc-integrations-table-settings").find(".qfb-popup-close-button").click(function(){d.hideTableSettings()}),a.get("#qfb-mc-integrations-table-settings").find(".qfb-popup-overlay").click(function(){d.hideTableSettings()}),a.get("#qfb_mailchimp_integrations_per_page").on("keyup",function(e){e.keyCode&&13===e.keyCode&&d.saveTableSettings()})},showAddNewPopup:function(){s.on("keydown.quform-close-popup",function(e){27===e.keyCode&&d.hideAddNewPopup()}),a.get("body").css("overflow","hidden"),a.get("#qfb-add-new-mc-integration-popup").show(),a.get("#qfb-add-new-mc-integration-name").focus()},hideAddNewPopup:function(){s.off("keydown.quform-close-popup"),a.get("#qfb-add-new-mc-integration-popup").hide(),a.get("body").css("overflow","")},addNew:function(){r||(r=!0,a.get("#qfb-add-new-mc-integration-loading").css({opacity:1}),t.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_mc_add_integration",_ajax_nonce:n.addNewNonce,name:a.get("#qfb-add-new-mc-integration-name").val()},dataType:"json"}).done(function(e){"success"!==(e=o.sanitiseResponse(e)).type?(a.get("#qfb-add-new-mc-integration-popup").find(".qfb-validation-error").remove(),r=!1,"error"!==e.type&&"invalid"!==e.type||d.onAddFail(e)):window.location=e.url}).fail(function(){a.get("#qfb-add-new-mc-integration-popup").find(".qfb-validation-error").remove(),r=!1,d.onAddFail({message:i.ajaxError})}).always(function(){a.get("#qfb-add-new-mc-integration-loading").css({opacity:0})}))},onAddFail:function(e){var i;o.isNonEmptyString(e.message)&&o.showFixedMessage(n.errorAdding+"<br>"+e.message,"error"),e.errors&&t.each(e.errors,function(e,t){var n=a.get("#"+e).closest(o.settingInputWrap);i=i||n,o.addValidationError(n,t)}),i&&o.scrollTo(i,a.get("#qfb-add-new-mc-integration-popup-inner"))},showTableSettings:function(){a.get("body").css("overflow","hidden"),a.get("#qfb-mc-integrations-table-settings").show()},hideTableSettings:function(){a.get("body").css("overflow",""),a.get("#qfb-mc-integrations-table-settings").hide(),a.get("#qfb-mc-integrations-table-settings").find(".qfb-submission-error").remove(),a.get("#qfb-mc-integrations-table-settings").find(".qfb-validation-error").remove()},saveTableSettings:function(){c||(c=!0,a.get("#qfb-mc-integrations-table-settings").find(".qfb-submission-error").remove(),a.get("#qfb-mc-integrations-table-settings").find(".qfb-validation-error").remove(),t.ajax({url:i.ajaxUrl,type:"POST",dataType:"json",data:{action:"quform_mc_save_integrations_table_settings",_ajax_nonce:n.saveTableSettingsNonce,per_page:a.get("#qfb_mailchimp_integrations_per_page").val()}}).done(function(e){var i;e=o.sanitiseResponse(e),c=!1,"success"===e.type?window.location.reload():"error"!==e.type&&"invalid"!==e.type||(i=[],e.message&&i.push(o.addSubmissionError(a.get("#qfb-mc-integrations-table-settings").find(".qfb-settings"),e.message)),e.errors&&t.each(e.errors,function(e,t){var n=a.get("#"+e).closest(o.settingInputWrap);o.addValidationError(n,t),i.push(n)}),i.length&&o.scrollTo(i[0],a.get("#qfb-mc-integrations-table-settings-inner")))}).fail(function(){o.scrollTo(o.addSubmissionError(a.get("#qfb-mc-integrations-table-settings").find(".qfb-settings"),i.ajaxError),a.get("#qfb-mc-integrations-table-settings-inner")),c=!1}))}};return t(d.init),e.mailchimp=e.mailchimp||{},e.mailchimp.list=d,e}(quform,jQuery,quformMailchimpIntegrationsListL10n,quformCoreL10n);