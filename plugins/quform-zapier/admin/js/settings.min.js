var quform=function(e,a,n,i){"use strict";var s=e.core,t=s.cache,o=a(window),r=!1,l=null,c=!1,f={init:function(){t.get("#qfb-zapier-settings-form").submit(function(){return!1}),t.get("#qfb-zapier-save-settings").add(t.get("#qfb-fixed-save-button")).click(function(){f.saveSettings()}),a(".qfb-permissions-role-name").click(function(){a(this).closest(".qfb-table-row").find(".qfb-permissions-capability").each(function(){this.checked=!this.checked})}),t.get("#qfb_zapier_uninstall_confirm").change(function(){t.get("#qfb-zapier-do-uninstall").closest(s.settingWrap)[this.checked?"qfbSlideShow":"qfbSlideHide"]()}),t.get("#qfb-zapier-do-uninstall").click(f.uninstallPlugin)},saveSettings:function(){r||(r=!0,t.get("#qfb-settings-save-loading").show().animate({maxWidth:"43px"}),"number"==typeof l&&(clearTimeout(l),l=null),t.get("#qfb-fixed-save-button").removeClass("qfb-saving qfb-saved qfb-save-error").addClass("qfb-saving"),a.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_zapier_save_settings",_ajax_nonce:n.saveSettingsNonce,options:JSON.stringify(f.getSettings())},dataType:"json"}).done(function(e){"success"===(e=s.sanitizeResponse(e)).type?f.onSaveSuccess():f.onSaveError(e.message)}).fail(function(){f.onSaveError(i.ajaxError)}).always(function(){r=!1,t.get("#qfb-settings-save-loading").css({maxWidth:0}).hide()}))},getSettings:function(){var s={enabled:t.get("#qfb_zapier_enabled").is(":checked"),permissions:{}};return a(".qfb-permissions-capability").each(function(){var e=a(this),n=e.data("role"),i=e.data("capability");"undefined"==typeof s.permissions[n]&&(s.permissions[n]={}),s.permissions[n][i]=e.is(":checked")}),s},onSaveSuccess:function(){s.showFixedMessage(n.settingsSaved,"success"),t.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-saved"),l=setTimeout(function(){t.get("#qfb-fixed-save-button").removeClass("qfb-saved")},2e3)},onSaveError:function(e){s.showFixedMessage(n.errorSavingSettings+"<br>"+e,"error"),t.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error"),l=setTimeout(function(){t.get("#qfb-fixed-save-button").removeClass("qfb-save-error")},2e3)},uninstallPlugin:function(){c||(c=!0,t.get("#qfb_zapier_uninstall_confirm").is(":checked")&&confirm(n.uninstallAreYouSure)?(t.get("#qfb-zapier-uninstall-loading").css({opacity:1}),a.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_zapier_uninstall_plugin",_ajax_nonce:n.uninstallPluginNonce},dataType:"json"}).done(function(e){"success"===(e=s.sanitizeResponse(e)).type?window.location=n.pluginsUrl:"error"!==e.type&&"invalid"!==e.type||f.onUninstallPluginFail(e.message,"error")}).fail(function(){f.onUninstallPluginFail(i.ajaxError)}).always(function(){t.get("#qfb-zapier-uninstall-loading").css({opacity:0}),c=!1})):c=!1)},onUninstallPluginFail:function(e){s.showFixedMessage(n.errorUninstalling+"<br>"+e,"error")}};return a(f.init),o.on("load",f.onWindowLoad),e.settings=f,e}(quform||{},jQuery,quformZapierSettingsL10n,quformCoreL10n);