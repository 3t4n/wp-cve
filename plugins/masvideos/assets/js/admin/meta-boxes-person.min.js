jQuery(function(s){function t(t){var e=s(t).next().is(".hasDatepicker")?"minDate":"maxDate",a="minDate"==e?s(t).next():s(t).prev(),i=s(t).datepicker("getDate");s(a).datepicker("option",e,i),s(t).change()}s(function(){s('[id$="-all"] > ul.categorychecklist').each(function(){var t=s(this),e=t.find(":checked").first();if(e.length){var a=t.find("input").position().top,i=e.position().top;t.closest(".tabs-panel").scrollTop(i-a+5)}})}),s("#upsell_person_data").bind("keypress",function(t){if(13===t.keyCode)return!1}),s(".type_box").appendTo("#masvideos-person-data .handle span"),s(".person_date_picker").each(function(){s(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){t(s(this))}}),s(this).find("input").each(function(){t(s(this))})});var e,a=s(".person_attributes").find(".masvideos_attribute").get();function n(){s(".person_attributes .masvideos_attribute").each(function(t,e){s(".attribute_position",e).val(parseInt(s(e).index(".person_attributes .masvideos_attribute"),10))})}a.sort(function(t,e){var a=parseInt(s(t).attr("rel"),10),i=parseInt(s(e).attr("rel"),10);return a<i?-1:i<a?1:0}),s(a).each(function(t,e){s(".person_attributes").append(e)}),s(".person_attributes .masvideos_attribute").each(function(t,e){"none"!==s(e).css("display")&&s(e).is(".taxonomy")&&s("select.attribute_taxonomy").find('option[value="'+s(e).data("taxonomy")+'"]').attr("disabled","disabled")}),s("button.add_attribute_person").on("click",function(){var t=s(".person_attributes .masvideos_attribute").length,e=s("select.attribute_taxonomy").val(),a=s(this).closest("#person_attributes"),i=a.find(".person_attributes"),o={action:"masvideos_add_attribute_person",taxonomy:e,i:t,security:masvideos_admin_meta_boxes.add_attribute_person_nonce};return a.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.post(masvideos_admin_meta_boxes.ajax_url,o,function(t){i.append(t),s(document.body).trigger("masvideos-enhanced-select-init"),n(),a.unblock(),s(document.body).trigger("masvideos_added_attribute_person")}),e&&(s("select.attribute_taxonomy").find('option[value="'+e+'"]').attr("disabled","disabled"),s("select.attribute_taxonomy").val("")),!1}),s(".person_attributes").on("blur","input.attribute_name",function(){s(this).closest(".masvideos_attribute").find("strong.attribute_name").text(s(this).val())}),s(".person_attributes").on("click","button.select_all_attributes",function(){return s(this).closest("td").find("select option").attr("selected","selected"),s(this).closest("td").find("select").change(),!1}),s(".person_attributes").on("click","button.select_no_attributes",function(){return s(this).closest("td").find("select option").removeAttr("selected"),s(this).closest("td").find("select").change(),!1}),s(".person_attributes").on("click",".remove_row",function(){if(window.confirm(masvideos_admin_meta_boxes.remove_attribute)){var t=s(this).parent().parent();t.is(".taxonomy")?(t.find("select, input[type=text]").val(""),t.hide(),s("select.attribute_taxonomy").find('option[value="'+t.data("taxonomy")+'"]').removeAttr("disabled")):(t.find("select, input[type=text]").val(""),t.hide(),n())}return!1}),s(".person_attributes").sortable({items:".masvideos_attribute",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),n()}}),s(".person_attributes").on("click","button.add_new_attribute",function(){s(".person_attributes").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e=s(this).closest(".masvideos_attribute"),t=e.data("taxonomy"),a=window.prompt(masvideos_admin_meta_boxes.new_attribute_prompt);if(a){var i={action:"masvideos_add_new_attribute_person",taxonomy:t,term:a,security:masvideos_admin_meta_boxes.add_attribute_person_nonce};s.post(masvideos_admin_meta_boxes.ajax_url,i,function(t){t.error?window.alert(t.error):t.slug&&(e.find("select.attribute_values").append('<option value="'+t.term_id+'" selected="selected">'+t.name+"</option>"),e.find("select.attribute_values").change()),s(".person_attributes").unblock()})}else s(".person_attributes").unblock();return!1}),s(".save_attributes_person").on("click",function(){s("#masvideos-person-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var t={post_id:masvideos_admin_meta_boxes.post_id,data:s(".person_attributes").find("input, select, textarea").serialize(),action:"masvideos_save_attributes_person",security:masvideos_admin_meta_boxes.save_attributes_person_nonce};s.post(masvideos_admin_meta_boxes.ajax_url,t,function(){var t=window.location.toString();t=t.replace("post-new.php?","post.php?post="+masvideos_admin_meta_boxes.post_id+"&action=edit&"),s("#masvideos-person-data").unblock()})});var o=s("#person_image_gallery"),r=s("#person_images_container").find("ul.person_images");s(".add_person_images").on("click","a",function(t){var i=s(this);t.preventDefault(),e||(e=wp.media.frames.person_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},library:{type:["image"]},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var t=e.state().get("selection"),a=o.val();t.map(function(t){if((t=t.toJSON()).id){a=a?a+","+t.id:t.id;var e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;r.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+e+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),o.val(a)}),e.open()}),r.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"masvideos-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")},update:function(){var e="";s("#person_images_container").find("ul li.image").css("cursor","default").each(function(){var t=s(this).attr("data-attachment_id");e=e+t+","}),o.val(e)}}),s("#person_images_container").on("click","a.delete",function(){s(this).closest("li.image").remove();var e="";return s("#person_images_container").find("ul li.image").css("cursor","default").each(function(){var t=s(this).attr("data-attachment_id");e=e+t+","}),o.val(e),s("#tiptip_holder").removeAttr("style"),s("#tiptip_arrow").removeAttr("style"),!1})});