"use strict";(self.webpackChunkmaxi_blocks=self.webpackChunkmaxi_blocks||[]).push([[193],{90193:function(e,t,a){a.r(t);var n=a(4942),l=a(70885),s=a(69307),r=(a(99196),a(65736)),c=a(9818),i=a(52175),o=a(69771),u=a(55609),d=a(92819),m=a(40684),v=a(86434),_=a(79165),b=a(40771),y=a(4271),f=a(19848);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var g=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,87570))})),x=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,26141))})),C=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,46006))})),h=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,86799))})),k=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,38207))})),E=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,22648))})),S=(0,m.ZP)((function(){return a.e(2878).then(a.bind(a,92878))})),N=(0,m.ZP)((function(){return Promise.resolve().then(a.bind(a,27910))})),O=(0,s.forwardRef)((function(e,t){var a,m,O=e.styleCards,j=e.setIsVisible,Z=(0,c.useSelect)((function(e){var t=(0,e("core/editor").getEditorSettings)().isRTL,a=(0,e("maxiBlocks").receiveMaxiDeviceType)(),n=e("maxiBlocks/style-cards"),l=n.receiveStyleCardsList,s=n.receiveMaxiActiveStyleCard,r=n.receiveSavedMaxiStyleCards,c=n.receiveMaxiSelectedStyleCard,i=l(),o=s(),u=o.key,d=o.value,m=r(),v=c();return{isRTL:t,breakpoint:a,SCList:i,activeSCKey:u,activeStyleCard:o,activeSCValue:d,savedStyleCards:m,selectedSCKey:v.key,selectedSCValue:v.value}})),w=Z.isRTL,P=Z.breakpoint,A=Z.SCList,M=Z.activeSCKey,D=Z.activeSCValue,T=Z.activeStyleCard,K=Z.savedStyleCards,L=Z.selectedSCKey,V=Z.selectedSCValue,B=(0,c.useDispatch)("maxiBlocks/style-cards"),I=B.saveMaxiStyleCards,W=B.setActiveStyleCard,R=B.removeStyleCard,U=B.setSelectedStyleCard,F=B.saveSCStyles,q=(0,s.useState)("".concat(null==D?void 0:D.name," - ")),z=(0,l.Z)(q,2),G=z[0],J=z[1],$=(0,s.useState)("light"),H=(0,l.Z)($,2),Q=H[0],X=H[1],Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V;return"user"===(null==e?void 0:e.type)},ee=(0,s.useState)(!Y()),te=(0,l.Z)(ee,2),ae=te[0],ne=te[1],le=(0,s.useState)(!1),se=(0,l.Z)(le,2),re=se[0],ce=se[1],ie=(0,s.useState)((0,v.WM)(T,4)),oe=(0,l.Z)(ie,2),ue=oe[0],de=oe[1];(0,s.useEffect)((function(){if(V){(0,_.oK)(V,ue),J("".concat(null==V?void 0:V.name," - "));var e=Y();ne(!e),ce(!1)}}),[L]);var me=function(e){var t,a,n,l,s={light:O[e].light.styleCard,dark:O[e].dark.styleCard},r={light:null===(t=K[e])||void 0===t?void 0:t.light.styleCard,dark:null===(a=K[e])||void 0===a?void 0:a.dark.styleCard};return!(0,d.isEqual)(s,r)||(null===(n=O[e])||void 0===n?void 0:n.gutenberg_blocks_status)!==(null===(l=K[e])||void 0===l?void 0:l.gutenberg_blocks_status)},ve=function(e,t){var a=Object.assign({},V),s="typography"===Object.keys(e)[0],r=(0,b.fN)({obj:s?e.typography:e,attributes:Object.assign({},V[Q].defaultStyleCard[t],V[Q].styleCard[t]),defaultAttributes:V[Q].defaultStyleCard[t],onChange:function(e){return e},isStyleCard:!0});Object.entries(r).forEach((function(e){var r,c,i=(0,l.Z)(e,2),o=i[0],u=i[1];s&&(0,d.isNil)(u)&&(null===(r=V[Q].styleCard)||void 0===r||null===(c=r[t])||void 0===c||delete c[o]),a=Object.assign({},a,(0,n.Z)({},Q,Object.assign({},a[Q],{styleCard:Object.assign({},a[Q].styleCard,(0,n.Z)({},t,Object.assign({},a[Q].styleCard[t],(0,n.Z)({},o,u))))})))}));var c=Object.assign({},O,(0,n.Z)({},L,Object.assign({},a)));I(c),(0,_.oK)(a,ue)},_e=(0,s.useState)(),be=(0,l.Z)(_e,1)[0],ye=function(e){var t="sc_".concat((new Date).getTime()),a=(0,d.cloneDeep)(null==y?void 0:y.sc_maxi),l=(0,d.cloneDeep)(e),s=(0,d.merge)(a,l),r=Object.assign({},O,(0,n.Z)({},t,s));I(r,!0),(0,_.oK)(e,ue),U(t)},fe=(0,s.useRef)();(0,s.useEffect)((function(){var e,t;null==fe||null===(e=fe.current)||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}),[re]);var pe,ge=(0,s.useState)(!1),xe=(0,l.Z)(ge,2),Ce=xe[0],he=xe[1],ke=(0,s.useState)(!1),Ee=(0,l.Z)(ke,2),Se=Ee[0],Ne=Ee[1],Oe=(0,o.date)(null===(a=(0,o.getSettings)())||void 0===a||null===(m=a.formats)||void 0===m?void 0:m.date),je=(pe=[],!(0,d.isEmpty)(O)&&Object.entries(O).map((function(e,t){var a=(0,l.Z)(e,2),n=a[0],s=a[1];return"user"!==(null==s?void 0:s.type)?pe.push({label:"".concat((0,r.__)("Template","maxi-blocks"),": ").concat(s.name),value:n,status:null==s?void 0:s.status,selected:(null==s?void 0:s.selected)||!1}):(0,d.isEmpty)(null==s?void 0:s.updated)?pe.push({label:"".concat(s.name),value:n,status:null==s?void 0:s.status,selected:(null==s?void 0:s.selected)||!1}):pe.push({label:"".concat(s.name," - ").concat(s.updated),value:n,status:null==s?void 0:s.status,selected:(null==s?void 0:s.selected)||!1}),null})),pe.sort((function(e,t){var a,n;return null!=e&&null!==(a=e.label)&&void 0!==a&&a.includes("Template:")?1:null!=t&&null!==(n=t.label)&&void 0!==n&&n.includes("Template:")||e<t?-1:1})).sort((function(e,t){var a,n,l,s;if(null!=e&&null!==(a=e.label)&&void 0!==a&&a.includes("Template:")||null!=t&&null!==(n=t.label)&&void 0!==n&&n.includes("Template:"))return null;var r=null==e||null===(l=e.label)||void 0===l?void 0:l.split("- ").pop(),c=null==t||null===(s=t.label)||void 0===s?void 0:s.split("- ").pop();return Date.parse(r)&&Date.parse(c)?new Date(c)-new Date(r):null}))),Ze=je[function(e){var t="";return e.forEach((function(e,a){e.selected&&(t=a)})),t}(je)],we=je[function(e){var t="";return e.forEach((function(e,a){"active"===e.status&&(t=a)})),t}(je)];return!(0,d.isEmpty)(O)&&(0,s.createElement)(u.Popover,{anchor:t.current,noArrow:!0,resize:!0,position:w?"bottom left right":"bottom right left",className:"maxi-style-cards__popover maxi-sidebar",focusOnMount:!0,strategy:"fixed"},(0,s.createElement)("div",{className:"active-style-card"},(0,s.createElement)("div",{className:"active-style-card_icon"},(0,s.createElement)(C,{icon:f.iSl})),(0,s.createElement)("div",{className:"active-style-card_title"},(0,s.createElement)("span",null,(0,r.__)("Active style card","maxi-blocks")),(0,s.createElement)("h2",{className:"maxi-style-cards__popover__title"},T.value.name,be&&(0,s.createElement)("span",null,"| ",be))),(0,s.createElement)("span",{className:"maxi-responsive-close has-tooltip",onClick:function(){return j(!1)}},(0,s.createElement)("span",{className:"tooltip"},(0,r.__)("Close","maxi-blocks")),(0,s.createElement)(C,{icon:f.UFW}))),(0,s.createElement)("div",{className:"maxi-style-cards__sc"},(0,s.createElement)("div",{className:"maxi-style-cards__sc__more-sc"},(0,s.createElement)(N,{type:"sc"}),(0,s.createElement)(i.MediaUploadCheck,null,(0,s.createElement)(i.MediaUpload,{onSelect:function(e){fetch(e.url).then((function(e){return e.json()})).then((function(e){return JSON.parse(e)})).then((function(e){A.map((function(e){return e.label})).filter((function(e){return e})).indexOf(e.name)<0?(ye(e),Ne(!1),he(!1)):Ne(!0)})).catch((function(e){console.error(e)}))},allowedTypes:"text",render:function(e){var t=e.open;return(0,s.createElement)(g,{className:"maxi-style-cards__sc__ie--import",onClick:t},(0,r.__)("Import","maxi-blocks"))}})),(0,s.createElement)("div",{className:"maxi-style-cards__sc__ie"},(0,s.createElement)(g,{className:"maxi-style-cards__sc__ie--export",disabled:!1,onClick:function(){var e="".concat(V.name,"_exported.txt");(0,v.i8)(Object.assign({},V,{name:"".concat(V.name," exported"),status:""}),e)}},(0,r.__)("Export","maxi-blocks")))),(0,s.createElement)("div",{className:"maxi-style-cards__active-edit"},(0,s.createElement)("div",{className:"maxi-style-cards__active-edit-title"},(0,s.createElement)("h3",null,(0,r.__)("Style card editor","maxi-blocks")),(0,s.createElement)("span",null,(0,r.__)("Preview, edit or activate style card","maxi-blocks"))),Se&&(0,s.createElement)("div",{className:"maxi-style-cards__card-already-exists"},(0,s.createElement)("span",null,(0,r.__)("Imported card already exists.","maxi-blocks"))),(0,s.createElement)("div",{className:"maxi-style-cards__active-edit-options"},(0,s.createElement)("div",{className:"maxi-style-cards__sc__more-sc--select"},(0,s.createElement)(E,{options:je,value:Ze||we,placeholder:(0,r.__)("Type to searchâ€¦","maxi-blocks"),onChange:function(e){var t=null==e?void 0:e.value;U(t);var a=null==O?void 0:O[t];!Y(a)&&function(){var e=document.getElementsByClassName("maxi-style-cards__settings")[0],t=null==e?void 0:e.getElementsByClassName("maxi-accordion-control__item");if(!t||(0,d.isEmpty)(t))return null;var a,n=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){c=!0,s=e},f:function(){try{r||null==a.return||a.return()}finally{if(c)throw s}}}}(t);try{for(n.s();!(a=n.n()).done;){var l;null===(l=a.value.querySelector("[aria-expanded=true]"))||void 0===l||l.click()}}catch(e){n.e(e)}finally{n.f()}}()},hideSelectedOptions:!0,noOptionsMessage:function(){return null}})),(0,s.createElement)(x,{message:(0,r.__)("Deleting".concat(" ".concat(V.name," "),"style card. This action is permanent."),"maxi-blocks"),cancelLabel:(0,r.__)("Cancel","maxi-blocks"),confirmLabel:(0,r.__)("Delete","maxi-blocks"),onConfirm:function(){R(L),M===L&&W("sc_maxi")},buttonDisabled:!function(e,t){return"sc_maxi"!==e&&e!==t}(L,M),buttonClassName:"maxi-style-cards__sc__more-sc--delete has-tooltip",buttonChildren:(0,s.createElement)(s.Fragment,null,(0,s.createElement)("span",{className:"tooltip"},(0,r.__)("Delete","maxi-blocks")),(0,s.createElement)(C,{icon:f.E58}))}))),(0,s.createElement)("div",{className:"maxi-style-cards__sc__actions edit-activate"},(0,s.createElement)(g,{className:"maxi-style-cards-customise-card-button",onClick:function(){return ce(!re)}},ae&&(0,r.__)("Customise card","maxi-blocks"),!ae&&(0,r.__)("Copy card","maxi-blocks")),!ae&&(0,s.createElement)(g,{className:"maxi-style-cards__sc__actions--save",disabled:!me(L),onClick:function(){var e="active"===(null==V?void 0:V.status),t=Object.assign({},O,(0,n.Z)({},L,Object.assign({},V,{status:e?"active":""})));e&&(de((0,v.WM)(V,4)),(0,_.oK)(V,(0,v.WM)(V,4))),I(t,!0),F(e)}},(0,r.__)("Save changes","maxi-blocks")),(0,s.createElement)(x,{message:(0,r.__)("Activate new style. Customized blocks will not change. All other Maxi blocks will get new,".concat(' "'.concat(V.name,'" '),"styles."),"maxi-blocks"),cancelLabel:(0,r.__)("Cancel","maxi-blocks"),confirmLabel:(0,r.__)("Activate","maxi-blocks"),onConfirm:function(){W(L),I(V),(0,_.oK)(V,(0,v.WM)(V,4)),de((0,v.WM)(V,4));var e=(0,d.cloneDeep)(O);Object.entries(e).forEach((function(t){var a=(0,l.Z)(t,2),n=a[0],s=a[1];e[n]=n===L?Object.assign({},s,{status:"active"}):Object.assign({},s,{status:""})})),I(e,!0),F(!0)},buttonDisabled:!function(e,t){return!(!me(e)&&e===t)}(L,M),buttonClassName:"maxi-style-cards__sc__actions--apply",buttonChildren:(0,s.createElement)(s.Fragment,null,(ae||!me(L))&&(0,r.__)("Activate now","maxi-blocks"),!ae&&me(L)&&(0,r.__)("Save and activate now","maxi-blocks"))})),!ae&&(0,s.createElement)(k,{label:(0,r.__)("Affect Gutenberg native blocks inside MaxiBlocks","maxi-blocks"),selected:V.gutenberg_blocks_status,onChange:function(e){return function(e){var t=Object.assign({},O,(0,n.Z)({},L,Object.assign({},V,{gutenberg_blocks_status:e})));I(t),(0,_.oK)(t[L],ue)}(e)}})),(0,s.createElement)("div",{className:"maxi-style-cards__sc maxi-style-cards__settings"},re&&(0,s.createElement)("div",{className:"maxi-style-cards__sc-custom-name"},(0,s.createElement)("h3",null,(0,r.__)("Create new style from","maxi-blocks"),(0,s.createElement)("b",null," ",V.name)),(0,s.createElement)("div",{className:"maxi-style-cards__sc__save"},(0,s.createElement)("input",{type:"text",maxLength:"35",placeholder:(0,r.__)("Short memorable name*","maxi-blocks"),value:G,onChange:function(e){J(e.target.value),he(!1)},ref:fe}),(0,s.createElement)(g,{disabled:(0,d.isEmpty)(G),onClick:function(){if(A.map((function(e){return e.label})).filter((function(e){return e})).indexOf(G)>=0)he(!0);else{he(!1),Ne(!1);var e={name:G,status:"",gutenberg_blocks_status:!("gutenberg_blocks_status"in V)||V.gutenberg_blocks_status,dark:{defaultStyleCard:Object.assign({},V.dark.defaultStyleCard,V.dark.styleCard),styleCard:{}},light:{defaultStyleCard:Object.assign({},V.light.defaultStyleCard,V.light.styleCard),styleCard:{}},type:"user",updated:Oe};ye(e),ce(!1)}}},(0,r.__)("Create","maxi-blocks")),(0,s.createElement)(g,{onClick:function(){return ce(!1)}},(0,r.__)("Cancel","maxi-blocks"))),Ce&&(0,s.createElement)("div",{className:"maxi-style-cards__card-already-exists create-new-section"},(0,s.createElement)("span",null,(0,r.__)("A card with this name already exists.")))),(0,s.createElement)("div",{className:ae?"maxi-style-card-settings-disabled":"maxi-style-card-settings"},(0,s.createElement)(h,{disablePadding:!0,returnValue:function(e){var t=e.key;return X(t)},items:[{label:(0,r.__)("Light tone globals","maxi-blocks"),key:"light",content:(0,s.createElement)(S,{SC:V.light,SCStyle:"light",onChangeValue:ve,breakpoint:P,currentKey:L})},{label:(0,r.__)("Dark tone globals","maxi-blocks"),key:"dark",content:(0,s.createElement)(S,{SC:V.dark,SCStyle:"dark",onChangeValue:ve,breakpoint:P,currentKey:L})}]}))))}));t.default=O}}]);