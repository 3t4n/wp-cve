!function(e){"use strict";var t="",i={initialize:function(){e(".wphr-hr-leave-policy").on("click","a#wphr-leave-policy-new",this,this.policy.create),e(".wphr-hr-leave-policy").on("click","a.link, span.edit a",this,this.policy.edit),e(".wphr-hr-leave-policy").on("click","a.submitdelete",this,this.policy.remove),e("body").on("change","#wphr-hr-leave-req-from-date, #wphr-hr-leave-req-to-date",this,this.leave.requestDates),e("body").on("change","#wphr-hr-leave-req-from-time, #wphr-hr-leave-req-to-time",this,this.leave.requestTimes),e("body").on("change","#from-time",this,this.leave.toTimes),e("body").on("change","#wphr-hr-leave-req-employee-id",this,this.leave.setPolicy),e("body").on("change","#wphr-hr-leave-req-leave-policy",this,this.leave.setAvailableDays),e(".hrm-dashboard, .leads-actions").on("click",".wphr-hr-new-leave-request-wrap a#wphr-hr-new-leave-req",this.leave.takeLeave),e(".wphr-employee-single").on("submit","form#wphr-hr-empl-leave-history",this.leave.showHistory),e("body").on("click","#wphr-hr-leave-houly-req",this.leave.show_timeslots),e("body").on("click",".hourly_leave_handler",this.leave.show_timeslots2),e(".entitlement-list-table").on("click","a.submitdelete",this,this.entitlement.remove),e(".wphr-hr-holiday-wrap").on("click","a#wphr-hr-new-holiday",this,this.holiday.create),e(".wphr-hr-holiday-wrap").on("click",".wphr-hr-holiday-edit",this,this.holiday.edit),e(".wphr-hr-holiday-wrap").on("click",".wphr-hr-holiday-delete",this,this.holiday.remove),e("body").on("change",".wphr-hr-holiday-date-range",this,this.holiday.checkRange),e(".wphr-hr-holiday-by-location-wrap").on("click","a#wphr-hr-new-holiday-by-location",this,this.holiday.createByLocation),e(".wphr-hr-holiday-by-location-wrap").on("click",".wphr-hr-holiday-by-location-edit",this,this.holiday.editByLocation),e(".wphr-hr-holiday-by-location-wrap").on("click",".wphr-hr-holiday-by-location-delete",this,this.holiday.remove),e("body").on("change",".wphr-hr-holiday-by-location-date-range",this,this.holiday.checkRange),e(".wphr-hr-holiday-wrap").on("click","#wphr-hr-import-ical",this,this.importICalInit),e(".wphr-hr-holiday-wrap").on("change","#wphr-ical-input",this,this.uploadICal),e(".wphr-hr-leave-requests").on("click",".wphr-hr-leave-reject-btn",this,this.leave.reject),e(".wphr-hr-holiday-by-location-wrap").on("click","#wphr-hr-import-ical-by-location",this,this.importICalInit_byLocation),e("body").on("change","#wphr-hr-import-by-location",this,this.uploadICal_byLocation),this.initDateField()},initToggleCheckbox:function(){var t=!1;e("tbody").children().children(".check-column").find(":checkbox").click(function(i){if("undefined"==i.shiftKey)return!0;if(i.shiftKey){if(!t)return!0;checks=e(t).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(t),last=checks.index(this),checked=e(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!e(this).closest("tr").is(":visible")&&checked}))}t=this;var a=e(this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return e(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===a.length}),!0}),e("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(t){var i=e(this),a=i.closest("table"),r=i.prop("checked"),o=t.shiftKey||i.data("wp-toggle");a.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!e(this).is(":hidden,:disabled")&&(o?!e(this).prop("checked"):!!r)}),a.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!o&&!!r})})},initDateField:function(){e(".wphr-leave-date-field").datepicker({dateFormat:wpHr.date_format,changeMonth:!0,changeYear:!0}),e(".wphr-leave-time-field").timepicker({showDuration:!0,timeFormat:"g:ia",minTime:"8:00am",maxTime:"11:30pm"}),e(".wphr-leave-date-picker-from").datepicker({dateFormat:wpHr.date_format,changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(t){e(".wphr-leave-date-picker-to").datepicker("option","minDate",t)}}),e(".wphr-leave-date-picker-to").datepicker({dateFormat:wpHr.date_format,changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(t){e(".wphr-leave-date-picker-from").datepicker("option","maxDate",t)}})},holiday:{checkRange:function(){e('input[name="range"]').is(":checked")?e('input[name="end_date"]').closest(".row").show():e('input[name="end_date"]').closest(".row").hide()},create:function(t){t.preventDefault(),e.wphrPopup({title:wpHr.popup.holiday,button:wpHr.popup.holiday_create,id:"wphr-hr-holiday-create-popup",content:wphr.template("wphr-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){i.initDateField(),i.holiday.checkRange(),i.initToggleCheckbox()},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},createByLocation:function(t){t.preventDefault(),e.wphrPopup({title:"Holiday By Location",button:wpHr.popup.holiday_create,id:"wphr-hr-holiday-createByLocation-popup",content:wphr.template("wphr-hr-holiday-by-location-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){if(i.initDateField(),i.holiday.checkRange(),i.initToggleCheckbox(),e("select#wphr-hr-leave-holiday-by-location-country").length<=0)return alert("No location specified!"),e(".close").trigger("click"),!1},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},edit:function(t){t.preventDefault();var a=e(this);e.wphrPopup({title:wpHr.popup.holiday,button:wpHr.popup.holiday_update,id:"wphr-hr-holiday-create-popup",content:wphr.template("wphr-hr-holiday-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){i.initDateField(),i.holiday.checkRange();var t=this;e("header",t).after(e('<div class="loader"></div>').show()),wp.ajax.send("wphr-hr-get-holiday",{data:{id:a.data("id"),_wpnonce:wpHr.nonce},success:function(i){e(".loader",t).remove();var a=i.holiday;e("#wphr-hr-holiday-title",t).val(a.title),e("#wphr-hr-holiday-start",t).val(a.start),e("#wphr-hr-holiday-end",t).val(a.end),e("#wphr-hr-holiday-id",t).val(a.id),e("#wphr-hr-holiday-description",t).val(a.description),e("#wphr-hr-holiday-action",t).val("wphr_hr_holiday_create");var r=new Date(a.start),o=new Date(a.end),l=Math.abs(o.getTime()-r.getTime());Math.ceil(l/864e5)>0&&(e("#wphr-hr-holiday-range").attr("checked","checked"),e("#wphr-hr-holiday-range").trigger("change"))}})},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},editByLocation:function(t){t.preventDefault();var a=e(this);e.wphrPopup({title:"Edit Holiday ( By Location )",button:"Update Holiday",id:"wphr-hr-holiday-by-location-create-popup",content:wphr.template("wphr-hr-holiday-by-location-js-tmp")({data:null}).trim(),extraClass:"smaller",onReady:function(){if(i.initDateField(),i.holiday.checkRange(),e("select#wphr-hr-leave-holiday-by-location-country").length<=0)return alert("No location specified!"),e(".close").trigger("click"),!1;var t=this;e("header",t).after(e('<div class="loader"></div>').show()),wp.ajax.send("wphr-hr-get-holiday-by-location",{data:{id:a.data("id"),_wpnonce:wpHr.nonce},success:function(i){e(".loader",t).remove();var a=i.holiday;e("#wphr-hr-holiday-by-location-title",t).val(a.title),e("#wphr-hr-holiday-by-location-start",t).val(a.start),e("#wphr-hr-holiday-by-location-end",t).val(a.end),e("#wphr-hr-holiday-by-location-id",t).val(a.id),e("#wphr-hr-holiday-by-location-description",t).val(a.description),e("#wphr-hr-leave-holiday-by-location-country",t).val(a.location_id),e("#wphr-hr-holiday-by-location-action",t).val("wphr_hr_holiday_create");var r=new Date(a.start),o=new Date(a.end),l=Math.abs(o.getTime()-r.getTime());Math.ceil(l/864e5)>0&&(e("#wphr-hr-holiday-by-location-range").attr("checked","checked"),e("#wphr-hr-holiday-by-location-range").trigger("change"))}})},onSubmit:function(e){t.data.holiday.submit.call(this,e)}})},remove:function(t){t.preventDefault();var i=e(this);confirm(wpHr.delConfirmHoliday)&&wp.ajax.send("wphr-hr-holiday-delete",{data:{_wpnonce:wpHr.nonce,id:i.data("id")},success:function(){i.closest("tr").fadeOut("fast",function(){e(this).remove()})},error:function(e){alert(e)}})},submit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),e(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){i.initDateField(),i.initToggleCheckbox()})},error:function(e){t.enableButton(),t.showError(e)}})}},policy:{periodField:function(){3==e(".wphr-hr-leave-period").val()&&e(".hide-if-manual").hide(),e(".wphr-hr-leave-period").on("change",function(){var t=e(this).val();2==t?e(".showifschedule").slideDown():e(".showifschedule").slideUp(),3!=t?e(".hide-if-manual").slideDown():e(".hide-if-manual").slideUp()})},submit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),e(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){i.initToggleCheckbox()})},error:function(e){t.enableButton(),alert(e)}})},create:function(t){t.preventDefault(),e.wphrPopup({title:wpHr.popup.policy,button:wpHr.popup.policy_create,id:"wphr-hr-leave-policy-create-popup",content:wp.template("wphr-leave-policy")({data:null}).trim(),extraClass:"smaller",onReady:function(){i.initDateField(),e(".wphr-color-picker").wpColorPicker().wpColorPicker("color","#fafafa"),i.policy.periodField()},onSubmit:function(e){t.data.policy.submit.call(this,e)}})},edit:function(t){t.preventDefault();var a=e(this).closest("tr").data("json");e.wphrPopup({title:wpHr.popup.policy,button:wpHr.popup.update_status,id:"wphr-hr-leave-policy-edit-popup",content:wphr.template("wphr-leave-policy")(a).trim(),extraClass:"smaller",onReady:function(){i.initDateField(),e(".wphr-color-picker").wpColorPicker(),e("div.row[data-selected]",this).each(function(){var t=e(this),i=t.data("selected");""!==i&&t.find("select").val(i)}),e("div.row[data-checked]",this).each(function(t,i){var a=e(this),r=a.data("checked");""!==r&&a.find('input[value="'+r+'"]').attr("checked","checked")}),i.policy.periodField(),e(".wphr-hr-leave-period").trigger("change")},onSubmit:function(e){t.data.policy.submit.call(this,e)}})},remove:function(t){t.preventDefault();var i=e(this);confirm(wpHr.delConfirmPolicy)&&wp.ajax.send("wphr-hr-leave-policy-delete",{data:{_wpnonce:wpHr.nonce,id:i.data("id")},success:function(){i.closest("tr").fadeOut("fast",function(){e(this).remove()})},error:function(e){alert(e)}})}},entitlement:{remove:function(t){t.preventDefault();var i=e(this);confirm(wpHr.delConfirmEntitlement)&&wp.ajax.send("wphr-hr-leave-entitlement-delete",{data:{_wpnonce:wpHr.nonce,id:i.data("id"),user_id:i.data("user_id"),policy_id:i.data("policy_id")},success:function(){i.closest("tr").fadeOut("fast",function(){e(this).remove()})},error:function(e){alert(e)}})}},leave:{show_timeslots:function(){e(this).is(":checked")?(e(".wphr-leave-time-slot").parents("div.row").show(),e(".wphr-leave-time-slot").attr("required","required"),e(".show-days").hide()):(e(".wphr-leave-time-slot").parents("div.row").hide(),e(".wphr-leave-time-slot").val(""),e(".wphr-leave-time-slot").removeAttr("required"),e(".show-days").show())},show_timeslots2:function(){e(this).is(":checked")?(e(this).next(".time-slot").show(),e(this).next(".time-slot").find("select").attr("required","required")):(e(this).next(".time-slot").hide(),e(this).next(".time-slot").find("select").val(""),e(this).next(".time-slot").find("select").removeAttr("required"))},takeLeave:function(t){t.preventDefault(),e.wphrPopup({title:wpHr.popup.new_leave_req,button:wpHr.popup.take_leave,id:"wphr-hr-new-leave-req-popup",content:wp.template("wphr-new-leave-req")().trim(),extraClass:"smaller",onReady:function(){i.initDateField()},onSubmit:function(t){e("button[type=submit]",".wphr-modal").attr("disabled","disabled"),wp.ajax.send({data:this.serialize(),success:function(e){t.enableButton(),alert(e),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},requestTimes:function(){var t=e("#wphr-hr-leave-req-from-time").val(),i=e("#wphr-hr-leave-req-to-time").val(),a=e(this).closest("form").find("input[type=submit]"),r=parseInt(e("#wphr-hr-leave-req-employee-id").val()),o=e("#wphr-hr-leave-req-leave-policy").val();console.log(t);var l=!1,n=i;if(!t)return a.prop("disabled",1),!1;e("#wphr-hr-leave-req-to-time option").show(),e("#wphr-hr-leave-req-to-time option").each(function(){if(l||e(this).hide(),e(this).val()==t){l=!0;var a=e("#wphr-hr-leave-req-to-time option[value='"+t+"']").next().attr("value");e("#wphr-hr-leave-req-to-time").val(a),i=a}l&&0}),"block"==e("#wphr-hr-leave-req-to-time option[value='"+n+"']").css("display")&&e("#wphr-hr-leave-req-to-time").val(n),""!==t&&""!==i&&wp.ajax.send("wphr-hr-leave-request-req-time",{data:{_wpnonce:wpHr.nonce,fromTime:t,toTime:e("#wphr-hr-leave-req-to-time").val(),start_date:e("#wphr-hr-leave-req-from-date").val(),end_date:e("#wphr-hr-leave-req-to-date").val(),employee_id:r,type:o},success:function(e){a.prop("disabled",!1)},error:function(e){a.attr("disabled","disable"),void 0!==e&&alert(e)}})},toTimes:function(){var t=e(this),i=t.next().next(),a=t.val(),r=i.val(),o=!1,l=r;i.find("option").show(),i.find("option").each(function(){if(o||e(this).hide(),e(this).val()==a){o=!0;var t=i.find("option[value='"+a+"']").next().attr("value");i.val(t),r=t}o&&0}),"block"==i.find("option[value='"+l+"']").css("display")&&i.val(l)},requestDates:function(){var t=e("#wphr-hr-leave-req-from-date").val(),i=e("#wphr-hr-leave-req-to-date").val(),a=e(this).closest("form").find("input[type=submit]"),r=parseInt(e("#wphr-hr-leave-req-employee-id").val()),o=e("#wphr-hr-leave-req-leave-policy").val();e(this).closest("form").find("input[type=submit]").length||(a=e(this).closest("form").find("button[type=submit]")),""!==t&&""!==i&&wp.ajax.send("wphr-hr-leave-request-req-date",{data:{_wpnonce:wpHr.nonce,from:t,to:i,employee_id:r,type:o},success:function(r){var o=wp.template("wphr-leave-days")(r.print),l=r.time_slot;console.log(l),t==i&&r.leave_count>0||(e("#wphr-hr-leave-houly-req").parents("div.row").hide(),e("#wphr-hr-leave-houly-req").attr("checked",!1),e(".wphr-leave-time-slot").val(""),e(".wphr-leave-time-slot").removeAttr("required"),e(".wphr-leave-time-slot").parents("div.row").hide(),e(".show-days").show()),e("#wphr-hr-leave-req-leave-policy").closest("div.row").find("span.description").remove(),e(r.message).insertAfter("#wphr-hr-leave-req-leave-policy"),e("div.wphr-hr-leave-req-show-days").html(o);var n=e("select.time-slot");n.html(""),n.html("<option value=''>- Select -</option>"),e.each(l,function(e,t){n.append("<option value='"+t.key+"'>"+t.value+"</option>")}),parseInt(r.leave_count)<=0?a.prop("disabled",!0):a.prop("disabled",!1)},error:function(t){e("div.wphr-hr-leave-req-show-days").empty(),a.attr("disabled","disable"),void 0!==t&&alert(t)}})},setPolicy:function(){i.leave.resetDateRange();var t=e(this),a=e("div.wphr-hr-leave-reqs-wrap"),r=a.find(".wphr-hr-leave-type-wrapper"),o=a.find(".wphr-leave-time-slot");r.html(""),0!=t.val()&&wp.ajax.send("wphr-hr-leave-employee-assign-policies",{data:{_wpnonce:wpHr.nonce,employee_id:t.val()},success:function(t){r.html(t.data).hide().fadeIn();var i=t.time_slot;o.html(""),o.append("<option value=''>- Select -</option>"),e.each(i,function(e,t){o.append("<option value='"+t.key+"'>"+t.value+"</option>")}),console.log(o),a.find('input[type="text"], textarea').removeAttr("disabled")},error:function(e){r.html(wpHr.empty_entitlement_text).hide().fadeIn()}})},setAvailableDays:function(){i.leave.resetDateRange();var t=e(this);wp.ajax.send("wphr-hr-leave-policies-availablity",{data:{_wpnonce:wpHr.nonce,employee_id:e("#wphr-hr-leave-req-employee-id").val(),policy_id:t.val()},success:function(i){t.closest("div.row").find("span.description").remove(),e(i).insertAfter(t)},error:function(e){alert(e)}})},resetDateRange:function(){e("#wphr-hr-leave-req-from-date").val(""),e("#wphr-hr-leave-req-to-date").val(""),e("div.wphr-hr-leave-req-show-days").html("")},showHistory:function(t){t.preventDefault();var i=e(this);wp.ajax.send("wphr-hr-empl-leave-history",{data:i.serializeObject(),success:function(t){e("table#wphr-hr-empl-leave-history tbody").html(t)}})},pageReload:function(){e(".wphr-hr-leave-requests").load(window.location.href+" .wphr-hr-leave-requests-inner")},reject:function(t){t.preventDefault();var a={id:e(this).data("id")};e.wphrPopup({title:wpHr.popup.leave_reject,button:wpHr.popup.update_status,id:"wphr-hr-leave-reject-popup",content:wphr.template("wphr-hr-leave-reject-js-tmp")(a).trim(),extraClass:"smaller",onSubmit:function(e){wp.ajax.send({data:this.serialize()+"&_wpnonce="+wpHr.nonce,success:function(t){i.leave.pageReload(),e.closeModal()},error:function(t){e.showError(t)}})}})}},importICalInit:function(t){t.preventDefault(),e("body #wphr-ical-input").trigger("click")},uploadICal:function(t){t.preventDefault();var a=t.target.files[0],r=new FormData,o=e(this).parents("form");r.append("ics",a),r.append("action","wphr-hr-import-ical"),r.append("_wpnonce",wpHr.nonce),wp.ajax.send({data:r,cache:!1,processData:!1,contentType:!1,success:function(){e(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){i.initDateField()}),o[0].reset()},error:function(e){o[0].reset(),alert(e)}})},importICalInit_byLocation:function(a){a.preventDefault(),e.wphrPopup({title:"Import iCal",button:"submit",id:"wphr-hr-holiday-by-location-import-popup",content:wphr.template("wphr-hr-import-ical-by-location-js-tmp")({data:null}).trim(),extraClass:"smaller",onSubmit:function(a){var r=e("#wphr-hr-leave-holiday-by-location-country").val(),o=e("#wphr-hr-import-by-location").val();return""==r?(alert("Please Select Country to continue import"),!1):""==o?(alert("File not selected"),!1):void function(a){var r=e("#wphr-hr-leave-holiday-by-location-country").val(),o=e(".wphr-modal-form"),l=new FormData;e('input[name="ics"]').val();l.append("ics",t),l.append("action","wphr-hr-import-ical"),l.append("_wpnonce",wpHr.nonce),l.append("location_id",r),wp.ajax.send({data:l,cache:!1,processData:!1,contentType:!1,success:function(){e(".list-table-wrap").load(window.location.href+" .list-wrap-inner",function(){i.initDateField()}),o[0].reset(),e(".close").click()},error:function(e){o[0].reset(),alert(e)}})}()}})},uploadICal_byLocation:function(e){e.preventDefault(),t=e.target.files[0]}};e(function(){i.initialize()})}(jQuery);