!function(a){window.WPHR_Uploader=function(b,c,d,e,f,g,h,i){this.container=d,this.browse_button=c,a("#"+c).length&&(this.uploader=new plupload.Uploader({dragdrop:!0,drop_element:e,runtimes:"html5,html4",browse_button:c,container:d,multipart_params:{action:b,file_id:a("#"+c).data("file_id"),_wpnonce:wpHr.nonce},max_file_size:h+"kb",url:wpHr.plupload.url+"&type="+f,flash_swf_url:wpHr.flash_swf_url,filters:[{title:"Allowed Files",extensions:g}],views:{list:!0,thumbs:!0,active:"thumbs"},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap"}),this.uploader.bind("Init",a.proxy(this,"init")),this.uploader.bind("FilesAdded",a.proxy(this,"added")),this.uploader.bind("QueueChanged",a.proxy(this,"upload")),this.uploader.bind("UploadProgress",a.proxy(this,"progress")),this.uploader.bind("Error",a.proxy(this,"error")),this.uploader.bind("FileUploaded",a.proxy(this,"uploaded")),this.uploader.init(),this.callback=i,a("#"+d).on("click","a.attachment-delete",a.proxy(this.removeAttachment,this)))},WPHR_Uploader.prototype={init:function(a,b){},executeFunctionByName:function(a,b,c){if(void 0===a)return!1;for(var c=[].slice.call(arguments).splice(2),d=a.split("."),e=d.pop(),f=0;f<d.length;f++)b=b[d[f]];return"function"==typeof b[e]&&b[e].apply(b,c)},added:function(b,c){var d=(a("#"+this.container).find(".wphr-attachment-upload-filelist"),a("#"+this.container).find(".wphr-attachment-list"));a.each(c,function(a,b){d.append('<li class="wphr-image-wrap thumbnail '+b.id+'"><div class="attachment-name wphr-img-progress"><div class="upload-item" id="'+b.id+'"><div class="progress progress-striped active"><div class="bar"></div></div></div></div></li>')}),b.refresh(),b.start()},upload:function(a){this.uploader.start()},progress:function(b,c){var d=a("#"+c.id);a(".bar",d).css({width:c.percent+"%"}),a(".percent",d).html(c.percent+"%")},error:function(b,c){a("#"+this.container).find("#"+c.file.id).remove();var d="";switch(c.code){case-600:d="The file you have uploaded exceeds the file size limit. Please try again.";break;case-601:d="You have uploaded an incorrect file type. Please try again.";break;default:d="Error #"+c.code+": "+c.message}alert(d),this.uploader.refresh()},uploaded:function(b,c,d){var e=a.parseJSON(d.response),f={up:b,file:c,response:d};!1===this.executeFunctionByName(this.callback.after_uploaded,window,f)&&(a("#"+c.id+" b").html("100%"),a("#"+c.id).remove(),e.success?a("."+c.id).replaceWith(e.data):alert(e.error))},removeAttachment:function(b){b.preventDefault();var c=this,d=a(b.currentTarget);if(confirm(wpHr.confirmMsg)){var e={attach_id:d.data("attach_id"),custom_attr:d.closest(".wphr-image-wrap").find(".wphr-file-mime").data(),_wpnonce:wpHr.nonce,action:"wphr_file_del"};jQuery.post(wpHr.ajaxurl,e,function(){d.parent().parent().remove(),c.uploader.refresh()})}}}}(jQuery);
