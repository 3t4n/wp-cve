window.wphr=window.wphr||{},function(a){"use strict";wphr.template=function(b){var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(d){return _.template(a("#tmpl-"+b).html(),null,c)(d)}},wphr.scriptReload=function(b,c){wp.ajax.send({data:{action:b},success:function(b){a("#"+c).html(b.content)},error:function(a){alert(a)}})},wphr.timeFormat=function(a){if(null!=a){var b=a.toString();a=new Date(b.substr(0,4),b.substr(5,2)-1,b.substr(8,2),b.substr(11,2),b.substr(14,2),b.substr(17,2));var c=a.getHours(),d=a.getMinutes(),e=c>=12?"pm":"am";return c%=12,c=c||12,d=d<10?"0"+d:d,c+":"+d+" "+e}},wphr.dateFormat=function(a,b){if(null!=a){var c=a.toString();a=new Date(c.substr(0,4),c.substr(5,2)-1,c.substr(8,2),c.substr(11,2),c.substr(14,2),c.substr(17,2));var d=("0"+(a.getMonth()+1)).slice(-2),e=("0"+a.getDate()).slice(-2),f=a.getFullYear(),g=["January","February","March","April","May","June","July","August","September","October","November","December"],h=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],i=g[a.getMonth()],j=h[a.getMonth()],k={Y:f,m:d,F:i,M:j,d:e,j:e};return b.replace(/Y|m|d|j|M|F/gi,function(a){return k[a]})}},wphr.parseCondition=function(a){var b={},c=a.split(/([a-zA-Z0-9\s\-\_\+\.\,\:]+)/);return""==c[0]?(b.condition="",b.val=c[1]):(b.condition=c[0],b.val=c[1]),b},wphr.wphr_parse_str=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=String(a).replace(/^&/,"").replace(/^\?/,"").replace(/&$/,"").split("&"),r=q.length,s=function(a){return decodeURIComponent(a.replace(/\+/g,"%20"))};for(b||(b=this.window),c=0;c<r;c++){for(k=q[c].split("="),l=s(k[0]),m=k.length<2?"":s(k[1]);" "===l.charAt(0);)l=l.slice(1);if(l.indexOf("\0")>-1&&(l=l.slice(0,l.indexOf("\0"))),l&&"["!==l.charAt(0)){for(o=[],n=0,d=0;d<l.length;d++)if("["!==l.charAt(d)||n){if("]"===l.charAt(d)&&n&&(o.length||o.push(l.slice(0,n-1)),o.push(l.substr(n,d-n)),n=0,"["!==l.charAt(d+1)))break}else n=d+1;for(o.length||(o=[l]),d=0;d<o[0].length&&(j=o[0].charAt(d)," "!==j&&"."!==j&&"["!==j||(o[0]=o[0].substr(0,d)+"_"+o[0].substr(d+1)),"["!==j);d++);for(h=b,d=0,p=o.length;d<p;d++)if(l=o[d].replace(/^['"]/,"").replace(/['"]$/,""),o.length,g=h,""!==l&&" "!==l||0===d)h[l]===i&&(h[l]={}),h=h[l];else{e=-1;for(f in h)h.hasOwnProperty(f)&&+f>e&&f.match(/^\d+$/g)&&(e=+f);l=e+1}g[l]=m}}},wphr.wphrGetParamByName=function(a,b){b=b.toLowerCase(),a=a.replace(/[\[\]]/g,"\\$&").toLowerCase();var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},wphr.wphrRemoveURLParameter=function(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=c[0]+(e.length>0?"?"+e.join("&"):"")}return a},wphr.swalSpinnerVisible=function(){swal({title:"",html:!0,showCancelButton:!1,showConfirmButton:!1}),a(".la-ball-fall").css({opacity:1,visibility:"visible",top:"-17px",color:"#008ec2"})},wphr.swalSpinnerHidden=function(){a(".la-ball-fall").css({opacity:0,visibility:"hidden"})};var b={initialize:function(){a("#postimagediv").on("click","#set-company-thumbnail",this.setCompanyLogo),a("#postimagediv").on("click","a.remove-logo",this.removeCompanyLogo),a("body").on("click","a#wphr-company-new-location",this.newCompanyLocation),a(".wphr-company-single").on("click","a.edit-location",this.editCompanyLocation),a(".wphr-company-single").on("click","a.remove-location",this.removeCompanyLocation),a("body").on("change","select.wphr-country-select",this.populateState),a("body").on("wphr-hr-after-new-location",this.afterNewLocation),a(".wphr-hr-audit-log").on("click","a.wphr-audit-log-view-changes",this.viewLogChanges),a("body").on("change","#filter_duration",this.customFilter),this.initFields()},afterNewLocation:function(b,c){wphr.scriptReload("wphr_hr_script_reload","tmpl-wphr-new-employee"),a(".wphr-hr-location-drop-down").append('<option selected="selected" value="'+c.id+'">'+c.title+"</option>"),a(".wphr-hr-location-drop-down").select2("val",c.id)},initFields:function(){a(".wphr-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+5"}),a(".wphr-date-picker-from").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,numberOfMonths:1,onClose:function(b){a(".wphr-date-picker-to").datepicker("option","minDate",b)}}),a(".wphr-date-picker-to").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,numberOfMonths:1,onClose:function(b){a(".wphr-date-picker-from").datepicker("option","maxDate",b)}}),a(".wphr-select2").select2({placeholder:a(this).attr("data-placeholder")})},viewLogChanges:function(b){b.preventDefault();var c=a(this);wp.ajax.send("wphr_audit_log_view",{data:{id:c.data("id"),_wpnonce:wpHr.nonce},success:function(b){a.wphrPopup({title:b.title,button:"",id:"wphr-audit-log-popup",content:b.content,extraClass:"midium"})},error:function(a){alert(a)}})},setCompanyLogo:function(b){b.preventDefault(),b.stopPropagation();var c;if(c)return void c.open();c=wp.media({title:wpHr.upload_logo,button:{text:wpHr.set_logo}}),c.on("select",function(){c.state().get("selection").map(function(b){b=b.toJSON();var c='<img src="'+b.url+'" alt="" />';c+='<input type="hidden" name="company_logo_id" value="'+b.id+'" />',c+='<a href="#" class="remove-logo">'+wpHr.remove_logo+"</a>",a(".inside","#postimagediv").html(c)})}),c.open()},removeCompanyLogo:function(b){b.preventDefault();var c='<a href="#" id="set-company-thumbnail" class="thickbox">'+wpHr.upload_logo+"</a>";a(".inside","#postimagediv").html(c)},populateState:function(){if("undefined"==typeof wpHrCountries)return!1;var b=a(this),c=b.val(),d=b.closest(b.data("parent")),e='<option value="-1">- Select -</option>';if(wpHrCountries[c]){var f="",g=wpHrCountries[c];for(var h in g)f=f+'<option value="'+h+'">'+g[h]+"</option>";a.isArray(wpHrCountries[c])?d.find("select.wphr-state-select").html(e):d.find("select.wphr-state-select").html(f)}else d.find("select.wphr-state-select").html(e)},customFilter:function(){"custom"!=this.value?a("#custom-input").remove():(a("#filter_duration").after('<span id="custom-input"><span>From </span><input name="start" class="wphr-date-field" type="text">&nbsp;<span>To </span><input name="end" class="wphr-date-field" type="text"></span>&nbsp;'),b.initFields())},newCompanyLocation:function(b){b.preventDefault();var c=a(this);a.wphrPopup({title:c.data("title"),button:wpHr.create,id:"wphr-new-location",content:wp.template("wphr-address")({company_id:c.data("id")}).trim(),extraClass:"medium",onReady:function(){a(".select2").select2()},onSubmit:function(b){wp.ajax.send({data:this.serialize(),success:function(d){a("#company-locations").load(window.location.href+" #company-locations-inside"),c.hasClass("wphr-add-new-location")||a("body").trigger("wphr-hr-after-new-location",[d]),b.closeModal()},error:function(a){b.showError(a)}})}})},editCompanyLocation:function(b){b.preventDefault();var c=a(this);a.wphrPopup({title:wpHr.update_location,button:wpHr.update_location,id:"wphr-edit-location",content:wp.template("wphr-address")(c.data("data")),extraClass:"medium",onReady:function(){a(".select2").select2(),a("li[data-selected]",this).each(function(){var b=a(this),c=b.data("selected");""!==c&&b.find("select").val(c)}),a("select.wphr-country-select").change(),setTimeout(function(){a( 'select.wphr-state-select').val(c)}, 1000)}},onSubmit:function(b){wp.ajax.send({data:this.serializeObject(),success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside"),b.closeModal()},error:function(a){b.showError(a)}})}})},removeCompanyLocation:function(b){b.preventDefault(),confirm(wpHr.confirm)&&wp.ajax.send("wphr-delete-comp-location",{data:{id:a(this).data("id"),_wpnonce:wpHr.nonce},success:function(){a("#company-locations").load(window.location.href+" #company-locations-inside")}})}};a(function(){b.initialize()})}(jQuery),jQuery.fn.serializeObject=function(){var a={},b=this.serializeArray();return jQuery.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.wphr.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.wphr.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("wphr.dropdown");d||c.data("wphr.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".wphr-dropdown-backdrop",f='[data-toggle="wphr-dropdown"]',g=function(b){a(b).on("click.wphr.dropdown",this.toggle)};g.VERSION="1.0.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("wphr-dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.wphr.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.wphr.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".wphr-dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.wphrDropdown;a.fn.wphrDropdown=d,a.fn.wphrDropdown.Constructor=g,a.fn.wphrDropdown.noConflict=function(){return a.fn.wphrDropdown=h,this},a(document).on("click.wphr.dropdown.data-api",c).on("click.wphr.dropdown.data-api",".wphr-dropdown form",function(a){a.stopPropagation()}).on("click.wphr.dropdown.data-api",f,g.prototype.toggle).on("keydown.wphr.dropdown.data-api",f,g.prototype.keydown).on("keydown.wphr.dropdown.data-api",".wphr-dropdown-menu",g.prototype.keydown)}(jQuery),function(a,b,c,d){function e(b){this.settings=a.extend({},g,b),this.element=a(this.settings.content),this.id=this.settings.id,this._defaults=g,this._name=f,this.init()}var f="wphrPopup",g={title:"",content:"",id:"",button:"Submit",extraClass:"",onReady:function(){},onSubmit:function(){},beforeClose:function(){}};a.extend(e.prototype,{init:function(){this.show_modal(),this.bindEvents()},bindEvents:function(){a("form.wphr-modal-form","#"+this.settings.id).on("submit",a.proxy(this.formSubmit,this)),a(".wphr-modal-backdrop, .wphr-modal .close").on("click",a.proxy(this.closeModal,this)),a("body").on("keydown","#"+this.id,a.proxy(this.onEscapeKey,this)),a("#"+this.id).focus()},formSubmit:function(b){b.preventDefault(),a(".wphr-modal-backdrop, .wphr-modal").find(".wphr-loader").removeClass("wphr-hide"),this.settings.onSubmit.call(a(b.currentTarget),this)},show_modal:function(){if(""!==this.id&&!a("#"+this.id).length){var b=a("#wphr-modal").find(".wphr-modal"),c=b.clone();""!==this.settings.extraClass&&c.addClass(this.settings.extraClass),c.attr("id",this.id),c.attr("tabindex",-1),c.addClass("wphr-count-class"),c.find("h2").text(this.settings.title),""===this.settings.button?c.find("footer").remove():c.find(".button-primary").text(this.settings.button),c.find(".content").empty().html(this.settings.content),c.show(),a("body").append(c);var d=600*a("body").find(".wphr-count-class").length,e=d-1;a("#"+this.id).css("z-index",d),a("#"+this.id).after('<div style="z-index: '+e+'" class="wphr-modal-backdrop '+this.id+'"></div>'),a("."+this.id).show(),this.settings.onReady.call(c,this)}},onEscapeKey:function(a){27===a.keyCode&&this.closeModal(a)},disableButton:function(){a("button[type=submit]",".wphr-modal").attr("disabled","disabled")},enableButton:function(){a("button[type=submit]",".wphr-modal").removeAttr("disabled")},closeModal:function(b){void 0!==b&&b.preventDefault(),a(".wphr-modal-backdrop, .wphr-modal").find(".wphr-loader").addClass("wphr-hide"),this.settings.beforeClose.call(!1,this),a("#"+this.id).remove(),a("."+this.id).remove()},showError:function(b){a(".wphr-modal-backdrop, .wphr-modal").find(".wphr-loader").addClass("wphr-hide"),alert(b)}}),a.wphrPopup=function(a){new e(a)}}(jQuery,window,document),jQuery(function(a){a(".colorpick").wpColorPicker(),a(".tips, .help_tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),{init:function(){a("a.wphr-image-upload").on("click",this.imageUpload),a("a.wphr-remove-image").on("click",this.removeBanner)},imageUpload:function(b){b.preventDefault();var c,d=a(this);if(c)return void c.open();c=wp.media.frames.file_frame=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text")},multiple:!1}),c.on("select",function(){var b=c.state().get("selection").first().toJSON(),e=d.closest("td");e.find("input.wphr-file-field").val(b.id),void 0!==b.sizes.thumbnail?e.find("img.wphr-option-image").attr("src",b.sizes.thumbnail.url):e.find("img.wphr-option-image").attr("src",b.url),a(".image-wrap",e).removeClass("wphr-hide"),a(".button-area",e).addClass("wphr-hide")}),c.open()},removeBanner:function(b){b.preventDefault();var c=a(this),d=c.closest(".image-wrap"),e=d.siblings(".button-area");d.find("input.wphr-file-field").val("0"),d.addClass("wphr-hide"),e.removeClass("wphr-hide")}}.init()}),function(a){window.WPHR_Uploader=function(b,c,d,e,f,g,h,i){this.container=d,this.browse_button=c,a("#"+c).length&&(this.uploader=new plupload.Uploader({dragdrop:!0,drop_element:e,runtimes:"html5,html4",browse_button:c,container:d,multipart_params:{action:b,file_id:a("#"+c).data("file_id"),_wpnonce:wpHr.nonce},max_file_size:h+"kb",url:wpHr.plupload.url+"&type="+f,flash_swf_url:wpHr.flash_swf_url,filters:[{title:"Allowed Files",extensions:g}],views:{list:!0,thumbs:!0,active:"thumbs"},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap"}),this.uploader.bind("Init",a.proxy(this,"init")),this.uploader.bind("FilesAdded",a.proxy(this,"added")),this.uploader.bind("QueueChanged",a.proxy(this,"upload")),this.uploader.bind("UploadProgress",a.proxy(this,"progress")),this.uploader.bind("Error",a.proxy(this,"error")),this.uploader.bind("FileUploaded",a.proxy(this,"uploaded")),this.uploader.init(),this.callback=i,a("#"+d).on("click","a.attachment-delete",a.proxy(this.removeAttachment,this)))},WPHR_Uploader.prototype={init:function(a,b){},executeFunctionByName:function(a,b,c){if(void 0===a)return!1;for(var c=[].slice.call(arguments).splice(2),d=a.split("."),e=d.pop(),f=0;f<d.length;f++)b=b[d[f]];return"function"==typeof b[e]&&b[e].apply(b,c)},added:function(b,c){var d=(a("#"+this.container).find(".wphr-attachment-upload-filelist"),a("#"+this.container).find(".wphr-attachment-list"));a.each(c,function(a,b){d.append('<li class="wphr-image-wrap thumbnail '+b.id+'"><div class="attachment-name wphr-img-progress"><div class="upload-item" id="'+b.id+'"><div class="progress progress-striped active"><div class="bar"></div></div></div></div></li>')}),b.refresh(),b.start()},upload:function(a){this.uploader.start()},progress:function(b,c){var d=a("#"+c.id);a(".bar",d).css({width:c.percent+"%"}),a(".percent",d).html(c.percent+"%")},error:function(b,c){a("#"+this.container).find("#"+c.file.id).remove();var d="";switch(c.code){case-600:d="The file you have uploaded exceeds the file size limit. Please try again.";break;case-601:d="You have uploaded an incorrect file type. Please try again.";break;default:d="Error #"+c.code+": "+c.message}alert(d),this.uploader.refresh()},uploaded:function(b,c,d){var e=a.parseJSON(d.response),f={up:b,file:c,response:d};!1===this.executeFunctionByName(this.callback.after_uploaded,window,f)&&(a("#"+c.id+" b").html("100%"),a("#"+c.id).remove(),e.success?a("."+c.id).replaceWith(e.data):alert(e.error))},removeAttachment:function(b){b.preventDefault();var c=this,d=a(b.currentTarget);if(confirm(wpHr.confirmMsg)){var e={attach_id:d.data("attach_id"),custom_attr:d.closest(".wphr-image-wrap").find(".wphr-file-mime").data(),_wpnonce:wpHr.nonce,action:"wphr_file_del"};jQuery.post(wpHr.ajaxurl,e,function(){d.parent().parent().remove(),c.uploader.refresh()})}}}}(jQuery);
