!function(a){a(document).ready(function(){var a=wp.media.editor.send.attachment,b=function(b,c){if(void 0===c.isOcsRemote||c.isOcsRemote===!1)return a(b,c);var d,e,f=c.caption;return wp.media.view.settings.captions||delete c.caption,b=wp.media.string.props(b,c),d={id:c.id,title:c.title,type:c.type,subtype:c.subtype,remotetype:c.remotetype,accountId:c.accountId||0,remotedata:c.remotedata||[],post_content:c.description,post_excerpt:f},b.linkUrl&&(d.url=b.linkUrl),"image"===c.type?(e=wp.media.string.image(b),_.each({align:"align",size:"image-size",alt:"image_alt"},function(a,c){b[c]&&(d[a]=b[c])}),d.width=c.width||0,d.height=c.height||0,d.imgurl=c.url||d.url,d["image-size"].length>0&&void 0!==c.sizes[d["image-size"]]&&(d.imgurl=c.sizes[d["image-size"]].url||d.imgurl,d.width=c.sizes[d["image-size"]].width||d.width,d.height=c.sizes[d["image-size"]].height||d.height)):"video"===c.type?e=wp.media.string.video(b,c):"audio"===c.type?e=wp.media.string.audio(b,c):(e=wp.media.string.link(b),d.post_title=b.title),wp.media.post("send-remote-attachment-to-editor",{nonce:rmlSendToEditorParams.nonce,attachment:d,html:e,post_id:wp.media.view.settings.post.id})};wp.media.editor.send.attachment=b}),wp.media.view.RemoteUploaderInline=wp.media.View.extend({tagName:"div",className:"remote-uploader",template:wp.media.template("remote-media-upload"),events:{input:"refresh",keyup:"refresh",change:"refresh"},initialize:function(){_.defaults(this.options,{message:"",status:!0});var a=this.controller.state(),b=a.get("uploadTemplate");b&&(this.template=wp.media.template(b)),this.options.status&&this.views.set(".upload-inline-status",new wp.media.view.UploaderStatus({controller:this.controller}))},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.refresh(),this},refresh:function(a){},hide:function(){this.$el.addClass("hidden")}}),wp.media.remotequery=function(a){return new wp.media.model.RemoteAttachments(null,{props:_.extend(_.defaults(a||{},{orderby:"date"}),{query:!0})})},wp.media.model.RemoteAttachments=wp.media.model.Attachments.extend({initialize:function(){wp.media.model.Attachments.prototype.initialize.apply(this,arguments)},_requery:function(a){var b;this.props.get("query")&&(b=this.props.toJSON(),b.cache=!0!==a,this.mirror(wp.media.model.RemoteQuery.get(this.props.toJSON())))}}),wp.media.model.RemoteQuery=wp.media.model.Query.extend({initialize:function(){wp.media.model.Query.prototype.initialize.apply(this,arguments)},more:function(){return this._more=wp.media.model.Query.prototype.more.apply(this,arguments),this._more.fail(function(a){429===a.statuscode&&alert("You have reached this service data rate limit on this IP address for this hour. Try again in a bit."),a.msg&&console.log("Error getting remote library data:\n"+a.msg)}),this._more},parse:function(a,b){return _.isArray(a)||(a=[a]),_.map(a,function(a){var c,d,e;return a instanceof Backbone.Model?(c=a.get("id"),a=a.attributes):c=a.id,a.accountId&&(c=a.accountId+c),d=wp.media.model.Attachment.get(c),e=d.parse(a,b),_.isEqual(d.attributes,e)||d.set(e),d})},sync:function(a,b,c){var d;return"read"===a?(c=c||{},c.context=this,c.data=_.extend(c.data||{},{action:"query-remote-attachments",post_id:wp.media.model.settings.post.id,security:rmlQueryAttachmentsParams.nonce}),args=_.clone(this.args),-1!==args.posts_per_page&&(args.paged=Math.floor(this.length/args.posts_per_page)+1),c.data.query=args,wp.media.ajax(c)):(d=wp.media.model.Attachments.prototype.sync?wp.media.model.Attachments.prototype:Backbone,d.sync.apply(this,arguments))}},{get:function(){var a=[];return function(b,c){var d,e={},f=wp.media.model.RemoteQuery.orderby,g=wp.media.model.RemoteQuery.defaultProps,h=!!b.cache||_.isUndefined(b.cache);return delete b.query,delete b.cache,_.defaults(b,g),b.order=b.order.toUpperCase(),"DESC"!==b.order&&"ASC"!==b.order&&(b.order=g.order.toUpperCase()),_.contains(f.allowed,b.orderby)||(b.orderby=g.orderby),_.each(["include","exclude"],function(a){b[a]&&!_.isArray(b[a])&&(b[a]=[b[a]])}),_.each(b,function(a,b){_.isNull(a)||(e[wp.media.model.RemoteQuery.propmap[b]||b]=a)}),_.defaults(e,wp.media.model.RemoteQuery.defaultArgs),e.orderby=f.valuemap[b.orderby]||b.orderby,h?d=_.find(a,function(a){return _.isEqual(a.args,e)}):a=[],d||(d=new wp.media.model.RemoteQuery([],_.extend(c||{},{props:b,args:e})),a.push(d)),d}}()}),wp.media.view.AttachmentFilters.RemoteCustom=wp.media.view.AttachmentFilters.extend({className:"rml-attachment-filters attachment-filters",createFilters:function(){var a={},b=this.model.get("remotefilters");_.each(b,function(b){var c={text:b.text||"Undefined",props:b.props||{uploadedTo:null,orderby:"date",order:"DESC"},priority:b.priority||10};b.slug&&(a[b.slug]=c)}),this.filters=a}}),wp.media.controller.RemoteLibrary=wp.media.controller.Library.extend({defaults:{id:"remote-library",multiple:"add",describe:!1,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",date:!1,remote:!0,searchable:!0,filterable:!1,sortable:!1,autoSelect:!0,allowLocalEdits:!0,contentUserSetting:!0,syncSelection:!0}});var b=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=b.extend({initialize:function(){b.prototype.initialize.apply(this,arguments)},createStates:function(){b.prototype.createStates.apply(this,arguments);var a=this.options,c=this;_.each(wp.media.view.settings.remoteMediaAccounts,function(b){var d=wp.media.view.settings.remoteServiceSettings[b.type]||[];c.states.add([new wp.media.controller.RemoteLibrary({id:"remote-library-"+b.id,sectionid:b.id,title:b.title,service:b.type,priority:30,toolbar:"main-remote",uploadTemplate:d.uploadTemplate||"",filterable:b.filterable||"uploaded",library:wp.media.remotequery(_.defaults({isOcsRemote:!0,account_id:b.id,remotefilters:b.filters||[],uioptions:b.uioptions||[],orderby:"menuOrder",order:"ASC"},a.library)),state:"remote-library-"+b.id,editable:!0,displaySettings:!0,displayUserSettings:!0,menu:"default",AttachmentView:wp.media.view.Attachment.RemoteLibrary})])},this)},bindHandlers:function(){b.prototype.bindHandlers.apply(this,arguments),this.on("toolbar:create:main-remote",this.createToolbar,this),this.on("toolbar:render:main-remote",this.mainInsertToolbar,this)},uploadContent:function(){this.state().get("sectionid")?(this.$el.removeClass("hide-toolbar"),this.content.set(new wp.media.view.RemoteUploaderInline({controller:this,model:this.state().props}))):wp.media.view.MediaFrame.Select.prototype.uploadContent.apply(this,arguments)}}),wp.media.view.RemoteAttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createSingle:function(){var a=this.sidebar,b=this.options.selection.single();b.get("type");if((b.get("isOcsRemote")||!1)!==!0)return wp.media.view.AttachmentsBrowser.prototype.createSingle.apply(this,arguments);wp.media.view.AttachmentsBrowser.prototype.createSingle.apply(this,arguments),this.model.id==="remote-library-"+this.model.get("sectionid")&&a.$el.addClass("visible")},createToolbar:function(){wp.media.view.AttachmentsBrowser.prototype.createToolbar.apply(this,arguments),"custom"===this.options.filters&&this.toolbar.set("filters",new wp.media.view.AttachmentFilters.RemoteCustom({controller:this.controller,model:this.collection.props,priority:-80}).render()),this.$el.addClass("remote-attachments-browser")}});var c=wp.media.view.MediaFrame.Select.prototype.browseContent;wp.media.view.MediaFrame.Select.prototype.browseContent=function(a){var b=this.state();if(b.get("remote")===!0){var d=b.get("library");this.$el.removeClass("hide-toolbar"),a.view=new wp.media.view.RemoteAttachmentsBrowser({controller:this,collection:d,selection:b.get("selection"),model:b,sortable:b.get("sortable"),search:b.get("searchable"),filters:b.get("filterable"),date:b.get("date"),display:b.has("display")?b.get("display"):b.get("displaySettings"),dragInfo:b.get("dragInfo"),idealColumnWidth:b.get("idealColumnWidth"),suggestedWidth:b.get("suggestedWidth"),suggestedHeight:b.get("suggestedHeight"),AttachmentView:b.get("AttachmentView")})}else c.apply(this,arguments)},wp.media.view.Attachment.RemoteLibrary=wp.media.view.Attachment.Library.extend({template:wp.media.template("attachment-remote"),toggleSelection:function(){wp.media.view.Attachment.Library.prototype.toggleSelection.apply(this,arguments)}}),wp.media.view.Attachment.RemoteSelection=wp.media.view.Attachment.Selection.extend({template:wp.media.template("attachment-remote")});var d=wp.media.view.Attachments.Selection;wp.media.view.Attachments.Selection=d.extend({initialize:function(){return _.defaults(this.options,{AttachmentView:wp.media.view.Attachment.RemoteSelection}),d.prototype.initialize.apply(this,arguments)}})}(jQuery);