!function(e){"use strict";var r;redux.field_objects=redux.field_objects||{},redux.field_objects.repeater=redux.field_objects.repeater||{},redux.field_objects.repeater.sort_repeaters=function(r){r.hasClass("redux-container-repeater")||(r=r.parents(".redux-container-repeater:first")),r.find(".redux-repeater-accordion-repeater").each(function(r){var t=e(this).attr("data-sortid");e(this).find(".redux-field .repeater[name*='["+t+"]']").each(function(){e(this).attr("name",e(this).attr("name").replace("["+t+"]","["+r+"]"))});var a=e(this).find(".ui-accordion-header"),i=a.attr("id").split("-header-");a.attr("id",i[0]+"-header-"+r),i=a.attr("aria-controls").split("-panel-"),a.attr("aria-controls",i[0]+"-panel-"+r);var d=e(this).find(".ui-accordion-content");i=d.attr("id").split("-panel-");d.attr("id",i[0]+"-panel-"+r),i=d.attr("aria-labelledby").split("-header-"),d.attr("aria-labelledby",i[0]+"-header-"+r)})},redux.field_objects.repeater.init=function(t){t||(t=e(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible")),e(t).each(function(t){var a=e(this),i=a;if(a.hasClass("redux-field-container")||(i=a.parents(".redux-field-container:first")),!i.is(":hidden")&&i.hasClass("redux-field-init")){i.removeClass("redux-field-init");i=a;a.hasClass("redux-field-container")||(i=a.parents(".redux-field-container:first"));var d=a.parents(".redux-container").data("opt-name");r=void 0===d?redux:redux.optName;var n=i.attr("data-id"),c=a.find(".redux-repeater-accordion-repeater:first-child");if(r.repeater[n].blank=c.clone().wrap("<p>").parent().html(),i.hasClass("redux-container-repeater")&&i.addClass("redux-field-init"),i.hasClass("redux-field-init")){i.removeClass("redux-field-init");var o,s=a.find(".redux-repeater-accordion"),l=Boolean(s.data("panels-closed"));o=!0===l?Boolean(!1):parseInt(0);var p=a.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,active:o,beforeActivate:function(r,t){"function"==typeof reduxRepeaterAccordionBeforeActivate&&reduxRepeaterAccordionBeforeActivate(e(this),a,r,t)},activate:function(r,t){e.redux.initFields(),"function"==typeof reduxRepeaterAccordionActivate&&reduxRepeaterAccordionActivate(e(this),a,r,t)},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}});1==r.repeater[n].sortable?p.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(r,t){t.item.children("h3").triggerHandler("focusout"),redux.field_objects.repeater.sort_repeaters(e(this))}}):p.find("h3.ui-accordion-header").css("cursor","pointer"),a.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(r){var t;t=e(r.target).find(":selected").text().length>0?e(r.target).find(":selected").text():e(r.target).val(),e(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(t)}),a.find(".redux-repeaters-remove").on("click",function(){redux_change(e(this));var t=e(this).parents(".redux-container-repeater:first"),i=t.attr("data-id");r.repeater[i].blank=e(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0),e(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){(e(this).remove(),redux.field_objects.repeater.sort_repeaters(a),""!=r.repeater[i].limit)&&(t.find(".redux-repeater-accordion-repeater").length<r.repeater[i].limit&&t.find(".redux-repeaters-add").removeClass("button-disabled"));t.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click()})}),a.find(".redux-repeater-accordion-repeater").hasClass("close-me")&&a.find(".redux-repeaters-remove").click(),String.prototype.reduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),r)},a.find(".redux-repeaters-add").click(function(){if(!e(this).hasClass("button-disabled")){var t=e(this).parent().find(".redux-repeater-accordion:first"),i=t.find(".redux-repeater-accordion-repeater").length,d=t.attr("data-id");if(""!=r.repeater[d].limit&&i>=r.repeater[d].limit)e(this).addClass("button-disabled");else{i++;var n=t.find(".redux-repeater-accordion-repeater").size();t.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&t.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").click();0==(c=t.find(".redux-repeater-accordion-repeater:first").clone(!0,!0)).length&&(c=r.repeater[d].blank),c.attr("data-sortid").length&&c.attr("data-sortid",n);var c,o=c.find("input.slide-title");if(o.attr("name",o.attr("name").replace("[0]","["+n+"]")),o.attr("data-key",n),o.val(""),r.repeater[d]){r.repeater[d].count=a.find(".redux-repeater-header").length;var s=r.repeater[d].html.reduxReplaceAll("99999",n);e(c).find(".redux-repeater-header").text("")}c.find(".ui-accordion-content").html(s),e(t).append(c),redux.field_objects.repeater.sort_repeaters(c),(c=e(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click(),c.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(r){var t;t=e(r.target).find(":selected").text().length>0?e(r.target).find(":selected").text():e(r.target).val(),e(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(t)}),r.repeater[d].limit>0&&i>=r.repeater[d].limit&&e(this).addClass("button-disabled"),!0===l&&i>=2&&a.find(".redux-repeater-accordion").accordion("option",{active:!1})}}})}}})}}(jQuery);