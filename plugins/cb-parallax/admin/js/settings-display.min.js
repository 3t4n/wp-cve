"use strict";(function(b){function a(){this.cb_Parallax=Cb_Parallax_Admin;this.canParallax=undefined!==this.cb_Parallax.image_options.can_parallax?this.cb_Parallax.image_options.can_parallax:"0";this.parallaxEnabledSwitch=null;this.placeholderImage=null;this.backgroundImage=null;this.attachmentId=null;this.CheckBoxes=null;this.parallaxDirectionSelectBox=null;this.addMediaButton=null;this.removeMediaButton=null;this.settingsForm=null;this.submitButton=null;this.resetButton=null;this.allImageOptions=null;this.staticImageOptions=null;this.parallaxImageOptions=null;this.attachmentWidth=this.cb_Parallax.image_data.image_width!==undefined?this.cb_Parallax.image_data.image_width:0;this.attachmentHeight=this.cb_Parallax.image_data.image_height!==undefined?this.cb_Parallax.image_data.image_height:0;this.verticalScrollDirectionContainer=null;this.horizontalScrollDirectionContainer=null;this.verticalAlignmentContainer=null;this.horizontalAlignmentContainer=null;this.direction=undefined!==this.cb_Parallax.image_options.cb_parallax_direction?this.cb_Parallax.image_options.cb_parallax_direction:this.cb_Parallax.default_options.cb_parallax_direction}a.prototype={constructor:function(){this.cb_Parallax=Cb_Parallax_Admin;this.canParallax=undefined!==this.cb_Parallax.image_options.can_parallax?this.cb_Parallax.image_options.can_parallax:"0";this.parallaxEnabledSwitch=null;this.placeholderImage=null;this.backgroundImage=null;this.attachmentId=null;this.CheckBoxes=null;this.parallaxDirectionSelectBox=null;this.addMediaButton=null;this.removeMediaButton=null;this.settingsForm=null;this.submitButton=null;this.resetButton=null;this.allImageOptions=null;this.staticImageOptions=null;this.parallaxImageOptions=null;this.attachmentWidth=this.cb_Parallax.image_data.image_width!==undefined?this.cb_Parallax.image_data.image_width:0;this.attachmentHeight=this.cb_Parallax.image_data.image_height!==undefined?this.cb_Parallax.image_data.image_height:0;this.verticalScrollDirectionContainer=null;this.horizontalScrollDirectionContainer=null;this.verticalAlignmentContainer=null;this.horizontalAlignmentContainer=null;this.direction=undefined!==this.cb_Parallax.image_options.cb_parallax_direction?this.cb_Parallax.image_options.cb_parallax_direction:this.cb_Parallax.default_options.cb_parallax_direction},init:function(){this.initColorpicker();this.initFancySelect();this.assembleSettingsContainers();this.localizeScript();this.initSettingsDisplay();this.addEvents();this.initContextualHelp()},assembleSettingsContainers:function(){this.allImageOptions=b("#cb_parallax_parallax_enabled_container, #cb_parallax_background_color_container, #cb_parallax_direction_container, #cb_parallax_vertical_scroll_direction_container, #cb_parallax_horizontal_scroll_direction_container, #cb_parallax_horizontal_alignment_container, #cb_parallax_vertical_alignment_container, #cb_parallax_overlay_image_container, #cb_parallax_overlay_opacity_container, #cb_parallax_overlay_color_container, #cb_parallax_background_repeat_container, #cb_parallax_position_x_container, #cb_parallax_position_y_container, #cb_parallax_background_attachment_container");this.parallaxImageOptions=b("#cb_parallax_parallax_enabled_container, #cb_parallax_background_color_container, #cb_parallax_direction_container, #cb_parallax_vertical_scroll_direction_container, #cb_parallax_horizontal_scroll_direction_container, #cb_parallax_horizontal_alignment_container, #cb_parallax_vertical_alignment_container, #cb_parallax_overlay_image_container, #cb_parallax_overlay_opacity_container, #cb_parallax_overlay_color_container");this.staticImageOptions=b("#cb_parallax_parallax_enabled_container, #cb_parallax_background_color_container, #cb_parallax_background_repeat_container, #cb_parallax_position_x_container, #cb_parallax_position_y_container, #cb_parallax_background_attachment_container, #cb_parallax_overlay_image_container, #cb_parallax_overlay_opacity_container, #cb_parallax_overlay_color_container");this.verticalScrollDirectionContainer=b("#cb_parallax_vertical_scroll_direction_container");this.horizontalScrollDirectionContainer=b("#cb_parallax_horizontal_scroll_direction_container");this.verticalAlignmentContainer=b("#cb_parallax_vertical_alignment_container");this.horizontalAlignmentContainer=b("#cb_parallax_horizontal_alignment_container");this.parallaxEnabledSwitch=b(".cb_parallax_parallax_enabled");this.placeholderImage=b(".cb_parallax_placeholder_image");this.backgroundImage=b(".cb_parallax_background_image");this.attachmentId=b(".cb_parallax_attachment_id");this.CheckBoxes=b(".cb-parallax-input-checkbox");this.parallaxDirectionSelectBox=b("[data-key='cb_parallax_direction']");this.parallaxDirectionSelectBoxTrigger=b("#cb_parallax_direction_container").find("div.trigger");this.parallaxSettingsTitle=b("h3.parallax");this.staticSettingsTitle=b("h3.static");this.addMediaButton=b(".cb-parallax-media-url");this.removeMediaButton=b(".cb-parallax-remove-media");this.settingsForm=b("#cb_parallax_settings_form");this.submitButton=b("#cb_parallax_form_submit");this.resetButton=b("#cb_parallax_form_reset")},initColorpicker:function(){b(".cb-parallax-color-picker").wpColorPicker()},initFancySelect:function(){b(".cb-parallax-fancy-select").fancySelect()},localizeScript:function(){b('<style>.cb-parallax-switch-input ~ .cb-parallax-switch-label:before{content:"'+this.cb_Parallax.strings.switches_text.Off+'";}</style>').appendTo("head");b('<style>.cb-parallax-switch-input:checked ~ .cb-parallax-switch-label:after{content:"'+this.cb_Parallax.strings.switches_text.On+'";}</style>').appendTo("head")},addEvents:function(){this.CheckBoxes.on("click",this.toggleCheckbox);this.parallaxDirectionSelectBoxTrigger.on("change",{context:this},this.toggleParallaxEnabledCheckbox);this.parallaxEnabledSwitch.on("change",{context:this},this.initSettingsDisplay);this.parallaxDirectionSelectBox.on("change.fs",{context:this},this.toggleParallaxEnabledCheckbox);this.removeMediaButton.on("click",{context:this},this.removeMedia);this.addMediaButton.on("click",{context:this},this.addMedia);this.submitButton.on("click",{context:this},this.cbparallaxSaveOptions);this.resetButton.on("click",{context:this},this.cbparallaxResetOptions)},initSettingsDisplay:function(c){var d=this;if(undefined!==c){d=c.data.context}d.allImageOptions.hide();d.removeMediaButton.hide();d.removeMediaButton.show();if("1"===d.canParallax&&d.parallaxEnabledSwitch.prop("checked")){d.staticImageOptions.hide();d.parallaxImageOptions.show()}else{d.parallaxImageOptions.hide();d.staticImageOptions.show()}d.toggleParallaxEnabledCheckbox()},toggleParallaxEnabledCheckbox:function(c){var d=this;if(undefined!==c){c.preventDefault();d=c.data.context}d.parallaxSettingsTitle.addClass("hidden");d.staticSettingsTitle.addClass("hidden");b(d.parallaxDirectionSelectBox).trigger("change.$");if(""!==d.backgroundImage.attr("src")){d.parallaxSettingsTitle.removeClass("hidden");if(d.parallaxEnabledSwitch.prop("checked")){if(d.parallaxDirectionSelectBoxTrigger.text()==="horizontal"){d.horizontalScrollDirectionContainer.show();d.verticalAlignmentContainer.show();d.verticalScrollDirectionContainer.hide();d.horizontalAlignmentContainer.hide()}else{d.verticalScrollDirectionContainer.show();d.horizontalAlignmentContainer.show();d.horizontalScrollDirectionContainer.hide();d.verticalAlignmentContainer.hide()}}else{d.verticalScrollDirectionContainer.hide();d.horizontalAlignmentContainer.hide();d.horizontalScrollDirectionContainer.hide();d.verticalAlignmentContainer.hide()}}else{d.verticalScrollDirectionContainer.hide();d.horizontalAlignmentContainer.hide();d.horizontalScrollDirectionContainer.hide();d.verticalAlignmentContainer.hide();d.staticSettingsTitle.removeClass("hidden")}},toggleCheckbox:function(){if("0"===b(this).val()){b(this).val("1")}else{b(this).val("0")}},addMedia:function(c){c.preventDefault();var d=c.data.context;var e=wp.media({className:"media-frame cb-parallax-frame",frame:"select",multiple:false,title:cbParallaxMediaFrame.title,library:{type:"image"},button:{text:cbParallaxMediaFrame.button}});e.on("select",function(){var f=e.state().get("selection").first().toJSON();d.attachmentId.val(f.id);d.backgroundImage.attr("src",f.url);d.placeholderImage.hide();b("[data-key='cb_parallax_background_image_url']").val(f.url);b("[data-key='cb_parallax_background_image_url_hidden']").val(f.url);b("[data-key='cb_parallax_attachment_id']").val(f.id);d.addMediaButton.addClass("disabled");d.attachmentHeight=f.height;d.attachmentWidth=f.width;d.initSettingsDisplay()});e.open()},removeMedia:function(c){c.preventDefault();var d=c.data.context;d.backgroundImage.attr("src","");d.placeholderImage.show();d.attachmentId.val("");d.attachmentHeight=0;d.attachmentWidth=0;b("[data-key='cb_parallax_background_image_url_hidden']").val("");b("[data-key='cb_parallax_attachment_id']").val("");d.addMediaButton.removeClass("disabled");d.initSettingsDisplay();return false},cbparallaxSaveOptions:function(e){e.preventDefault();var h=e.data.context;var c={};var d=h.settingsForm.data("form");var g="image"===d?h.cb_Parallax.option_keys.image:h.cb_Parallax.option_keys.all;b.each(g,function(){c[this]=b("[data-key='"+this+"']").val()});var f={action:"cb_parallax_save_options",nonce:h.settingsForm.data("nonce"),input:c,post_id:h.settingsForm.data("postid")};b.post(ajaxurl,f,function(i){if(i.success===true){alert(h.cb_Parallax.strings.save_options_ok)}else{alert(h.cb_Parallax.strings.save_options_error)}});h.initSettingsDisplay();return false},cbparallaxResetOptions:function(c){c.preventDefault();var e=c.data.context;var d={action:"cb_parallax_reset_options",nonce:e.settingsForm.data("nonce"),post_id:e.settingsForm.data("postid")};if(!confirm(e.cb_Parallax.strings.reset_settings_confirmation)){return false}b.post(ajaxurl,d,function(f){if(f.success===true){e.resetOptionsPageInputFields();b("");alert(e.cb_Parallax.strings.reset_options_ok)}else{alert(e.cb_Parallax.strings.reset_options_error)}})},resetOptionsPageInputFields:function(){var c=this.settingsForm.data("form");var d="image"===c?this.cb_Parallax.option_keys.image:this.cb_Parallax.option_keys.all;var e=this;b.each(d,function(){var g=b("[data-key="+this+"]");var i=e.cb_Parallax.default_options[this];if("checkbox"===g.attr("type")){b(g).val("0").prop("checked","")}else{if("text"===g.attr("type")){b(g).wpColorPicker("color","transparent")}else{if("select"===g.attr("type")){g.val(i);var h=b(g).parent().find("ul.options");var f=b(h).find("li");b(f).removeAttr("class");b(h).find(b("li[data-raw-value="+this+"]")).addClass("selected");b(g).parent().find(".trigger").html(i)}else{b(g).val(i)}}}});this.backgroundImage.attr("src","");this.placeholderImage.show();b("[data-key='cb_parallax_background_image_url_hidden']").val("");b("[data-key='cb_parallax_attachment_id']").val("")},initContextualHelp:function(){b("#cb-parallax-help-tabs").tabs()}};b(document).one("ready",function(){var c=new a();c.init()})})(jQuery);