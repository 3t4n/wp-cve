jQuery.fn.viwcuf_get_variations=function(t){return new viwcuf_get_variation(this,t),this};var viwcuf_get_variation=function(t,e){let i=this;i.wc_ajax_url=e.wc_ajax_url||"",i.form=t,i.product_id=parseInt(t.data("product_id")),i.variations=t.data("product_variations")||"",i.is_ajax=!i.variations,i.xhr=!1,i.img_product=i.get_product_img(t),i.img_src=i.img_product.attr("data-src")||i.img_product.attr("src")||i.img_product.attr("content")||i.img_product.attr("srcset")||"",i.current_attr=e.current_attr||{},t.on("viwcuf_check_variations",{viwcuf_get_variation:i},i.find_variation),t.on("change","select",{viwcuf_get_variation:i},i.onChange),setTimeout((function(e){let i=0;if(t.closest(".vi-wcuf-product-wrap-checked").length){let i=t.closest(".vi-wcuf-product-wrap-checked").data("variation")||{};t.find("select").each((function(){let t=jQuery(this).attr("name"),a=i[t]||"";e.current_attr[jQuery(this).data("attribute_name")]=a,jQuery(this).val(a).trigger("change")}))}else t.find("select").each((function(){let t=jQuery(this).val();e.current_attr[jQuery(this).data("attribute_name")]=t,t?(i++,jQuery(this).val(t)):jQuery(this).closest(".vi-wcuf-swatches-value").data("selected")?(e.current_attr[jQuery(this).data("attribute_name")]=jQuery(this).closest(".vi-wcuf-swatches-value").data("selected"),jQuery(this).val(jQuery(this).closest(".vi-wcuf-swatches-value").data("selected")).addClass("viwcuf-attribute-options-selected").trigger("change")):jQuery(this).closest(".vi-wcuf-swatches-value").find(".vi-wpvs-option-wrap.vi-wpvs-option-wrap-selected").removeClass("vi-wpvs-option-wrap-selected")}));i&&t.trigger("viwcuf_check_variations")}),100,i)};viwcuf_get_variation.prototype.onChange=function(t){let e=t.data.viwcuf_get_variation,i=e.form;i.find('input[name="variation_id"], input.variation_id').val("").trigger("change");let a=jQuery(this).val()||"";if(jQuery(this).hasClass("viwcuf-attribute-options-selected")&&(a=jQuery(this).closest(".vi-wcuf-swatches-value").data("selected"),jQuery(this).removeClass("viwcuf-attribute-options-selected")),e.current_attr[jQuery(this).data("attribute_name")]=a,Object.keys(e.current_attr).length<i.find(".viwcuf-attribute-options").length)return!1;e.is_ajax||i.trigger("woocommerce_variation_select_change"),i.trigger("viwcuf_check_variations"),i.trigger("woocommerce_variation_has_changed")},viwcuf_get_variation.prototype.find_variation=function(t){let e=t.data.viwcuf_get_variation,i=null,a=!1,c=e.current_attr,r=e.form,o=e.variations;return r.hasClass("vi-wcuf-cart-form-variable")?(jQuery.each(c,(function(t,e){if(!e)return a=!0,!1})),a?(e.update_attributes(c,o,r,e),e.show_variation(e,null,r),!1):void(e.is_ajax?(e.xhr&&e.xhr.abort(),o?(jQuery.each(o,(function(t,a){if(e.check_is_equal(c,a.attributes))return i=a,!1})),i?e.show_variation(e,i,r):o.length<parseInt(r.data("variation_count")||0)?e.call_ajax(c,o,r,e):e.show_variation(e,null,r)):(o=[],e.call_ajax(c,o,r,e))):(jQuery.each(o,(function(t,a){if(e.check_is_equal(c,a.attributes))return i=a,!1})),i||r.find("select").each((function(t,e){jQuery(e).val(""),c[jQuery(e).data("attribute_name")]=""})),e.update_attributes(c,o,r,e),e.show_variation(e,i,r)))):r.closest(".vi-wcuf-product-wrap-checked").length?(r.find("select").each((function(){let t=jQuery(this).val();jQuery(this).find("option").each((function(){jQuery(this).attr("value")!=t&&jQuery(this).addClass("vi-wcuf-option-disabled")}))})),!1):(jQuery.each(c,(function(t,e){if(!e)return a=!0,!1})),a?(r.find(".vi-wcuf-us-product-bt-atc, vi-wcuf-swatches-control-footer-bt-ok").addClass("vi-wcuf-button-swatches-disable"),r.closest(".vi-wcuf-ob-product-wrap").find(".vi-wcuf-ob-checkbox").addClass("vi-wcuf-ob-checkbox-swatches-disable")):(r.find(".vi-wcuf-us-product-bt-atc, vi-wcuf-swatches-control-footer-bt-ok").removeClass("vi-wcuf-button-swatches-disable"),r.closest(".vi-wcuf-ob-product-wrap").find(".vi-wcuf-ob-checkbox").removeClass("vi-wcuf-ob-checkbox-swatches-disable")),!1)},viwcuf_get_variation.prototype.update_attributes=function(t,e,i,a){if(a.is_ajax)return!1;i.find("select").each((function(i,c){let r,o=jQuery(c),s=o.data("attribute_name")||o.attr("name"),n=o.data("show_option_none"),u=o.val()||"",d=!0,l=jQuery("<select/>"),v=":gt(0)";if(!o.data("attribute_html")){let t=o.clone();t.find("option").removeAttr("disabled attached selected"),o.data("attribute_options",t.find("option"+v).get()),o.data("attribute_html",t.html())}l.html(o.data("attribute_html"));let f=jQuery.extend(!0,{},t);f[s]="";let _=[];for(let t=0;t<e.length;t++){let i=e[t];a.check_is_equal(f,i.attributes)&&_.push(i)}for(let t in _){if(void 0===_[t])continue;let e=_[t].attributes;for(let i in e){if(!e.hasOwnProperty(i))continue;let a=e[i],c="";if(i===s)if(_[t].variation_is_active&&(c="enabled"),a){a=jQuery("<div/>").html(a).text();let t=l.find("option");if(t.length)for(let e=0,i=t.length;e<i;e++){let i=jQuery(t[e]);if(a===i.val()){i.addClass("attached "+c);break}}}else l.find("option:gt(0)").addClass("attached "+c)}}r=l.find("option.attached").length,u&&(d=!1,0!==r&&l.find("option.attached.enabled").each((function(){var t=jQuery(this).val();if(u===t)return d=!0,!1}))),r>0&&u&&d&&"no"===n&&(l.find("option:first").remove(),v=""),l.find("option"+v+":not(.attached)").remove(),o.html(l.html()),o.find("option"+v+":not(.enabled)").prop("disabled",!0),u?d?o.val(u):o.val("").change():o.val("")})),i.trigger("woocommerce_update_variation_values")},viwcuf_get_variation.prototype.call_ajax=function(t,e,i,a){t.product_id=a.product_id,i.hasClass("vi-wcuf-ob-cart-form")?(t.wcuf_pd_type="order_bump",t.discount_type=i.find(".viwcuf_ob_discount_type").val(),t.discount_amount=i.find(".viwcuf_ob_discount_amount").val()):t.wcuf_pd_type="upsell_funnel",t.viwcuf_nonce=viwcuf_frontend_us_params&&viwcuf_frontend_us_params.nonce?viwcuf_frontend_us_params.nonce:viwcuf_frontend_ob_params&&viwcuf_frontend_ob_params.nonce?viwcuf_frontend_ob_params.nonce:"",a.xhr=jQuery.ajax({url:a.wc_ajax_url.toString().replace("%%endpoint%%","viwcuf_get_variation"),type:"POST",data:t,beforeSend:function(){i.addClass("vi-wcuf-product-loading").closest(".vi-wcuf-product").addClass("vi-wcuf-product-loading")},success:function(c){a.show_variation(a,c,i),c&&(e[e.length||0]=c),delete t.product_id,delete t.wcuf_pd_type,delete t.discount_type,delete t.discount_amount,delete t.viwcuf_nonce},complete:function(){i.removeClass("vi-wcuf-product-loading").closest(".vi-wcuf-product").removeClass("vi-wcuf-product-loading")}})},viwcuf_get_variation.prototype.show_variation=function(t,e,i){let a=t.img_product;if(e){let c=!0;e.is_purchasable&&e.is_in_stock&&e.variation_is_visible||(c=!1);let r=e.viwcuf_price_html||e.price_html||"";r&&(i.find(".single_variation").removeClass("vi-wcuf-disable").html('<div class ="woocommerce-variation-price" >'+r+"</div>"),i.find(".vi-wcuf-swatches-control-content-price").removeClass("vi-wcuf-disable")),a&&jQuery(a).length&&(jQuery(a).parent().is("picture")&&jQuery(a).parent().find("source").each((function(t,i){jQuery(i).attr({srcset:e.image.thumb_src})})),a.attr({src:e.image.thumb_src,srcset:e.image.thumb_src})),c?(t.set_add_to_cart(e.variation_id,i),i.find(".vi-wcuf-us-product-bt-atc, vi-wcuf-swatches-control-footer-bt-ok").removeClass("vi-wcuf-button-swatches-disable"),i.closest(".vi-wcuf-ob-product-wrap").find(".vi-wcuf-ob-checkbox").removeClass("vi-wcuf-ob-checkbox-swatches-disable"),i.closest(".vi-wcuf-product-wrap-checked").length&&i.find("select").each((function(){let t=jQuery(this).val();jQuery(this).find("option").each((function(){jQuery(this).attr("value")!=t&&jQuery(this).addClass("vi-wcuf-option-disabled")})),jQuery(this).closest(".vi-wpvs-variation-wrap-wrap").find(".vi-wpvs-option-wrap").each((function(){jQuery(this).data("attribute_value")==t?jQuery(this).removeClass("vi-wpvs-option-wrap-default").addClass("vi-wpvs-option-wrap-selected"):jQuery(this).removeClass("vi-wpvs-option-wrap-selected vi-wpvs-option-wrap-default").addClass("vi-wpvs-option-wrap-disable")}))}))):(t.set_add_to_cart("",i),i.find(".vi-wcuf-us-product-bt-atc, vi-wcuf-swatches-control-footer-bt-ok").addClass("vi-wcuf-button-swatches-disable"),i.closest(".vi-wcuf-ob-product-wrap").find(".vi-wcuf-ob-checkbox").addClass("vi-wcuf-ob-checkbox-swatches-disable")),i.trigger("viwpvs_show_variation",[e,c])}else a&&jQuery(a).length&&(jQuery(a).parent().is("picture")&&jQuery(a).parent().find("source").each((function(e,i){jQuery(i).attr({srcset:t.img_src})})),a.attr({src:t.img_src,srcset:t.img_src})),t.set_add_to_cart("",i),i.find(".single_variation").addClass("vi-wcuf-disable"),i.find(".vi-wcuf-swatches-control-content-price").addClass("vi-wcuf-disable"),i.find(".vi-wcuf-us-product-bt-atc, vi-wcuf-swatches-control-footer-bt-ok").addClass("vi-wcuf-button-swatches-disable"),i.closest(".vi-wcuf-ob-product-wrap").find(".vi-wcuf-ob-checkbox").addClass("vi-wcuf-ob-checkbox-swatches-disable"),i.trigger("viwpvs_hide_variation")},viwcuf_get_variation.prototype.set_add_to_cart=function(t,e){t=t||0,e.find(".variation_id").val(t)},viwcuf_get_variation.prototype.get_product_img=function(t){let e=t.closest(".vi-wcuf-product"),i=!1;return e&&e.find("img")&&(i=e.find("img").first()),i},viwcuf_get_variation.prototype.check_is_equal=function(t,e){let i=Object.getOwnPropertyNames(t),a=Object.getOwnPropertyNames(e);if(i.length!==a.length)return!1;for(let a=0;a<i.length;a++){let c=i[a],r=t[c],o=e[c];if(void 0!==r&&void 0!==o&&0!==r.length&&0!==o.length&&r!==o)return!1}return!0};