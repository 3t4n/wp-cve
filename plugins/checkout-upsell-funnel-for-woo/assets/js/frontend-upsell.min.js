var viwcuf_countdown,viwcuf_count_time,viwcuf_atc=[],viwcuf_remove_cart_item=[];jQuery((function(t){t(window).on("load",(function(){"use strict";if(!viwcuf_frontend_us_params)return!1;let c=e;c.wc_ajax_url=viwcuf_frontend_us_params.wc_ajax_url,c.checkout_url=viwcuf_frontend_us_params.checkout_url,c.is_redirect_page=viwcuf_frontend_us_params.is_redirect_page,c.is_popup=viwcuf_frontend_us_params.is_popup,c.position=viwcuf_frontend_us_params.position,c.limit_rows=viwcuf_frontend_us_params.limit_rows,c.pd_hide_after_atc=viwcuf_frontend_us_params.pd_hide_after_atc,c.i18n_unavailable_text=viwcuf_frontend_us_params.i18n_unavailable_text||"Sorry, this product is unavailable. Please choose a different combination.",c.i18n_make_a_selection_text=viwcuf_frontend_us_params.i18n_make_a_selection_text||"Please select some product options before adding {product_name} to your cart.",c.i18n_quantity_error=viwcuf_frontend_us_params.i18n_quantity_error||"The maximum number of {product_name} quantity is {pd_limit_quantity}",c.$wrap=t(".viwcuf-checkout-funnel-container"),c.$checkout_form=t("form.checkout"),c.init()}));var e={wc_ajax_url:"",checkout_url:"",is_redirect_page:"",limit_rows:"",pd_hide_after_atc:"",i18n_unavailable_text:"",i18n_make_a_selection_text:"",i18n_quantity_error:"",is_popup:"",position:"",$supports_html5_storage:"sessionStorage"in window&&null!==window.sessionStorage,$wrap:t(".viwcuf-checkout-funnel-container"),$checkout_form:t("form.checkout"),init:function(){let c=this;c.$wrap.find(".vi-wcuf-us-shortcode-wrap").length&&c.design(),c.is_popup||t(document).on("click","#place_order",(function(t){c.$wrap.remove()})),!c.is_redirect_page&&c.is_popup&&(t(".viwcuf_us_position").length||c.$checkout_form.append('<input type="hidden" name="viwcuf_us_position" class="viwcuf_us_position" value="'+c.position+'">'),c.$checkout_form.find("#payment_method_twocheckout_inline").length&&c.$checkout_form.on("click","#place_order",(function(){"footer"===c.position?(c.$checkout_form.find(".viwcuf_us_position").remove(),c.remove_session()):c.create_session()})),c.$checkout_form.on("submit",(function(){c.$wrap.hasClass("viwcuf-checkout-funnel-container-popup-init")||c.create_session()}))),t(document.body).on("updated_checkout",(function(e,a){c.$wrap=t(".viwcuf-checkout-funnel-container"),c.$checkout_form=t("form.checkout"),c.$wrap.find(".vi-wcuf-us-shortcode-wrap").length&&c.design(),c.$wrap.find(".vi-wcuf-us-product-bt-atc-loading").removeClass("vi-wcuf-us-product-bt-atc-loading"),c.$wrap.find(".vi-wcuf-product-loading").removeClass("vi-wcuf-product-loading")})),t(document.body).on("checkout_error",(function(e,a){t(".vi-wcaio-sidebar-cart-overlay, .vi-wcaio-sidebar-cart-close-wrap").removeClass("vi-wcaio-not-hidden"),t(".vi-wcuf-loading-wrap").addClass("vi-wcuf-disable"),(c.is_redirect_page||c.$wrap.hasClass("viwcuf-checkout-funnel-container-popup-init"))&&(t("html, body").stop(),t.ajax({type:"post",url:c.wc_ajax_url.toString().replace("%%endpoint%%","viwcuf_us_set_session"),data:{time_end:1,viwcuf_nonce:viwcuf_frontend_us_params.nonce,error_message:a||t(".woocommerce-error, .woocommerce-message, .woocommerce-NoticeGroup-checkout").html()},complete:function(){c.is_redirect_page}}));let i=t('[data-viwcufenable="yes"]').data("viwcufdata");if(!i&&a){i=/data-viwcufdata=\"(.*?)\"/g.exec(a),null!==i&&(i=i[1].replace(/&quot;/g,'"'),i=JSON.parse(i))}if(!i)return c.remove_session(),!1;if(t("html, body").stop(),!i.product_ids)return c.remove_session(),c.$wrap.trigger("vi_wcuf_continue_checkout"),!1;if(i.is_popup)return i.popup_html?(t(".viwcuf-checkout-us-container").html(i.popup_html),c.$wrap=t(".viwcuf-checkout-funnel-container"),c.$checkout_form=t("form.checkout"),c.$checkout_form.find("#woocommerce-process-checkout-nonce").replaceWith(i.wc_process_checkout_nonce),c.$wrap.addClass("viwcuf-checkout-funnel-container-popup-init").removeClass("vi-wcuf-disable"),c.design()):(c.remove_session(),c.$wrap.trigger("vi_wcuf_continue_checkout")),!1;let u=i.redirect_url;if(u){if(!c.$supports_html5_storage||!sessionStorage.getItem("viwcuf_upsell_funnel_session"))return c.$wrap.trigger("vi_wcuf_continue_checkout"),!1;u=u.replace(/&amp;/gm,"&").replace(/&#38;/gm,"&"),c.$checkout_form.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),window.location=u}else c.remove_session(),c.$wrap.trigger("vi_wcuf_continue_checkout");return!1})),t(document).on("change",".vi-wcuf-us-swatches-popup-wrap .viwcuf_us_product_qty",(function(e){e.preventDefault(),e.stopPropagation();let c,a=parseFloat(t(this).val()||0),i=parseFloat(t(this).attr("min")||0),u=parseFloat(t(this).parent().find(".viwcuf_us_qty_available").val()||0);c=a,i>a&&(c=i),u>-1&&u<a&&(c=u),t(this).val(c)})),t(document).on("click",".vi-wcuf-us-swatches-popup-overlay",(function(){t(".vi-wcuf-us-swatches-popup-wrap-wrap .vi-wcuf-swatches-control-footer-bt-cancel").trigger("click")})),t(document).on("click",".vi-wcuf-swatches-control-footer-bt-cancel",(function(){"footer"===c.position?(t(".viwcuf-checkout-funnel-container-popup-init").animate({left:"0"},500),t(".vi-wcuf-us-swatches-popup-wrap-wrap").animate({left:"100%"},500,(function(){t(".vi-wcuf-us-swatches-popup-wrap-wrap").remove()}))):t(".vi-wcuf-us-swatches-popup-wrap-wrap").remove();let e=t(this).hasClass("vi-wcuf-swatches-control-footer-bt-cancel-pause_countdown");t("html").removeClass("viwcuf-html-non-scroll"),t(".vi-wcuf-us-product-editing").removeClass("vi-wcuf-us-product-editing"),t(".vi-wcuf-swatches-selected-wrap-clicking").removeClass("vi-wcuf-swatches-selected-wrap-clicking"),e||c.run_countdown(viwcuf_count_time)})),t(document).on("click",".vi-wcuf-swatches-control-footer-bt-ok:not(.vi-wcuf-us-product-bt-atc-loading)",(function(a){a.stopPropagation(),a.preventDefault();let i=t(this),u=t(this).closest(".vi-wcuf-us-cart-form");if(i.hasClass("vi-wcuf-button-atc-disable-qty"))return c.show_message(c.i18n_quantity_error.replace("{product_name}",u.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",u.find(".viwcuf_us_qty_available").data("limit_quantity"))),u.find(".viwcuf_us_product_qty").val(0),c.run_countdown(viwcuf_count_time),!1;let o=!0;if(u.find(".viwcuf-attribute-options").each((function(e,c){if(!t(c).val())return o=!1,!1})),!o)return c.show_message(c.i18n_make_a_selection_text.replace("{product_name}",u.find(".viwcuf_us_qty_available").data("product_name"))),c.run_countdown(viwcuf_count_time),!1;if(i.hasClass("vi-wcuf-button-swatches-disable")||i.hasClass("vi-wcuf-button-atc-disable"))return c.show_message(c.i18n_unavailable_text),c.run_countdown(viwcuf_count_time),!1;let s=parseFloat(u.find(".viwcuf_us_product_qty").val()),n=parseFloat(u.find(".viwcuf_us_qty_available").val());if(!n||s>n&&n>-1)return c.show_message(c.i18n_quantity_error.replace("{product_name}",u.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",u.find(".viwcuf_us_qty_available").data("limit_quantity"))),u.find(".viwcuf_us_product_qty").val(1),c.run_countdown(viwcuf_count_time),!1;t(".vi-wcuf-swatches-selected-wrap.vi-wcuf-swatches-selected-wrap-clicking span").html(e.get_attribute_selected(u)),i.addClass("vi-wcuf-us-product-bt-atc-loading"),c.add_to_cart(i,n,s,u,"btn_popup")})),t(document).on("click",".vi_wcuf_us_change_qty",(function(e){e.preventDefault(),e.stopPropagation();let c=t(this).closest(".vi-wcuf-us-quantity-wrap").find(".viwcuf_us_product_qty"),a=parseFloat(c.val()),i=parseFloat(c.attr("step"));t(this).hasClass("vi_wcuf_us_plus")?a+=i:a-=i,c.val(a).trigger("change")}))},init_events:function(){let c=this;c.$wrap.on("vi_wcuf_continue_checkout",c.continue_checkout),c.$wrap.on("click",".vi-wcuf-us-shortcode-bt-continue-wrap",(function(t){t.stopPropagation(),t.preventDefault(),clearInterval(viwcuf_countdown),c.$wrap.trigger("vi_wcuf_continue_checkout")})),c.$wrap.on("click",".vi-wcuf-us-shortcode-bt-pause-wrap",(function(){clearInterval(viwcuf_countdown),c.$wrap.find(".vi-wcuf-us-shortcode-countdown-wrap").addClass("viwcuf-countdown-pausing").addClass("viwcuf-hidden"),t.ajax({type:"post",url:c.wc_ajax_url.toString().replace("%%endpoint%%","viwcuf_us_set_session"),data:{time_pause:1,viwcuf_nonce:viwcuf_frontend_us_params.nonce}})})),c.$wrap.on("click",".vi-wcuf-us-checkbox.vi-wcuf-us-product-bt-atc:not(.vi-wcuf-us-product-bt-atc-loading)",(function(e){clearInterval(viwcuf_countdown);let a=t(this),i=a.closest(".vi-wcuf-us-product");if(a.hasClass("vi-wcuf-us-checkbox-checked"))return a.addClass("vi-wcuf-us-product-bt-atc-loading"),c.remove_form_cart(a,i),!1;if(i.find(".vi-wcuf-cart-form-swatches").length)return i.find(".vi-wcuf-swatches-selected-wrap").trigger("click"),!1;let u=i.find(".vi-wcuf-us-cart-form");if(a.hasClass("vi-wcuf-button-atc-disable-qty"))return c.show_message(c.i18n_quantity_error.replace("{product_name}",u.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",u.find(".viwcuf_us_qty_available").data("limit_quantity"))),u.find(".viwcuf_us_product_qty").val(0),c.run_countdown(viwcuf_count_time),!1;if(a.hasClass("vi-wcuf-button-swatches-disable")||a.hasClass("vi-wcuf-button-atc-disable"))return c.show_message(c.i18n_unavailable_text),c.run_countdown(viwcuf_count_time),!1;let o=parseFloat(u.find(".viwcuf_us_product_qty").val()),s=parseFloat(u.find(".viwcuf_us_qty_available").val());if(!s||s>-1&&o>s)return c.show_message(c.i18n_quantity_error.replace("{product_name}",u.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",u.find(".viwcuf_us_qty_available").data("limit_quantity"))),u.find(".viwcuf_us_product_qty").val(1),c.run_countdown(viwcuf_count_time),!1;a.addClass("vi-wcuf-us-product-bt-atc-loading"),c.add_to_cart(a,s,o,u,"checkbox")})),c.$wrap.on("click",".vi-wcuf-swatches-selected-wrap:not(.vi-wcuf-swatches-selected-wrap-clicking):not(.vi-wcuf-swatches-selected-wrap-not-click)",(function(a){a.stopPropagation(),a.preventDefault(),clearInterval(viwcuf_countdown),t(this).addClass("vi-wcuf-swatches-selected-wrap-clicking");let i=t(this).closest(".vi-wcuf-us-product");i.addClass("vi-wcuf-us-product-editing"),t("html").addClass("viwcuf-html-non-scroll"),t("body").append('<div class="vi-wcuf-us-swatches-popup-wrap-wrap"><div class="vi-wcuf-us-swatches-popup-wrap"></div><div class="vi-wcuf-us-swatches-popup-overlay"></div></div>');let u=t(".vi-wcuf-us-swatches-popup-wrap");"footer"===c.position&&u.parent().css({left:"100%"}),c.$wrap.hasClass("viwcuf-checkout-funnel-container-rtl")&&u.addClass("vi-wcuf-us-swatches-popup-wrap-rtl"),i.find(".vi-wcuf-us-cart-form").clone().appendTo(u),u.find(".vi-wcuf-us-cart-form").append('<span class="vi-wcuf-swatches-control-footer-bt-cancel">x</span>'),u.find(".vi-wcuf-swatches-selected-wrap").remove(),u.find(".vi-wcuf-swatches-control-wrap-wrap").removeClass("vi-wcuf-disable"),u.find('.viwcuf_us_product_qty[type="hidden"]').length&&u.find(".vi-wcuf-swatches-control-content-quantity").addClass("vi-wcuf-disable"),u.find(".vi-wcuf-cart-form-swatches:not(.vi-wcuf-cart-form-swatches-init)").each((function(){t(this).find("select").each((function(e,c){t(c).val(t(c).closest(".vi-wcuf-swatches-value").data("selected")||t(c).closest(".vi-wcuf-swatches-value").find(".vs-option-wrap-selected").data("attribute_value")||"")})),t(this).addClass("vi-wcuf-cart-form-swatches-init vi_wpvs_variation_form").viwcuf_get_variations({wc_ajax_url:e.wc_ajax_url}),t(this).find(".babystreet-wcs-swatches").length&&t(this).babystreet_wcs_variation_swatches_form()})),t(document.body).trigger("vi_wpvs_variation_form"),"footer"===c.position&&(t(".viwcuf-checkout-funnel-container-popup-init").animate({left:"-100%"},500),u.parent().animate({left:"0"},500))})),c.$wrap.on("change",".viwcuf_us_product_qty",(function(){let e,c=parseFloat(t(this).val()||0),a=parseFloat(t(this).attr("min")||0),i=parseFloat(t(this).parent().find(".viwcuf_us_qty_available").val()||0);e=c,a>c&&(e=a),i>-1&&i<c&&(e=i),t(this).val(e)})),c.$wrap.on("click",".vi-wcuf-us-product-bt-remove:not(.vi-wcuf-us-product-bt-atc-loading)",(function(e){e.stopPropagation(),e.preventDefault(),clearInterval(viwcuf_countdown),c.remove_form_cart(t(this),t(this).closest(".vi-wcuf-us-product-wrap-wrap"))})),c.$wrap.on("click",".vi-wcuf-us-product-bt-atc:not(.vi-wcuf-us-checkbox):not(.vi-wcuf-us-product-bt-atc-loading)",(function(e){e.stopPropagation(),e.preventDefault(),clearInterval(viwcuf_countdown);let a=t(this),i=t(this).closest(".vi-wcuf-us-cart-form");if(a.hasClass("vi-wcuf-button-atc-disable-qty"))return c.show_message(c.i18n_quantity_error.replace("{product_name}",i.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",i.find(".viwcuf_us_qty_available").data("limit_quantity"))),i.find(".viwcuf_us_product_qty").val(0),c.run_countdown(viwcuf_count_time),!1;let u=!0;if(i.find(".viwcuf-attribute-options").each((function(e,c){if(!t(c).val())return u=!1,!1})),!u)return c.show_message(c.i18n_make_a_selection_text.replace("{product_name}",i.find(".viwcuf_us_qty_available").data("product_name"))),c.run_countdown(viwcuf_count_time),!1;if(a.hasClass("vi-wcuf-button-swatches-disable")||a.hasClass("vi-wcuf-button-atc-disable"))return c.show_message(c.i18n_unavailable_text),c.run_countdown(viwcuf_count_time),!1;let o=parseFloat(i.find(".viwcuf_us_product_qty").val()),s=parseFloat(i.find(".viwcuf_us_qty_available").val());if(!s||s>-1&&o>s)return c.show_message(c.i18n_quantity_error.replace("{product_name}",i.find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",i.find(".viwcuf_us_qty_available").data("limit_quantity"))),i.find(".viwcuf_us_product_qty").val(1),c.run_countdown(viwcuf_count_time),!1;a.addClass("vi-wcuf-us-product-bt-atc-loading"),c.add_to_cart(a,s,o,i)})),c.$wrap.on("click",".vi-wcuf-us-shortcode-bt-alltc:not(.vi-wcuf-us-shortcode-bt-alltc-loading)",(function(a){a.stopPropagation(),a.preventDefault();let i,u=[],o=c.$wrap.find(".vi-wcuf-us-product-wrap-wrap");if(o.each((function(e,a){let u=parseFloat(t(a).find(".viwcuf_us_quantity").val()||0),o=parseFloat(t(a).find(".viwcuf_us_qty_available").val()||0);o>-1&&o<1?(t(a).find(".vi-wcuf-us-product-bt-atc").addClass("vi-wcuf-button-atc-disable-qty"),t(a).find("select.viwcuf-attribute-options").addClass("viwcuf-attribute-options-check")):o>-1&&u>o&&(i=c.i18n_quantity_error.replace("{product_name}",t(a).find(".viwcuf_us_qty_available").data("product_name")).replace("{pd_limit_quantity}",t(a).find(".viwcuf_us_qty_available").data("limit_quantity")))})),i)return c.show_message(i),!1;if(o.find(".viwcuf-attribute-options:not(.viwcuf-attribute-options-check)").each((function(e,a){if(!t(a).val())return i=c.i18n_make_a_selection_text.replace("{product_name}",t(a).closest(".vi-wcuf-us-product").find(".woocommerce-loop-product__title").text()),!1})),i)return c.show_message(i),!1;let s=t(this),n=c.$wrap.find(".vi-wcuf-us-product-bt-atc:not(.vi-wcuf-button-atc-disable-qty):not(.vi-wcuf-button-swatches-disable):not(.vi-wcuf-button-atc-disable)");return n.length&&(clearInterval(viwcuf_countdown),s.addClass("vi-wcuf-us-shortcode-bt-alltc-loading"),c.$wrap.find(".vi-wcuf-loading-wrap").removeClass("vi-wcuf-disable"),n.each((function(e,c){let a=t(c).closest(".vi-wcuf-us-cart-form");a.find(".vi-wcuf-add-to-cart, .vi-wcuf-product_id").val(a.data("product_id")||0),u[e]=a.find("select, input").serializeArray()})),t.ajax({type:"POST",url:c.wc_ajax_url.toString().replace("%%endpoint%%","viwcuf_us_add_all_to_cart"),data:{viwcuf_us_alltc:u,viwcuf_nonce:viwcuf_frontend_us_params.nonce},success:function(a){if("error"===a.status&&a.message)return c.show_message(a.message),!1;t(document.body).trigger("vi_wcuf_added_all_to_cart",[a.fragments,a.cart_hash,s]),t(document.body).trigger("update_checkout",{update_shipping_method:!1}),c.is_popup?c.$wrap.find(".vi-wcuf-us-shortcode-bt-continue-wrap").trigger("click"):e.pd_hide_after_atc||(s.each((function(e,c){let a=t(c).closest(".vi-wcuf-us-product-wrap-wrap"),i=parseFloat(a.find(".viwcuf_us_product_qty").val())||0,u=parseFloat(a.find(".viwcuf_us_qty_available").val())||0;if(u>-1){let e=u>i?u-i:0;a.find(".viwcuf_us_qty_available").val(e),e>0?a.find(".viwcuf_us_product_qty").attr("max",e):(a.find(".viwcuf_us_product_qty").attr("type","hidden"),t(c).addClass("vi-wcuf-button-atc-disable-qty"))}})),s.removeClass("vi-wcuf-us-shortcode-bt-alltc-loading"),c.$wrap.find(".vi-wcuf-loading-wrap").addClass("vi-wcuf-disable"),c.$wrap.find(".vi-wcuf-add-to-cart, .vi-wcuf-product_id").val(""),c.run_countdown(viwcuf_count_time))}})),!1})),c.$wrap.on("click",".vi-wcuf-us-product-not-redirect .vi-wcuf-us-product-top, .vi-wcuf-us-product-not-redirect .vi-wcuf-us-product-desc",(function(e){e.stopPropagation(),e.preventDefault(),t(this).closest(".vi-wcuf-us-product").find(".vi-wcuf-us-product-bt-atc").trigger("click")}))},remove_form_cart:function(c,a){c=t(c);let i=(a=t(a)).find(".vi-wcuf-us-cart-item-info");c.removeClass("vi-wcuf-us-checkbox-checked");let u={viwcuf_nonce:viwcuf_frontend_us_params.nonce,product_id:a.data("product_id")||i.data("added_id"),product_type:"viwcuf_us_product",cart_item_key:i.data("cart_item_key")};viwcuf_remove_cart_item.push({type:"post",url:e.wc_ajax_url.toString().replace("%%endpoint%%","viwcuf_remove_form_cart"),data:u,beforeSend:function(){a.addClass("vi-wcuf-product-loading")},success:function(i){if(!i||i.error)return i.message&&e.show_message(i.message),viwcuf_remove_cart_item=[],e.run_countdown(viwcuf_count_time),!1;if(a.hasClass("vi-wcuf-us-product-added")){let t=a.find(".viwcuf_us_product_qty").attr("max")?parseFloat(a.find(".viwcuf_us_product_qty").attr("max")):"",e=parseFloat(a.find(".vi-wcuf-us-cart-item-info").data("count_added")||0),c=parseFloat(a.find(".viwcuf_us_qty_available").val()||0);c>-1&&a.find(".viwcuf_us_qty_available").val(c+e),t&&t>-1&&a.find(".viwcuf_us_product_qty").attr("max",t+e),c+e>1&&a.find(".viwcuf_us_product_qty").attr("type","number"),a.find(".vi-wcuf-us-cart-item-info").data({count_added:0,cart_item_key:""}),a.find(".vi-wcuf-us-product-bt-atc").removeClass("added"),a.removeClass("vi-wcuf-us-product-added").find(".vi-wcuf-button-atc-disable-qty").removeClass("vi-wcuf-button-atc-disable-qty")}else{if(a.find(".vi-wcuf-us-cart-item-info").length&&-1!=a.find(".viwcuf_us_qty_available").val()){let t=a.find(".viwcuf_us_product_qty").attr("max")?parseFloat(a.find(".viwcuf_us_product_qty").attr("max")):"",e=parseFloat(a.find(".vi-wcuf-us-cart-item-info").data("count_added")),c=parseFloat(a.find(".viwcuf_us_qty_available").val()||0);c>-1&&a.find(".viwcuf_us_qty_available").val(c+e),t&&t>-1&&a.find(".viwcuf_us_product_qty").attr("max",t+e),a.find(".vi-wcuf-us-cart-item-info").remove()}a.find(".vi-wcuf-swatches-selected-wrap span").html(e.get_attribute_selected(a)),a.find(".vi-wcuf-swatches-selected-wrap").removeClass("vi-wcuf-swatches-selected-wrap-not-click"),a.find(".vi-wcuf-us-quantity-wrap").removeClass("vi-wcuf-us-quantity-wrap-not-change")}if(a.find(".vi-wcuf-us-quantity-wrap").removeClass("vi-wcuf-us-quantity-wrap-not-change"),t(document.body).trigger("removed_from_cart",[i.fragments,i.cart_hash,c]),t(document.body).trigger("vi_wcuf_removed_from_cart",[i.fragments,i.cart_hash,c]),viwcuf_remove_cart_item.shift(),viwcuf_remove_cart_item.length>0)t.ajax(viwcuf_remove_cart_item[0]);else{if(viwcuf_atc.length>0)return!1;e.run_countdown(viwcuf_count_time),t(document.body).trigger("update_checkout",{update_shipping_method:!1})}},complete:function(){a.removeClass("vi-wcuf-product-loading")}}),1===viwcuf_remove_cart_item.length&&t.ajax(viwcuf_remove_cart_item[0])},add_to_cart:function(c,a,i,u,o=""){let s;if(c=t(c),(u=t(u)).find(".vi-wcuf-add-to-cart, .vi-wcuf-product_id").val(u.data("product_id")||0),"btn_popup"===o)s=t(".vi-wcuf-swatches-selected-wrap.vi-wcuf-swatches-selected-wrap-clicking").closest(".vi-wcuf-us-product-wrap-wrap"),u.find(".vi-wcuf-swatches-control-footer-bt-cancel").addClass("vi-wcuf-swatches-control-footer-bt-cancel-pause_countdown").trigger("click");else s=u.closest(".vi-wcuf-us-product-wrap-wrap");let n=u.find("select, input").serialize();-1===n.search("viwcuf_nonce")&&(n+="&viwcuf_nonce="+viwcuf_frontend_us_params.nonce),viwcuf_atc.push({type:"post",url:e.wc_ajax_url.replace("%%endpoint%%","viwcuf_add_to_cart"),data:n,beforeSend:function(t){s.find(".vi-wcuf-us-checkbox").addClass("vi-wcuf-us-checkbox-checked vi-wcuf-us-product-bt-atc-loading"),u.addClass("vi-wcuf-product-loading").closest(".vi-wcuf-us-product").addClass("vi-wcuf-product-loading")},success:function(n){if(!n||n.error)return s.find(".vi-wcuf-us-checkbox").removeClass("vi-wcuf-us-checkbox-checked"),n.message&&e.show_message(n.message),viwcuf_atc=[],e.run_countdown(viwcuf_count_time),!1;if(n.message&&e.show_message(n.message),!e.pd_hide_after_atc)switch(o){case"checkbox":u.find(".vi-wcuf-us-quantity-wrap").addClass("vi-wcuf-us-quantity-wrap-not-change"),u.find(".vi-wcuf-swatches-selected-wrap").addClass("vi-wcuf-swatches-selected-wrap-not-click");break;case"btn_popup":s.find(".vi-wcuf-swatches-selected-wrap").addClass("vi-wcuf-swatches-selected-wrap-not-click"),u.find(".vi-wcuf-swatches-control-footer-bt-cancel").addClass("vi-wcuf-swatches-control-footer-bt-cancel-pause_countdown").trigger("click");break;default:if(u.closest(".vi-wcuf-us-product-wrap-wrap").addClass("vi-wcuf-us-product-added"),u.find(".viwcuf_us_product_qty").attr("data-qty_added",i),u.find(".vi-wcuf-us-cart-item-info").length?u.find(".vi-wcuf-us-cart-item-info").data("count_added",parseFloat(u.find(".vi-wcuf-us-cart-item-info").data("count_added")||0)+i):u.append('<span class="vi-wcuf-us-cart-item-info vi-wcuf-disable" data-added_id="'+u.data("product_id")+'" data-count_added="'+i+'"></span>'),a>-1){let t=a>i?a-i:0;u.find(".viwcuf_us_qty_available").val(t),t?u.find(".viwcuf_us_product_qty").attr("max",t):(u.find(".viwcuf_us_product_qty").attr("type","hidden"),c.addClass("vi-wcuf-button-atc-disable-qty"))}}t(document.body).trigger("added_to_cart",[n.fragments,n.cart_hash,c]),t(document.body).trigger("vi_wcuf_added_to_cart",[n.fragments,n.cart_hash,c]),viwcuf_atc.shift(),viwcuf_atc.length>0?t.ajax(viwcuf_atc[0]):(void 0!==viwcuf_remove_cart_item&&viwcuf_remove_cart_item.length>0||t(document.body).trigger("update_checkout",{update_shipping_method:!1}),t(".vi-wcuf-us-product-wrap-wrap").length?(e.design(!0),e.run_countdown(viwcuf_count_time)):e.is_popup?e.$wrap.find(".vi-wcuf-us-shortcode-bt-continue-wrap").trigger("click"):e.$wrap.remove())},error:function(t){e.show_message(t.statusText),console.log(t),s.find(".vi-wcuf-us-checkbox").removeClass("vi-wcuf-us-checkbox-checked"),u.find(".vi-wcuf-swatches-control-footer-bt-cancel").trigger("click")},complete:function(t){u.find(".vi-wcuf-add-to-cart, .vi-wcuf-product_id").val(""),u.removeClass("vi-wcuf-product-loading").closest(".vi-wcuf-us-product").removeClass("vi-wcuf-product-loading")}}),1===viwcuf_atc.length&&t.ajax(viwcuf_atc[0])},get_attribute_selected:function(e){e=t(e);let c=[];return e.find("select").each((function(e,a){t(a).val()&&c.push(t(a).find("option:selected").html())})),c.length?c.join(","):e.find('option[value=""]').first().html()},design:function(c=!1){let a=e.$wrap,i=a.find(".vi-wcuf-us-shortcode-content-wrap").outerWidth(),u=a.find(".vi-wcuf-us-shortcode-products-wrap").data("item_per_row")||4,o=a.find(".vi-wcuf-us-shortcode-products-wrap").data("item_per_row_mobile")||2;if(i<600&&i>=480&&(u=3),i<480&&(u=o),a.hasClass("viwcuf-checkout-funnel-container-scroll")){let t,c=e.limit_rows,i=10/u;a.find(".vi-wcuf-us-shortcode-products-wrap").css({"grid-template-columns":"repeat("+u+","+i+"fr)"}),c&&c>0&&(t=a.find(".vi-wcuf-us-product-wrap-wrap").outerHeight(),t=10+t*c,a.find(".vi-wcuf-us-shortcode-content-2").css({"max-height":t+"px"}))}else{let t=a.find(".vi-wcuf-us-shortcode-products-wrap").attr("data-rtl");t=!!parseInt(t);let e=(i-12*u)/u;a.find(".vi-wcuf-us-shortcode-content-2").removeData("flexslider"),a.find(".vi-wcuf-us-shortcode-content-2").viwcuf_flexslider({namespace:"vi-wcuf_slider-",selector:".vi-wcuf-us-shortcode-products-wrap .vi-wcuf-us-product-wrap-wrap",animation:"slide",animationLoop:!1,itemWidth:e,itemMargin:12,controlNav:!1,maxItems:u,reverse:!1,slideshow:!1,rtl:t}).addClass("vi-wcuf-us-shortcode-content-2-slider")}if(c)return!1;a.find(".vi-wcuf-us-shortcode-element-wrap:not(.vi-wcuf-us-shortcode-element2-wrap) .vi-wcuf-us-shortcode-element").each((function(e,c){t(c).children().length||t(c).parent().remove()})),e.run_countdown(),a.find(".vi-wcuf-us-cart-item-info").each((function(){let e=t(this).closest(".vi-wcuf-us-cart-form");e.addClass("vi-wcuf-us-form-checked"),e.find(".vi-wcuf-us-checkbox").addClass("vi-wcuf-us-checkbox-checked"),e.find(".vi-wcuf-us-quantity-wrap").addClass("vi-wcuf-us-quantity-wrap-not-change"),e.find(".vi-wcuf-swatches-selected-wrap").addClass("vi-wcuf-swatches-selected-wrap-not-click"),t(this).data("variation")&&e.find(".vi-wcuf-swatches-selected-wrap span").html(Object.values(t(this).data("variation")).join(", "))})),a.find(".vi-wcuf-us-cart-form:not(.vi-wcuf-us-form-checked):not(.vi-wcuf-cart-form-swatches)").each((function(){let e=t(this).find(".viwcuf_us_product_qty"),c=parseFloat(e.attr("min")||0),a=parseFloat(e.attr("max")||0);(a>-1&&a<c||0===a)&&(e.attr("type","hidden"),t(this).find(".vi-wcuf-us-product-bt-atc").addClass("vi-wcuf-button-disable"))})),a.find(".vi-wcuf-us-product-2 .vi-wcuf-us-cart-form:not(.vi-wcuf-cart-form-swatches) .viwcuf_us_product_qty").each((function(){"hidden"===t(this).attr("type")&&t(this).closest(".vi-wcuf-us-product-2").addClass("vi-wcuf-us-product-2-qty-disable")})),a.find(".vi-wcuf-cart-form-swatches:not(.vi-wcuf-us-form-checked):not(.vi-wcuf-cart-form-swatches-init)").each((function(){if(t(this).find("select").each((function(e,c){t(c).val(t(c).closest(".vi-wcuf-swatches-value").data("selected")||t(c).closest(".vi-wcuf-swatches-value").find(".vs-option-wrap-selected").data("attribute_value")||"")})),t(this).find(".vi-wcuf-swatches-selected-wrap").length){let c=e.get_attribute_selected(t(this));t(this).find(".vi-wcuf-swatches-selected-wrap span").html(c)}else t(this).addClass("vi-wcuf-cart-form-swatches-init vi_wpvs_variation_form").viwcuf_get_variations({wc_ajax_url:e.wc_ajax_url}),t(this).find(".babystreet-wcs-swatches").length&&t(this).babystreet_wcs_variation_swatches_form()})),t(document.body).trigger("vi_wpvs_variation_form"),this.init_events()},run_countdown:function(c){clearInterval(viwcuf_countdown);let a=e.$wrap.find(".vi-wcuf-us-shortcode-countdown-wrap:not(.viwcuf-countdown-pausing)");if(0===a.length)return!1;a.find(".vi-wcuf-us-shortcode-progress_bar-value").css({transform:"rotate("+t(this).data("deg")+"deg)"}),c=c||a.find(".vi-wcuf-us-shortcode-countdown-container-wrap").data("count")||0,c=parseInt(c),viwcuf_countdown=setInterval((function(){a.find(".vi-wcuf-us-shortcode-countdown-container-wrap").attr("data-count",c),a.find(".vi-wcuf-us-shortcode-countdown-container-wrap span").html(c);let t=6*Math.floor(c%60);t<180?(a.find(".vi-wcuf-us-shortcode-progress_bar-wrap").removeClass("vi-wcuf-us-shortcode-progress_bar-wrap-over50"),a.find(".vi-wcuf-us-shortcode-progress_bar-first50").addClass("vi-wcuf-hidden")):(a.find(".vi-wcuf-us-shortcode-progress_bar-wrap").addClass("vi-wcuf-us-shortcode-progress_bar-wrap-over50"),a.find(".vi-wcuf-us-shortcode-progress_bar-first50").removeClass("vi-wcuf-hidden")),a.find(".vi-wcuf-us-shortcode-progress_bar-value").css({transform:"rotate("+t+"deg)"}),c--,viwcuf_count_time=c,c<0&&(clearInterval(viwcuf_countdown),e.is_popup?e.$wrap.find(".vi-wcuf-us-shortcode-bt-continue-wrap").trigger("click"):e.$wrap.remove())}),1e3)},show_message:function(e){t(".vi-wcuf-warning-wrap").length?t(".vi-wcuf-warning-wrap").removeClass("vi-wcuf-warning-wrap-close").addClass("vi-wcuf-warning-wrap-open").html(e):t("body").append('<div class="vi-wcuf-warning-wrap vi-wcuf-warning-wrap-open">'+e+"</div>"),setTimeout((function(){t(".vi-wcuf-warning-wrap").addClass("vi-wcuf-warning-wrap-close").removeClass("vi-wcuf-warning-wrap-open")}),5e3)},checkout:function(){e.remove_session(),e.$wrap.hasClass("viwcuf-checkout-funnel-container-footer")?e.$wrap.addClass("vi-wcuf-disable"):e.$wrap.find(".vi-wcuf-loading-wrap").removeClass("vi-wcuf-disable"),e.$checkout_form.find(".viwcuf_us_position").remove(),e.$checkout_form.find("#place_order").trigger("click")},continue_checkout:function(){if(e.is_redirect_page||e.$wrap.hasClass("viwcuf-checkout-funnel-container-popup-init")){let c=JSON.parse(sessionStorage.getItem("viwcuf_upsell_funnel_session"));if(!c)return e.checkout(),!1;let a=c.data,i=t(c.html);t.each(a,(function(c,a){let u=i.find('[name="'+a.name+'"]');u.length?1===u.length?u.val()!=a.value&&u.val(a.value):u.each((function(){if(t(this).val()==a.value&&!t(this).prop("checked"))return t(this).prop("checked",!0),!1})):e.$checkout_form.append('<input type="hidden" />').addClass(a.name).attr("name",a.name).val(a.value)})),i.find("#woocommerce-process-checkout-nonce").val(e.$checkout_form.find("#woocommerce-process-checkout-nonce").val()),e.$checkout_form.html(i),e.$checkout_form.find(".viwcuf_funnel_session_prop_checked").each((function(){t(this).prop("checked",!0)})),void 0!==window.wc_stripe&&(window.wc_stripe.payment_token_received=!0,window.wc_stripe.credit_card.payment_token_received=!0)}e.checkout()},create_session:function(){if(e.$supports_html5_storage){let c=e.$checkout_form.clone();c.find("select").each((function(c,a){t(a).val(e.$checkout_form.find("select").eq(c).val())})),c.find(".viwcuf-checkout-ob-container, .viwcuf_us_position").remove(),c.find(".woocommerce-error, .woocommerce-message, .woocommerce-NoticeGroup").remove(),c.find(".blockUI").remove(),c.find(":checked").addClass("viwcuf_funnel_session_prop_checked");let a={data:c.serializeArray(),html:c.html()};sessionStorage.setItem("viwcuf_upsell_funnel_session",JSON.stringify(a))}},remove_session:function(){e.$supports_html5_storage&&sessionStorage.removeItem("viwcuf_upsell_funnel_session")}}}));