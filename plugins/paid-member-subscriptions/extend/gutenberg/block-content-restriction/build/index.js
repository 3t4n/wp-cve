(()=>{"use strict";const e=window.wp.element,t=window.lodash,n=window.wp.hooks,s=window.wp.compose,o=window.wp.i18n,i=window.wp.blockEditor,l=window.wp.components,a=window.React,r=window.wp.htmlEntities;function c(n){const{name:s,attributes:i,setAttributes:c}=n;if(!(0,t.has)(i,"pmsContentRestriction"))return null;const{pmsContentRestriction:p}=i,_=pmsBlockEditorDataBlockContentRestriction.subscriptionPlans;let m=!1;["pms/content-restriction-start","pms/content-restriction-end"].includes(s)&&(m=!0);let g="";switch(p.display_to){case"all":g=(0,o.__)("This content is not restricted and can be seen by all users.","paid-member-subscriptions");break;case"":g=(0,o.__)("This content is restricted and can only be seen by logged in users","paid-member-subscriptions"),p.subscription_plans&&0!==p.subscription_plans.length&&(p.not_subscribed?g+=(0,o.__)(" that do not have","paid-member-subscriptions"):g+=(0,o.__)(" that have","paid-member-subscriptions"),g+=(0,o.__)(" the following subscriptions: ","paid-member-subscriptions"),p.subscription_plans.map((e=>{_?.map((t=>{t.id==e&&(g+=(0,r.decodeEntities)(t.name)+", ")}))})),g=g.slice(0,-2)),g+=".";break;case"not_logged_in":g=(0,o.__)("This content is restricted and can only be seen by logged out users.","paid-member-subscriptions");break;default:g=(0,o.__)("Please select an option.","paid-member-subscriptions")}return(0,e.createElement)(a.Fragment,null,(0,e.createElement)("p",null,g),(0,e.createElement)("br",null),(0,e.createElement)(l.__experimentalToggleGroupControl,{isBlock:!0,label:(0,o.__)("Show content to","paid-member-subscriptions"),value:p.display_to,onChange:e=>c({pmsContentRestriction:(0,t.assign)({...p},{display_to:e})})},!m&&(0,e.createElement)(l.__experimentalToggleGroupControlOption,{label:(0,o.__)("All Users","paid-member-subscriptions"),value:"all"}),(0,e.createElement)(l.__experimentalToggleGroupControlOption,{label:(0,o.__)("Logged In Users","paid-member-subscriptions"),value:""}),(0,e.createElement)(l.__experimentalToggleGroupControlOption,{label:(0,o.__)("Logged Out Users","paid-member-subscriptions"),value:"not_logged_in"})),"all"==p.display_to&&(0,e.createElement)("p",null),""==p.display_to&&(0,e.createElement)("div",null,(0,e.createElement)(l.BaseControl,{label:(0,o.__)("Subscriptions","paid-member-subscriptions")},(0,e.createElement)(l.SelectControl,{help:(0,o.__)("The desired valid subscriptions. Select none to display the content to all logged in users.","paid-member-subscriptions"),multiple:!0,value:p.subscription_plans,onChange:e=>c({pmsContentRestriction:(0,t.assign)({...p},{subscription_plans:e})}),className:"components-select-control__input"},_?.map((t=>(0,e.createElement)("option",{key:t.id,value:t.id},(0,r.decodeEntities)(t.name))))),(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Show to Not Subscribed","paid-member-subscriptions"),checked:!!p.not_subscribed&&p.not_subscribed,onChange:()=>c({pmsContentRestriction:(0,t.assign)({...p},{not_subscribed:!p.not_subscribed})})})),(0,e.createElement)(a.Fragment,null,(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Enable Custom Message","paid-member-subscriptions"),checked:!!p.enable_message_logged_in&&p.enable_message_logged_in,onChange:()=>c({pmsContentRestriction:(0,t.assign)({...p},{enable_message_logged_in:!p.enable_message_logged_in})})}),p.enable_message_logged_in&&(0,e.createElement)(l.TextareaControl,{help:(0,o.__)("Custom message for logged-in users.","paid-member-subscriptions"),value:p.message_logged_in,onChange:e=>c({pmsContentRestriction:(0,t.assign)({...p},{message_logged_in:e})})}))),"not_logged_in"==p.display_to&&(0,e.createElement)(a.Fragment,null,(0,e.createElement)(l.ToggleControl,{label:(0,o.__)("Enable Custom Message","paid-member-subscriptions"),checked:!!p.enable_message_logged_out&&p.enable_message_logged_out,onChange:()=>c({pmsContentRestriction:(0,t.assign)({...p},{enable_message_logged_out:!p.enable_message_logged_out})})}),p.enable_message_logged_out&&(0,e.createElement)(l.TextareaControl,{help:(0,o.__)("Custom message for logged-out users","paid-member-subscriptions"),value:p.message_logged_out,onChange:e=>c({pmsContentRestriction:(0,t.assign)({...p},{message_logged_out:e})})})))}function p(n){const{name:s,attributes:a,setAttributes:r}=n,{pmsContentRestriction:p}=a;return!(0,t.has)(a,"pmsContentRestriction")||["pms/content-restriction-start","pms/content-restriction-end","pms/content-restriction-start","pms/content-restriction-start"].includes(s)?null:(0,e.createElement)(i.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:(0,o.__)("Content Restriction","paid-member-subscriptions"),className:"paid-member-subscriptions-content-restriction-settings",initialOpen:p.panel_open,onToggle:e=>r({pmsContentRestriction:(0,t.assign)({...p},{panel_open:!p.panel_open})})},(0,e.createElement)(c,{...n})))}(0,n.addFilter)("blocks.registerBlockType","paid-member-subscriptions/attributes",(function(e){let n={pmsContentRestriction:{type:"object",properties:{subscription_plans:{type:"array"},display_to:{type:"string"},not_subscribed:{type:"bool"},enable_message_logged_in:{type:"bool"},enable_message_logged_out:{type:"bool"},message_logged_in:{type:"string"},message_logged_out:{type:"string"},panel_open:{type:"bool"}},default:{subscription_plans:[],display_to:"all",not_subscribed:!1,enable_message_logged_in:!1,enable_message_logged_out:!1,message_logged_in:"",message_logged_out:"",panel_open:!1}}};return e.attributes.pms_content_restriction_block_start&&(n.pmsContentRestriction.default.display_to=""),e.attributes.pms_content_restriction_block_end||e.attributes.wppb_content_restriction_block_start||e.attributes.wppb_content_restriction_block_end||(e.attributes=(0,t.assign)(e.attributes,n)),e}));const _=(0,s.createHigherOrderComponent)((t=>n=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t,{...n}),(0,e.createElement)(p,{...n}))),"blockPMSContentRestrictionControls");(0,n.addFilter)("editor.BlockEdit","paid-member-subscriptions/inspector-controls",_,100)})();