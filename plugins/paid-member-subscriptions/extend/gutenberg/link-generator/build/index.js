(()=>{"use strict";const e=window.wp.element,t=window.lodash,n=window.wp.coreData,r=window.wp.htmlEntities,o=window.wp.data,l=window.wp.hooks,i=window.wp.i18n,a=window.wp.blockEditor,s=window.wp.compose,c=window.wp.components,p={"core/button":{link:"url"},"themeisle-blocks/button":{link:"link"},"themeisle-blocks/font-awesome-icons":{link:"link"}},m=({props:l,children:s})=>{const m=(0,o.useSelect)((e=>e(n.store).getEntityRecords("postType","page",{per_page:-1})),[]),u=pmsBlockEditorDataLinkGenerator.subscriptionPlans,d=!!pmsBlockEditorDataLinkGenerator.registerPageID&&pmsBlockEditorDataLinkGenerator.registerPageID.toString(),b=(e=>{-1<e.indexOf("?")&&(e=e.split("?")[1]);const t=e.split("&"),n={};return t.forEach((function(e){""!==(e=e.split("="))[0]&&(n[e[0]]=decodeURIComponent(e[1]||""))})),n})(l.attributes[p[l.name].link]||""),[E,k]=(0,e.useState)(),[g,w]=(0,e.useState)(!1),[_,h]=(0,e.useState)({...b});d&&(0,t.isEmpty)(_)&&(_.p=d);const y=e=>{let t={..._};Object.keys(e).forEach((n=>{t[n]=e[n]})),t=Object.fromEntries(Object.entries(t).filter((([e,t])=>null!==t&&""!==t&&void 0!==t))),h({...t})},{isQueryChild:v}=(0,o.useSelect)((e=>{const{getBlockParentsByBlockName:t}=e("core/block-editor");return{isQueryChild:0<t(l.clientId,"core/query").length}}),[]);return(0,e.createElement)(e.Fragment,null,s,(0,e.createElement)(a.BlockControls,null,(0,e.createElement)(c.ToolbarGroup,null,(0,e.createElement)(c.ToolbarButton,{name:"pms-link-generator",icon:()=>(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"m 10.951071,22.655193 c -1.6414171,-0.205916 -3.5758081,-1.068475 -5.0122731,-2.23501 -0.94328,-0.766025 -1.181857,-0.87327 -1.500507,-0.674512 -0.932319,0.581542 -1.215071,0.331936 -1.198567,-1.058062 0.02496,-2.101371 0.241943,-3.142584 0.672136,-3.225194 0.47754,-0.09171 3.561318,1.139933 3.912561,1.562645 0.221719,0.266834 0.160331,0.404101 -0.384871,0.860571 -0.648667,0.543099 -0.648667,0.543099 0.243196,1.224672 4.6571691,3.559068 11.5872441,0.646323 12.5503531,-5.274976 0.27163,-1.670009 1.263047,-2.303337 1.954856,-1.24878 0.255325,0.389205 0.273351,0.709633 0.100298,1.782902 -0.863167,5.353294 -5.822209,8.977595 -11.337182,8.285744 z M 10.624653,19.077156 C 9.3600599,18.722024 9.1681389,18.520771 9.1156939,17.494835 c -0.06004,-1.174372 -0.520684,-1.753317 -1.744921,-2.193015 -1.45253,-0.521691 -1.556673,-0.700925 -1.541162,-2.652348 0.02114,-2.6592954 1.28833,-4.7391761 3.568876,-5.8577071 1.6547741,-0.811611 4.1955171,-0.8400736 5.7487431,-0.064397 1.036772,0.5177592 1.036772,0.5177592 1.14045,1.7807827 0.122329,1.490265 0.320192,1.7756664 1.55849,2.2480054 1.083375,0.413245 1.245457,0.796985 1.084669,2.568038 -0.364707,4.017203 -4.438866,6.839013 -8.306186,5.752962 z m 2.332704,-2.799401 c 0.115111,-0.214828 0.528974,-0.578984 0.919696,-0.809236 1.746836,-1.029414 1.053182,-2.798685 -1.42543,-3.635779 -1.068157,-0.360744 -1.168957,-1.033997 -0.169292,-1.13072 0.494839,-0.04788 0.717321,0.04287 0.888552,0.362431 0.270897,0.505564 1.150246,0.572039 1.331356,0.10065 0.16379,-0.426316 -0.177701,-1.042269 -0.8057,-1.4532524 -0.276652,-0.181051 -0.556849,-0.49863 -0.62266,-0.705731 -0.235263,-0.740349 -1.221071,-0.72629 -1.458475,0.0208 -0.06944,0.218541 -0.398228,0.537815 -0.730629,0.709498 -0.9158861,0.4730514 -1.1538501,1.8528734 -0.454503,2.6353994 0.178573,0.199812 0.874352,0.563472 1.546175,0.808136 1.012558,0.36875 1.210869,0.51916 1.159368,0.879327 -0.09427,0.659247 -1.008195,0.674662 -1.775327,0.02994 -0.645657,-0.542626 -1.16638,-0.535546 -1.3793441,0.01875 -0.145869,0.379673 1.9006671,2.548584 2.4113461,2.555537 0.195565,0.0026 0.449755,-0.170926 0.564867,-0.38575 z M 2.6437629,13.934578 C 2.2586709,13.549952 2.3481649,11.271428 2.8065869,9.7890226 4.9831789,2.7505514 13.773264,0.40495617 19.192807,5.4164334 20.415063,6.546659 20.424413,6.5508128 21.153448,6.2875086 22.222666,5.9013411 22.309284,6.1047613 22.084667,8.4744836 21.858065,10.865172 21.759236,10.97596 20.346792,10.422652 17.299761,9.2290136 16.920196,8.8320916 18.092279,8.0650396 18.652755,7.6982469 18.652755,7.6982469 17.760114,6.9070565 16.096781,5.4327601 14.822308,4.9669839 12.451623,4.9669839 c -1.837407,0 -2.217694,0.066539 -3.3393541,0.5843029 -2.597438,1.1989858 -4.336428,3.7143668 -4.620348,6.6831602 -0.09603,1.004161 -0.256765,1.631153 -0.449347,1.752847 -0.421945,0.266629 -1.104848,0.240892 -1.398811,-0.05271 z"})),title:(0,i.__)("PMS Link Generator","paid-member-subscriptions"),ref:k,onClick:()=>{w(!g)}}))),g&&l.isSelected&&(0,e.createElement)(c.Popover,{position:"bottom right",variant:"toolbar",anchor:E,className:"pms-link-generator-popover",onClose:()=>w(!1)},(0,e.createElement)(c.PanelBody,null,(0,e.createElement)("p",null,(0,i.__)("Generate links to Subscription Plans","paid-member-subscriptions")),(0,e.createElement)("br",null),(0,e.createElement)("br",null),(0,e.createElement)(c.BaseControl,{label:(0,i.__)("Subscription Plan","paid-member-subscriptions"),id:"pms-link-generator-subscription-plan"},(0,e.createElement)("select",{value:_.subscription_plan||"",onChange:e=>y({subscription_plan:e.target.value}),id:"pms-link-generator-subscription-plan-select",className:"components-select-control__input"},(0,e.createElement)("option",{value:"none"},(0,i.__)("Select a plan","paid-member-subscriptions")),u?.map((t=>(0,e.createElement)("option",{key:t.id,value:t.id},(0,r.decodeEntities)(t.name)))))),(0,e.createElement)(c.BaseControl,{label:(0,i.__)("Page","paid-member-subscriptions"),id:"pms-link-generator-page"},(0,e.createElement)("select",{value:_.p||"",onChange:e=>y({p:e.target.value}),id:"pms-link-generator-page-select",className:"components-select-control__input"},(()=>{if(!d)return(0,e.createElement)("option",{value:"none"},(0,i.__)("Select a page","paid-member-subscriptions"))})(),m?.map((t=>(0,e.createElement)("option",{key:t.id,value:t.id},(0,r.decodeEntities)(t.title.rendered)))))),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("br",null),(0,e.createElement)(c.ToggleControl,{label:(0,i.__)("Exclude other plans","paid-member-subscriptions"),checked:"yes"===_.single_plan||!1,onChange:()=>y({single_plan:"yes"===_.single_plan?void 0:"yes"})})),(0,e.createElement)("br",null),(0,e.createElement)(c.ExternalLink,{target:"_blank",rel:"noopener noreferrer",href:"https://www.cozmoslabs.com/docs/paid-member-subscriptions/shortcodes/#Pre-select_a_subscription_plan_through_an_URL_parameter"},(0,i.__)("Documentation","paid-member-subscriptions"))),(0,e.createElement)(c.PanelBody,null,(0,e.createElement)(c.ButtonGroup,null,(0,e.createElement)(c.Button,{isPrimary:!0,variant:"primary",disabled:(0,t.isEmpty)(_)||(0,t.isEqual)(_,b),onClick:()=>{const e=Object.fromEntries(Object.entries(_).filter((([e,t])=>null!==t&&""!==t&&void 0!==t)));var t;v&&(e.context="query"),l.setAttributes({[p[l.name].link]:`/?${t=e,Object.keys(t).map((e=>e+"="+t[e])).join("&")}`})}},(0,i.__)("Apply","paid-member-subscriptions")),(0,e.createElement)(c.Button,{isDestructive:!0,variant:"tertiary",onClick:()=>{h(d?{p:d}:{}),l.setAttributes({[p[l.name].link]:void 0})}},(0,i.__)("Delete","paid-member-subscriptions"))))))},u=(0,s.createHigherOrderComponent)((t=>n=>Object.keys(p).includes(n.name)?(0,e.createElement)(m,{props:n},(0,e.createElement)(t,{...n})):(0,e.createElement)(t,{...n})),"pmsToolbarButton");(0,l.addFilter)("editor.BlockEdit","paid-member-subscriptions/with-toolbar-button",u)})();