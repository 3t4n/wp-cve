!function(a){var l={};a.fn.fontselect=function(t){function e(t,e){return function(){return t.apply(e,arguments)}}var s={style:"font-select",placeholder:"Select a font",placeholderSearch:"Search...",searchable:!0,lookahead:2,googleApi:"https://fonts.googleapis.com/css?family=",localFontsUrl:"/fonts/",systemFonts:"Default|Arial|Helvetica Neue|Courier New|Times New Roman|Comic Sans MS|Verdana|Impact".split("|"),googleFonts:t.fonts.join("|").split(" ").join(" ").split("|")},i=(o.prototype={keyDown:function(t){function e(t){t.preventDefault(),t.stopPropagation()}if(this.keyActive=!0,27==t.keyCode)return e(t),void this.toggleDropdown("hide");if(38!=t.keyCode)if(40!=t.keyCode){if(13==t.keyCode)return e(t),void a("li.active",this.$results).trigger("click");this.query+=String.fromCharCode(t.keyCode).toLowerCase();var s=a("li[data-query^='"+this.query+"']").first();0<s.length&&(a("li.active",this.$results).removeClass("active"),this.$results.scrollTop(s.addClass("active")[0].offsetTop))}else{e(t);var i=(o=a("li.active",this.$results)).next("li");0<i.length&&(o.removeClass("active"),this.$results.scrollTop(i.addClass("active")[0].offsetTop-this.searchBoxHeight))}else{e(t);var o,l=(o=a("li.active",this.$results)).prev("li");0<l.length&&(o.removeClass("active"),this.$results.scrollTop(l.addClass("active")[0].offsetTop-this.searchBoxHeight))}},keyUp:function(t){this.keyActive=!1},bindEvents:function(){var l=this;a("li",this.$results).click(e(this.selectFont,this)).mouseover(e(this.activateFont,this)),this.$select.click(e(function(){a(this.$drop).is(":hidden")?l.toggleDropdown("show"):l.toggleDropdown("hide")},this)),this.$original.on("setFont",function(t,e,s){s=s||400;var i=e.replace(/ /g,"+")+(400==s?"":":"+s),o=a("li[data-value='"+i+"']",l.$results);0==o.length&&(i=e.replace(/ /g,"+")),o=a("li[data-value='"+i+"']",l.$results),a("li.active",l.$results).removeClass("active"),o.addClass("active"),l.$original.val(i),l.updateSelected(),l.addFontLink(o.data("value"))}),this.$original.on("change",function(){l.updateSelected(),l.addFontLink(a("li.active",l.$results).data("value"))}),this.options.searchable&&this.$input.on("keyup",function(){var t=this.value.toLowerCase();a("li",l.$results).each(function(){-1==a(this).text().toLowerCase().indexOf(t)?a(this).hide():a(this).show()})}),a(document).on("click",function(t){0===a(t.target).closest("."+l.options.style).length&&l.toggleDropdown("hide")})},toggleDropdown:function(t){"hide"===t?(this.$element.off("keydown keyup"),this.query="",this.keyActive=!1,this.$element.removeClass("font-select-active"),this.$drop.hide(),clearInterval(this.visibleInterval)):(this.$element.on("keydown",e(this.keyDown,this)),this.$element.on("keyup",e(this.keyUp,this)),this.$element.addClass("font-select-active"),this.$drop.show(),this.visibleInterval=setInterval(e(this.getVisibleFonts,this),500),this.searchBoxHeight=this.$search.outerHeight()),this.moveToSelected()},selectFont:function(){var t=a("li.active",this.$results).data("value");this.$original.val(t).change(),this.updateSelected(),this.toggleDropdown("hide")},moveToSelected:function(){var t=this.$original.val().replace(/\+/g," "),e=t?a("li[data-value='"+t+"']",this.$results):e=a("li",this.$results).first();a("li.active",this.$results).removeClass("active"),this.updateSelected(),a(".fontselect_placeholder").text(e.text()),null!=e.addClass("active")[0]&&this.$results.scrollTop(e.addClass("active")[0].offsetTop-this.searchBoxHeight)},activateFont:function(t){this.keyActive||(a("li.active",this.$results).removeClass("active"),a(t.target).addClass("active"))},updateSelected:function(){var t=this.$original.val();a("span",this.$element).text(this.toReadable(t)).css(this.toStyle(t))},setupHtml:function(){this.$original.hide(),this.$element=a("<div>",{class:this.options.style}),this.$select=a('<span tabindex="0" class="fontselect_placeholder">'+this.options.placeholder+"</span>"),this.$search=a("<div>",{class:"fs-search"}),this.$input=a("<input>",{type:"text"}),this.options.placeholderSearch&&this.$input.attr("placeholder",this.options.placeholderSearch),this.$search.append(this.$input),this.$drop=a("<div>",{class:"fs-drop"}),this.$results=a("<ul>",{class:"fs-results"}),this.$original.after(this.$element.append(this.$select,this.$drop)),this.options.searchable&&this.$drop.append(this.$search),this.$drop.append(this.$results.append(this.fontsAsHtml())).hide()},fontsAsHtml:function(){var t,e,s,i,o="",l=this.options.systemFonts,a=this.options.localFonts,n=this.options.googleFonts;for(t=0;t<l.length;t++)e=this.toReadable(l[t]),s=this.toStyle(l[t]),"Default"==l[t]&&(l[t]="initial"),i="font-family:"+s["font-family"],(0<a.length||0<n.length)&&t==l.length-1&&(i+=";border-bottom:1px solid #444"),o+='<li data-value="'+l[t]+'" data-query="'+l[t].toLowerCase()+'" style="'+i+'">'+e+"</li>";for(t=0;t<a.length;t++)e=this.toReadable(a[t]),i="font-family:"+(s=this.toStyle(a[t]))["font-family"],0<n.length&&t==a.length-1&&(i+=";border-bottom:1px solid #444"),o+='<li data-value="'+a[t]+'" data-query="'+a[t].toLowerCase()+'" style="'+i+'">'+e+"</li>";for(t=0;t<n.length;t++)e=this.toReadable(n[t]),i="font-family:"+(s=this.toStyle(n[t]))["font-family"]+";font-weight:"+s["font-weight"],o+='<li data-value="'+n[t]+'" data-query="'+n[t].toLowerCase()+'" style="'+i+'">'+e+"</li>";return o},toReadable:function(t){return t.replace(/[\+|:]/g," ")},toStyle:function(t){var e=t.split(":");return{"font-family":"'"+this.toReadable(e[0])+"'","font-weight":e[1]||400}},getVisibleFonts:function(){if(!this.$results.is(":hidden")){var s=this,i=this.$results.scrollTop(),o=i+this.$results.height();if(this.options.lookahead){var t=a("li",this.$results).first().height();o+=t*this.options.lookahead}a("li:visible",this.$results).each(function(){var t=a(this).position().top+i,e=t+a(this).height();i<=e&&t<=o&&s.addFontLink(a(this).data("value"))})}},addFontLink:function(t){l[t]||(l[t]=!0,-1<this.options.googleFonts.indexOf(t)?a("link:last").after('<link href="'+this.options.googleApi+t+'" rel="stylesheet" type="text/css">'):-1<this.options.localFonts.indexOf(t)&&(t=this.toReadable(t),a("head").append("<style> @font-face { font-family:'"+t+"'; font-style:normal; font-weight:400; src:local('"+t+"'), url('"+this.options.localFontsUrl+t+".woff') format('woff'); } </style>")))}},o);function o(t,e){e.systemFonts||(e.systemFonts=[]),e.localFonts||(e.localFonts=[]),e.googleFonts||(e.googleFonts=[]),this.options=e,this.$original=a(t),this.setupHtml(),this.getVisibleFonts(),this.bindEvents(),this.query="",this.keyActive=!1,this.searchBoxHeight=0;var s=this.$original.val();s&&(this.updateSelected(),this.addFontLink(s))}return this.each(function(){return t&&a.extend(s,t),new i(this,s)})}}(jQuery);