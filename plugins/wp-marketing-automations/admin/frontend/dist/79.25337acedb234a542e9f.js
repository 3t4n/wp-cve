(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1126:function(e,t,a){"use strict";a.r(t);var r=a(0),c=a(4),n=a(2),s=a(5),m=a(10),o=a.n(m),i=a(796),l=a(805),b=a(53),d=a.n(b),p=a(3),w=a(832),u=a(142),O=a(67),f=a(8),j=a(135),v=a(134);function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _(e,t,a,r,c,n,s){try{var m=e[n](s),o=m.value}catch(e){return void a(e)}m.done?t(o):Promise.resolve(o).then(r,c)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,c=!1,n=void 0;try{for(var s,m=e[Symbol.iterator]();!(r=(s=m.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){c=!0,n=e}finally{try{r||null==m.return||m.return()}finally{if(c)throw n}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}t.default=function(e){var t=Object(r.useContext)(s.d),a=E(Object(r.useState)(!1),2),m=a[0],b=a[1],y=E(Object(r.useState)(1),2),h=y[0],N=y[1],k=E(Object(r.useState)(""),2),C=k[0],S=k[1],P=E(Object(r.useState)({loading:!1,error:!1,success:!1,message:""}),2),x=P[0],T=P[1],M=E(Object(r.useState)(!1),2),I=M[0],D=M[1],A=E(Object(r.useState)(!1),2),B=A[0],H=A[1],Y=E(Object(r.useState)(!1),2),L=Y[0],R=Y[1],F=E(Object(r.useState)({}),2),z=F[0],U=F[1],G={rich:Object(n.__)("Rich Text","wp-marketing-automations"),wc:Object(n.__)("WooCommerce","wp-marketing-automations"),html:Object(n.__)("HTML","wp-marketing-automations"),editor:Object(n.__)("Editor","wp-marketing-automations")},W=E(Object(r.useState)({message:"",type:1}),2),q=W[0],J=W[1],V=Object(l.a)().setCampaignValues,$=Object(s.t)(),K=i.a.getCampaignData(),Q=i.a.getCampaignId(),X=(i.a.getEditableMode(),parseInt(K.type));Object(r.useEffect)((function(){!function(){if(K.data&&K.data.content&&K.data.content.length>0){var e=!0;K.data.content.map((function(t,a){K.hasOwnProperty("validated_email_body_".concat(a))&&!K["validated_email_body_".concat(a)]&&(e=!1)})),R(e)}}()}),[K]),Object(r.useEffect)((function(){if(K)if(K.hasOwnProperty("execution_time")&&!Object(p.isNull)(K.execution_time))N(2),S(d()(Object(s.O)(K.execution_time,!0,!0,!1)).format("YYYY-MM-DDTHH:mm:ss"));else{var e=Object(s.z)(d()(new Date)).format("YYYY-MM-DDTHH:mm:ss");S(e)}}),[]),Object(r.useEffect)((function(){document.addEventListener("click",(function(e){var t=document.getElementsByClassName("bwf-crm-campaign-schedule-popover")[0],a=!0;void 0!==t&&t.contains(e.target)&&(a=!1),m&&"bwf-crm-campaign-review-schedule-text-box"!=e.target.id&&a&&b(!1)}))}));var Z=Object(v.a)().setL2Title;Object(r.useEffect)((function(){Z("title"in K?Object(r.createElement)(r.Fragment,null,K.title):"")}),[K]);var ee,te,ae,re=K?K.count:0,ce=[{value:1,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-now",label:Object(n.__)("Broadcast Now","wp-marketing-automations")},{value:2,className:"bwf-crm-campaign-schedule bwf-crm-campaign-schedule-later",label:Object(n.__)("Schedule For Later","wp-marketing-automations")}],ne=function(){var a,r=(a=regeneratorRuntime.mark((function a(){var r,c;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.setPending(!0),!(re<=0)){a.next=5;break}return T({status:!0,error:Object(n.__)("No Contacts are selected.","wp-marketing-automations")}),e.setPending(!1),a.abrupt("return");case 5:if(r=Object(s.z)(d()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),c=Object(s.z)(d()(C)),2!=h||c.isAfter(r)||c.isSame(r,"minute")){a.next=11;break}return T({status:!0,error:Object(n.__)("Given time should exceeds the current time.","wp-marketing-automations")}),e.setPending(!1),a.abrupt("return");case 11:return a.prev=11,a.next=14,o()({path:Object(s.m)("/broadcast/".concat(Q)),method:"POST",data:{data:{schedule_time:2==h?Object(s.B)(C).utc().format():"",modified_by:Object(s.x)()},step:4},headers:{"Content-Type":"application/json"}}).then((function(e){200==e.code?(t(e.message),Object(s.gb)(t,2e3),setTimeout((function(){V("data",e.result),V("editableMode",!1)}),2e3)):T({status:!0,error:e.message})}));case 14:a.next=19;break;case 16:a.prev=16,a.t0=a.catch(11),T({status:!0,error:a.t0.message});case 19:e.setPending(!1);case 20:case"end":return a.stop()}}),a,null,[[11,16]])})),function(){var e=this,t=arguments;return new Promise((function(r,c){var n=a.apply(e,t);function s(e){_(n,r,c,s,m,"next",e)}function m(e){_(n,r,c,s,m,"throw",e)}s(void 0)}))});return function(){return r.apply(this,arguments)}}();return Object(r.createElement)(r.Fragment,null,Object(r.createElement)(O.a,null),Object(r.createElement)("div",{className:"bwf-campaign-step-div bwf-card-wrap bwf-campaign-step-4"},Object(r.createElement)("div",{className:"bwf-card-header"},Object(r.createElement)("span",{className:"bwf-form-title"},Object(n.__)("Review & Schedule","wp-marketing-automations"))),Object(r.createElement)("div",{className:""},Object(r.createElement)("div",{className:"bwf-p-gap bwf-top-gap"},Object(r.createElement)(c.Card,{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)(c.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.__)("Information","wp-marketing-automations")),Object(r.createElement)(c.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Title","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.title)),Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Type","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},$[X].label)),!!K.description&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Description","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.description)))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)(r.Fragment,null,Object(r.createElement)(c.Card,{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)(c.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.__)("Contacts","wp-marketing-automations")),Object(r.createElement)(c.CardBody,{className:"bwf-crm-overview-report-body"},Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Total","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(r.createElement)("b",null,re))),K.data.hasOwnProperty("filters")&&!Object(p.isEmpty)(K.data.filters)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Segments","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(w.b)(K.data.filters)))))))),Object(r.createElement)("div",{className:" bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)(c.Card,{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)(c.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.__)("Content","wp-marketing-automations")),Object(r.createElement)(c.CardBody,{className:"bwf-crm-overview-report-body"},X&&1==X&&K.data.hasOwnProperty("senders_name")&&!Object(p.isEmpty)(K.data.senders_name)&&Object(r.createElement)("div",{className:"bwf-report-row",key:1},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("From Name","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.data.senders_name)),X&&1==X&&K.data.hasOwnProperty("senders_email")&&!Object(p.isEmpty)(K.data.senders_email)&&Object(r.createElement)("div",{className:"bwf-report-row",key:2},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("From Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.data.senders_email)),X&&1==X&&K.data.hasOwnProperty("replyto")&&!Object(p.isEmpty)(K.data.replyto)&&Object(r.createElement)("div",{className:"bwf-report-row",key:3},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Reply-To Email","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.data.replyto)),K.data&&K.data.content&&K.data.content.map((function(e,t){return Object(r.createElement)("div",{className:"bwf-report-row",key:t},Object(r.createElement)("div",{className:"bwf-report-row-label"},K.data.content.length>1?Object(n.__)("Content #","wp-marketing-automations")+(parseInt(t)+1):Object(n.__)("Content","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value bwf-report-value-modal"},X&&e.subject&&Object(r.createElement)("span",null,e.subject),Object(r.createElement)(c.Button,{isSecondary:!0,className:"bwf-a-no-underline",style:{height:"auto",padding:"10px 20px"},onClick:function(){H(!0),[2,3].includes(parseInt(X))?D(!0):D(!1),U(e)}},Object(n.__)("View details","wp-marketing-automations")),K.hasOwnProperty("validated_email_body_".concat(t))&&!K["validated_email_body_".concat(t)]&&Object(r.createElement)("div",{className:"bwf-error"},Object(n.__)("Invalid email content. Please fix to proceed further.","wp-marketing-automations"))))})),!!K.data&&K.data.hasOwnProperty("smart_send")&&K.data.smart_send.hasOwnProperty("enable")&&K.data.smart_send.enable&&Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-report-row",key:11},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Smart sending","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},Object(n.__)("Enabled","wp-marketing-automations"))),Object(r.createElement)("div",{className:"bwf-report-row",key:12},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Sample size (in percent)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.data.smart_send.percent+" %")),Object(r.createElement)("div",{className:"bwf-report-row",key:13},Object(r.createElement)("div",{className:"bwf-report-row-label"},Object(n.__)("Wait Time (in hours)","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-report-row-value"},K.data.smart_send.hours+" hours"))),B&&Object(r.createElement)(c.Modal,{onRequestClose:function(){return H(!1)},className:"bwf-message-preview-modal bwf-admin-modal bwf-admin-modal-large bwf-h--core-header"},Object(r.createElement)("div",{className:"bwf-modal-header"},Object(r.createElement)("div",{className:"bwf-modal-heading"},Object(n.__)("Details","wp-marketing-automations")),Object(r.createElement)("span",{onClick:function(){return H(!1)},className:"bwf-modal-close"},Object(r.createElement)(f.a,{icon:"close",color:"#353030"}))),(ee=z,te="",ae=!0,3==X&&ee.hasOwnProperty("whatsAppImage")&&ee.whatsAppImage&&ee.hasOwnProperty("whatsAppImageSetting")&&ee.whatsAppImageSetting.hasOwnProperty("position")&&!Object(p.isEmpty)(ee.whatsAppImageSetting.position)&&ee.whatsAppImageSetting.hasOwnProperty("imageURL")&&!Object(p.isEmpty)(ee.whatsAppImageSetting.imageURL)&&(te="before"===ee.whatsAppImageSetting.position?Object(r.createElement)(r.Fragment,null,Object(r.createElement)("img",{src:ee.whatsAppImageSetting.imageURL,width:50,height:50}),Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:ee.body}})):Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:ee.body}}),Object(r.createElement)("img",{src:ee.whatsAppImageSetting.imageURL,width:50,height:50})),ae=!1),ae&&(te=Object(r.createElement)("div",{dangerouslySetInnerHTML:{__html:"editor"===ee.type?ee.editor.body:ee.body}})),Object(r.createElement)(r.Fragment,null,Object(r.createElement)("div",{className:"bwf-message-wrap"},Object(r.createElement)("div",{className:"bwf-section"},1==X&&Object(r.createElement)("div",{className:"bwf-p-15 bwf-bb-grey"},Object(r.createElement)("div",{className:"bwf-w-210 bwf_bold bwf_align_center"},Object(n.__)("Subject","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf_align_center"},ee.subject)),1==X&&ee.hasOwnProperty("preheader")&&!Object(p.isEmpty)(ee.preheader)&&Object(r.createElement)("div",{className:"bwf-p-15 bwf-bb-grey"},Object(r.createElement)("div",{className:"bwf-w-210 bwf_bold bwf_align_center"},Object(n.__)("Mail Pre-header","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf_align_center"},ee.preheader)),1==X&&ee.hasOwnProperty("type")&&!Object(p.isEmpty)(ee.type)&&Object(r.createElement)("div",{className:"bwf-p-15 bwf-bb-grey"},Object(r.createElement)("div",{className:"bwf-w-210 bwf_bold bwf_align_center"},Object(n.__)("Mail Type","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf_align_center"},G[ee.type])),ee.hasOwnProperty("utm")&&!Object(p.isEmpty)(ee.utm)&&function(e){var t=[];return t.push(Object(n.__)("Source","wp-marketing-automations")+": "+e.source),t.push(Object(n.__)("Medium","wp-marketing-automations")+": "+e.medium),e.hasOwnProperty("name")&&!Object(p.isEmpty)(e.name)&&t.push(Object(n.__)("Name","wp-marketing-automations")+": "+e.name),e.hasOwnProperty("content")&&!Object(p.isEmpty)(e.content)&&t.push(Object(n.__)("Content","wp-marketing-automations")+": "+e.content),e.hasOwnProperty("term")&&!Object(p.isEmpty)(e.term)&&t.push(Object(n.__)("Term","wp-marketing-automations")+": "+e.term),Object(r.createElement)("div",{className:"bwf-p-15 bwf-bb-grey"},Object(r.createElement)("div",{className:"bwf-w-210 bwf_bold bwf_align_center"},Object(n.__)("UTM Details","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf_align_center",style:{maxWidth:"400px"}},Object(r.createElement)("div",{className:"bwf-p"},t.join(" | "))))}(ee.utm),I&&Object(r.createElement)("div",{className:"bwf-p-15 bwf-bb-grey"},Object(r.createElement)("div",{className:"bwf-report-row-value"},te)),Object(r.createElement)("div",{className:"bwf-p-15 bwf-t-center"},Object(r.createElement)("a",{className:"bwf-model-link",onClick:function(){return D(!I)}},I?Object(n.__)("Less Details","wp-marketing-automations"):Object(n.__)("More Details","wp-marketing-automations")))))))))))),Object(r.createElement)("div",{className:"bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-p-gap "},Object(r.createElement)(c.Card,{className:"bwf-crm-overview-detail-wrap"},Object(r.createElement)(c.CardHeader,{className:"bwf-crm-overview-report-header"},Object(n.__)("Schedule","wp-marketing-automations")),Object(r.createElement)(c.CardBody,{className:"bwf-crm-overview-schedule-section"},Object(r.createElement)("div",{className:"bwf-campaign-review-broadcast-wrap",onClick:function(){b(!1)}},Object(r.createElement)(c.ButtonGroup,{className:"bwf-crm-campaign-schedule-btn-grp bwf-alter-button"},ce.map((function(e,t){var a=e.value===h?{isPrimary:!0}:{isSecondary:!0};return Object(r.createElement)(c.Button,g({onClick:function(){N(e.value)}},a,{className:e.className,key:t}),1==e.value?Object(r.createElement)(f.a,{icon:"broadcasts",color:e.value===h?"#fff":"#000"}):Object(r.createElement)(f.a,{icon:"timer",color:e.value===h?"#fff":"#000"}),e.label)}))),2==h&&Object(r.createElement)("div",{className:"bwf-crm-campaign-review-date-wrap"},Object(r.createElement)("div",null,Object(r.createElement)("span",{className:"bwf-mr-5"},Object(r.createElement)(f.a,{icon:"calender"})),Object(n.__)("Pick Date and Time","wp-marketing-automations")),Object(r.createElement)("div",{className:"bwf-crm-campaign-review-schedule-text-box",id:"bwf-crm-campaign-review-schedule-text-box",onClick:function(e){e.stopPropagation(),b(!m)}},Object(s.O)(d()(C),!1,!1)),m&&Object(r.createElement)("div",{className:"bwf-crm-campaign-schedule-popover",onClick:function(e){return e.stopPropagation()}},Object(r.createElement)(c.DateTimePicker,{currentDate:C,isInvalidDate:function(e){return Object(s.z)(e).isBefore(Object(s.z)(d()()),"day")},onChange:function(e,t){var a=Object(s.z)(d()(new Date)).format("YYYY-MM-DDTHH:mm:ss"),r=Object(s.z)(d()(e));r.isAfter(a)||r.isSame(a,"minute")?S(e):J({message:Object(n.__)("Given time should exceeds the current time.","wp-marketing-automations"),type:0})},is12Hour:!0}),Object(r.createElement)("div",{className:"bwf-p bwf-display-flex"},"Current Store Time: ",Object(s.O)(d()().tz("UTC")))))))))),Object(r.createElement)("div",{className:"bwf-p-gap bwf-pt-0"},Object(r.createElement)("div",{className:"bwf-crm-campaign-navigation"},Object(r.createElement)(c.Button,{isSecondary:!0,className:"bwf-crm-navigation-previous",onClick:function(){V("step",3)}},Object(n.__)("Previous","wp-marketing-automations")),Object(r.createElement)(c.Button,{className:"bwf-crm-navigation-next",isPrimary:!0,disabled:!L,onClick:function(){L&&ne()},isBusy:e.isPending},1===h?Object(n.__)("Send Now","wp-marketing-automations"):Object(n.__)("Schedule","wp-marketing-automations")))),Object(r.createElement)(j.a,{modalTitle:Object(n.__)("Update Broadcast"),confirmText:x.confirmText,deleteEntityName:x.deleteEntityName,confirmButtonText:x.buttonConfirm,cancelButtonText:x.buttonCancel,onConfirm:x.onConfirm,isLoading:x.loading,successMessage:x.success,errorMessage:x.error,onRequestClose:function(){return T({status:!1})},isOpen:x.status,isDelete:!0}),Object(r.createElement)(u.a,{message:q.message,type:q.type,removeMessage:function(){return J({message:"",type:1})}})))}}}]);