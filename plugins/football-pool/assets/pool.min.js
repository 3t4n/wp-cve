/*
 Football Pool WordPress plugin

 @copyright Copyright (c) 2012-2022 Antoine Hurkmans
 @link https://wordpress.org/plugins/football-pool/
 @license https://plugins.svn.wordpress.org/football-pool/trunk/COPYING

 This file is part of Football pool.

 Football pool is free software: you can redistribute it and/or modify it under the
 terms of the GNU General Public License as published by the Free Software Foundation,
 either version 3 of the License, or (at your option) any later version.

 Football pool is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
 PURPOSE. See the GNU General Public License for more details.

 You should have received a copy of the GNU General Public License along with Football pool.
 If not, see <https://www.gnu.org/licenses/>.
*/
var fp_do_ajax_saves="yes"===FootballPoolAjax.do_ajax_saves,fp_show_success_messages="yes"===FootballPoolAjax.show_success_messages,fp_onunload_check="yes"===FootballPoolAjax.onunload_check;
jQuery(document).ready(function(){jQuery(".fp-lightbox").colorbox({transition:"elastic",speed:400,maxWidth:"95%",maxHeight:"95%"});!0===fp_do_ajax_saves&&(jQuery("form.fp-prediction-form").on("input","input.prediction",function(){FootballPool.change_prediction(jQuery(this),"team")}),jQuery("form.fp-prediction-form").on("input","input.bonus, textarea.bonus, select.bonus",function(){FootballPool.change_prediction(jQuery(this),"question")}),jQuery(document).on("submit","form.fp-prediction-form",function(){FootballPool.do_submit()}),
fp_onunload_check&&window.addEventListener("beforeunload",function(e){!1===FootballPool.check_submit()&&!1===FootballPool.check_for_unsaved_changes()&&(e.preventDefault(),e.returnValue=FootballPool_i18n.unsaved_changes_message)}));jQuery("body").prepend('<div id="fp-toasts"></div>')});
var FootballPool=function(e){function p(a,b){a.data("saved",b)}function y(a){var b="",c=a.closest("div.bonus"),f=a.attr("name"),g=f.substring(f.indexOf("_")+1);g=g.substring(g.indexOf("_")+1,g.length);-1!==g.indexOf("[")&&(g=g.substring(0,g.indexOf("[")));var h=a.prop("type");if("text"===h||"textarea"===h||"select-one"===h)b=a.val();else if("radio"===h)b=a.val(),a.data("value",null);else if("checkbox"===h){var l=[];e('input[name="'+f+'"]:checked').each(function(){l.push(e(this).val())});b=l.join(";");
a.data("value",b)}e.ajax({data:{action:"footballpool_update_bonus_question",fp_question_nonce:FootballPoolAjax.fp_question_nonce,answer:b,question:g,type:h},url:FootballPoolAjax.ajax_url,global:!1,dataType:"json",method:"POST",success:function(d,q,m){!1===d.return_code?n({type:"error",message:d.msg}):(console.log("Question "+g+" saved!"),fp_show_success_messages&&n({type:"success",message:k.question_saved.replace("{id}",g)}));p(a,!0);r(c)},error:function(d,q,m){console.log(m);n({type:"error",message:k.general_error});
r(c)}})}function z(a){var b=a.attr("name");b=b.substring(b.indexOf("_")+1);var c=b.substring(b.indexOf("_")+1,b.length);b=b.substring(0,b.indexOf("_"));e.ajax({data:{action:"footballpool_update_team_prediction",fp_match_nonce:FootballPoolAjax.fp_match_nonce,prediction:a.val(),match:c,type:b},url:FootballPoolAjax.ajax_url,global:!1,dataType:"json",method:"POST",success:function(f,g,h){!1===f.return_code?(n({type:"error",message:f.msg}),null!==f.prev_prediction?a.val(parseInt(f.prev_prediction,10)):
a.val("")):(console.log("Match "+c+" saved!"),fp_show_success_messages&&n({type:"success",message:k.match_saved.replace("{id}",c)}));p(a,!0);r(a)},error:function(f,g,h){console.log(h);n({type:"error",message:k.general_error});r(a)}})}function A(a){var b=a.substring(a.indexOf("-")+1);b=b.substring(0,b.indexOf("-"));var c=e("#"+a);c.addClass("saving");c.closest(".match-card").addClass("saving");p(c,!1);e.ajax({data:{action:"footballpool_update_joker",fp_joker_nonce:FootballPoolAjax.fp_joker_nonce,joker:b},
url:FootballPoolAjax.ajax_url,global:!1,dataType:"json",method:"POST",success:function(f,g,h){!1===f.return_code?(n({type:"error",message:f.msg}),v(b)):(0<Object.keys(f.action).length&&e.each(f.action,function(l,d){"set"===d?t(l,!0):"clear"===d?t(l,!1):console.log("ERROR: undefined joker action.")}),p(c,!0),e("input[name='_joker']").val(f.joker),console.log("Multiplier "+b+" saved!"),fp_show_success_messages&&n({type:"success",message:k.match_saved.replace("{id}",b)}))},error:function(f,g,h){console.log(h);
n({type:"error",message:k.general_error});v(b)}})}function r(a){a.removeClass("saving");a.closest(".match-card").removeClass("saving")}function v(a){a=e('div[id^="joker-'+a+'-"]');a.removeClass("saving");a.closest(".match-card").removeClass("saving")}function t(a,b){var c=!0===b?"fp-joker":"fp-nojoker";b=!0===b?"fp-nojoker":"fp-joker";e('div[id^="joker-'+a+'-"]').removeClass(b).addClass(c);fp_do_ajax_saves&&v(a)}function w(a,b){a="#q"+a;e(a+" :checkbox:checked").length>=b?e(a+" :checkbox:not(:checked)").attr("disabled",
"disabled"):e(a+" :checkbox").removeAttr("disabled")}function n(a){a=e.extend({},{autoDismiss:!0,container:"#fp-toasts",autoDismissDelay:4E3,transitionDuration:500},a);e.toast(a)}var k=FootballPool_i18n,x=!1;return{add_ordinal_suffix:function(a,b){var c=b||["th","st","nd","rd","th"];b=String(a);b=3<b.substring(-Math.min(b.length,2))&&21>b.substring(-Math.min(b.length,2))?c[0]:c[Math.min(Number(b)%10,4)];return a+b},change_joker:function(a){if(!0===fp_do_ajax_saves)A(a);else{var b=e("input[name='_joker']").val().split(","),
c=e("#"+a).hasClass("fp-joker");a=a.substring(a.indexOf("-")+1);a=a.substring(0,a.indexOf("-"));c?(t(a,!1),c=b.indexOf(a),-1<c&&b.splice(c,1)):(t(a,!0),b.push(a));e("input[name='_joker']").val(b.join())}},change_prediction:function(a,b){var c=a.data("timer"),f=parseInt(FootballPoolAjax.ajax_save_delay,10);c&&clearTimeout(c);a.data("timer",setTimeout(function(){a.val()!==a.data("value")&&(a.data("value",a.val()),"team"===b?(a.addClass("saving"),a.closest(".match-card").addClass("saving")):a.closest("div.bonus").addClass("saving"),
p(a,!1),"team"===b?z(a):y(a))},f))},update_chars:function(a,b){a=e("#"+a);var c=a.val().length;b-=c;a.parent().find("span span").replaceWith("<span>"+b+"</span>")},countdown:function(a,b,c,f,g,h,l,d,q,m){l=(new Date(c,f-1,g,h,l,d)).getTime();var u=(new Date).getTime();d=Math.abs(Math.round((l-u)/1E3));h=g=f=c=0;if(""===m||null===m)m="{d} {days}, {h} {hrs}, {m} {min}, {s} {sec}";null===b&&(b={pre_before:k.count_pre_before,post_before:k.count_post_before,pre_after:k.count_pre_after,post_after:k.count_post_after});
l<u?(l=b.pre_after,b=b.post_after):(l=b.pre_before,b=b.post_before);switch(q){case 1:h=d;break;case 2:case 4:switch(!0){case 86400<d:c=Math.floor(d/86400),d-=86400*c;case 3600<d:f=Math.floor(d/3600),d-=3600*f;case 60<d:g=Math.floor(d/60),d-=60*g;default:h=d}break;case 3:case 5:switch(!0){case 3600<d:f=Math.floor(d/3600),d-=3600*f;case 60<d:g=Math.floor(d/60),d-=60*g;default:h=d}}q=1===c?k.count_day:k.count_days;d=1===f?k.count_hour:k.count_hours;u=1===g?k.count_minute:k.count_minutes;var B=1===h?
k.count_second:k.count_seconds;m=m.replace("{d}",c).replace("{days}",q).replace("{h}",f).replace("{hrs}",d).replace("{m}",g).replace("{min}",u).replace("{s}",h).replace("{sec}",B);e(a).text(l+m+b)},charts_user_toggle:function(){e("input:checkbox",".user-selector ol").bind("click",function(){e(this).parent().parent().toggleClass("selected")})},set_max_answers:function(a,b){var c="#q"+a;w(a,b);e(c+" :checkbox").click(function(){w(a,b)})},do_submit:function(){x=!0},check_submit:function(){return x},
check_for_unsaved_changes:function(){var a=!0;e(".match.open input.prediction, .bonus.open input.bonus, .bonus.open textarea.bonus, .bonus.open ul.multi-select input, .bonus.open .multi-select select, .match.open .fp-joker-box").each(function(){a=!1!==e(this).data("saved")&&a;if(!1===a)return!1});return a}}}(jQuery);
