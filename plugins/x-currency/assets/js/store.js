(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);var r={};e.r(r),e.d(r,{getMarkedData:()=>o,isAllMarked:()=>i,onAllMarkToggle:()=>n,prepareMarker:()=>l});var a={};e.r(a),e.d(a,{conditional_field:()=>d,responsiveDefaultValue:()=>p,screenSize:()=>u});var s={};e.r(s),e.d(s,{exportAsJSON:()=>S,toNumber:()=>C,validateCurrencyList:()=>E});const c=window.wp.hooks;function n(e,t){const r={};for(let a in e.marker)r[a]=!t;return r}function o(e){const t=[];for(let r in e.marker)e.marker[r]&&t.push(r);return t}function i(e){const t=o(e).length,r=Object.keys(e.marker).length;return t>0&&r>0&&t===r}function l(e=[]){return e.reduce(((e,t)=>({...e,[t]:!1})),"")||{}}function d(e,t){let r=!0;return Object.entries(e.conditional||{}).map((([e,a])=>{r=!(!r||!Reflect.has(t,e)||a!=t[e])})),r}function u(e){return"default"===e?"100%":"tablet"===e?620:"mobile"===e?400:"100%"}function p(e,t,r,a="default"){let s=r;return e.responsive&&"default"!==a&&(s=`_${a}_${r}`),t[s]}(0,c.addFilter)("x-currency-pro.license","pro_license_validation",(()=>({isPro:!1}))),(0,c.addFilter)("x-currency-pro.components","pro_plugin_components",(()=>({})));const y=window.wp.data;function E(e=[]){const t={},r=[],a=[],s={};if(!_.isArray(e))return console.warn("Currency list must be an array"),{list:t,allowed:r,rejected:a,marker:s};let n=!1;const o=(0,c.applyFilters)("x-currency-pro.license"),i=(0,y.select)("x-currency/global").getBaseCurrency();return e.filter(((c,l)=>{t[c.id]=c,_.size(e)<=3||o.isPro?(r.push(c.id),i!=c.id&&(s[c.id]=!1)):(!n&&l<=2&&i==c.id&&(n=!0),l<2||i&&2===l?(r.push(c.id),i!=c.id&&(s[c.id]=!1)):!i&&l>2?(n=!0,r.push(i),i!=c.id&&(s[i]=!1)):i&&l>2&&i!=c.id&&a.push(c.id))})),{list:t,allowed:r,rejected:a,marker:s}}function S(e,t){let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}function C(e){return _.isArray(e)?e.map((e=>Number(e))):Number(e)}window.Xcurrency={Meta:Backbone.Model.extend({defaults:{apiPrefix:"/x-currency/"}}),Utility:Backbone.Model.extend({...t,...r,...a,...s})};const T=window.jQuery;let g=T("#adminmenuwrap").outerWidth(),m=T("#wpadminbar").outerHeight();const h={style:{height:60,left:g,top:m,width:`calc(100% - ${g}px)`}};(0,y.register)((0,y.createReduxStore)("x-currency/header",{reducer:(e=h,t)=>"SET_STYLE"===t.type?{...e,style:{...e.style,...t.payload}}:e,actions:{setStyle:e=>({type:"SET_STYLE",payload:e})},selectors:{getStyle:e=>e.style}})),T(document).on("wp-menu-state-set wp-collapse-menu",(function(e,t){"open"!==t.state&&"folded"!==t.state||(g=T("#adminmenuwrap").outerWidth(),m=T("#wpadminbar").outerHeight(),(0,y.dispatch)("x-currency/header").setStyle({left:g,top:m,width:`calc(100% - ${g}px)`})),"responsive"===t.state&&(0,y.dispatch)("x-currency/header").setStyle({left:0,top:0,width:"100%"})}));const R=window.wp.apiFetch;var f=e.n(R);const A=new Xcurrency.Meta,w={settings:{},fields:{}},k={setSettings:e=>({type:"SET_SETTINGS",payload:e}),setFields:e=>({type:"SET_FIELDS",payload:e}),fetchFromAPI:e=>({type:"FETCH_FROM_API",path:A.get("apiPrefix")+e})},I={getSettings:e=>e.settings,getFields:e=>e.fields,getBaseCurrency:e=>e.settings.base_currency||x_currency.base_currency},F={FETCH_FROM_API:e=>f()({path:e.path})},M={*getFields(){const e=yield k.fetchFromAPI("setting_inputs");return k.setFields(e.data)}};(0,y.register)((0,y.createReduxStore)("x-currency/global",{reducer:(e=w,t)=>{switch(t.type){case"SET_SETTINGS":return e.fields.base_currency.default=t.payload.base_currency,Object.keys(e.fields).forEach((r=>{e.fields[r].default=t.payload[r]})),e.settings=t.payload,e;case"SET_FIELDS":return{...e,fields:t.payload}}return e},actions:k,selectors:I,controls:F,resolvers:M}));const L=new Xcurrency.Meta,P=new Xcurrency.Utility,O={createFields:{},list:{},allowed:[],rejected:[],marker:{},demoList:{},geoFields:{}},b={setCurrencyInputFields:e=>({type:"SET_CURRENCY_INPUT_FIELDS",payload:e}),setCurrencyOrganiser(e,t){let r=e,a=t,s=(0,c.applyFilters)("x-currency-pro.license");return"sort"===e?(r="SET_SORT_CURRENCY",s.isPro||(a=_.first(t,3))):"deactive"===e?r="SET_DEACTIVE_CURRENCY":"active"===e?r="SET_ACTIVE_CURRENCY":"delete"===e&&(r="SET_DELETE_CURRENCY"),{type:r,payload:a}},setNewCurrency:e=>({type:"CREATE_NEW_CURRENCY",payload:e}),setUpdateCurrency:e=>({type:"CREATE_UPDATE_CURRENCY",payload:e}),setCurrencies:e=>({type:"SET_CURRENCIES",payload:e}),setDemoCurrencies:e=>({type:"SET_DEMO_CURRENCIES",payload:e}),setMarkToggle:e=>({type:"SET_MARK_TOGGLE",payload:e}),setAllMarkToggle:()=>({type:"SET_ALL_MARK_TOGGLE",payload:""}),setGeoFields:e=>({type:"SET_GEO_FIELDS",payload:e}),fetchFromAPI:e=>({type:"FETCH_FROM_API",path:L.get("apiPrefix")+e})},D={getCurrencyInputFields:e=>e.currencyInputFields,getCurrencies:e=>({list:e.list,allowed:e.allowed,rejected:e.rejected}),getDemoCurrencies:e=>e.demoCurrencies,isMarked:(e,t)=>!!Reflect.has(e.marker,t)&&e.marker[t],isAllMarked:e=>P.isAllMarked(e),getMarkedData:e=>P.getMarkedData(e),getGeoFields:e=>e.geoFields},N={FETCH_FROM_API:e=>f()({path:e.path,headers:{"X-WP-Nonce":x_currency.nonce}})},U={*getCurrencyInputFields(){const e=yield b.fetchFromAPI("currency_input_fields");return b.setCurrencyInputFields(e.data)},*getCurrencies(){const e=yield b.fetchFromAPI("currencies");return b.setCurrencies(P.validateCurrencyList(e.data))},*getDemoCurrencies(){const e=yield b.fetchFromAPI("demo_currencies");return b.setDemoCurrencies(e.data)},*getGeoFields(){const e=yield b.fetchFromAPI("geo_input_fields");return b.setGeoFields(e.data)}};(0,y.register)((0,y.createReduxStore)("x-currency/currencies",{reducer:(e=O,t)=>{switch(t.type){case"SET_CURRENCY_INPUT_FIELDS":return{...e,currencyInputFields:t.payload};case"SET_CURRENCIES":return{...e,...t.payload};case"CREATE_NEW_CURRENCY":return e.list[t.payload.id]=t.payload,e.allowed.push(t.payload.id),e.marker[t.payload.id]=!1,{...e};case"CREATE_UPDATE_CURRENCY":return e.list[t.payload.id]=t.payload,{...e};case"SET_DEMO_CURRENCIES":return{...e,demoCurrencies:t.payload};case"SET_SORT_CURRENCY":return{...e,allowed:t.payload};case"SET_DEACTIVE_CURRENCY":return t.payload.filter((t=>{e.marker[t]=!1,e.list[t].active=!1})),{...e};case"SET_ACTIVE_CURRENCY":return t.payload.filter((t=>{e.marker[t]=!1,e.list[t].active=!0})),{...e};case"SET_DELETE_CURRENCY":return t.payload.filter((t=>{e.allowed=_.without(P.toNumber(e.allowed),P.toNumber(t)),delete e.list[t],delete e.marker[t]})),{...e};case"SET_MARK_TOGGLE":return e.marker[t.payload]=!e.marker[t.payload],{...e};case"SET_GEO_FIELDS":return{...e,geoFields:t.payload};case"SET_ALL_MARK_TOGGLE":const r=P.isAllMarked(e),a=P.onAllMarkToggle(e,r);return{...e,marker:a}}return e},actions:b,selectors:D,controls:N,resolvers:U}));const x=(0,y.dispatch)("x-currency/currencies");(0,c.addAction)("x-currency.sync_currencies","syncCurrencies",(()=>{f()({path:L.get("apiPrefix")+"currencies"}).then((e=>{"success"===e.status&&x.setCurrencies(P.validateCurrencyList(e.data))}))})),(0,c.addAction)("x-currency.sync_demo_currencies","syncDemoCurrencies",(()=>{f()({path:L.get("apiPrefix")+"demo_currencies"}).then((e=>{"success"===e.status&&x.setDemoCurrencies(e.data)}))}));const v={switcherList:null,marker:{},pages:[]},G=new Xcurrency.Meta,H=new Xcurrency.Utility,Y={setSwitcherList:e=>({type:"SET_SWITCHER_LIST",payload:e}),setMarkToggle:e=>({type:"SET_MARK_TOGGLE",payload:e}),setAllMarkToggle:()=>({type:"SET_ALL_MARK_TOGGLE",payload:""}),setSwitcher:e=>({type:"CREATE_SWITCHER",payload:e}),setUpdateSwitcher:e=>({type:"CREATE_SWITCHER",payload:e}),setSwitcherOrganiser:(e,t)=>({type:e,payload:t}),fetchFromAPI:e=>({type:"FETCH_FROM_API",path:G.get("apiPrefix")+e}),setPages:e=>({type:"SET_PAGES",payload:e})},j={getSwitcherList:e=>e.switcherList,isMarked:(e,t)=>!!Reflect.has(e.marker,t)&&e.marker[t],isAllMarked:e=>H.isAllMarked(e),getMarkedData:e=>H.getMarkedData(e),getPages:e=>e.pages},W={FETCH_FROM_API:e=>f()({path:e.path})},V={*getSwitcherList(){const e=yield Y.fetchFromAPI("switcher_list");return Y.setSwitcherList(e.data)},*getFields(){const e=yield Y.fetchFromAPI("setting_inputs");return Y.setFields(e.data)},*getPages(){const e=yield Y.fetchFromAPI("pages");return Y.setPages(e.data)}};(0,y.register)((0,y.createReduxStore)("x-currency/switchers",{reducer:(e=v,t)=>{switch(t.type){case"SET_SWITCHER_LIST":const r=Object.keys(t.payload);return{...e,switcherList:t.payload,marker:H.prepareMarker(r)};case"SET_MARK_TOGGLE":return e.marker[t.payload]=!e.marker[t.payload],{...e};case"SET_ALL_MARK_TOGGLE":const a=H.isAllMarked(e),s=H.onAllMarkToggle(e,a);return{...e,marker:s};case"CREATE_SWITCHER":return e.switcherList[t.payload.id]=t.payload,e.marker[t.payload.id]=!1,{...e};case"SET_DEACTIVE_SWITCHER":return t.payload.filter((t=>{e.marker[t]=!1,e.switcherList[t].active=!1})),{...e};case"SET_ACTIVE_SWITCHER":return t.payload.filter((t=>{e.marker[t]=!1,e.switcherList[t].active=!0})),{...e};case"SET_DELETE_SWITCHER":return t.payload.filter((t=>{delete e.switcherList[t],delete e.marker[t]})),{...e};case"SET_PAGES":return e.pages=t.payload,{...e}}return e},actions:Y,selectors:j,controls:W,resolvers:V}));const K={device:"default",controls:{},custom_css:{}};(0,y.register)((0,y.createReduxStore)("x-currency/editor",{reducer:(e=K,t)=>{const{type:r,payload:a}=t;switch(r){case"SET_DEVICE":return{...e,device:a};case"SET_CONTROLS":return e.controls[a.id]=a.attributes,{...e};case"SET_CUSTOM_CSS":case"UPDATE_CUSTOM_CSS":return e.custom_css[a.id]=a.css,{...e};case"UPDATE_CONTROL":return{...e,controls:{...e.controls,[a.id]:{...e.controls[a.id],[a.property]:a.value}}}}return e},actions:{setDevice:e=>({type:"SET_DEVICE",payload:e}),setControls:(e,t)=>({type:"SET_CONTROLS",payload:{id:e,attributes:t}}),setCustomCSS:(e,t)=>({type:"SET_CUSTOM_CSS",payload:{id:e,css:t}}),updateControl:(e,t,r)=>({type:"UPDATE_CONTROL",payload:{id:e,property:t,value:r}}),updateCustomCSS:(e,t)=>({type:"UPDATE_CUSTOM_CSS",payload:{id:e,css:t}})},selectors:{getDevice:e=>e.device,getControls:e=>e.controls,getCustomCSS:e=>e.custom_css}}))})();