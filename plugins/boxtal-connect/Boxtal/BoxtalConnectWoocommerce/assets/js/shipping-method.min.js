"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e={};e.ratesTable={branding:"bw",trigger:"#bw-rates-table",init:function(){var t=document.querySelector(this.trigger),n=this;null!==t&&(n.on("body","click","."+e.ratesTable.branding+"-add-rate-line",function(t){t.preventDefault();var r=new XMLHttpRequest;r.onreadystatechange=function(t){if(4===r.readyState)if(200===r.status){var a="object"===_typeof(r.response)&&null!==r.response?r.response.data:JSON.parse(r.response).data;n.getTableBody().insertAdjacentHTML("beforeend",a),n.initSelect("#"+e.ratesTable.branding+"-rates-table tbody tr:last-child ."+e.ratesTable.branding+"-tail-select")}else console.log("Error: "+r.status)},r.open("POST",bwData[e.ratesTable.branding].ajaxurl),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.responseType="json";var a="action="+t.target.getAttribute("data-action")+"&security="+encodeURIComponent(bwData[e.ratesTable.branding].shippingMethodAjaxNonce),l=n.getTableRows();if(null!==l){var i=l[l.length-1],o=[];n.parseNodeChildrenSpecificTypeAction(i,["SELECT","INPUT"],function(e){if("SELECT"===e.tagName){var t=e.getAttribute("name"),r=n.getSelectedOptions(e);r.length>0?r.map(function(e){o.push(t+"="+encodeURIComponent(e.value))}):o.push(t+"=")}else o.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),a+="&"+o.join("&")}r.send(a)}),n.on("body","click","."+e.ratesTable.branding+"-remove-rate-line",function(e){e.preventDefault();var t=document.querySelector(".pricing-item.last_selected");null!==t&&t.remove()}),n.on("body","click","."+e.ratesTable.branding+"-remove-line",function(e){e.preventDefault();var t=n.getParentRow(e.target);null!==t&&t.remove()}),n.on("body","change","."+e.ratesTable.branding+"-change-state",function(e,t){var r=null!==e.target&&!1===e.target.checked,a=n.getParentRow(e.target);null!==a&&n.setRowState(a,r)}),n.initSelect("."+e.ratesTable.branding+"-tail-select"),n.submitForm=n.submitForm.bind(n),document.getElementById("mainform").addEventListener("submit",n.submitForm))},getParentRow:function(e){for(;null!==e&&e!==undefined&&"tr"!==e.tagName.toLowerCase();)e=e.parentNode;return e===undefined?null:e},setRowState:function(t,n){var r=t.querySelectorAll('input[type="text"], input[type="number"], select'),a=!0,l=!1,i=undefined;try{for(var o,c=r[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var u=o.value;if("select"===u.tagName.toLowerCase()){var s=tail.select(u);n?s.disable():s.enable()}else u.disabled=n}}catch(d){l=!0,i=d}finally{try{!a&&c["return"]&&c["return"]()}finally{if(l)throw i}}this.initSelect("#"+e.ratesTable.branding+"-rates-table ."+e.ratesTable.branding+"-tail-select"),n?t.classList.add("disabled"):t.classList.remove("disabled")},getSelectedOptions:function(e,t){for(var n,r=[],a=0,l=e.options.length;a<l;a++)(n=e.options[a]).selected&&(r.push(n),t&&t(n));return r},submitForm:function(t){t.preventDefault();var n=[],r=document.querySelectorAll(".pricing-item");if(r.length>0)for(var a=0;a<r.length;a++){var l=r[a],i=l.querySelector("td .state"),o=i.checked?i.getAttribute("data-checked"):i.getAttribute("data-unchecked"),c=l.querySelector("td .shipping-class"),u=document.querySelector("#"+e.ratesTable.branding+"-rates-table").getAttribute("data-default-shipping-class"),s={"price-from":l.querySelector("td .price-from").value,"price-to":l.querySelector("td .price-to").value,"weight-from":l.querySelector("td .weight-from").value,"weight-to":l.querySelector("td .weight-to").value,"shipping-class":null===c?[u]:Array.apply(null,c.options).filter(function(e){return e.selected}).map(function(e){return e.value}),"parcel-point-network":Array.apply(null,l.querySelector("td .parcel-point-network").options).filter(function(e){return e.selected}).map(function(e){return e.value}),pricing:o,"flat-rate":l.querySelector("td .flat-rate").value,state:l.querySelector("td .state").checked};n.push(s)}var d=document.querySelectorAll(".pricing-item input, .pricing-item select");if(d.length>0)for(var g=0;g<d.length;g++){d[g].disabled=!0}var p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","pricing-items"),p.value=JSON.stringify(n);var b=document.createElement("input");return b.setAttribute("type","hidden"),b.setAttribute("name","save"),b.value=1,document.querySelector(this.trigger).appendChild(p),document.querySelector(this.trigger).appendChild(b),document.getElementById("mainform").removeEventListener("submit",this.submitForm),document.getElementById("mainform").submit(),!0},initSelect:function(t){for(var n=this,r=tail.select(t,{locale:bwData[e.ratesTable.branding].locale,multiShowCount:!1,multiSelectAll:!0,cbComplete:function(e){var t=n.getPlaceholderText(this),r=e.querySelector(".label-inner");null!==r&&(r.innerHTML=t)}}),a=function(e){var t=r[e];t.on("close",function(){n.refreshSelectText(this)}),t.e.name.indexOf('["pricing"]')>-1&&t.on("change",function(e,n){var r=/pricing-items\[(\d+)\]\["pricing"\]/g.exec(t.e.name);if(null!==r){var a=r[1],l=document.getElementById("flat-rate-"+a);null!==l&&("rate"===e.key?(l.removeAttribute("disabled"),""===l.value&&(l.value=0)):l.setAttribute("disabled","disabled"))}})},l=0;l<r.length;l++)a(l)},getPlaceholderText:function(t){if(t.options.length>0){for(var n=[],r=0;r<t.options.length;r++){var a=t.options[r];!0===a.selected&&n.push(a.value)}return n.length>0?n.length===t.options.length?tail.select.strings[bwData[e.ratesTable.branding].locale].all:n.join(", "):tail.select.strings[bwData[e.ratesTable.branding].locale].none}return tail.select.strings[bwData[e.ratesTable.branding].locale].emptySearch},refreshSelectText:function(e){var t=this.getPlaceholderText(e);e.config("placeholder",t)},getTableBody:function(){var e=document.querySelector(this.trigger).querySelector("tbody");return null===e?null:e},getTableRows:function(){var e=this.getTableBody();return null===e?null:0===e.childElementCount?null:e.children},parseNodeChildrenSpecificTypeAction:function(e,t,n){if(e.hasChildNodes())for(var r=e.childNodes,a=0;a<r.length;a++){var l=r[a];-1!==t.indexOf(l.tagName)&&n(l),this.parseNodeChildrenSpecificTypeAction(l,t,n)}return e},on:function(e,t,n,r){var a=document.querySelector(e);a.addEventListener(t,function(e){for(var t=a.querySelectorAll(n),l=e.target,i=0,o=t.length;i<o;i++)for(var c=l,u=t[i];c&&c!==a;){if(c===u)return r.call(u,e);c=c.parentNode}})}},document.addEventListener("DOMContentLoaded",function(){e.ratesTable.init()})}();