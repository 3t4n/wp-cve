(()=>{"use strict";function e(o){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(o)}jQuery((function(o){if("undefined"==typeof wcDibsEasy)return!1;var t={bodyEl:o("body"),paymentMethodEl:o('input[name="payment_method"]'),dibsCheckout:null,blocked:!1,selectAnotherSelector:"#dibs-easy-select-other",checkoutInitiated:wcDibsEasy.checkoutInitiated,dibsOrderProcessing:!1,checkoutFormSelector:"form.checkout",shippingSelector:".woocommerce-checkout-review-order-table",standardWooFields:wcDibsEasy.standard_woo_checkout_fields,wooTerms:"form.checkout #terms",init:function(){o(document).ready(t.loadDibs),t.bodyEl.on("click",t.selectAnotherSelector,t.changeFromDibsEasy)},dibsIsSelected:function(){return t.paymentMethodEl.length>0&&(t.paymentMethod=t.paymentMethodEl.filter(":checked").val(),"dibs_easy"===t.paymentMethod)},loadDibs:function(){t.dibsIsSelected()&&(t.moveExtraCheckoutFields(),t.initDibsCheckout(),t.bodyEl.on("update_checkout",t.updateCheckout),t.bodyEl.on("updated_checkout",t.updatedCheckout))},paymentCompleted:function(e){t.logToFile("Payment completed is triggered with payment id: ".concat(e.paymentId));var o=sessionStorage.getItem("redirectNets");o&&(window.location.href=o)},displayMustLoginError:function(e){var o='<div class="'.concat("woocommerce-NoticeGroupwoocommerce-NoticeGroup-updateOrderReview",'">\n\t\t\t\t<ul class="woocommerce-error" role="alert">\n\t\t\t\t\t<li>').concat(e,"</li>\n\t\t\t\t</ul>\n\t\t\t</div>");t.checkoutFormSelector.prepend(o)},updateAddress:function(e){if("yes"===e.updateNeeded&&(o("#billing_country").val(e.country),o("#shipping_country").val(e.country),o("#billing_postcode").val(e.postCode),o("#shipping_postcode").val(e.postCode)),"yes"===e.mustLogin){t.displayMustLoginError(e.mustLoginMessage),t.dibsCheckout.freezeCheckout();var a=t.checkoutFormSelector.offset().top;o("html, body").animate({scrollTop:a},1e3)}else t.dibsCheckout.thawCheckout(),o(document.body).trigger("update_checkout")},updateCheckout:function(){console.log("update_checkout"),void 0!==window.Dibs&&t.dibsCheckout.freezeCheckout()},updatedCheckout:function(){console.log("updated_checkout"),void 0!==window.Dibs&&(t.dibsCheckout.thawCheckout(),o("#dibs-order-review").unblock())},addressChanged:function(e){t.logToFile("Address changed is triggered."),e&&(console.log("address-changed"),console.log(e),o.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.customer_address_updated_url,data:{action:"customer_address_updated",address:e,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){},error:function(e){},complete:function(e){console.log("COMPLETED"),console.log("customer_address_updated "),console.log(e.responseJSON.data),t.updateAddress(e.responseJSON.data),wcDibsEasy.isMobile&&o("html, body").animate({scrollTop:o(wcDibsEasy.shippingSelector).offset().top-10},1e3)}}))},applePayAddressChanged:function(e){console.log("applepay-contact-updated",e),t.logToFile("ApplePay address changed is triggered."),e&&(console.log("applepay-contact-updated"),o.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.customer_address_updated_url,data:{action:"customer_address_updated",address:e,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){},error:function(e){},complete:function(e){console.log("COMPLETED"),console.log("customer_address_updated "),console.log(e.responseJSON.data),t.updateAddress(e.responseJSON.data),t.dibsCheckout.completeApplePayShippingContactUpdate(e.responseJSON.data.cart_total)}}))},initDibsCheckout:function(){t.dibsCheckout=new Dibs.Checkout({checkoutKey:wcDibsEasy.privateKey,paymentId:wcDibsEasy.dibs_payment_id,containerId:"dibs-complete-checkout",language:wcDibsEasy.locale}),t.dibsCheckout.on("pay-initialized",t.getDibsEasyOrder),t.dibsCheckout.on("payment-completed",t.paymentCompleted),t.dibsCheckout.on("address-changed",t.addressChanged),t.dibsCheckout.on("applepay-contact-updated",t.applePayAddressChanged)},getDibsEasyOrder:function(e){t.dibsOrderProcessing=!0,t.logToFile("Pay initialized is triggered with payment id: ".concat(e)),o(document.body).trigger("dibs_pay_initialized"),o.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.get_order_data_url,data:{action:"payment_success",paymentId:e,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){console.log(e),!1===e.success?(console.log("PaymentID already exist in order"),console.log(e),t.failOrder("ajax-error",'<div class="woocommerce-error">'+e.data+"</div>"),e.data.redirect&&(window.location.href=e.data.redirect)):t.setAddressData(e)},error:function(e){console.log(e,"error_data")},complete:function(e){}})},setAddressData:function(a){t.logToFile('Received "customer data" from Nets Easy');var c=a.data.payment.consumer,s=c.billingAddress,i=c.shippingAddress,n="object"===e(s)&&!Array.isArray(s);if(o("#billing_address_1").val(n?s.addressLine1:i.addressLine1),o("#billing_postcode").val(n?s.postalCode:i.postalCode),o("#billing_city").val(n?s.city:i.city),o("#billing_country").val(i.country),o("#shipping_address_1").val(i.addressLine1),o("#shipping_postcode").val(i.postalCode),o("#shipping_city").val(i.city),o("#shipping_country").val(i.country),c.company.hasOwnProperty("name")){var r=c.company,d=r.contactDetails,l=d.firstName,u=d.lastName,p=d.email,m=d.phoneNumber,y=m.prefix,g=m.number;o("#billing_company").val(r.name),o("#shipping_company").val(r.name),o("#billing_first_name").val(l),o("#billing_last_name").val(u),o("#shipping_first_name").val(l),o("#shipping_last_name").val(u),o("#billing_email").val(p),o("#billing_phone").val("".concat(y).concat(g)),o("#billing_country").change(),o("#billing_email").change(),o("#billing_email").blur()}else{var h=c.privatePerson,b=h.firstName,_=h.lastName,f=h.email,k=h.phoneNumber,v=k.prefix,w=k.number;o("#billing_company").val(""),o("#shipping_company").val(""),o("#billing_first_name").val(b),o("#billing_last_name").val(_),o("#shipping_first_name").val(b),o("#shipping_last_name").val(_),o("#billing_email").val(f),o("#billing_email").change(),o("#billing_email").blur(),o("#billing_phone").val("".concat(v).concat(w))}null!=i.addressLine2&&(o("#billing_address_2").val(i.addressLine2),o("#shipping_address_2").val(i.addressLine2)),o(t.wooTerms).length>0&&o(t.wooTerms).prop("checked",!0),o("input#ship-to-different-address-checkbox").prop("checked",!0),t.submitOrder()},submitOrder:function(){o(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax({type:"POST",url:wcDibsEasy.submitOrder,data:o("form.checkout").serialize(),dataType:"json",success:function(e){try{if("success"!==e.result)throw"Result failed";t.logToFile("Successfully placed order."),window.sessionStorage.setItem("redirectNets",e.redirect),t.dibsCheckout.send("payment-order-finalized",!0)}catch(o){e.messages?(t.logToFile("Checkout error | "+e.messages),t.failOrder("submission",e.messages)):(t.logToFile("Checkout error | No message"),t.failOrder("submission",'<div class="woocommerce-error">Checkout error</div>'))}},error:function(e){try{t.logToFile("AJAX error | "+JSON.stringify(e))}catch(e){t.logToFile("AJAX error | Failed to parse error message.")}t.failOrder("ajax-error",'<div class="woocommerce-error">Internal Server Error</div>')}})},changeFromDibsEasy:function(e){e.preventDefault(),o(t.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.change_payment_method_url,data:{action:"dibs_change_payment_method",dibs_easy:!1,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){},error:function(e){},complete:function(e){console.log("Change payment method success"),console.log(e.responseJSON.data.redirect),t.bodyEl.removeClass("dibs-selected"),window.location.href=e.responseJSON.data.redirect}})},moveExtraCheckoutFields:function(){o(".woocommerce-additional-fields").appendTo("#dibs-extra-checkout-fields");for(var e=o('form[name="checkout"] input, form[name="checkout"] select, textarea'),a=0;a<e.length;a++){var c=e[a].name,s=t.standardWooFields;-1===o.inArray(c,s)&&o("p#"+c+"_field").appendTo("#dibs-extra-checkout-fields")}},logToFile:function(e){o.ajax({url:wcDibsEasy.log_to_file_url,type:"POST",dataType:"json",data:{message:e,nonce:wcDibsEasy.log_to_file_nonce}})},failOrder:function(e,a){var c='<div class="'.concat("woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout",'">').concat(a,"</div>");t.dibsCheckout.send("payment-order-finalized",!1),t.bodyEl.trigger("updated_checkout"),o(t.checkoutFormSelector).removeClass("processing"),o(".woocommerce-NoticeGroup-checkout,.woocommerce-error,.woocommerce-message").remove(),o(t.checkoutFormSelector).prepend(c),o(t.checkoutFormSelector).find(".input-text, select, input:checkbox").trigger("validate").blur(),o(document.body).trigger("checkout_error",[a]),o("html, body").animate({scrollTop:o(t.checkoutFormSelector).offset().top-100},1e3)}};t.init()}))})();
//# sourceMappingURL=nets-easy-for-woocommerce.min.js.map