(function(){tinymce.PluginManager.add("fmc",function(editor,url){editor.addButton("fmc_button",{text:false,title:"flexmlsÂ® Connect Shortcode Generator",image:fmcAjax.pluginurl+"/images/fbs_small.png",onclick:function(){var width=jQuery(window).width(),H=jQuery(window).height(),W=(720<width)?720:width;W=W-80;H=H-84;tb_show("flexmls&reg; Connect Shortcode Generator","#TB_inline?width="+W+"&height="+H+"&inlineId=fmc_shortcode_window");}});});jQuery(function(){var container_body='<div id="fmc_shortcode_window"></div>';var form=jQuery(container_body);form.appendTo("body").hide();jQuery.getJSON(fmcAjax.ajaxurl,{action:"fmcShortcodeContainer"},function(data){jQuery("#fmc_shortcode_window").html(data.body);form.find(".fmc_which_shortcode").click(function(){jQuery(".flexmls_connect__widget_menu li").removeClass("fmc_selected_shortcode");jQuery(this).parent().addClass("fmc_selected_shortcode");jQuery("#fmc_shortcode_window_content").html("<p class='first'>loading...</p>");var which_shortcode=jQuery(this).attr("data-connect-shortcode");jQuery.getJSON(fmcAjax.ajaxurl,{action:which_shortcode+"_shortcode"},function(idata){jQuery("#fmc_shortcode_window_content").html('<h3 id="fmc_box_title">'+idata.title+"</h3>"+idata.body);jQuery(".fmc_shortcode_submit").click(function(){var widget=jQuery("input[name='widget']").val();var send_data={action:widget+"_shortcode_gen"};var form_fields_list=jQuery("input[name='shortcode_fields_to_catch']").val();var form_fields=form_fields_list.split(",");jQuery.each(form_fields,function(){var field_name=this;var field_value=jQuery("[name='"+field_name+"']").val();var field_element=jQuery("[fmc-field='"+field_name+"']");value="";if(field_element.attr("fmc-type")=="select"){field_value=jQuery(":selected",field_element).map(function(){return jQuery(this).val();}).get().join();}else{if(field_element.attr("fmc-type")=="checkbox"){field_value=jQuery(":checked[fmc-field='"+field_name+"']").map(function(){return jQuery(this).val();}).get().join();}}send_data[field_name]=field_value;});jQuery.getJSON(fmcAjax.ajaxurl,send_data,function(data){tinyMCE.activeEditor.execCommand("mceInsertContent",0,data.body);tb_remove();return false;});});});});});});})();

