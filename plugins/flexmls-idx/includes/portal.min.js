function add_cart(cart_id,listing_id,cart_type,dom_carts,cart_event){jQuery.post(fmcAjax.ajaxurl,{action:"fmcAccount_add_cart",flexmls_cart_id:cart_id,flexmls_listing_id:listing_id,flexmls_cart_type:cart_type,flexmls_page_override:document.URL},function(response){window.onbeforeunload=function(e){return undefined;};if(response=="SUCCESS"){dom_carts.each(function(){var current=jQuery(this);current.bind("click",cart_event);});}else{window.location=response;}});}function remove_cart(cart_id,listing_id,cart_type,dom_carts,cart_event,should_redirect){jQuery.post(fmcAjax.ajaxurl,{action:"fmcAccount_remove_cart",flexmls_cart_id:cart_id,flexmls_listing_id:listing_id,flexmls_cart_type:cart_type,flexmls_page_override:document.URL},function(response){window.onbeforeunload=function(e){return undefined;};if(response=="SUCCESS"){if(dom_carts){dom_carts.each(function(){var current=jQuery(this);current.bind("click",cart_event);});}}else{if(should_redirect){window.location=response;}}});}function get_cart_type(current){if(current.hasClass("Favorites")){return"Favorites";}else{if(current.hasClass("Possibilities")){return("Possibilities");}else{if(current.hasClass("Rejects")){return("Rejects");}}}}var flexml_cart_event=function(){window.onbeforeunload=function(e){return"Leaving now may prevent your listing from being saved in your listing cart.";};var selected_option=jQuery(this);var cart_id=selected_option.attr("Value");var listing_id=selected_option.parent().attr("Value");var smilies=selected_option.parent().children();if(!selected_option.hasClass("selected")){smilies.each(function(){var current=jQuery(this);current.unbind();if(current.hasClass("selected")){remove_cart(current.attr("Value"),listing_id,get_cart_type(current),false,flexml_cart_event);}current.removeClass("selected");});selected_option.addClass("selected");add_cart(cart_id,listing_id,get_cart_type(selected_option),smilies,flexml_cart_event);}else{smilies.each(function(){var current=jQuery(this);current.unbind();});selected_option.removeClass("selected");remove_cart(cart_id,listing_id,get_cart_type(selected_option),smilies,flexml_cart_event,true);}};jQuery(document).ready(function(){jQuery(".flexmls_portal_cart_handle").bind("click",flexml_cart_event);jQuery("button[href].flexmls_connect__page_content").click(function(){document.location.href=jQuery(this).attr("href");});jQuery(function(){var page_name=jQuery(".flexmlsConnect_cookie").val();if(typeof page_name!=="undefined"){var page_views=parseInt(flexmls_connect.readCookie(page_name),10);if(isNaN(page_views)){flexmls_connect.createCookie(page_name,2,5);}else{flexmls_connect.createCookie(page_name,parseInt(page_views+1,5));}}var timer=parseInt(jQuery("#portal_seconds").val(),10)*1000;var open=(jQuery("#portal_show").val()==true);var isrequired=jQuery("#portal_required").val();var portal_position_x=jQuery("#portal_position_x").val();var portal_position_y=jQuery("#portal_position_y").val();var portal_link=jQuery("#portal_link").val();var the_dialog=jQuery("#fmc_dialog");var y_position=screen.availHeight*portal_position_y-the_dialog.height();var x_position=screen.availWidth*portal_position_x-the_dialog.width()/4;var buttons=[];buttons.push({text:"Create or Login","class":"portal-button-primary flexmls_connect__button",click:function(){window.location=portal_link;}});if(!isrequired){buttons.push({text:"Not now","class":"portal-button-secondary",click:function(){jQuery.post(fmcAjax.ajaxurl,{action:"fmcPortal_No_Thanks"},function(response){if(response=="SUCCESS"){document.cookie="user_start_time=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";document.cookie="search_page=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";document.cookie="detail_page=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";the_dialog.dialog("close");}});}});}the_dialog.dialog({dialogClass:"wp-dialog",position:Array(x_position,y_position),resizable:false,buttons:buttons,closeOnEscape:!isrequired,autoOpen:false,modal:isrequired});if(open){the_dialog.dialog("open");}else{if(timer){setTimeout(function(){the_dialog.dialog("open");},timer);}}if(open||timer){if(portal_position_y=="bottom"){jQuery(".wp-dialog").css("bottom","10%");jQuery(".wp-dialog").css("top","auto");var scrollTop=jQuery(window).scrollTop();var elementOffset=jQuery(".wp-dialog").offset().top;var distance=(elementOffset-scrollTop);jQuery(".wp-dialog").css("top",distance+"px");jQuery(".wp-dialog").css("bottom","auto");}else{if(portal_position_y=="top"){jQuery(".wp-dialog").css("top","5%");}}if(portal_position_x=="left"){jQuery(".wp-dialog").css("left","5%");}else{if(portal_position_x=="right"){jQuery(".wp-dialog").css("right","5%");jQuery(".wp-dialog").css("left","auto");var scrollTop=jQuery(window).scrollLeft();var elementOffset=jQuery(".wp-dialog").offset().left;var distance=(elementOffset-scrollTop);jQuery(".wp-dialog").css("left",distance+"px");jQuery(".wp-dialog").css("right","auto");}}}});});

