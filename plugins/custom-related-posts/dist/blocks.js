var CustomRelatedPosts;(()=>{"use strict";var e={790:(e,t)=>{var n,r=Object.prototype.hasOwnProperty;function o(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}t.P=function(e,t){t=t||"";var o,a,l=[];for(a in"string"!=typeof t&&(t="?"),e)if(r.call(e,a)){if((o=e[a])||null!==o&&o!==n&&!isNaN(o)||(o=""),a=encodeURIComponent(a),o=encodeURIComponent(o),null===a||null===o)continue;l.push(a+"="+o)}return l.length?t+l.join("&"):""}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r);var e=wp.apiFetch;const t={selectRelationsForCurrentPost:(0,wp.data.withSelect)(function(e,t){var n=(0,e("core/editor").getCurrentPostId)(),r=e("custom-related-posts").getRelations(null,{postId:n});return{postId:n,relations:r,updated:Date.now(),relationToIDs:Object.keys(r.to).map(function(e){return parseInt(e)}),relationFromIDs:Object.keys(r.from).map(function(e){return parseInt(e)})}}),saveRelation:function(t,n,r){e({path:"custom-related-posts/v1/relations/".concat(t),method:"POST",data:{target:n,type:r}})},setOrder:function(t,n){e({path:"custom-related-posts/v1/relations/".concat(t,"/order"),method:"PUT",data:{order:n}})},removeRelation:function(t,n,r){e({path:"custom-related-posts/v1/relations/".concat(t),method:"DELETE",data:{target:n,type:r}})}};function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=wp.apiFetch,c=wp.data,i=c.registerStore,u=c.dispatch,p={relations:{to:{},from:{}}};i("custom-related-posts",{reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0,n=JSON.parse(JSON.stringify(e));switch(t.type){case"SET_RELATIONS":return n.relations=t.relations,n;case"SET_ORDER":var r={},o=0,l=!0,s=!1,c=void 0;try{for(var i,u=t.order[Symbol.iterator]();!(l=(i=u.next()).done);l=!0){var d=i.value;e.relations.to.hasOwnProperty(d)&&(r[d]=a({},e.relations.to[d],{order:o}),o++)}}catch(e){s=!0,c=e}finally{try{l||null==u.return||u.return()}finally{if(s)throw c}}for(var f=0,m=Object.keys(e.relations.to);f<m.length;f++){var y=m[f];r.hasOwnProperty(y)||(r[y]=a({},e.relations.to[y],{order:o}))}return n.relations.to=r,n;case"ADD_RELATION_TO":return n.relations.to[t.post.id]=t.post,n;case"ADD_RELATION_BOTH":return n.relations.to[t.post.id]=t.post,n.relations.from[t.post.id]=t.post,n;case"ADD_RELATION_FROM":return n.relations.from[t.post.id]=t.post,n;case"REMOVE_RELATION_TO":return delete n.relations.to[t.target],n;case"REMOVE_RELATION_FROM":return delete n.relations.from[t.target],n}return e},actions:{setRelations:function(e){return{type:"SET_RELATIONS",relations:e}},setOrder:function(e,n){return t.setOrder(e,n),{type:"SET_ORDER",order:n}},addRelationTo:function(e,n){return t.saveRelation(e,n.id,"to"),{type:"ADD_RELATION_TO",post:n}},addRelationBoth:function(e,n){return t.saveRelation(e,n.id,"both"),{type:"ADD_RELATION_BOTH",post:n}},addRelationFrom:function(e,n){return t.saveRelation(e,n.id,"from"),{type:"ADD_RELATION_FROM",post:n}},removeRelationTo:function(e,n){return t.removeRelation(e,n,"to"),{type:"REMOVE_RELATION_TO",target:n}},removeRelationFrom:function(e,n){return t.removeRelation(e,n,"from"),{type:"REMOVE_RELATION_FROM",target:n}}},selectors:{getRelations:function(e,t){return e.relations}},resolvers:{getRelations:function(e,t){s({path:"custom-related-posts/v1/relations/".concat(t.postId)}).then(function(e){Array.isArray(e.to)&&(e.to={}),Array.isArray(e.from)&&(e.from={}),u("custom-related-posts").setRelations(e)})}}});var d=wp.components,f=d.Button,m=d.Dashicon;const y=function(e){var t=e.post;return t?React.createElement("li",{className:"crp-relation"},React.createElement(f,{className:"crp-remove-relation-button",onClick:function(){return e.onRemove(t.id)}},React.createElement(m,{icon:"trash"})),React.createElement("a",{className:"crp-relation-title",href:t.permalink,target:"_blank"},t.title),e.hasOwnProperty("onChangeOrder")&&!1!==e.onChangeOrder&&React.createElement("span",{className:"crp-relation-order-buttons"},React.createElement(f,{className:"crp-order-up-relation-button",onClick:function(){return e.onChangeOrder(!0)},disabled:!e.allowUp},React.createElement(m,{icon:"arrow-up"})),React.createElement(f,{className:"crp-order-down-relation-button",onClick:function(){return e.onChangeOrder(!1)},disabled:!e.allowDown},React.createElement(m,{icon:"arrow-down"})))):null};var h=wp.i18n.__,b=wp.element.Fragment,R=wp.compose.compose,v=wp.data.withDispatch,O=function(e,t,n){var r=Object.values(e);return r.sort(function(e,t){return e.order-t.order}),React.createElement("ul",null,r.map(function(o,a){var l=e[o.id],s=0<a,c=a<r.length-1,i=!1;return!1!==n&&(i=function(e){var t=r.map(function(e){return e.id}),o=a;e&&s?o--:!e&&c&&o++;var l=t[o];t[o]=t[a],t[a]=l,n(t)}),React.createElement(y,{post:l,allowUp:s,allowDown:c,key:o.id,onRemove:t,onChangeOrder:i})}))};var g=v(function(e,t){var n=e("custom-related-posts"),r=n.removeRelationTo,o=n.removeRelationFrom,a=n.setOrder;return{onRemoveRelationTo:function(e){return r(t.postId,e)},onRemoveRelationFrom:function(e){return o(t.postId,e)},onChangeOrder:function(e){return a(t.postId,e)}}});const E=R(t.selectRelationsForCurrentPost,g)(function(e){var t=e.relations,n=e.relationToIDs,r=e.relationFromIDs;return React.createElement(b,null,0<n.length&&React.createElement(b,null,React.createElement("h3",null,h("This post links to")),O(t.to,e.onRemoveRelationTo,e.onChangeOrder)),0<r.length&&React.createElement(b,null,React.createElement("h3",null,h("This post get links from")),O(t.from,e.onRemoveRelationFrom,!1)))});var w=n(790);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=wp.i18n.__,j=wp.element.Fragment,S=wp.components.Button,C=wp.compose.compose;var k=(0,wp.data.withDispatch)(function(e,t){var n=e("custom-related-posts"),r=n.addRelationTo,o=n.addRelationBoth,a=n.addRelationFrom;return{onAddRelationTo:function(e){return r(t.postId,e)},onAddRelationBoth:function(e){return o(t.postId,e)},onAddRelationFrom:function(e){return a(t.postId,e)}}});const D=C(t.selectRelationsForCurrentPost,k)(function(e){var t=e.post,n=e.relationToIDs,r=e.relationFromIDs;if(!t)return null;var o=!1;n.includes(t.id)&&r.includes(t.id)?o="both":n.includes(t.id)?o="to":r.includes(t.id)&&(o="from");var a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{order:n.length});return React.createElement("tr",null,React.createElement("td",null,t.post_type),React.createElement("td",null,t.date_display),React.createElement("td",null,React.createElement("a",{href:t.permalink,target:"_blank"},t.title)),React.createElement("td",null,"both"===o?React.createElement(S,{variant:"secondary",disabled:!0},T("Already linked")):React.createElement(j,null,React.createElement(S,{className:"crp-add-relations-button-to",variant:"secondary",disabled:!1!==o,onClick:function(){return e.onAddRelationTo(a)}},T("To")),React.createElement(S,{className:"crp-add-relations-button-both",isPrimary:!0,onClick:function(){return e.onAddRelationBoth(a)}},T("Both")),React.createElement(S,{className:"crp-add-relations-button-from",variant:"secondary",disabled:!1!==o,onClick:function(){return e.onAddRelationFrom(a)}},T("From")))))});function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=wp.i18n.__,L=wp.apiFetch,B=wp.element.Component,U=wp.components.Modal;const V=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=N(this,F(t).apply(this,arguments))).state={postType:"",search:"",posts:[],updatingPosts:!1,needToUpdatePosts:!1},e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,B),n=t,(r=[{key:"onChangePostType",value:function(e){var t=e.target.value;t!==this.state.postType&&this.setState({postType:t,needToUpdatePosts:this.state.search.length>=2})}},{key:"onChangeSearch",value:function(e){var t=e.target.value;t!==this.state.search&&this.setState({search:t,needToUpdatePosts:!0})}},{key:"componentDidUpdate",value:function(){this.state.needToUpdatePosts&&this.updatePosts()}},{key:"updatePosts",value:function(){var e=this;this.state.updatingPosts||(this.state.search.length<2?this.setState({updatingPosts:!1,needToUpdatePosts:!1,posts:[]}):(this.setState({updatingPosts:!0,needToUpdatePosts:!1}),L({path:"/custom-related-posts/v1/search?".concat((0,w.P)({post_type:this.state.postType,keyword:this.state.search}))}).then(function(t){e.setState({posts:t,updatingPosts:!1})})))}},{key:"render",value:function(){return React.createElement(U,{title:x("Add Relations"),onRequestClose:this.props.onClose,focusOnMount:!1,className:"crp-add-relations-modal"},React.createElement("div",{className:"crp-add-relations"},React.createElement("div",{className:"crp-add-relations-input"},React.createElement("select",{value:this.state.postType,onChange:this.onChangePostType.bind(this)},React.createElement("option",{value:""},x("All Post Types","custom-related-posts")),Object.keys(crp_admin.post_types).map(function(e,t){return React.createElement("option",{value:e,key:t},crp_admin.post_types[e])})),React.createElement("input",{autoFocus:!0,type:"text",placeholder:x("Start typing to search..."),className:"crp-add-relations-search",value:this.state.search,onChange:this.onChangeSearch.bind(this)})),React.createElement("table",{className:"crp-add-relations-posts"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,x("Post Type")),React.createElement("th",null,x("Date")),React.createElement("th",null,x("Title")),React.createElement("th",null,x("Link")))),0===this.state.posts.length?React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",{colSpan:"4"},React.createElement("em",null,"No posts found.")))):React.createElement("tbody",null,this.state.posts.map(function(e,t){return React.createElement(D,{post:e,key:t})})))))}}])&&I(n.prototype,r),o&&I(n,o),t}();function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=wp.i18n.__,K=wp.element,Q=K.Component,W=K.Fragment,X=wp.editPost,Y=X.PluginSidebar,$=X.PluginSidebarMoreMenuItem,ee=wp.components,te=ee.Panel,ne=ee.PanelBody,re=ee.Button,oe=ee.Icon;function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(n,!0).forEach(function(t){ce(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ue(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(0,wp.plugins.registerPlugin)("custom-related-posts",{render:function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Z(this,q(t).apply(this,arguments))).state={isModalOpen:!1},e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,Q),n=t,(r=[{key:"openModal",value:function(){this.state.isModalOpen||this.setState({isModalOpen:!0})}},{key:"closeModal",value:function(){this.state.isModalOpen&&this.setState({isModalOpen:!1})}},{key:"render",value:function(){return React.createElement(W,null,React.createElement($,{target:"sidebar-custom-related-posts",icon:"admin-links"},"Custom Related Posts"),React.createElement(Y,{name:"sidebar-custom-related-posts",title:"Custom Related Posts",icon:React.createElement(oe,{icon:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",width:"20",height:"20"},React.createElement("title",null,"link"),React.createElement("g",{className:"nc-icon-wrapper",fill:"#111111"},React.createElement("path",{d:"M17.619,10.138l-2.241,2.24c-.06.061-.1.13-.158.193a4.958,4.958,0,0,1,2.816,1.393,5.008,5.008,0,0,1,0,7.072l-5.5,5.5a5,5,0,0,1-7.072-7.072l2.385-2.385a10.054,10.054,0,0,1-.23-4.011L3.343,17.343A8,8,0,0,0,14.657,28.657l5.5-5.5a7.99,7.99,0,0,0-2.538-13.019Z",fill:"#111111"})," ",React.createElement("path",{"data-color":"color-2",d:"M17.343,3.343l-5.5,5.5a7.99,7.99,0,0,0,2.538,13.019l2.241-2.24c.06-.061.107-.129.162-.193a4.953,4.953,0,0,1-2.82-1.393,5.008,5.008,0,0,1,0-7.072l5.5-5.5a5,5,0,0,1,7.072,7.072l-2.383,2.382a10.086,10.086,0,0,1,.241,4l4.263-4.263A8,8,0,0,0,17.343,3.343Z"})))})},React.createElement(te,null,React.createElement(ne,{title:G("Relations")},React.createElement(E,null),React.createElement(re,{isPrimary:!0,onClick:this.openModal.bind(this)},G("Add Relations"))))),this.state.isModalOpen&&React.createElement(V,{onClose:this.closeModal.bind(this)}))}}])&&J(n.prototype,r),o&&J(n,o),t}()});var fe,me,ye=wp.i18n.__,he=wp.components,be=he.PanelBody,Re=he.TextControl,ve=he.RadioControl,Oe=he.Disabled,ge=wp.element,Ee=ge.Component,we=ge.Fragment;fe=wp.hasOwnProperty("blockEditor")?wp.blockEditor.InspectorControls:wp.editor.InspectorControls,me=wp.hasOwnProperty("serverSideRender")?wp.serverSideRender:wp.components.ServerSideRender;var Pe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ue(this,pe(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,Ee),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.attributes,n=e.setAttributes,r=t.title,o=t.none_text,a=t.order_by,l=t.order,s=Object.values(this.props.relations.to).filter(function(e){return"publish"===e.status}),c=s.length>0,i=React.createElement(fe,null,React.createElement(be,{title:ye("Custom Related Posts Settings")},React.createElement(Re,{label:ye("Title"),value:r,onChange:function(e){return n({title:e})}}),React.createElement(Re,{label:ye("None Text"),help:ye("Leave blank to hide when there are no related posts."),value:o,onChange:function(e){return n({none_text:e})}}),React.createElement(ve,{label:ye("Order By"),selected:a,options:[{label:ye("Title"),value:"title"},{label:ye("Date"),value:"date"},{label:ye("Custom"),value:"custom"},{label:ye("Random"),value:"rand"}],onChange:function(e){return n({order_by:e})}}),React.createElement(ve,{label:ye("Order"),selected:l,options:[{label:ye("Ascending"),value:"ASC"},{label:ye("Descending"),value:"DESC"}],onChange:function(e){return n({order:e})}})));return React.createElement(we,null,i,c||o?React.createElement(Oe,null,React.createElement(me,{block:"custom-related-posts/related-posts",attributes:se({},t,{relations:s})})):React.createElement("em",null,ye("This block will be empty until you add a related post.")))}}])&&ie(n.prototype,r),o&&ie(n,o),t}();const _e=t.selectRelationsForCurrentPost(Pe);var Te=wp.i18n.__;(0,wp.blocks.registerBlockType)("custom-related-posts/related-posts",{title:Te("Custom Related Posts"),description:Te("Display a list of your custom related posts."),icon:"list-view",keywords:["crp"],category:"widgets",supports:{html:!1},transforms:{from:[{type:"shortcode",tag:"custom-related-posts",attributes:{title:{type:"string",shortcode:function(e){var t=e.named.title;return(void 0===t?"":t).replace("title","")}},order_by:{type:"string",shortcode:function(e){var t=e.named.order_by;return(void 0===t?"":t).replace("order_by","")}},order:{type:"string",shortcode:function(e){var t=e.named.order;return(void 0===t?"":t).replace("order","")}},none_text:{type:"string",shortcode:function(e){var t=e.named.none_text;return(void 0===t?"":t).replace("none_text","")}}}}]},edit:_e,save:function(e){return null}})})(),(CustomRelatedPosts=void 0===CustomRelatedPosts?{}:CustomRelatedPosts).blocks=r})();