!function(e){"use strict";function a(e){var a;if(a)return a.open(),!1;(a=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",multiple:!1})).on("insert",function(){var i=a.state().get("selection").first().toJSON();if(0==i.url.trim().length)return!1;e(i)}),a.state("embed").on("select",function(){var i=a.state().props.toJSON();if(0==i.url.trim().length)return!1;i.id=0,e(i)}),a.on("open",function(){jQuery("#menu-item-gallery, #menu-item-playlist, #menu-item-video-playlist").hide()}),a.open()}function i(a){a.autocomplete({source:function(a,i){e.ajax({url:ajaxurl,dataType:"json",method:"post",data:{action:"aiovg_autocomplete_get_videos",security:aiovg_admin.ajax_nonce,term:a.term},success:function(a){i(e.map(a,function(e){return{label:e.post_title,value:e.post_title,data:e}}))}})},autoFocus:!0,minLength:0,select:function(a,i){var o=e(this).closest(".aiovg-widget-field"),t="";0!=i.item.data.ID?(t='<span class="dashicons dashicons-yes-alt"></span> ',t+="<span>"+i.item.data.post_title+"</span> ",t+='<a href="javascript:void(0);" class="aiovg-remove-autocomplete-result">'+aiovg_admin.i18n.remove+"</a>"):(t='<span class="dashicons dashicons-info"></span> ',t+="<span>"+aiovg_admin.i18n.no_video_selected+"</span>"),o.find(".aiovg-widget-input-id").val(i.item.data.ID).trigger("change"),o.find(".aiovg-autocomplete-result").html(t)},open:function(){e(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){e(this).removeClass("ui-corner-top").addClass("ui-corner-all"),e(this).val("")}})}function o(e){var a=document.createElement("input");a.value=e,document.body.appendChild(a),a.focus(),a.select(),document.execCommand("copy"),a.remove(),alert(aiovg_admin.i18n.copied+"\n"+e)}e.fn.aiovgReplaceClass=function(e,a){return this.removeClass(function(a,i){var o=i.match(e);return o?o.join(" "):""}).addClass(a),this},e(function(){var t,n;e(document).on("click",".aiovg-upload-media",function(i){i.preventDefault();var o=e(this);a(function(e){o.closest(".aiovg-media-uploader").find("input[type=text]").val(e.url).trigger("file.uploaded")})}),e.fn.wpColorPicker&&(e(".aiovg-color-picker").wpColorPicker(),e(document).on("widget-added widget-updated",function(a,i){i.find(".aiovg-color-picker").wpColorPicker({change:_.throttle(function(){e(this).trigger("change")},3e3)})})),e.fn.magnificPopup&&e(".aiovg-modal-button").magnificPopup({type:"inline",mainClass:"mfp-fade"}),e("#aiovg-shortcode-selector input[type=radio]").on("change",function(){var a=e("#aiovg-shortcode-selector input[type=radio]:checked").val();e(".aiovg-shortcode-form").hide(),e("#aiovg-shortcode-form-"+a).show(),e(".aiovg-shortcode-instructions").hide(),e("#aiovg-shortcode-instructions-"+a).show()}).trigger("change"),e("#aiovg-shortcode-forms .aiovg-shortcode-section-header").on("click",function(){var a=e(this),i=a.parent();i.hasClass("aiovg-active")||a.closest(".aiovg-shortcode-form").find(".aiovg-active").removeClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle(),i.toggleClass("aiovg-active").find(".aiovg-shortcode-controls").slideToggle()}),e("#aiovg-shortcode-form-video select[name=type]").on("change",function(){var a=e(this).val();e("#aiovg-shortcode-form-video").aiovgReplaceClass(/\aiovg-type-\S+/ig,"aiovg-type-"+a)}),e("#aiovg-shortcode-form-videos select[name=template]").on("change",function(){var a=e(this).val();e("#aiovg-shortcode-form-videos").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}).trigger("change"),e("#aiovg-shortcode-form-categories select[name=template]").on("change",function(){var a=e(this).val();e("#aiovg-shortcode-form-categories").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}).trigger("change"),e("#aiovg-generate-shortcode").on("click",function(a){a.preventDefault();var i=e("#aiovg-shortcode-selector input[type=radio]:checked").val(),o=i,t={};for(var n in e(".aiovg-shortcode-field","#aiovg-shortcode-form-"+i).each(function(){var a=e(this),i=a.attr("type"),o=a.attr("name"),n=a.val(),s=0;void 0!==a.data("default")&&(s=a.data("default")),"checkbox"==i&&(n=a.is(":checked")?1:0),("category"==o||"tag"==o)&&(n=a.find("input[type=checkbox]:checked").map(function(){return this.value}).get().join(",")),n!=s&&(t[o]=n)}),t)t.hasOwnProperty(n)&&(o+=" "+n+'="'+t[n]+'"');e("#aiovg-shortcode").val("[aiovg_"+o+"]")}),e("#aiovg-issues-check-all").on("change",function(){var a=!!e(this).is(":checked");e("#aiovg-issues .aiovg-issue").prop("checked",a)}),e("#aiovg-issues-form").submit(function(){if(!(e("#aiovg-issues .aiovg-issue:checked").length>0))return alert(aiovg_admin.i18n.no_issues_selected),!1}),e(".aiovg-copy-url").on("click",function(){o(e(this).data("url"))}),e(".aiovg-copy-shortcode").on("click",function(){var a;o('[aiovg_video id="'+parseInt(e(this).data("id"))+'"]')}),e("#aiovg-video-type").on("change",function(a){a.preventDefault();var i=e(this).val();e(".aiovg-toggle-fields").hide(),e(".aiovg-type-"+i).show(300)}).trigger("change"),e("#aiovg-add-new-source").on("click",function(a){a.preventDefault();var i=e(this),o=parseInt(e(this).data("limit")),t=e("#aiovg-field-mp4 .aiovg-quality-selector").length,n=t-1;0==n&&e("#aiovg-field-mp4 .aiovg-quality-selector").show();var s=e("#aiovg-source-clone .aiovg-source").clone();s.find("input[type=radio]").attr("name","quality_levels["+n+"]"),s.find("input[type=text]").attr("name","sources["+n+"]"),i.before(s),t+1>=o&&i.hide()}),e("#aiovg-field-mp4").on("change",".aiovg-quality-selector input[type=radio]",function(){var a=e(this),i=[];e(".aiovg-quality-selector").each(function(){var o=e(this).find("input[type=radio]:checked").val();o&&(i.includes(o)?(a.prop("checked",!1),alert(aiovg_admin.i18n.quality_exists)):i.push(o))})}),e("#aiovg-add-new-track").on("click",function(a){a.preventDefault();var i=e("#aiovg-tracks-clone tr").clone();e("#aiovg-tracks").append(i)}),0==e("#aiovg-tracks .aiovg-tracks-row").length&&e("#aiovg-add-new-track").trigger("click"),e(document).on("click",".aiovg-upload-track",function(i){i.preventDefault();var o=e(this);a(function(e){o.closest("tr").find(".aiovg-track-src input[type=text]").val(e.url)})}),e(document).on("click",".aiovg-delete-track",function(a){a.preventDefault(),e(this).closest("tr").remove()}),e.fn.sortable&&((t=e("#aiovg-tracks tbody")).hasClass("ui-sortable")&&t.sortable("destroy"),t.sortable({handle:".aiovg-handle"})),e("#aiovg-add-new-chapter").on("click",function(a){a.preventDefault();var i=e("#aiovg-chapters-clone tr").clone();e("#aiovg-chapters").append(i)}),0==e("#aiovg-chapters .aiovg-chapters-row").length&&e("#aiovg-add-new-chapter").trigger("click"),e(document).on("click",".aiovg-delete-chapter",function(a){a.preventDefault(),e(this).closest("tr").remove()}),e.fn.sortable&&((n=e("#aiovg-chapters tbody")).hasClass("ui-sortable")&&n.sortable("destroy"),n.sortable({handle:".aiovg-handle"})),e("#aiovg-categories-upload-image").on("click",function(i){i.preventDefault(),a(function(a){e("#aiovg-categories-image-wrapper").html('<img src="'+a.url+'" alt="" />'),e("#aiovg-categories-image").val(a.url),e("#aiovg-categories-image_id").val(a.id),e("#aiovg-categories-upload-image").hide(),e("#aiovg-categories-remove-image").show()})}),e("#aiovg-categories-remove-image").on("click",function(a){a.preventDefault(),e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show()}),e(document).ajaxComplete(function(a,i,o){if(e("#aiovg-categories-image").length&&o.data){var t=o.data.split("&");-1!==e.inArray("action=add-tag",t)&&e(i.responseXML).find("term_id").text()&&(e("#aiovg-categories-image-wrapper").html(""),e("#aiovg-categories-image").val(""),e("#aiovg-categories-image_id").val(""),e("#aiovg-categories-remove-image").hide(),e("#aiovg-categories-upload-image").show(),e("#aiovg-categories-exclude_search_form").prop("checked",!1),e("#aiovg-categories-exclude_video_form").prop("checked",!1))}}),e("#aiovg-settings .form-table").each(function(){var a=e(this).find("tr:first th label").attr("for").split("[");a=a[0].replace(/_/g,"-"),e(this).attr("id",a)}),e("#aiovg-categories-settings tr.template select").on("change",function(){var a=e(this).val();e("#aiovg-categories-settings").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}).trigger("change"),e("#aiovg-videos-settings tr.template select").on("change",function(){var a=e(this).val();e("#aiovg-videos-settings").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}).trigger("change"),e(document).on("change",".aiovg-widget-form-categories .aiovg-widget-input-template",function(){var a=e(this).val();e(this).closest(".aiovg-widget-form-categories").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}),e(document).on("change",".aiovg-widget-form-videos .aiovg-widget-input-template",function(){var a=e(this).val();e(this).closest(".aiovg-widget-form-videos").aiovgReplaceClass(/\aiovg-template-\S+/ig,"aiovg-template-"+a)}),e.fn.autocomplete&&(e(".aiovg-autocomplete-input").each(function(){i(e(this))}),e(document).on("widget-added widget-updated",function(e,a){var o=a.find(".aiovg-autocomplete-input");o.length>0&&i(o)}),e(document).on("click",".aiovg-remove-autocomplete-result",function(){var a=e(this).closest(".aiovg-widget-field"),i='<span class="dashicons dashicons-info"></span> ';i+="<span>"+aiovg_admin.i18n.no_video_selected+"</span>",a.find(".aiovg-widget-input-id").val(0).trigger("change"),a.find(".aiovg-autocomplete-result").html(i)}))})}(jQuery);