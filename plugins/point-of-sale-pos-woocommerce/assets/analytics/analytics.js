!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=8)}([function(module,exports){module.exports=window.wp.i18n},function(module,exports){module.exports=window.window.wc.components},function(module,exports){module.exports=window.wp.element},function(module,exports){module.exports=window.wp.apiFetch},function(module,exports){module.exports=window.window.wc.date},function(module,exports){module.exports=window.window.wc.wcSettings},function(module,exports){module.exports=window.window.wc.currency},function(module,exports){module.exports=window.wp.hooks},function(module,exports,__webpack_require__){__webpack_require__(10),module.exports=__webpack_require__(9)},function(module,exports,__webpack_require__){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var external_wp_hooks_=__webpack_require__(7),external_wp_i18n_=__webpack_require__(0),external_wp_element_=__webpack_require__(2),external_window_wc_date_=__webpack_require__(4),external_wp_apiFetch_=__webpack_require__(3),external_wp_apiFetch_default=__webpack_require__.n(external_wp_apiFetch_),external_window_wc_currency_=__webpack_require__(6),external_window_wc_currency_default=__webpack_require__.n(external_window_wc_currency_),external_window_wc_wcSettings_=__webpack_require__(5),external_window_wc_components_=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var tableHeaders=[{key:"date",label:Object(external_wp_i18n_.__)("Date","zpos-wp-api"),isLeftAligned:!0,isSortable:!0},{key:"id",label:Object(external_wp_i18n_.__)("Order #","zpos-wp-api"),isLeftAligned:!0,isSortable:!0,isNumeric:!0},{key:"status",label:Object(external_wp_i18n_.__)("Status","zpos-wp-api")},{key:"gross",label:Object(external_wp_i18n_.__)("Gross sales","zpos-wp-api"),isSortable:!0,isNumeric:!0},{key:"net",label:Object(external_wp_i18n_.__)("Net sales","zpos-wp-api"),isSortable:!0,isNumeric:!0},{key:"items",label:Object(external_wp_i18n_.__)("Items","zpos-wp-api"),isSortable:!0,isNumeric:!0},{key:"refunds",label:Object(external_wp_i18n_.__)("Refunds","zpos-wp-api"),isSortable:!0,isNumeric:!0},{key:"shipping",label:Object(external_wp_i18n_.__)("Shipping","zpos-wp-api"),isSortable:!0,isNumeric:!0},{key:"coupons",label:Object(external_wp_i18n_.__)("Coupons","zpos-wp-api"),isSortable:!0,isNumeric:!0}],userTableHeaders=[].concat(_toConsumableArray(tableHeaders.slice(0,1)),[{key:"station",label:Object(external_wp_i18n_.__)("Station","zpos-wp-api")}],_toConsumableArray(tableHeaders.slice(1))),stationTableHeaders=[].concat(_toConsumableArray(tableHeaders.slice(0,1)),[{key:"user",label:Object(external_wp_i18n_.__)("User","zpos-wp-api")}],_toConsumableArray(tableHeaders.slice(1))),Table_Table=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(Table,_Component);var Constructor,protoProps,staticProps,_super=_createSuper(Table);function Table(props){var _this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Table);var dataSortedByDefault=(_this=_super.call(this,props)).sort(_this.props.data,"date","desc");return _this.state={data:dataSortedByDefault,sortColumn:"date",sortDirection:"desc"},_this.handleSort=_this.handleSort.bind(_assertThisInitialized(_this)),_this}return Constructor=Table,(protoProps=[{key:"setSortDirection",value:function(direction){return"asc"===direction?"desc":"asc"}},{key:"setHeaderSortOptions",value:function(header){return header.key===this.state.sortColumn?(header.defaultSort=!0,header.defaultDirection=this.state.sortDirection):(header.defaultSort&&delete header.defaultSort,header.defaultDirection&&delete header.defaultDirection),header}},{key:"sort",value:function(data,column,sortDirection){var appliedSortDirection="asc"===sortDirection?1:-1;return data.sort((function(a,b){return a[column]>b[column]?appliedSortDirection:a[column]<b[column]?-1*appliedSortDirection:0}))}},{key:"handleSort",value:function(newSortColumn){var _this$state=this.state,data=_this$state.data,sortColumn=_this$state.sortColumn,sortDirection=_this$state.sortDirection;sortColumn===newSortColumn?(data.reverse(),sortDirection=this.setSortDirection(sortDirection)):(sortColumn=newSortColumn,data=this.sort(data,sortColumn,sortDirection)),this.setState({data:data,sortColumn:sortColumn,sortDirection:sortDirection})}},{key:"render",value:function(){var _this2=this,rawData=this.state.data,currency=this.props.currency,headers=tableHeaders;"user"===this.props.reportType&&(headers=userTableHeaders),"station"===this.props.reportType&&(headers=stationTableHeaders);var data={headers:headers.map((function(header){return _this2.setHeaderSortOptions(header)})),rows:rawData.map((function(item){var itemData=[{display:React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-table__period ".concat(item.isPrev?"pos-analytics-table__period_prev":"")},React.createElement("div",{className:"pos-analytics-table__period-label"},item.isPrev?Object(external_wp_i18n_.__)("Previous period","zpos-wp-api"):Object(external_wp_i18n_.__)("Current period","zpos-wp-api"))),React.createElement(external_window_wc_components_.Date,{date:item.date,visibleFormat:Object(external_window_wc_wcSettings_.getSetting)("dateFormat",external_window_wc_date_.defaultTableDateFormat)})),value:item.date},{display:React.createElement(external_window_wc_components_.Link,{href:"post.php?post=".concat(item.id,"&action=edit"),type:"wp-admin"},item.id),value:item.id},{display:React.createElement(external_window_wc_components_.OrderStatus,{className:"woocommerce-orders-table__status",order:{status:item.status},orderStatusMap:Object(external_window_wc_wcSettings_.getSetting)("orderStatuses",{})}),value:item.status},{display:currency.render(item.gross),value:item.gross},{display:currency.render(item.net),value:item.net},{display:"".concat(item.items," (").concat(item.units," units)"),value:item.items},{display:"-".concat(currency.render(item.refunds)),value:item.refunds},{display:currency.render(item.shipping),value:item.shipping},{display:currency.render(item.coupons),value:item.coupons}];return"user"===_this2.props.reportType&&itemData.splice(1,0,{display:"".concat(item.pos_station.name," ").concat("-1"===item.pos_station.posID?"":"(ID: ".concat(item.pos_station.posID,")")),value:item.pos_station.name}),"station"===_this2.props.reportType&&itemData.splice(1,0,{display:"".concat(item.pos_user.name," (ID: ").concat(item.pos_user.id,")"),value:item.pos_user.name}),itemData}))};return React.createElement(external_window_wc_components_.TableCard,{title:this.props.title,rows:data.rows,headers:data.headers,rowsPerPage:99999999,totalRows:data.rows.length,onSort:this.handleSort})}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Table}(external_wp_element_.Component);function getQueryVar(name){var url=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function date_typeof(obj){return(date_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function calculatePeriodDays(date1,date2){"object"!==date_typeof(date1)&&(date1=new Date(date1)),"object"!==date_typeof(date2)&&(date1=new Date(date2)),date1.setHours(0,0,0,0),date2.setHours(0,0,0,0);var dateDiff=Math.abs(date1.getTime()-date2.getTime());return parseInt(dateDiff/864e5,10)+1}function getQueryDates(query){var _getCurrentDates=Object(external_window_wc_date_.getCurrentDates)(query);return _objectSpread(_objectSpread({},{primaryDate:_getCurrentDates.primary,secondaryDate:_getCurrentDates.secondary}),Object(external_window_wc_date_.getDateParamsFromQuery)(query))}function getPeriod(filterDates){var ISO=arguments.length>1&&void 0!==arguments[1]&&arguments[1],start=filterDates.primaryDate.after._d,end=filterDates.primaryDate.before._d,prevStart=filterDates.secondaryDate.after._d,prevEnd=filterDates.secondaryDate.before._d;return end.setHours(23,59,59,999),prevEnd.setHours(23,59,59,999),ISO?{startISODate:start.toISOString(),endISODate:end.toISOString(),prevStartISODate:prevStart.toISOString(),prevEndISODate:prevEnd.toISOString()}:{startDate:start,endDate:end,prevStartDate:prevStart,prevEndDate:prevEnd}}function calculation_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function calculation_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?calculation_ownKeys(Object(source),!0).forEach((function(key){calculation_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):calculation_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function calculation_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var defaultSummary={grossPeriod:0,grossDaily:0,netPeriod:0,netDaily:0,ordersCount:0,itemsCount:0,unitsCount:0,refunded:0,refundedOrders:0,refundedItems:0,shipping:0,coupons:0,gateways:{}};function calculateDelta(num1,num2){return 0===num1&&0===num2||"number"!=typeof num1||1/0===num1?0:0===num2||"number"!=typeof num2||1/0===num2?100:(num=(num1-num2)/num2*100,Math.round(100*(num+Number.EPSILON))/100);var num}function calculateSummary(orders,filterDates){var includeGateways=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],periodDaysCount=calculatePeriodDays(filterDates.primaryDate.before._d,filterDates.primaryDate.after._d);return orders.reduce((function(result,order){var refunded=order.refunds.reduce((function(refResult,orderRef){return refResult+Math.abs(Number(orderRef.total))}),0),grossPeriod=Number(order.total),grossDaily=grossPeriod/periodDaysCount,netPeriod=grossPeriod-Number(order.total_tax),netDaily=netPeriod/periodDaysCount,itemsCount=order.line_items.length,unitsCount=order.line_items.reduce((function(unitsResult,orderItem){return unitsResult+orderItem.quantity}),0),refundedOrders=0<order.refunds.length?1:0,shipping=Number(order.shipping_total),coupons=Number(order.discount_total),summary={grossPeriod:result.grossPeriod+grossPeriod,grossDaily:result.grossDaily+grossDaily,netPeriod:result.netPeriod+netPeriod,netDaily:result.netDaily+netDaily,ordersCount:result.ordersCount+1,itemsCount:result.itemsCount+itemsCount,unitsCount:result.unitsCount+unitsCount,refunded:result.refunded+refunded,refundedOrders:result.refundedOrders+refundedOrders,refundedItems:result.refundedItems+refundedOrders,shipping:result.shipping+shipping,coupons:result.coupons+coupons,gateways:{}};if(includeGateways){var gateways=calculation_objectSpread({},result.gateways);gateways[order.payment_method]={key:order.payment_method,label:"".concat(Object(external_wp_i18n_.__)("Payments via","zpos-wp-api"),' "').concat(order.payment_method_title,'"'),value:void 0===result.gateways[order.payment_method]?grossPeriod:result.gateways[order.payment_method].value+grossPeriod},summary.gateways=gateways}return summary}),defaultSummary)}function calculateChartData(chart,orders,prevOrders,filterDates){for(var startDate=filterDates.primaryDate.after._d,periodDaysCount=calculatePeriodDays(filterDates.primaryDate.before._d,startDate),period=[],i=0;i<=periodDaysCount;i++){var date=new Date(startDate);date.setDate(date.getDate()+i),period.push(date)}return period.map((function(date){var calculate=function(orders){var isPrev=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return orders.reduce((function(valueResult,order){var orderDate=new Date(order.date_created);if(orderDate.setHours(0,0,0,0),isPrev&&(orderDate.setFullYear(date.getFullYear()),"previous_period"===filterDates.compare&&orderDate.setDate(orderDate.getDate()+periodDaysCount)),orderDate.getTime()===date.getTime())switch(chart){case"grossPeriod":return valueResult+Number(order.total);case"netPeriod":return valueResult+Number(order.total)-Number(order.total_tax);case"ordersCount":return valueResult+1;case"itemsCount":return valueResult+order.line_items.length;case"refunded":return valueResult+order.refunds.reduce((function(refResult,orderRef){return refResult+Math.abs(Number(orderRef.total))}),0);case"shipping":return valueResult+Number(order.shipping_total);case"coupons":return valueResult+Number(order.discount_total);case order.payment_method:return valueResult+Number(order.total);default:return valueResult}return valueResult}),0)};return{date:date,curr:{label:Object(external_wp_i18n_.__)("Current period","zpos-wp-api"),value:calculate(orders)},prev:{label:Object(external_wp_i18n_.__)("Previous period","zpos-wp-api"),value:calculate(prevOrders,!0)}}}))}function table_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return table_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return table_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return table_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function table_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function prepareTableData(orders,prevOrders){var prepare=function(orders){var isPrev=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return orders.map((function(order){var data={date:order.date_created,id:order.id,status:order.status,gross:Number(order.total),net:Number(order.total)-Number(order.total_tax),items:order.line_items.length,units:order.line_items.reduce((function(unitsResult,orderItem){return unitsResult+orderItem.quantity}),0),refunds:order.refunds.reduce((function(refResult,orderRef){return refResult+Math.abs(Number(orderRef.total))}),0),shipping:Number(order.shipping_total),coupons:Number(order.discount_total),isPrev:isPrev};return void 0!==order.pos_station&&(data.pos_station=order.pos_station),void 0!==order.pos_user&&(data.pos_user=order.pos_user),data}))};return[].concat(table_toConsumableArray(prepare(orders)),table_toConsumableArray(prepare(prevOrders,!0)))}function Gateway_typeof(obj){return(Gateway_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||Gateway_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gateway_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return Gateway_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||Gateway_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gateway_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return Gateway_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gateway_arrayLikeToArray(o,minLen):void 0}}function Gateway_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Gateway_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Gateway_setPrototypeOf(o,p){return(Gateway_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function Gateway_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Gateway_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Gateway_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Gateway_possibleConstructorReturn(this,result)}}function Gateway_possibleConstructorReturn(self,call){if(call&&("object"===Gateway_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return Gateway_assertThisInitialized(self)}function Gateway_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function Gateway_getPrototypeOf(o){return(Gateway_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var Gateway_currency=new external_window_wc_currency_default.a(external_window_wc_wcSettings_.CURRENCY),defaultGatewayFilterOptions=[{label:Object(external_wp_i18n_.__)("All payment types","zpos-wp-api"),value:"-1"},{label:Object(external_wp_i18n_.__)("POS Cash","zpos-wp-api"),value:"pos_cash"},{label:Object(external_wp_i18n_.__)("POS Smart Card","zpos-wp-api"),value:"pos_card_smart"},{label:Object(external_wp_i18n_.__)("POS Stripe Card","zpos-wp-api"),value:"pos_stripe"},{label:Object(external_wp_i18n_.__)("POS Other Payments","zpos-wp-api"),value:"pos_epd"}],tableTitle=Object(external_wp_i18n_.__)("Payment Orders","zpos-wp-api"),Gateway_Gateway=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Gateway_setPrototypeOf(subClass,superClass)}(Gateway,_Component);var Constructor,protoProps,staticProps,_super=Gateway_createSuper(Gateway);function Gateway(props){var _this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Gateway);var queryDates=getQueryDates((_this=_super.call(this,props)).props.query),queryGatewayId=getQueryVar("gatewayId");return _this.state={loading:!0,dates:queryDates,gatewayFilterOptions:defaultGatewayFilterOptions,gatewayId:queryGatewayId||"-1",orders:[],prevOrders:[],summary:defaultSummary,prevSummary:defaultSummary,activeChart:"grossPeriod",chartData:[],tableData:[]},_this.handleDateChange=_this.handleDateChange.bind(Gateway_assertThisInitialized(_this)),_this.handleGatewayChange=_this.handleGatewayChange.bind(Gateway_assertThisInitialized(_this)),_this.handeChartChange=_this.handeChartChange.bind(Gateway_assertThisInitialized(_this)),_this}return Constructor=Gateway,(protoProps=[{key:"componentDidMount",value:function(){this.setGatewayFilterOptions()}},{key:"setGatewayFilterOptions",value:function(){var _this2=this;external_wp_apiFetch_default()({path:"/wc/v3/payment_gateways?per_page=-1"}).then((function(gateways){var preparedOptions=[].concat(defaultGatewayFilterOptions,Gateway_toConsumableArray(gateways.map((function(gateway){return{label:gateway.method_title,value:String(gateway.id)}}))));_this2.setState({loading:!0,gatewayFilterOptions:preparedOptions}),_this2.setData(_this2.state.gatewayId,_this2.state.dates)})).catch((function(err){return console.error(err)}))}},{key:"setData",value:function(gatewayId,filterDates){var _this3=this,_getPeriod=getPeriod(filterDates,!0),startISODate=_getPeriod.startISODate,endISODate=_getPeriod.endISODate,prevStartISODate=_getPeriod.prevStartISODate,prevEndISODate=_getPeriod.prevEndISODate;Promise.all([external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1&pos_gateway=".concat(gatewayId,"&after=").concat(startISODate,"&before=").concat(endISODate)}),external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1&pos_gateway=".concat(gatewayId,"&after=").concat(prevStartISODate,"&before=").concat(prevEndISODate)})]).then((function(_ref){var _ref2=_slicedToArray(_ref,2),orders=_ref2[0],prevOrders=_ref2[1];_this3.setState({loading:!1,orders:orders,prevOrders:prevOrders,summary:calculateSummary(orders,filterDates,!1),prevSummary:calculateSummary(prevOrders,filterDates,!1),tableData:prepareTableData(orders,prevOrders)}),_this3.handeChartChange(_this3.state.activeChart)})).catch((function(err){return console.error(err)}))}},{key:"handleDateChange",value:function(query){var dates=getQueryDates(query);this.setState({loading:!0,dates:dates}),this.setData(this.state.gatewayId,dates)}},{key:"handleGatewayChange",value:function(query){var gatewayId=void 0===query.gatewayId?"-1":query.gatewayId;this.setState({loading:!0,gatewayId:gatewayId}),this.setData(gatewayId,this.state.dates)}},{key:"handeChartChange",value:function(chart){var _this$state=this.state,orders=_this$state.orders,prevOrders=_this$state.prevOrders,dates=_this$state.dates;this.setState({activeChart:chart,chartData:calculateChartData(chart,orders,prevOrders,dates)})}},{key:"render",value:function(){var _this4=this,dateFilter=React.createElement(external_window_wc_components_.ReportFilters,{dateQuery:this.state.dates,query:this.props.query,path:this.props.path,currency:Gateway_currency,isoDateFormat:external_window_wc_date_.isoDateFormat,onDateSelect:this.handleDateChange}),gatewayFilter=React.createElement(external_window_wc_components_.FilterPicker,{config:{label:Object(external_wp_i18n_.__)("Payment type","zpos-wp-api"),staticParams:[],param:"gatewayId",defaultValue:"-1",showFilters:function(){},filters:this.state.gatewayFilterOptions},path:this.props.path,query:this.props.query,onFilterSelect:this.handleGatewayChange});if(this.state.loading)return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters pos-analytics-filters_disabled"},dateFilter,gatewayFilter),React.createElement(external_window_wc_components_.SummaryListPlaceholder,{numberOfItems:9}),React.createElement(external_window_wc_components_.ChartPlaceholder,{height:300}),React.createElement(external_window_wc_components_.TablePlaceholder,{caption:tableTitle,headers:tableHeaders}));var _this$state2=this.state,summary=_this$state2.summary,prevSummary=_this$state2.prevSummary;return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters"},dateFilter,gatewayFilter),React.createElement("div",{className:"pos-analytics-summary"},React.createElement(external_window_wc_components_.SummaryList,null,(function(){return[React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossPeriod",value:Gateway_currency.render(summary.grossPeriod),prevValue:Gateway_currency.render(prevSummary.grossPeriod),delta:calculateDelta(summary.grossPeriod,prevSummary.grossPeriod),label:Object(external_wp_i18n_.__)("Gross sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("grossPeriod")},isOpen:"grossPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossDaily",value:Gateway_currency.render(summary.grossDaily),prevValue:Gateway_currency.render(prevSummary.grossDaily),delta:calculateDelta(summary.grossDaily,prevSummary.grossDaily),label:Object(external_wp_i18n_.__)("Average gross daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netPeriod",value:Gateway_currency.render(summary.netPeriod),prevValue:Gateway_currency.render(prevSummary.netPeriod),delta:calculateDelta(summary.netPeriod,prevSummary.netPeriod),label:Object(external_wp_i18n_.__)("Net sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("netPeriod")},isOpen:"netPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netDaily",value:Gateway_currency.render(summary.netDaily),prevValue:Gateway_currency.render(prevSummary.netDaily),delta:calculateDelta(summary.netDaily,prevSummary.netDaily),label:Object(external_wp_i18n_.__)("Average net daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"ordersCount",value:summary.ordersCount,prevValue:prevSummary.ordersCount,delta:calculateDelta(summary.ordersCount,prevSummary.ordersCount),label:Object(external_wp_i18n_.__)("Orders placed","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("ordersCount")},isOpen:"ordersCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"itemsCount",value:"".concat(summary.itemsCount," (").concat(summary.unitsCount," units)"),prevValue:prevSummary.itemsCount,delta:calculateDelta(summary.itemsCount,prevSummary.itemsCount),label:Object(external_wp_i18n_.__)("Items purchased","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("itemsCount")},isOpen:"itemsCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"refunded",value:"-".concat(Gateway_currency.render(summary.refunded)),prevValue:"-".concat(Gateway_currency.render(prevSummary.refunded)),delta:calculateDelta(summary.refunded,prevSummary.refunded),reverseTrend:!0,label:Object(external_wp_i18n_.sprintf)(Object(external_wp_i18n_.__)("Refunded %1$s orders (-%2$s items)","zpos-wp-api"),summary.refundedOrders,summary.refundedItems),onToggle:function(){_this4.handeChartChange("refunded")},isOpen:"refunded"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"shipping",value:Gateway_currency.render(summary.shipping),prevValue:Gateway_currency.render(prevSummary.shipping),delta:calculateDelta(summary.shipping,prevSummary.shipping),label:Object(external_wp_i18n_.__)("Charged for shipping","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("shipping")},isOpen:"shipping"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"coupons",value:Gateway_currency.render(summary.coupons),prevValue:Gateway_currency.render(prevSummary.coupons),delta:calculateDelta(summary.coupons,prevSummary.coupons),label:Object(external_wp_i18n_.__)("Worth of coupons used","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("coupons")},isOpen:"coupons"===_this4.state.activeChart})]}))),React.createElement("div",{className:"pos-analytics-chart"},React.createElement(external_window_wc_components_.Chart,{data:this.state.chartData,query:this.props.query,path:this.props.path})),React.createElement("div",{className:"pos-analytics-table"},React.createElement(Table_Table,{data:this.state.tableData,currency:Gateway_currency,title:tableTitle})))}}])&&Gateway_defineProperties(Constructor.prototype,protoProps),staticProps&&Gateway_defineProperties(Constructor,staticProps),Gateway}(external_wp_element_.Component);function User_typeof(obj){return(User_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function User_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||User_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function User_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return User_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||User_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function User_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return User_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?User_arrayLikeToArray(o,minLen):void 0}}function User_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function User_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function User_setPrototypeOf(o,p){return(User_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function User_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=User_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=User_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return User_possibleConstructorReturn(this,result)}}function User_possibleConstructorReturn(self,call){if(call&&("object"===User_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return User_assertThisInitialized(self)}function User_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function User_getPrototypeOf(o){return(User_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var User_currency=new external_window_wc_currency_default.a(external_window_wc_wcSettings_.CURRENCY),defaultUserFilterOptions=[{label:Object(external_wp_i18n_.__)("All users","zpos-wp-api"),value:"-1"}],User_tableTitle=Object(external_wp_i18n_.__)("User Orders","zpos-wp-api"),User_User=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&User_setPrototypeOf(subClass,superClass)}(User,_Component);var Constructor,protoProps,staticProps,_super=User_createSuper(User);function User(props){var _this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,User);var queryDates=getQueryDates((_this=_super.call(this,props)).props.query),queryUserId=getQueryVar("userId");return _this.state={loading:!0,dates:queryDates,userFilterOptions:defaultUserFilterOptions,userId:queryUserId||"-1",orders:[],prevOrders:[],summary:defaultSummary,prevSummary:defaultSummary,activeChart:"grossPeriod",chartData:[],tableData:[]},_this.handleDateChange=_this.handleDateChange.bind(User_assertThisInitialized(_this)),_this.handleUserChange=_this.handleUserChange.bind(User_assertThisInitialized(_this)),_this.handeChartChange=_this.handeChartChange.bind(User_assertThisInitialized(_this)),_this}return Constructor=User,(protoProps=[{key:"componentDidMount",value:function(){this.setUserFilterOptions()}},{key:"setUserFilterOptions",value:function(){var _this2=this;external_wp_apiFetch_default()({path:"/wp/v2/users?per_page=-1"}).then((function(users){var preparedOptions=[].concat(defaultUserFilterOptions,User_toConsumableArray(users.map((function(user){return{label:user.name,value:String(user.id)}}))));_this2.setState({loading:!0,userFilterOptions:preparedOptions}),_this2.setData(_this2.state.userId,_this2.state.dates)})).catch((function(err){return console.error(err)}))}},{key:"setData",value:function(userId,filterDates){var _this3=this,_getPeriod=getPeriod(filterDates,!0),startISODate=_getPeriod.startISODate,endISODate=_getPeriod.endISODate,prevStartISODate=_getPeriod.prevStartISODate,prevEndISODate=_getPeriod.prevEndISODate,queryUserId="-1"===userId?"":"&pos_user=".concat(userId);Promise.all([external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1".concat(queryUserId,"&after=").concat(startISODate,"&before=").concat(endISODate,"&with_pos_station=1")}),external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1".concat(queryUserId,"&after=").concat(prevStartISODate,"&before=").concat(prevEndISODate,"&with_pos_station=1")})]).then((function(_ref){var _ref2=User_slicedToArray(_ref,2),orders=_ref2[0],prevOrders=_ref2[1];_this3.setState({loading:!1,orders:orders,prevOrders:prevOrders,summary:calculateSummary(orders,filterDates),prevSummary:calculateSummary(prevOrders,filterDates),tableData:prepareTableData(orders,prevOrders)}),_this3.handeChartChange(_this3.state.activeChart)})).catch((function(err){return console.error(err)}))}},{key:"handleDateChange",value:function(query){var dates=getQueryDates(query);this.setState({loading:!0,dates:dates}),this.setData(this.state.userId,dates)}},{key:"handleUserChange",value:function(query){var userId=void 0===query.userId?"-1":query.userId;this.setState({loading:!0,userId:userId}),this.setData(userId,this.state.dates)}},{key:"handeChartChange",value:function(chart){var _this$state=this.state,orders=_this$state.orders,prevOrders=_this$state.prevOrders,dates=_this$state.dates;this.setState({activeChart:chart,chartData:calculateChartData(chart,orders,prevOrders,dates)})}},{key:"render",value:function(){var _this4=this,dateFilter=React.createElement(external_window_wc_components_.ReportFilters,{dateQuery:this.state.dates,query:this.props.query,path:this.props.path,currency:User_currency,isoDateFormat:external_window_wc_date_.isoDateFormat,onDateSelect:this.handleDateChange}),userFilter=React.createElement(external_window_wc_components_.FilterPicker,{config:{label:Object(external_wp_i18n_.__)("User","zpos-wp-api"),staticParams:[],param:"userId",defaultValue:"-1",showFilters:function(){},filters:this.state.userFilterOptions},path:this.props.path,query:this.props.query,onFilterSelect:this.handleUserChange});if(this.state.loading)return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters pos-analytics-filters_disabled"},dateFilter,userFilter),React.createElement(external_window_wc_components_.SummaryListPlaceholder,{numberOfItems:9}),React.createElement(external_window_wc_components_.ChartPlaceholder,{height:300}),React.createElement(external_window_wc_components_.TablePlaceholder,{caption:User_tableTitle,headers:userTableHeaders}));var _this$state2=this.state,summary=_this$state2.summary,prevSummary=_this$state2.prevSummary;return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters"},dateFilter,userFilter),React.createElement("div",{className:"pos-analytics-summary"},React.createElement(external_window_wc_components_.SummaryList,null,(function(){return[React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossPeriod",value:User_currency.render(summary.grossPeriod),prevValue:User_currency.render(prevSummary.grossPeriod),delta:calculateDelta(summary.grossPeriod,prevSummary.grossPeriod),label:Object(external_wp_i18n_.__)("Gross sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("grossPeriod")},isOpen:"grossPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossDaily",value:User_currency.render(summary.grossDaily),prevValue:User_currency.render(prevSummary.grossDaily),delta:calculateDelta(summary.grossDaily,prevSummary.grossDaily),label:Object(external_wp_i18n_.__)("Average gross daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netPeriod",value:User_currency.render(summary.netPeriod),prevValue:User_currency.render(prevSummary.netPeriod),delta:calculateDelta(summary.netPeriod,prevSummary.netPeriod),label:Object(external_wp_i18n_.__)("Net sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("netPeriod")},isOpen:"netPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netDaily",value:User_currency.render(summary.netDaily),prevValue:User_currency.render(prevSummary.netDaily),delta:calculateDelta(summary.netDaily,prevSummary.netDaily),label:Object(external_wp_i18n_.__)("Average net daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"ordersCount",value:summary.ordersCount,prevValue:prevSummary.ordersCount,delta:calculateDelta(summary.ordersCount,prevSummary.ordersCount),label:Object(external_wp_i18n_.__)("Orders placed","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("ordersCount")},isOpen:"ordersCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"itemsCount",value:"".concat(summary.itemsCount," (").concat(summary.unitsCount," units)"),prevValue:prevSummary.itemsCount,delta:calculateDelta(summary.itemsCount,prevSummary.itemsCount),label:Object(external_wp_i18n_.__)("Items purchased","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("itemsCount")},isOpen:"itemsCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"refunded",value:"-".concat(User_currency.render(summary.refunded)),prevValue:"-".concat(User_currency.render(prevSummary.refunded)),delta:calculateDelta(summary.refunded,prevSummary.refunded),reverseTrend:!0,label:Object(external_wp_i18n_.sprintf)(Object(external_wp_i18n_.__)("Refunded %1$s orders (-%2$s items)","zpos-wp-api"),summary.refundedOrders,summary.refundedItems),onToggle:function(){_this4.handeChartChange("refunded")},isOpen:"refunded"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"shipping",value:User_currency.render(summary.shipping),prevValue:User_currency.render(prevSummary.shipping),delta:calculateDelta(summary.shipping,prevSummary.shipping),label:Object(external_wp_i18n_.__)("Charged for shipping","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("shipping")},isOpen:"shipping"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"coupons",value:User_currency.render(summary.coupons),prevValue:User_currency.render(prevSummary.coupons),delta:calculateDelta(summary.coupons,prevSummary.coupons),label:Object(external_wp_i18n_.__)("Worth of coupons used","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("coupons")},isOpen:"coupons"===_this4.state.activeChart})].concat(User_toConsumableArray(Object.values(summary.gateways).map((function(gateway){var prevValue=void 0===prevSummary.gateways[gateway.key]?0:prevSummary.gateways[gateway.key].value;return React.createElement(external_window_wc_components_.SummaryNumber,{key:gateway.key,value:User_currency.render(gateway.value),prevValue:User_currency.render(prevValue),delta:calculateDelta(gateway.value,prevValue),label:gateway.label,onToggle:function(){_this4.handeChartChange(gateway.key)},isOpen:gateway.key===_this4.state.activeChart})}))),User_toConsumableArray(Object.values(prevSummary.gateways).map((function(gateway){return void 0===summary.gateways[gateway.key]?React.createElement(external_window_wc_components_.SummaryNumber,{key:gateway.key,value:User_currency.render(0),prevValue:User_currency.render(gateway.value),delta:calculateDelta(0,gateway.value),label:gateway.label,onToggle:function(){_this4.handeChartChange(gateway.key)},isOpen:gateway.key===_this4.state.activeChart}):{}})).filter((function(gateway){return 0!==Object.keys(gateway).length}))))}))),React.createElement("div",{className:"pos-analytics-chart"},React.createElement(external_window_wc_components_.Chart,{data:this.state.chartData,query:this.props.query,path:this.props.path})),React.createElement("div",{className:"pos-analytics-table"},React.createElement(Table_Table,{data:this.state.tableData,currency:User_currency,title:User_tableTitle,reportType:"user"})))}}])&&User_defineProperties(Constructor.prototype,protoProps),staticProps&&User_defineProperties(Constructor,staticProps),User}(external_wp_element_.Component);function Station_typeof(obj){return(Station_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function Station_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||Station_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Station_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return Station_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||Station_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Station_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return Station_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Station_arrayLikeToArray(o,minLen):void 0}}function Station_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Station_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Station_setPrototypeOf(o,p){return(Station_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function Station_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Station_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Station_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Station_possibleConstructorReturn(this,result)}}function Station_possibleConstructorReturn(self,call){if(call&&("object"===Station_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return Station_assertThisInitialized(self)}function Station_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function Station_getPrototypeOf(o){return(Station_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var Station_currency=new external_window_wc_currency_default.a(external_window_wc_wcSettings_.CURRENCY),defaultStationFilterOptions=[{label:Object(external_wp_i18n_.__)("All stations","zpos-wp-api"),value:"-1"}],Station_tableTitle=Object(external_wp_i18n_.__)("Station Orders","zpos-wp-api"),Station_Station=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&Station_setPrototypeOf(subClass,superClass)}(Station,_Component);var Constructor,protoProps,staticProps,_super=Station_createSuper(Station);function Station(props){var _this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Station);var queryDates=getQueryDates((_this=_super.call(this,props)).props.query),queryStationId=getQueryVar("stationId");return _this.state={loading:!0,dates:queryDates,stationFilterOptions:defaultStationFilterOptions,stationId:queryStationId||"-1",orders:[],prevOrders:[],summary:defaultSummary,prevSummary:defaultSummary,activeChart:"grossPeriod",chartData:[],tableData:[]},_this.handleDateChange=_this.handleDateChange.bind(Station_assertThisInitialized(_this)),_this.handleStationChange=_this.handleStationChange.bind(Station_assertThisInitialized(_this)),_this.handeChartChange=_this.handeChartChange.bind(Station_assertThisInitialized(_this)),_this}return Constructor=Station,(protoProps=[{key:"componentDidMount",value:function(){this.setStationFilterOptions()}},{key:"setStationFilterOptions",value:function(){var _this2=this;external_wp_apiFetch_default()({path:"/wc-pos/stations"}).then((function(stations){var preparedOptions=[].concat(defaultStationFilterOptions,Station_toConsumableArray(stations.map((function(station){return{label:"".concat(station.name," (ID: ").concat(station.posID,")"),value:String(station.posID)}}))));_this2.setState({loading:!0,stationFilterOptions:preparedOptions}),_this2.setData(_this2.state.stationId,_this2.state.dates)})).catch((function(err){return console.error(err)}))}},{key:"setData",value:function(stationId,filterDates){var _this3=this,_getPeriod=getPeriod(filterDates,!0),startISODate=_getPeriod.startISODate,endISODate=_getPeriod.endISODate,prevStartISODate=_getPeriod.prevStartISODate,prevEndISODate=_getPeriod.prevEndISODate;Promise.all([external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1&pos_station=".concat(stationId,"&after=").concat(startISODate,"&before=").concat(endISODate,"&with_pos_user=1")}),external_wp_apiFetch_default()({path:"/wc/v3/orders?per_page=-1&pos_station=".concat(stationId,"&after=").concat(prevStartISODate,"&before=").concat(prevEndISODate,"&with_pos_user=1")})]).then((function(_ref){var _ref2=Station_slicedToArray(_ref,2),orders=_ref2[0],prevOrders=_ref2[1];_this3.setState({loading:!1,orders:orders,prevOrders:prevOrders,summary:calculateSummary(orders,filterDates),prevSummary:calculateSummary(prevOrders,filterDates),tableData:prepareTableData(orders,prevOrders)}),_this3.handeChartChange(_this3.state.activeChart)})).catch((function(err){return console.error(err)}))}},{key:"handleDateChange",value:function(query){var dates=getQueryDates(query);this.setState({loading:!0,dates:dates}),this.setData(this.state.stationId,dates)}},{key:"handleStationChange",value:function(query){var stationId=void 0===query.stationId?"-1":query.stationId;this.setState({loading:!0,stationId:stationId}),this.setData(stationId,this.state.dates)}},{key:"handeChartChange",value:function(chart){var _this$state=this.state,orders=_this$state.orders,prevOrders=_this$state.prevOrders,dates=_this$state.dates;this.setState({activeChart:chart,chartData:calculateChartData(chart,orders,prevOrders,dates)})}},{key:"render",value:function(){var _this4=this,dateFilter=React.createElement(external_window_wc_components_.ReportFilters,{dateQuery:this.state.dates,query:this.props.query,path:this.props.path,currency:Station_currency,isoDateFormat:external_window_wc_date_.isoDateFormat,onDateSelect:this.handleDateChange}),stationFilter=React.createElement(external_window_wc_components_.FilterPicker,{config:{label:Object(external_wp_i18n_.__)("Station","zpos-wp-api"),staticParams:[],param:"stationId",defaultValue:"-1",showFilters:function(){},filters:this.state.stationFilterOptions},path:this.props.path,query:this.props.query,onFilterSelect:this.handleStationChange});if(this.state.loading)return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters pos-analytics-filters_disabled"},dateFilter,stationFilter),React.createElement(external_window_wc_components_.SummaryListPlaceholder,{numberOfItems:9}),React.createElement(external_window_wc_components_.ChartPlaceholder,{height:300}),React.createElement(external_window_wc_components_.TablePlaceholder,{caption:Station_tableTitle,headers:stationTableHeaders}));var _this$state2=this.state,summary=_this$state2.summary,prevSummary=_this$state2.prevSummary;return React.createElement(external_wp_element_.Fragment,null,React.createElement("div",{className:"pos-analytics-filters"},dateFilter,stationFilter),React.createElement("div",{className:"pos-analytics-summary"},React.createElement(external_window_wc_components_.SummaryList,null,(function(){return[React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossPeriod",value:Station_currency.render(summary.grossPeriod),prevValue:Station_currency.render(prevSummary.grossPeriod),delta:calculateDelta(summary.grossPeriod,prevSummary.grossPeriod),label:Object(external_wp_i18n_.__)("Gross sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("grossPeriod")},isOpen:"grossPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"grossDaily",value:Station_currency.render(summary.grossDaily),prevValue:Station_currency.render(prevSummary.grossDaily),delta:calculateDelta(summary.grossDaily,prevSummary.grossDaily),label:Object(external_wp_i18n_.__)("Average gross daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netPeriod",value:Station_currency.render(summary.netPeriod),prevValue:Station_currency.render(prevSummary.netPeriod),delta:calculateDelta(summary.netPeriod,prevSummary.netPeriod),label:Object(external_wp_i18n_.__)("Net sales in this period","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("netPeriod")},isOpen:"netPeriod"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"netDaily",value:Station_currency.render(summary.netDaily),prevValue:Station_currency.render(prevSummary.netDaily),delta:calculateDelta(summary.netDaily,prevSummary.netDaily),label:Object(external_wp_i18n_.__)("Average net daily sales","zpos-wp-api")}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"ordersCount",value:summary.ordersCount,prevValue:prevSummary.ordersCount,delta:calculateDelta(summary.ordersCount,prevSummary.ordersCount),label:Object(external_wp_i18n_.__)("Orders placed","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("ordersCount")},isOpen:"ordersCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"itemsCount",value:"".concat(summary.itemsCount," (").concat(summary.unitsCount," units)"),prevValue:prevSummary.itemsCount,delta:calculateDelta(summary.itemsCount,prevSummary.itemsCount),label:Object(external_wp_i18n_.__)("Items purchased","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("itemsCount")},isOpen:"itemsCount"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"refunded",value:"-".concat(Station_currency.render(summary.refunded)),prevValue:"-".concat(Station_currency.render(prevSummary.refunded)),delta:calculateDelta(summary.refunded,prevSummary.refunded),reverseTrend:!0,label:Object(external_wp_i18n_.sprintf)(Object(external_wp_i18n_.__)("Refunded %1$s orders (-%2$s items)","zpos-wp-api"),summary.refundedOrders,summary.refundedItems),onToggle:function(){_this4.handeChartChange("refunded")},isOpen:"refunded"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"shipping",value:Station_currency.render(summary.shipping),prevValue:Station_currency.render(prevSummary.shipping),delta:calculateDelta(summary.shipping,prevSummary.shipping),label:Object(external_wp_i18n_.__)("Charged for shipping","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("shipping")},isOpen:"shipping"===_this4.state.activeChart}),React.createElement(external_window_wc_components_.SummaryNumber,{key:"coupons",value:Station_currency.render(summary.coupons),prevValue:Station_currency.render(prevSummary.coupons),delta:calculateDelta(summary.coupons,prevSummary.coupons),label:Object(external_wp_i18n_.__)("Worth of coupons used","zpos-wp-api"),onToggle:function(){_this4.handeChartChange("coupons")},isOpen:"coupons"===_this4.state.activeChart})].concat(Station_toConsumableArray(Object.values(summary.gateways).map((function(gateway){var prevValue=void 0===prevSummary.gateways[gateway.key]?0:prevSummary.gateways[gateway.key].value;return React.createElement(external_window_wc_components_.SummaryNumber,{key:gateway.key,value:Station_currency.render(gateway.value),prevValue:Station_currency.render(prevValue),delta:calculateDelta(gateway.value,prevValue),label:gateway.label,onToggle:function(){_this4.handeChartChange(gateway.key)},isOpen:gateway.key===_this4.state.activeChart})}))),Station_toConsumableArray(Object.values(prevSummary.gateways).map((function(gateway){return void 0===summary.gateways[gateway.key]?React.createElement(external_window_wc_components_.SummaryNumber,{key:gateway.key,value:Station_currency.render(0),prevValue:Station_currency.render(gateway.value),delta:calculateDelta(0,gateway.value),label:gateway.label,onToggle:function(){_this4.handeChartChange(gateway.key)},isOpen:gateway.key===_this4.state.activeChart}):{}})).filter((function(gateway){return 0!==Object.keys(gateway).length}))))}))),React.createElement("div",{className:"pos-analytics-chart"},React.createElement(external_window_wc_components_.Chart,{data:this.state.chartData,query:this.props.query,path:this.props.path})),React.createElement("div",{className:"pos-analytics-table"},React.createElement(Table_Table,{data:this.state.tableData,currency:Station_currency,title:Station_tableTitle,reportType:"station"})))}}])&&Station_defineProperties(Constructor.prototype,protoProps),staticProps&&Station_defineProperties(Constructor,staticProps),Station}(external_wp_element_.Component);function index_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return index_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return index_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return index_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function index_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object(external_wp_hooks_.addFilter)("woocommerce_admin_reports_list","analytics/pos",(function(defaults){return[].concat(index_toConsumableArray(defaults),[{report:"pos-gateway",title:Object(external_wp_i18n_.__)("Payments","zpos-wp-api"),component:Gateway_Gateway},{report:"pos-user",title:Object(external_wp_i18n_.__)("Users","zpos-wp-api"),component:User_User},{report:"pos-station",title:Object(external_wp_i18n_.__)("Stations","zpos-wp-api"),component:Station_Station}])})),Object(external_wp_hooks_.addFilter)("woocommerce_admin_orders_report_filters","analytics/pos",(function(args){return args[0].filters.push({label:Object(external_wp_i18n_.__)("Online orders","zpos-wp-api"),value:"pos-online"},{label:Object(external_wp_i18n_.__)("POS orders","zpos-wp-api"),value:"pos-stations"}),args}))}]);