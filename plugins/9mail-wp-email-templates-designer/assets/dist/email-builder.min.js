"use strict";let styleSection="style",contentSection="content",viWecEditorArea="#emtmpl-email-editor-content",viWecChange=!0,viWecFontWeightOptions=[{id:300,text:300},{id:400,text:400},{id:500,text:500},{id:600,text:600},{id:700,text:700},{id:800,text:800},{id:900,text:900}],viWecAlignmentOptions=[{value:"left",title:"Left",icon:"dashicons dashicons-editor-alignleft",checked:!0},{value:"center",title:"Center",icon:"dashicons dashicons-editor-aligncenter",checked:!1},{value:"right",title:"Right",icon:"dashicons dashicons-editor-alignright",checked:!1}],viWecFontFamilyOptions=[{id:"'andale mono', monospace",text:"Andale Mono"},{id:"arial, helvetica, sans-serif",text:"Arial"},{id:"'arial black', sans-serif",text:"Arial Black"},{id:"'book antiqua', palatino, serif",text:"Book Antiqua"},{id:"'comic sans ms', sans-serif",text:"Comic Sans MS"},{id:"'courier new', courier, monospace",text:"Courier New"},{id:"georgia, palatino, serif",text:"Georgia"},{id:"helvetica, arial, sans-serif",text:"Helvetica"},{id:"impact, sans-serif",text:"Impact"},{id:"symbol",text:"Symbol"},{id:"tahoma, arial, helvetica, sans-serif",text:"Tahoma"},{id:"terminal, monaco, monospace",text:"Terminal"},{id:"'times new roman', times, serif",text:"Times New Roman"},{id:"'trebuchet ms', geneva, sans-serif",text:"Trebuchet MS"},{id:"verdana, geneva, sans-serif",text:"Verdana"},{id:"webdings",text:"Webdings"},{id:"wingdings, 'zapf dingbats'",text:"Wingdings"},],viWecMapObj=viWecParams.shortcode_for_replace,viWecShortcodeList=viWecParams.shortcode.map(a=>({text:a,value:a}));if(viWecParams.sc_3rd_party_for_text_editor)for(let sc in viWecParams.sc_3rd_party_for_text_editor)viWecShortcodeList.push(viWecParams.sc_3rd_party_for_text_editor[sc]);let viWecShortcodeListValue="";if(viWecParams.shortcode)for(let sc of viWecParams.shortcode)viWecShortcodeListValue+="<li>"+sc+"</li>";if(viWecParams.sc_3rd_party)for(let sc of viWecParams.sc_3rd_party)viWecShortcodeListValue+="<li>"+sc+"</li>";if(void 0===ViWec)var ViWec={};!function(){var a={};window.viWecTmpl=function e(b,c){var d=/^[-a-zA-Z0-9]+$/.test(b)?a[b]=a[b]||e(document.getElementById(b).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+b.replace(/[\r\t\n]/g," ").split("{%").join("	").replace(/((^|%})[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%}/g,"',$1,'").split("	").join("');").split("%}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return c?d(c):d}}(),jQuery(document).ready(function($){window.viWecNoticeBox=(b,a,c=3e3)=>{a=a||"white";let d=$("#emtmpl-notice-box");d.text(b).css({color:a,bottom:0}),setTimeout(function(){d.css({bottom:"-50px"})},c)},$.fn.handleRow=function(){return 0===this.find(".emtmpl-layout-handle-outer").length&&this.append(viWecTmpl("emtmpl-input-handle-outer",{})),this.on("click",".emtmpl-delete-row-btn",()=>{this.remove(),ViWec.Builder.clearTab(),ViWec.Builder.activeTab("components")}),this.on("click",".emtmpl-duplicate-row-btn",()=>{let a=this.clone();a.find(".emtmpl-column-sortable").columnSortAble(),a.handleRow().handleColumn(),this.after(a)}),this.on("click",".emtmpl-edit-outer-row-btn",()=>{ViWec.Builder.removeFocus(),this.addClass("emtmpl-block-focus"),ViWec.Builder.selectedEl=this.find(".emtmpl-layout-row"),ViWec.Builder.loadLayoutControl()}),this.on("click",".emtmpl-copy-row-btn",function(){let a=$(this).closest(".emtmpl-block");a=a.prop("outerHTML"),localStorage.setItem("emtmplCopyRow",a),viWecNoticeBox("Copied")}),this.on("click",".emtmpl-paste-row-btn",function(){let a=localStorage.getItem("emtmplCopyRow");a&&((a=$(a)).find(".emtmpl-column-sortable").columnSortAble(),a.handleRow().handleColumn(),$(this).closest(".emtmpl-block").after(a))}),this},$.fn.handleElement=function(){this.append(`<div class="emtmpl-element-handle">
                <span class="dashicons dashicons-welcome-add-page emtmpl-copy-element-btn" title="Copy"></span>
                <span class="dashicons dashicons-admin-page emtmpl-duplicate-element-btn" title="Duplicate"></span>
                <span class="dashicons dashicons-no-alt emtmpl-delete-element-btn" title="Delete"></span></div>`)},$.fn.columnSortAble=function(){$(this).sortable({cursor:"move",cursorAt:{left:40,top:18},placeholder:"emtmpl-placeholder",connectWith:".emtmpl-column-sortable",thisColumn:"",accept:".emtmpl-content-draggable",start:function(b,a){a.helper.addClass("emtmpl-is-dragging"),this.thisColumn=a.helper.closest(".emtmpl-column")},stop:function(c,b){let a=b.item.get(0).style;a.position=a.top=a.left=a.right=a.bottom=a.height=a.width="",b.item.removeClass("emtmpl-is-dragging"),b.item.offsetParent().find(".emtmpl-element").length&&b.item.offsetParent().removeClass("emtmpl-column-placeholder"),this.thisColumn.find(".emtmpl-element").length||this.thisColumn.addClass("emtmpl-column-placeholder"),b.item.click(),viWecChange=!0}})},$.fn.handleColumn=function(){return this.on("click",a=>{(this.hasClass("emtmpl-column-placeholder")||this.find(".emtmpl-column-placeholder").length)&&(ViWec.Builder.removeFocus(),ViWec.Builder.selectedEl=this.find(".emtmpl-column-sortable").addClass("emtmpl-block-focus"),ViWec.Builder.loadLayoutControl("editColumn"))}),this.on("click",".emtmpl-column-edit",()=>{ViWec.Builder.removeFocus(),ViWec.Builder.selectedEl=this.find(".emtmpl-column-sortable").addClass("emtmpl-block-focus"),ViWec.Builder.loadLayoutControl("editColumn")}),this.on("click",".emtmpl-column-paste",function(){let a=localStorage.getItem("emtmplCopy");a&&(a=$(a),$(this).closest(".emtmpl-column").find(".emtmpl-column-sortable").append(a))}),this},ViWec.viWecReplaceShortcode=a=>{if(!a||"string"!=typeof a)return a;var b=new RegExp(Object.keys(viWecMapObj).join("|"),"gm");return a=a.replace(b,function(a){return viWecMapObj[a]})},ViWec.Components={_categories:{},_components:{baseProp:{}},init(){this.registerCategory("layout","Layout"),this.registerCategory("content","Basic content")},registerCategory(a,b){this._categories[a]||(this._categories[a]={name:b,elements:[]})},get:function(a){return this._components[a]},add(a){let c=a.category||"content";if(this._categories[c]&&this._categories[c].elements.push(a.type),a.inheritProp){let b=[];for(let d of a.inheritProp)this._components.baseProp[d]&&(b=[...b,...this._components.baseProp[d].properties]);a.properties||(a.properties=[]),a.properties=[...a.properties,...b]}this._components[a.type]=a},addBaseProp(a){this._components.baseProp[a.type]=a},render:function(i){let d=this._components[i],c,e=$("#emtmpl-attributes-list");if(!d)return;var j=function(b,a,c){return a.input.on("propertyChange",function(j,d,g){viWecChange=!0;let e=ViWec.viWecReplaceShortcode(d);if(a.outputValue&&(d=a.outputValue),a.htmlAttr){if(["style","childStyle"].indexOf(a.htmlAttr)> -1){let i=a.unit?a.unit:"";c=ViWec.StyleManager.setStyle(c,a.key,d,i)}else if("innerHTML"===a.htmlAttr){if(a.renderShortcode){let f=c.clone(),h=(c=c.html(d).hide()).parent().find(".emtmpl-text-view");0===h.length?(f=f.removeClass().html(e).addClass("emtmpl-text-view"),c.after(f)):h.html(e)}else c.html(d)}else c=c.attr(a.htmlAttr,d)}return"function"==typeof b.onChange&&(c=b.onChange(c,a,d,g)),"function"==typeof a.onChange&&(c=a.onChange(c,d,e,g,b,a)),c})};let f="";for(let k in d.name&&e.append(`<div id="emtmpl-component-name">Component: ${d.name}</div>`),d.properties){var a=d.properties[k],b=ViWec.Builder.selectedEl;if(!1!==a.visible&&(!a.target||b.find(a.target).length)&&(a.target&&b.find(a.target).length&&(b=b.find(a.target)),a.data?(a.data.key=a.key,a.name&&(a.data.header=a.name)):(a.data={key:a.key},a.name&&(a.data.header=a.name)),a.inputType)){if(a.inputType.hasOwnProperty("init")&&(a.input=a.inputType.init(a.data)),a.init)a.inputType.setValue(a.init(b.get(0)));else if(a.htmlAttr){let g;(g="style"===a.htmlAttr?ViWec.StyleManager.getStyle(b,a):"childStyle"===a.htmlAttr?ViWec.StyleManager.getStyle(b,a):"innerHTML"===a.htmlAttr?b.html():b.attr(a.htmlAttr))||!a.default||(g=a.default),g&&a.inputType.setValue(g)}if(a.input&&j(d,a,b),c=a.section?a.section:""){if(0===e.find(`.emtmpl-${c}`).length&&e.append(`<div class="emtmpl-${c} vi-ui accordion styled fluid">
                                                <div class="title active">
                                                    <i class="dropdown icon"></i>
                                                    ${c.replace(/^./,c[0].toUpperCase())}
                                                </div>
                                                <div class="content active ${c}-properties">
                                            </div></div>`),a.inputType===SectionInput)e.find(`.emtmpl-${c} .${c}-properties`).append(viWecTmpl("emtmpl-input-sectioninput",a.data)),f=a.key?a.key:f;else if(a.label)e.find(`.emtmpl-${c} .${f}`).append(`<label class="emtmpl-group-name" for="input-model">${a.label}</label>`);else if(!a.hidden){let h=$(viWecTmpl("emtmpl-property",a));h.find(".input").append(a.input),"function"==typeof a.setup&&(h=a.setup(h)),e.find(`.emtmpl-${c} .${f}`).append(h),"function"==typeof a.inputType.subInit&&a.inputType.subInit(b)}a.inputType.afterInit&&a.inputType.afterInit(a.input)}}}$(".vi-ui.accordion").accordion(),d.init&&d.init(ViWec.Builder.selectedEl.get(0))}},ViWec.Blocks={_blocks:{},get:function(a){return this._blocks[a]},add:function(a,b){b.type=a,this._blocks[a]=b}},ViWec.Builder={component:{},dragMoveMutation:!1,isPreview:!1,designerMode:!1,copyStorage:"",init:function(b){var a=this;a.selectedEl=null,a.initCallback=b,a.dragElement=null,a.loadControlGroups(),a.initDragDrop(),a.initHandleBox(),a.loadContentControl(),a.loadBackgroundControl(),a.initQuickAddLayout(),a.globalEvent()},loadControlGroups:function(){let d=$("#emtmpl-components-list"),c={},a={};for(let b in d.empty(),ViWec.Components._categories){d.append(`<div class="vi-ui accordion styled fluid">
                                <div class="title active">
                                    <i class="dropdown icon"></i>
                                   ${ViWec.Components._categories[b].name}
                                </div>
                                <div class="content active" data-section="${b}">
                                    <ul></ul>
                                </div>
                            </div>`);let j=d.find('div[data-section="'+b+'"] ul'),g=ViWec.Components._categories[b].elements;for(let k in b="layout"===b?"layout":"content",g){let h=g[k],e;if(a=ViWec.Components.get(h)){if("function"==typeof a.setup)c=a.setup(),"function"==typeof a.onChange&&a.onChange(c);else{let i=a.classes||"",f=i.includes("emtmpl-pro-version"),l=f?"":`emtmpl-${b}-draggable`,m=f?"<div class='emtmpl-unlock-notice'><a target='_blank' href='https://1.envato.market/BZZv1'>Unlock this feature</a></div>":"",n=f?"<div class='dashicons dashicons-lock'></div>":"",o=a.info||"";e=`<div class="emtmpl-control-btn ${l} ${i}" data-type="${h}" data-drag-type="component">
                                            ${n} ${m} ${o}
                                            <div class="emtmpl-control-icon">
                                                <i class="emtmpl-ctrl-icon-${a.icon}"></i>
                                            </div>
                                            <div class="emtmpl-ctrl-title">${a.name}</div>`,c=$(`<li  data-section="${b}">
                                    ${e}
                                    </div></li>`)}j.append(c),"layout"===b&&$("#emtmpl-quick-add-layout .emtmpl-layout-list").append(e)}}}$(".vi-ui.accordion").accordion()},activeTab(a){$("#emtmpl-control-panel .item, #emtmpl-control-panel .tab").removeClass("active"),$(`#emtmpl-control-panel [data-tab=${a}]`).addClass("active")},clearTab(){$("#emtmpl-control-panel #emtmpl-attributes-list").empty()},loadLayoutControl:function(a){this.clearTab(),this.activeTab("editor");let b=a||this.selectedEl.data("type");ViWec.Components.render(b)},loadContentControl:function(){let a=this;$("#emtmpl-email-editor-wrapper").on("click",".emtmpl-element",function(c){a.removeFocus(),$(this).addClass("emtmpl-element-focus"),a.clearTab(),a.activeTab("editor");let b=$(this).data("type");a.selectedEl=$(this),ViWec.Components.render(b)})},loadBackgroundControl:function(){let a=this;$(".emtmpl-edit-bgcolor-btn span").on("click",function(b){a.clearTab(),a.activeTab("editor"),a.selectedEl=$("#emtmpl-email-editor-wrapper"),ViWec.Components.render("background")})},initHandleBox:function(){let b=this,a=$("#emtmpl-email-editor-wrapper");a.on("click",".emtmpl-delete-element-btn",function(a){a.preventDefault(),a.stopImmediatePropagation();let c=$(this),d=c.closest(".emtmpl-column");c.closest(".emtmpl-element").remove(),b.clearTab(),b.activeTab("components"),0===d.find(".emtmpl-element").length&&d.addClass("emtmpl-column-placeholder")}),a.on("click",".emtmpl-duplicate-element-btn",function(a){a.preventDefault(),a.stopImmediatePropagation();let c=$(this).closest(".emtmpl-element");c.after(c.clone()),b.removeFocus()}),a.on("click",".emtmpl-copy-element-btn",function(b){b.preventDefault(),b.stopImmediatePropagation();let a=$(this).closest(".emtmpl-element");a=a.prop("outerHTML"),localStorage.setItem("emtmplCopy",a)}),a.on("click",function(a){$(a.target).is(".emtmpl-layout-row")&&(b.removeFocus(),b.selectedEl=$(a.target),b.selectedEl.closest(".emtmpl-block").addClass("emtmpl-block-focus"),b.loadLayoutControl())})},removeFocus:function(){$("body .emtmpl-element-focus").removeClass("emtmpl-element-focus"),$("body .emtmpl-block-focus").removeClass("emtmpl-block-focus"),this.clearTab(),this.activeTab("components")},initDragDrop:function(){let a=this;$(".emtmpl-layout-draggable").draggable({cursor:"move",cursorAt:{left:40,top:15},helper:function(){let b=$(this).data("type");return a.component=ViWec.Components.get(b),viWecTmpl("emtmpl-block",{type:b,colsQty:a.component.cols})},start:function(b,a){a.helper.addClass("emtmpl-is-dragging")},stop:function(b,a){a.helper.handleRow(),a.helper.find(".emtmpl-column").each(function(b,a){$(a).handleColumn()}),a.helper.removeClass("emtmpl-is-dragging"),viWecChange=!0},connectToSortable:viWecEditorArea}),$(".emtmpl-sortable").sortable({cursor:"move",placeholder:"emtmpl-placeholder",handle:".dashicons-move",cancel:"",cursorAt:{left:40,top:18},start:function(b,a){a.helper.addClass("emtmpl-is-dragging")},stop:function(b,a){a.item.css({width:"auto",height:"auto","z-index":"unset"}),a.item.find(".emtmpl-column-sortable").columnSortAble(),a.item.removeClass("emtmpl-is-dragging"),viWecChange=!0}}),$(".emtmpl-content-draggable").draggable({cursor:"move",cursorAt:{left:40,top:15},helper:function(){let b=jQuery(this),d;if("component"===b.data("drag-type")?a.component=ViWec.Components.get(b.data("type")):a.component=ViWec.Blocks.get(b.data("type")),d=a.component.dragHtml?a.component.dragHtml:a.component.html,0===$(viWecEditorArea).children().length){let c=$(viWecTmpl("emtmpl-block",{type:"layout/grid1cols",colsQty:1}));c.handleRow().handleColumn(),c.find(".emtmpl-column-sortable").columnSortAble(),$(".emtmpl-sortable").append(c)}return`<div class='emtmpl-element' style="font-size:15px;border-radius: 0; overflow: hidden;line-height: 22px;" data-type="${b.data("type")}">${d}</div>`},start:function(b,a){a.helper.addClass("emtmpl-is-dragging")},drag:function(a,b){},stop:function(b,a){a.helper.handleElement(),a.helper.removeClass("emtmpl-is-dragging"),a.helper.css("z-index",""),a.helper.click(),viWecChange=!0,$("#emtmpl-element-search input.emtmpl-search").val("").trigger("keyup"),$("#emtmpl-attributes-list input").trigger("keyup")},connectToSortable:".emtmpl-column-sortable"})},initQuickAddLayout:function(){$("#emtmpl-quick-add-layout .emtmpl-control-btn").on("click",function(){let b=$(this).data("type"),a;self.component=ViWec.Components.get(b),(a=$(viWecTmpl("emtmpl-block",{type:b,colsQty:self.component.cols}))).handleRow().handleColumn(),a.find(".emtmpl-column-sortable").columnSortAble(),$(".emtmpl-sortable").append(a),$(this).closest(".emtmpl-layout-list").toggle()})},globalEvent:function(){let a=this;$("body").on("click",function(b){($(b.target).is("#wpwrap")||$(b.target).is("#emtmpl-email-editor-wrapper"))&&(a.removeFocus(),$(".emtmpl-layout-list").hide())}).on("keyup",function(a){46===a.which&&($(a.target).closest("#emtmpl-control-panel").length||($(".emtmpl-element-focus .emtmpl-delete-element-btn").trigger("click"),$(".emtmpl-block-focus .emtmpl-delete-row-btn").trigger("click")))})}},ViWec.StyleManager={setStyle:function(a,b,c,d){return a.css(b,c+d)},_getCssStyle:function(d,e,g=null){let b=g||e.key;if("width"===b&&e.unit&&"%"===e.unit){let h=parseInt(d.css("width")),f=parseInt(d.parent().css("width"));if(f>0)return Math.round(h/f*100)+"%"}else{let a=d.get(0),c;if(a)return a.style&&a.style.length>0&&a.style[b]?c=a.style[b]:a.currentStyle?c=a.currentStyle[b]:window.getComputedStyle&&(c=document.defaultView.getDefaultComputedStyle?document.defaultView.getDefaultComputedStyle(a,null).getPropertyValue(b):window.getComputedStyle(a,null).getPropertyValue(b)),"transparent"===c&&(c=""),c}},getStyle:function(a,b,c){return this._getCssStyle(a,b,c)}}})