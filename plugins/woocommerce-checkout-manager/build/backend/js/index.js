(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const a=window.jQuery;var o=e.n(a);function n(e){const t=o()(e).next().is(".hasDatepicker")?"minDate":"maxDate",a="minDate"===t?o()(e).next():o()(e).prev(),n=o()(e).datepicker("getDate");o()(a).datepicker("option",t,n),o()(e).change()}function i(){return{language:{errorLoading:()=>wc_enhanced_select_params.i18n_searching,inputTooLong(e){const t=e.input.length-e.maximum;return 1===t?wc_enhanced_select_params.i18n_input_too_long_1:wc_enhanced_select_params.i18n_input_too_long_n.replace("%qty%",t)},inputTooShort(e){const t=e.minimum-e.input.length;return 1===t?wc_enhanced_select_params.i18n_input_too_short_1:wc_enhanced_select_params.i18n_input_too_short_n.replace("%qty%",t)},loadingMore:()=>wc_enhanced_select_params.i18n_load_more,maximumSelected:e=>1===e.maximum?wc_enhanced_select_params.i18n_selection_too_long_1:wc_enhanced_select_params.i18n_selection_too_long_n.replace("%qty%",e.maximum),noResults:()=>wc_enhanced_select_params.i18n_no_matches,searching:()=>wc_enhanced_select_params.i18n_searching}}}window.window.serializeJSON,o()(document).on("wooccm-enhanced-between-dates",(function(e){o()(".wooccm-enhanced-between-dates").filter(":not(.enhanced)").each((function(){o()(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect(){n(o()(this))}}),o()(this).find("input").each((function(){n(o()(this))}))}))})),o()(document).on("wooccm-enhanced-options",(function(e){o()("table.wc_gateways tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,helper:(e,t)=>(t.children().each((function(){o()(this).width(o()(this).width())})),t.css("left","0"),t),start(e,t){t.item.css("background-color","#f6f6f6")},stop(e,t){t.item.removeAttr("style"),t.item.trigger("updateMoveButtons")},update(e,t){o()(this).find("tr").each((function(e,t){const a=o()(t).find("input.check");a.length>0&&a.prop("disabled",0==e),o()(t).find("input.add-order").val(e).trigger("change")}))}}),o()(".wooccm-enhanced-options").each((function(){const e=o()(this),t=e.find(".add-option"),a=e.find(".remove-options");t.on("click",(function(t){const n=e.find("tbody > tr"),i=n.children("td").children(".label").toArray().reduce(((e,t)=>{const a=Number(o()(t).prop("name").match(/\d+/)[0]);return a>e?a:e}),0)+1,c=n.first().clone().html().replace(/options\[([0-9]+)\]/g,"options["+i+"]").replace('disabled="disabled"',"").replace('checked="checked"',"").replace('<input value="0"','<input value="'+i+'"').replace('<input value="0"','<input value="'+i+'"');n.last().after(o()("<tr>"+c+"</tr>")).find("input").trigger("change"),a.removeProp("disabled")})),a.on("click",(function(t){e.find("tbody > tr").length<2||e.find("tbody > tr").length<=e.find("tr > td.check-column input:checked").length?alert("You cant delete all options."):(e.find("tr > td.check-column input:checked").closest("tr").remove(),e.find("tbody > tr").first().find("input").trigger("change"))})),o()(document).ready((function(){o()("input[type=radio][name=default]").click((function(){if(1==o()(this).data("waschecked"))o()(this).prop("checked",!1),o()(this).data("waschecked",!1),o()(this).trigger("change");else{const e=o()(this);e.data("waschecked",!0),o()("input[type=radio][name=default]").each((function(){const t=o()(this);e.val()!==t.val()&&(t.prop("checked",!1),t.data("waschecked",!1))}))}}))}))}))})),o()(document).on("wooccm-enhanced-select",(function(e){o()(".wooccm-enhanced-select").filter(":not(.enhanced)").each((function(){const e=o().extend({minimumResultsForSearch:10,allowClear:!!o()(this).data("allow_clear"),placeholder:o()(this).data("placeholder")},i());o()(this).selectWoo(e).addClass("enhanced")})),o()(".wooccm-product-search").filter(":not(.enhanced)").each((function(){let e={allowClear:!!o()(this).data("allow_clear"),placeholder:o()(this).data("placeholder"),minimumInputLength:o()(this).data("minimum_input_length")?o()(this).data("minimum_input_length"):"3",escapeMarkup:e=>e,ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",delay:250,data(e){return{term:e.term,action:o()(this).data("action")||"wooccm_select_search_products",security:wc_enhanced_select_params.search_products_nonce,selected:o()(this).select2("val")||0,exclude:o()(this).data("exclude"),include:o()(this).data("include"),limit:o()(this).data("limit"),display_stock:o()(this).data("display_stock")}},processResults(e){const t=[];return e&&o().each(e,(function(e,a){t.push({id:e,text:a})})),{results:t}},cache:!0}};if(e=o().extend(e,i()),o()(this).attr("name"),o()(this).selectWoo(e).addClass("enhanced"),o()(this).data("sortable")){const e=o()(this),t=o()(this).next(".select2-container").find("ul.select2-selection__rendered");t.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop(){o()(t.find(".select2-selection__choice").get().reverse()).each((function(){const t=o()(this).data("data").id,a=e.find('option[value="'+t+'"]')[0];e.prepend(a)}))}})}else o()(this).prop("multiple")&&o()(this).on("change",(function(){const e=o()(this).children();e.filter("option").sort((function(e,t){const a=e.text.toLowerCase(),o=t.text.toLowerCase();return a>o?1:a<o?-1:0})),o()(this).html(e)}))}))})),o()(".wooccm-enhanced-search").filter(":not(.enhanced)").each((function(){let e={allowClear:!!o()(this).data("allow_clear"),placeholder:o()(this).data("placeholder"),minimumInputLength:o()(this).data("minimum_input_length")||"3",escapeMarkup:e=>e,ajax:{url:wooccm_admin.ajax_url,dataType:"json",cache:!0,delay:250,data(e){return{term:e.term,key:o()(this).data("key"),action:"wooccm_search_field",nonce:wooccm_admin.nonce}},processResults(e,t){const a=[];return e&&o().each(e,(function(e,t){a.push({id:e,text:t})})),{results:a}}}};e=o().extend(e,i()),o()(this).select2(e).addClass("enhanced")})),window.wp.util,window.window.Backbone,window.window.uiDatepicker,function(e){let t,a=0;const o=function(){e("#wooccm_modal").removeClass("processing")};_.mixin({sortOptions:e=>_.sortBy(e,(function(e){return e.order})),escapeHtml:e=>e.replace("&amp;",/&/g).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#039;/g,"'"),getFormData(e){const t=e.serializeJSON({checkboxUncheckedValue:"false",parseBooleans:!0,parseNulls:!0}),a=Object.assign({},wooccm_field.args);return Object.assign(a,t)}});const n=Backbone.Model.extend({defaults:Object.create(wooccm_field.args)}),i=Backbone.View.extend({initialize(t){const a=e(t.target).closest("[data-field_id]").data("field_id"),o=new n;o.set({id:a}),new c({model:o}).render()}}),c=Backbone.View.extend({events:{"change input":"enableSave","change textarea":"enableSave","change select":"enableSave","click .media-modal-backdrop":"close","click .media-modal-close":"close","click .media-modal-prev":"edit","click .media-modal-next":"edit","click .media-modal-tab":"tab","change .media-modal-parent":"parent","change .media-modal-render-tabs":"renderTabs","change #datepicker-enhance-bahaviour":"renderPanels","change #datepicker-date-limit":"renderPanels",'change .media-modal-render-panels input[type="text"]':"renderPanels","change .media-modal-render-info":"renderInfo","submit .media-modal-form":"submit"},templates:{},initialize(){_.bindAll(this,"open","tab","edit","load","render","close","submit","parent"),this.init(),this.open()},init(){this.templates.window=wp.template("wooccm-modal-main")},assign(e,t){e.setElement(this.$(t)).render()},updateModel(e){e&&e.preventDefault();const t=this.$el.find("#wooccm_modal").find("form"),a=_.getFormData(t);this.model.set(a)},reload(e){this.$el.find("#wooccm_modal").hasClass("reload")?location.reload():this.remove()},close(t){t.preventDefault(),this.undelegateEvents(),e(document).off("focusin"),e("body").removeClass("modal-open"),this.$el.find("#wooccm_modal").addClass("reload"),this.reload(t)},enableSave(t){e(".media-modal-submit").prop("disabled",!1),this.updateModel(t)},disableSave(t){e(".media-modal-submit").prop("disabled",!0)},tab(t){t.preventDefault();const a=this.$el.find("#wooccm_modal"),o=e(t.currentTarget),n=a.find("ul.wc-tabs"),i=o.find("a").attr("href").replace("#","");n.find(".active").removeClass("active"),o.addClass("active"),this.model.attributes.panel=i,this.model.changed.panel=i,this.renderPanels(t)},renderTabs(e){this.renderPanels(e),this.tabs.render()},renderPanels(e){this.updateModel(e),this.panels.render()},render(){const e=this;e.$el.html(e.templates.window(e.model.attributes)),this.tabs=new s({model:e.model}),this.panels=new l({model:e.model}),this.info=new d({model:e.model}),this.assign(this.tabs,"#wooccm-modal-tabs"),this.assign(this.panels,"#wooccm-modal-panels"),this.assign(this.info,"#wooccm-modal-info")},open(t){e("body").addClass("modal-open").append(this.$el),null!=this.model.attributes.id?this.load():_.delay((function(){o()}),100)},load(){const t=this;null!=t.model.attributes.id?e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_load_field",nonce:wooccm_field.nonce,field_id:this.model.attributes.id},dataType:"json",type:"POST",complete(){o()},error(){alert("Error!")},success(e){console.log("response",e),e.success?(t.model.set(e.data),t.render()):alert(e.data)}}):t.render()},edit(o){o.preventDefault();let n=this,i=e(o.target),c=parseInt(e(".wc_gateways tr[data-field_id]").length),s=parseInt(n.model.get("order"));a++,t&&clearTimeout(t),t=setTimeout((function(){s=i.hasClass("media-modal-next")?Math.min(s+a,c):Math.max(s-a,1),n.model.set({id:parseInt(e(".wc_gateways tr[data-field_order="+s+"]").data("field_id"))}),a=0,n.load()}),300)},submit(t){t.preventDefault();const a=this,o=a.$el.find("#wooccm_modal"),n=o.find(".settings-save-status .spinner"),i=o.find(".settings-save-status .saved");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_save_field",nonce:wooccm_field.nonce,field_data:JSON.stringify(a.model.attributes)},dataType:"json",type:"POST",beforeSend(){e(".media-modal-submit").prop("disabled",!0),n.addClass("is-active")},complete(){i.addClass("is-active"),n.removeClass("is-active"),_.delay((function(){i.removeClass("is-active")}),1e3)},error(e){alert("Error!")},success(e){e.success?null==a.model.attributes.id&&(o.addClass("reload"),a.reload(t),a.close(t)):alert(e.data)}}),!1},renderInfo(){this.info.render()},parent(t){t.preventDefault();const a=this,o=a.$el.find("#wooccm_modal").find(".attachment-details");return this.updateModel(t),e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_load_parent",nonce:wooccm_field.nonce,conditional_parent_key:a.model.attributes.conditional_parent_key},dataType:"json",type:"POST",beforeSend(){a.disableSave(),o.addClass("save-waiting")},complete(){o.addClass("save-complete"),o.removeClass("save-waiting"),a.enableSave()},error(){alert("Error!")},success(e){e.success?(a.model.attributes.parent=e.data,a.model.changed.parent=e.data,a.renderInfo()):alert(e.data)}}),!1}}),s=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-tabs")},render(){this.model.attributes.panel="general",this.$el.html(this.templates.window(this.model.attributes))}}),l=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-panels")},render(){this.$el.html(this.templates.window(this.model.attributes)),this.$el.trigger("wooccm-enhanced-options"),this.$el.trigger("wooccm-enhanced-select"),this.$el.trigger("init_tooltips")}}),d=Backbone.View.extend({templates:{},initialize(){this.templates.window=wp.template("wooccm-modal-info")},render(){this.$el.html(this.templates.window(this.model.attributes)),this.$el.trigger("wooccm-enhanced-select"),this.$el.trigger("init_tooltips")}});e("#wooccm_billing_settings_add, #wooccm_shipping_settings_add, #wooccm_additional_settings_add").on("click",(function(e){e.preventDefault(),new i(e)})),e("#wooccm_billing_settings_reset, #wooccm_shipping_settings_reset, #wooccm_additional_settings_reset").on("click",(function(t){return t.preventDefault(),e(t.target),!!confirm(wooccm_field.message.reset)&&(e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_reset_fields",nonce:wooccm_field.nonce},dataType:"json",type:"POST",beforeSend(){},complete(){},error(){alert("Error!")},success(e){e.success?location.reload():alert(e.data)}}),!1)})),e(".wooccm_billing_settings_edit, .wooccm_shipping_settings_edit, .wooccm_additional_settings_edit").on("click",(function(e){e.preventDefault(),new i(e)})),e(".wooccm_billing_settings_delete, .wooccm_shipping_settings_delete, .wooccm_additional_settings_delete").on("click",(function(t){t.preventDefault();const a=e(t.target).closest("[data-field_id]"),o=a.data("field_id");return!!confirm(wooccm_field.message.remove)&&(e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_delete_field",nonce:wooccm_field.nonce,field_id:o},dataType:"json",type:"POST",beforeSend(){},complete(){},error(){alert("Error!")},success(e){e.success?a.remove():alert(e.data)}}),!1)})),e(document).on("click",".wooccm-field-toggle-attribute",(function(t){t.preventDefault();const a=e(this),o=a.closest("tr"),n=a.find(".woocommerce-input-toggle");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_toggle_field_attribute",nonce:wooccm_field.nonce,field_attr:e(this).data("field_attr"),field_id:o.data("field_id")},dataType:"json",type:"POST",beforeSend(e){n.addClass("woocommerce-input-toggle--loading")},success(e){!0===e.data?(n.removeClass("woocommerce-input-toggle--enabled, woocommerce-input-toggle--disabled"),n.addClass("woocommerce-input-toggle--enabled"),n.removeClass("woocommerce-input-toggle--loading")):!0!==e.data&&(n.removeClass("woocommerce-input-toggle--enabled, woocommerce-input-toggle--disabled"),n.addClass("woocommerce-input-toggle--disabled"),n.removeClass("woocommerce-input-toggle--loading"))}}),!1})),e(document).on("change",".wooccm-field-change-attribute",(function(t){t.preventDefault();const a=e(this),o=a.closest("tr");return e.ajax({url:wooccm_field.ajax_url,data:{action:"wooccm_change_field_attribute",nonce:wooccm_field.nonce,field_attr:a.data("field_attr"),field_value:a.val(),field_id:o.data("field_id")},dataType:"json",type:"POST",beforeSend(e){a.prop("disabled",!0)},success(e){console.log(e.data)},complete(e){a.prop("disabled",!1)}}),!1}))}(jQuery),(window.tiktok=window.tiktok||{}).backend=t})();