jQuery(document).ready(function(y){y(".menu-item-depth-0 .is-submenu").hide(),y("#submit-wechatlinkdiv").on("click",function(){var I=function(){y("a.item-edit").off("focus").on("focus",function(){y(this).off("keydown").on("keydown",function(e){var t,n=y(this),i=n.parents("li.menu-item").getItemData(),a=parseInt(e.which,10);if((37===a||38===a||39===a||40===a)&&(n.off("keydown"),1!==y("#menu-to-edit li").length)){switch(t={38:"up",40:"down",37:"left",39:"right"},y("body").hasClass("rtl")&&(t={38:"up",40:"down",39:"left",37:"right"}),t[e.which]){case"up":m(n,"up");break;case"down":m(n,"down");break;case"left":m(n,"left");break;case"right":m(n,"right")}return y("#edit-"+i["menu-item-db-id"]).focus(),!1}})})},g=function(){y(".menu-item-settings .field-move .menus-move").hide(),y("a.item-edit").data("needs_accessibility_refresh",!0),y(".menu-item-edit-active a.item-edit").each(function(){e(this)})},e=function(e){if(!0===y(e).data("needs_accessibility_refresh")){var t,n,i,a,m,s,u,d,r,l=y(e),o=l.closest("li.menu-item").first(),c=o.menuItemDepth(),h=0===c,p=l.closest(".menu-item-handle").find(".menu-item-title").text(),f=parseInt(o.index(),10),v=h?c:parseInt(c-1,10),b=o.prevAll(".menu-item-depth-"+v).first().find(".menu-item-title").text(),I=o.prevAll(".menu-item-depth-"+c).first().find(".menu-item-title").text(),g=y("#menu-to-edit li").length,w=o.nextAll(".menu-item-depth-"+c).length;o.find(".field-move").toggle(1<g),0!==f&&(t=o.find(".menus-move-up")).attr("aria-label",menus.moveUp).css("display","inline"),0!==f&&h&&(t=o.find(".menus-move-top")).attr("aria-label",menus.moveToTop).css("display","inline"),f+1!==g&&0!==f&&(t=o.find(".menus-move-down")).attr("aria-label",menus.moveDown).css("display","inline"),0===f&&0!==w&&(t=o.find(".menus-move-down")).attr("aria-label",menus.moveDown).css("display","inline"),h||(t=o.find(".menus-move-left"),n=menus.outFrom.replace("%s",b),t.attr("aria-label",menus.moveOutFrom.replace("%s",b)).text(n).css("display","inline")),0!==f&&o.find(".menu-item-data-parent-id").val()!==o.prev().find(".menu-item-data-db-id").val()&&(t=o.find(".menus-move-right"),n=menus.under.replace("%s",I),t.attr("aria-label",menus.moveUnder.replace("%s",I)).text(n).css("display","inline")),h?(a=(i=y(".menu-item-depth-0")).index(o)+1,g=i.length,m=menus.menuFocus.replace("%1$s",p).replace("%2$d",a).replace("%3$d",g)):(u=(s=o.prevAll(".menu-item-depth-"+parseInt(c-1,10)).first()).find(".menu-item-data-db-id").val(),d=s.find(".menu-item-title").text(),r=y('.menu-item .menu-item-data-parent-id[value="'+u+'"]'),a=y(r.parents(".menu-item").get().reverse()).index(o)+1,m=menus.subMenuFocus.replace("%1$s",p).replace("%2$d",a).replace("%3$s",d)),l.attr("aria-label",m).text(m),l.data("needs_accessibility_refresh",!1)}},m=function(e,t){var n,i,a,m=y("#menu-to-edit li"),s=m.length,u=e.parents("li.menu-item"),d=u.childMenuItems(),r=u.getItemData(),l=parseInt(u.menuItemDepth(),10),o=parseInt(u.index(),10),c=u.next(),h=c.childMenuItems(),p=parseInt(c.menuItemDepth(),10)+1,f=u.prev(),v=parseInt(f.menuItemDepth(),10),b=f.getItemData()["menu-item-db-id"];switch(t){case"up":if(i=o-1,0===o)break;0===i&&0!==l&&u.moveHorizontally(0,l),0!==v&&u.moveHorizontally(v,l),d?(n=u.add(d)).detach().insertBefore(m.eq(i)).updateParentMenuItemDBId():u.detach().insertBefore(m.eq(i)).updateParentMenuItemDBId();break;case"down":if(d){if(n=u.add(d),(h=0!==(c=m.eq(n.length+o)).childMenuItems().length)&&(a=parseInt(c.menuItemDepth(),10)+1,u.moveHorizontally(a,l)),s===o+n.length)break;n.detach().insertAfter(m.eq(o+n.length)).updateParentMenuItemDBId()}else{if(0!==h.length&&u.moveHorizontally(p,l),s===o+1)break;u.detach().insertAfter(m.eq(o+1)).updateParentMenuItemDBId()}break;case"top":if(0===o)break;d?(n=u.add(d)).detach().insertBefore(m.eq(0)).updateParentMenuItemDBId():u.detach().insertBefore(m.eq(0)).updateParentMenuItemDBId();break;case"left":if(0===l)break;u.shiftHorizontally(-1);break;case"right":if(0===o)break;if(r["menu-item-parent-id"]===b)break;u.shiftHorizontally(1)}e.focus(),I(),g()},t=y("#wechat-menu-item-url").val(),n=y("#wechat-menu-item-name").val(),i=y("#wechat-menu-item-attr-title").val(),a={action:"add_wechat_menu_item",menu:y("#menu").val(),"menu-settings-column-nonce":y("#menu-settings-column-nonce").val(),"menu-item":{"-1":{"menu-item-type":"wechat","menu-item-url":t,"menu-item-title":n,"menu-item-attr-title":i}}};y(".wechatlinkdiv .spinner").addClass("is-active"),y.post(ajaxurl,a,function(e){var t,n=y("#menu-instructions");e=y.trim(e),(t=y(e)).hideAdvancedMenuItemFields().appendTo(y("#menu-to-edit")),I(),g(),y(document).trigger("menu-item-added",[t]),y("li.pending").hide().fadeIn("slow"),y(".drag-instructions").show(),!n.hasClass("menu-instructions-inactive")&&n.siblings().length&&n.addClass("menu-instructions-inactive"),y(".wechatlinkdiv .spinner").removeClass("is-active"),y("#wechat-menu-item-name").val("").blur(),y("#wechat-menu-item-url").val("")})})});