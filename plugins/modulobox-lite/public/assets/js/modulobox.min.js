/**
 * ModuloBox PACKAGED v1.5.0
 * Touch & responsive multimedia Lightbox
 *
 * @author Themeone [https://theme-one.com/]
 * Copyright Â© 2016 All Rights Reserved.
 */
!function(){var t=window,e=0;t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame,t.requestAnimationFrame||(t.requestAnimationFrame=function(t){var i=(new Date).getTime(),s=Math.max(0,16-(i-e));return t=setTimeout(t,s),e=i+s,t}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(t,e){"function"==typeof define&&define.amd?define("themeone-utils/utils",e):"object"==typeof module&&module.exports?module.exports=e():t.ThemeoneUtils=e()}(this,function(){var t={},e=window.console;return t.error=function(t){void 0!==e&&e.error(t)},t.extend=function(t,e){if(t)if("object"!=typeof t)this.error("Custom options must be an object");else for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e[i]=t[i]);return e},t.prop=function(t){for(var e=this.createEl(),i=["","Webkit","Moz","ms","O"],s=0,n=i.length;s<n;s++){var o=i[s]?i[s]+t.charAt(0).toUpperCase()+t.slice(1):t;if(void 0!==e.style[o])return o}return""},t.cloneObject=function(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i},t.createEl=function(t,e){var i=document.createElement(t||"div");return e&&(i.className=e),i},t.camelize=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.handleEvents=function(t,e,i,s,n){"object"!=typeof this.event_handlers&&(this.event_handlers={}),this.event_handlers[s]||(this.event_handlers[s]=t[s].bind(t));var o=void 0===n||n?"addEventListener":"removeEventListener";i.forEach(function(t){e[o](t,this.event_handlers[s],!1)}.bind(this))},t.dispatchEvent=function(t,e,i,s,n){i+=e?"."+e:"",e=s?[s].concat(n):[n],t.emitEvent(i,e)},t.throttle=function(t,e){var i=null;return function(){var s=arguments,n=Date.now();(!i||n-i>=e)&&(i=n,t.apply(this,s))}},t.modulo=function(t,e){return(t+e%t)%t},t.classReg=function(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")},t.hasClass=function(t,e){return!!t.className.match(this.classReg(e))},t.addClass=function(t,e){this.hasClass(t,e)||(t.className+=(t.className?" ":"")+e)},t.removeClass=function(t,e){this.hasClass(t,e)&&(t.className=t.className.replace(this.classReg(e)," ").replace(/\s+$/,""))},t.translate=function(t,e,i,s){s=s?" scale("+s+","+s+")":"",t.style[this.browser.trans]=this.browser.gpu?"translate3d("+(e||0)+"px, "+(i||0)+"px, 0)"+s:"translate("+(e||0)+"px, "+(i||0)+"px)"+s},t.browser={trans:t.prop("transform"),gpu:!!t.prop("perspective")},t}),function(t,e){"function"==typeof define&&define.amd?define("themeone-event/event",e):"object"==typeof module&&module.exports?module.exports=e():t.ThemeoneEvent=e()}("undefined"!=typeof window?window:this,function(){var t=function(){},e=t.prototype;return e.on=function(t,e){if(!t||!e)return null;var i=this._events=this._events||{};return-1===(i=i[t]=i[t]||[]).indexOf(e)&&i.push(e),this},e.off=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length)return null;var s=i.indexOf(e);return-1!==s&&i.splice(s,1),this},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length)return null;var s=0,n=i[s];e=e||[];for(var o=this._onceEvents&&this._onceEvents[t];n;){var r=o&&o[n];r&&(this.off(t,n),delete o[n]),n.apply(this,e),n=i[s+=r?0:1]}return this},t}),function(t,e){"function"==typeof define&&define.amd?define("themeone-animate/animate",["themeone-utils/utils","themeone-event/event"],e):"object"==typeof module&&module.exports?module.exports=e(require("themeone-utils"),require("themeone-event")):t.ThemeoneAnimate=e(t.ThemeoneUtils,t.ThemeoneEvent)}(this,function(t,e){var i=function(t,e,i,s){this.element=t,this.defaults=e,this.forces={friction:i||.28,attraction:s||.028},this.resetAnimate()},s=i.prototype=Object.create(e.prototype);return s.updateDrag=function(t){this.move=!0,this.drag=t},s.releaseDrag=function(){this.move=!1},s.animateTo=function(t){this.attraction=t},s.startAnimate=function(){this.move=!0,this.settle=!1,this.restingFrames=0,this.RAF||this.animate()},s.stopAnimate=function(){this.move=!1,this.restingFrames=0,this.RAF&&(cancelAnimationFrame(this.RAF),this.RAF=!1),this.start=t.cloneObject(this.position),this.velocity={x:0,y:0,s:0}},s.resetAnimate=function(){this.stopAnimate(),this.settle=!0,this.drag=t.cloneObject(this.defaults),this.start=t.cloneObject(this.defaults),this.resting=t.cloneObject(this.defaults),this.position=t.cloneObject(this.defaults),this.attraction=t.cloneObject(this.defaults)},s.animate=function(){var e=function(){if(void 0!==this.position){var i=t.cloneObject(this.position);this.applyDragForce(),this.applyAttractionForce(),t.dispatchEvent(this,"toanimate","render",this),this.integratePhysics(),this.getRestingPosition(),this.render(100),this.RAF=requestAnimationFrame(e),this.checkSettle(i)}}.bind(this);this.RAF=requestAnimationFrame(e)},s.integratePhysics=function(){for(var t in this.position)void 0!==this.position[t]&&(this.position[t]+=this.velocity[t],this.position[t]="s"===t?Math.max(.1,this.position[t]):this.position[t],this.velocity[t]*=this.getFrictionFactor())},s.applyDragForce=function(){if(this.move)for(var t in this.drag)void 0!==this.drag[t]&&this.applyForce(t,this.drag[t]-this.position[t]-this.velocity[t])},s.applyAttractionForce=function(){if(!this.move)for(var t in this.attraction)void 0!==this.attraction[t]&&this.applyForce(t,(this.attraction[t]-this.position[t])*this.forces.attraction)},s.getRestingPosition=function(){for(var t in this.position)void 0!==this.position[t]&&(this.resting[t]=this.position[t]+this.velocity[t]/(1-this.getFrictionFactor()))},s.applyForce=function(t,e){this.velocity[t]+=e},s.getFrictionFactor=function(){return 1-this.forces.friction},s.roundValues=function(t,e){for(var i in t)void 0!==t[i]&&(e="s"===i?100*e:e,t[i]=Math.round(t[i]*e)/e)},s.checkSettle=function(e){if(!this.move){var i,s=0;for(i in this.position)if(void 0!==this.position[i]){var n="s"===i?1e4:100;Math.round(this.position[i]*n)===Math.round(e[i]*n)&&(++s===Object.keys(this.position).length&&this.restingFrames++)}}2<this.restingFrames&&(this.stopAnimate(),this.render(1<this.position.s?10:1),this.settle=!0,JSON.stringify(this.start)!==JSON.stringify(this.position)&&t.dispatchEvent(this,"toanimate","settle",this))},s.render=function(e){this.roundValues(this.position,e),t.translate(this.element,this.position.x,this.position.y,this.position.s)},i}),function(t,e){"function"==typeof define&&define.amd?define(["themeone-utils/utils","themeone-event/event","themeone-animate/animate"],e):"object"==typeof exports&&module.exports?module.exports=e(require("themeone-utils"),require("themeone-event"),require("themeone-animate")):t.ModuloBox=e(t.ThemeoneUtils,t.ThemeoneEvent,t.ThemeoneAnimate)}(this,function(t,e,i){var s=0,n={},o="mobx"+("1.5.0"+Math.random()).replace(/\D/g,""),r={uid:0},a={mediaSelector:".mobx",threshold:5,attraction:{slider:.055,slide:.018},friction:{slider:.62,slide:.18},rightToLeft:!1,loop:3,preload:1,unload:!1,timeToIdle:4e3,fadeIfSettle:!1,controls:["close"],prevNext:!0,prevNextTouch:!1,counterMessage:"[index] / [total]",caption:!0,autoCaption:!1,captionSmallDevice:!0,spacing:.1,smartResize:!0,overflow:!1,loadError:"Sorry, an error occured while loading the content...",noContent:"Sorry, no content was found!",prevNextKey:!0,escapeToClose:!0,dragToClose:!0,tapToClose:!0},h=function(e){var i=document.querySelector(".mobx-holder");if(i&&i.GUID)return n[i.GUID];this.options=t.extend(e,a),this.setVar()};return(e=h.prototype=Object.create(e.prototype)).init=function(){this.GUID||(this.createDOM(),this.setAnimation(),this.getGalleries(),this.GUID=++s,this.DOM.holder.GUID=s,n[this.GUID]=this)},e.setVar=function(){var t=window,e=navigator;this.pre="mobx",this.gesture={},this.buttons={},this.slider={},this.slides={},this.cells={},this.states={},this.pointers=[],this.expando=o,this.cache=r,this.dragEvents=this.detectPointerEvents(),this.browser={touchDevice:"ontouchstart"in t||0<e.maxTouchPoints||0<e.msMaxTouchPoints}},e.detectPointerEvents=function(){var t=navigator;return t.pointerEnabled?{start:["pointerdown"],move:["pointermove"],end:["pointerup","pointercancel"]}:t.msPointerEnabled?{start:["MSPointerDown"],move:["MSPointerMove"],end:["MSPointerUp","MSPointerCancel"]}:{start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","mouseleave","touchend","touchcancel"]}},e.createDOM=function(){this.DOM={};for(var e="holder overlay slider item item-inner ui top-bar bottom-bar counter caption caption-inner".split(" "),i=0;i<e.length;i++)this.DOM[t.camelize(e[i])]=t.createEl("div",this.pre+"-"+e[i]);this.appendDOM(this.DOM)},e.appendDOM=function(e){var i=this.options;e.holder.appendChild(e.overlay),e.holder.appendChild(e.slider),e.holder.appendChild(e.ui);for(var s=0;5>s;s++){var n=e.item.cloneNode(!0);n.appendChild(e.itemInner.cloneNode(!0)),e.slider.appendChild(n),this.slides[s]=n}this.slides.length=e.slider.children.length,this.createUI(e,i),e.holder.setAttribute("tabindex",-1),e.holder.setAttribute("aria-hidden",!0),this.DOM.comment=document.createComment(" ModuloBox (v1.5.0) by Themeone "),document.body.appendChild(this.DOM.comment),t.dispatchEvent(this,"modulobox","beforeAppendDOM",e),document.body.appendChild(e.holder),e.topBar.height=e.topBar.clientHeight},e.createUI=function(t,e){if((e.controls.length||e.counterMessage)&&(t.ui.appendChild(t.topBar),e.counterMessage&&t.topBar.appendChild(t.counter),e.controls.length)){var i=e.controls.slice();this.createButtons(i.reverse(),t.topBar)}e.caption&&(t.ui.appendChild(t.bottomBar),e.caption&&t.bottomBar.appendChild(t.caption).appendChild(t.captionInner)),e.prevNext&&this.createButtons(["prev","next"],t.ui)},e.createButtons=function(e,i,s){for(var n=e.length,o=0;o<n;o++){var r=e[o];this.buttons[r]=t.createEl("BUTTON",this.pre+"-"+r.toLowerCase()),i.appendChild(this.buttons[r]),(r&&"function"==typeof this[r]||s)&&(this.buttons[r].event=s||r,this.buttons[r].action=r)}},e.getGalleries=function(){this.galleries={};var e=this.options.mediaSelector,i="";if(!e)return!1;try{i=document.querySelectorAll(e)}catch(i){t.error('Your current mediaSelector is not a valid selector: "'+e+'"')}e=0;for(var s=i.length;e<s;e++){var n=i[e],o={};if(o.src="A"===n.tagName?n.getAttribute("href"):null,o.src="IMG"===n.tagName?n.currentSrc||n.src:o.src,o.src=n.getAttribute("data-src")||o.src,o.src&&(this.getMediaAtts(n,o),this.setMediaType(o),o.type)){this.getMediaCaption(n,o),this.setMediaCaption(o);var r=this.setGalleryName(n);o.index=r.length,r.push(o),this.setMediaEvent(n,r.name,o.index)}}t.dispatchEvent(this,"modulobox","updateGalleries",this.galleries)},e.addMedia=function(e,i){if(!i||"object"!=typeof i)return t.error("No media was found to addMedia() in a gallery"),!1;e=""===e?1:e;var s=this.galleries[e];(s=s||(this.galleries[e]=[])).name=e;for(var n=i.length,o=0;o<n;o++){var r=t.cloneObject(i[o]);r.src&&(this.setMediaType(r),this.setMediaCaption(r),r.index=s.length,s.push(r))}},e.setMediaType=function(t){if("image"!==t.type){t.type=null;var e=t.src?t.src:null,i=(e.split(/[?#]/)[0]||e).substr(2+(~-e.lastIndexOf(".")>>>0));(/(jpg|jpeg|png|bmp|gif|tif|tiff|jfi|jfif|exif|svg)/i.test(i)||-1<["external.xx.fbcdn","drscdn.500px.org"].indexOf(e))&&(t.type="image",t.src=this.getSrc(e))}},e.getSrc=function(t){var e=(t||"").split(/,/),i=e.length,s=0;if(1>=i)return t;for(var n=0;n<i;n++){var o=e[n].replace(/\s+/g," ").trim().split(/ /),r=parseFloat(o[1])||0;("w"===(o[1]?o[1].slice(-1):null)&&screen.width>=r&&r>s||!r||0===n)&&(s=r,t=o[0])}return t},e.getMediaAtts=function(t,e){var i=this.options.autoCaption,s=this.getAttr(t),n=t.firstElementChild;n="IMG"!==t.tagName&&n&&"IMG"===n.tagName?n:t,e.type=e.type?e.type:s.type||t.getAttribute("data-type"),e.title=s.title||t.getAttribute("data-title")||(i?n.title:null),e.desc=s.desc||t.getAttribute("data-desc")||(i?n.alt:null),e.width=s.width||t.getAttribute("data-width"),e.height=s.height||t.getAttribute("data-height"),e.title===e.desc&&(e.desc=null)},e.getMediaCaption=function(t,e){var i=t.nextElementSibling;i&&"FIGCAPTION"===i.tagName&&(i=i.innerHTML,e.title?e.desc||(e.desc=i):e.title=i)},e.setMediaCaption=function(t){t.title=t.title?'<div class="'+this.pre+'-title">'+t.title.trim()+"</div>":"",t.desc=t.desc?'<div class="'+this.pre+'-desc">'+t.desc.trim()+"</div>":"",t.caption=t.title+t.desc},e.getGalleryName=function(t){for(var e=0;t&&2>e;){if((t=t.parentNode)&&"FIGURE"===t.tagName&&t.parentNode)return t.parentNode.getAttribute("id");e++}},e.setGalleryName=function(t){var e=this.getAttr(t).rel||t.getAttribute("data-rel");return e=(e=e||this.getGalleryName(t))?e:Object.keys(this.galleries).length+1,(t=(t=this.galleries[e])?t:this.galleries[e]=[]).name=e,t},e.setMediaEvent=function(t,e,i){t.mobxListener&&t.removeEventListener("click",t.mobxListener,!1),t.mobxListener=this.open.bind(this,e,i),t.addEventListener("click",t.mobxListener,!1),"undefined"!=typeof jQuery&&jQuery(t).on("click",t.mobxListener)},e.open=function(e,i,s){return s&&(s.preventDefault(),s.stopPropagation()),!!this.GUID&&(this.galleries.hasOwnProperty(e)?this.galleries[e].length?this.galleries[e][i]?(t.dispatchEvent(this,"modulobox","beforeOpen",e,i),this.slides.index=i,this.gallery=this.galleries[e],this.gallery.name=e,this.gallery.index=i,this.gallery.loaded=!1,this.removeContent(),this.wrapAround(),this.setSlider(),this.setCaption(),this.setMedia(this.options.preload),this.updateMediaInfo(),this.setControls(),this.bindEvents(!0),this.show(),void(this.states.open=!0)):(t.error("Sorry, no media was found for the current media index: "+i),!1):(t.error("Sorry, no media was found for the current gallery."),!1):(t.error('This gallery name : "'+e+'", does not exist!'),!1))},e.show=function(){var e=this.DOM.holder,i=this.options.rightToLeft?"add":"remove";e.setAttribute("aria-hidden",!1),t.removeClass(e,this.pre+"-idle"),t.removeClass(e,this.pre+"-will-close"),t[i+"Class"](e,this.pre+"-rtl"),t.addClass(e,this.pre+"-open")},e.close=function(e){e&&e.preventDefault(),e=this.DOM.holder;var i=this.gallery;t.dispatchEvent(this,"modulobox","beforeClose",i?i.name:"undefined",i?i.index:"undefined"),this.bindEvents(!1),e.setAttribute("aria-hidden",!0),t.removeClass(e,this.pre+"-open"),this.states.open=!1},e.setControls=function(){this.DOM.counter&&(this.DOM.counter.style.display=1<this.gallery.initialLength?"":"none"),this.setPrevNextButtons()},e.setPrevNextButtons=function(){if(this.options.prevNext){var t=680>this.slider.width&&this.browser.touchDevice&&!this.options.prevNextTouch;this.buttons.prev.style.display=this.buttons.next.style.display=1<this.gallery.length&&!t?"":"none"}},e.setCaption=function(){this.states.caption=!(!this.options.captionSmallDevice&&(480>=this.slider.width||480>=this.slider.height)),this.DOM.caption.style.display=this.states.caption?"":"none"},e.bindEvents=function(e){var i,s=window,n=this.options,o=this.DOM.holder,r=this.buttons;for(i in r)r.hasOwnProperty(i)&&t.handleEvents(this,r[i],["click","touchend"],r[i].event,e);t.handleEvents(this,o,this.dragEvents.start,"touchStart",e),t.handleEvents(this,s,["keydown"],"keyDown",e),t.handleEvents(this,s,["resize","orientationchange"],"resize",e),t.handleEvents(this,o,["transitionend","webkitTransitionEnd","oTransitionEnd","otransitionend","MSTransitionEnd"],"opened"),t.handleEvents(this,o,["touchend"],"disableZoom",e),0<n.timeToIdle&&t.handleEvents(this,o,["mousemove"],"mouseMove",e)},e.opened=function(e){if("visibility"===e.propertyName&&e.target===this.DOM.holder){e=this.gallery.name;var i=this.gallery.index;this.states.open?t.dispatchEvent(this,"modulobox","afterOpen",e,i):(this.removeContent(),t.dispatchEvent(this,"modulobox","afterClose",e,i))}},e.mouseMove=function(){var e=this.DOM.holder,i=this.pre+"-idle";clearTimeout(this.states.idle),this.states.idle=setTimeout(function(){t.addClass(e,i)}.bind(this),this.options.timeToIdle),t.removeClass(e,i)},e.disableZoom=function(t){for(var e=t.target;e;){if(-1<["VIDEO","INPUT","A"].indexOf(e.tagName))return;e=e.parentElement}t.preventDefault()},e.resize=function(e){this.DOM.topBar.height=this.DOM.topBar.clientHeight,this.setSlider(),this.setCaption(),this.resizeMedia(),this.updateMediaInfo(),this.setPrevNextButtons(),t.dispatchEvent(this,"modulobox","resize",e)},e.resizeMedia=function(){for(var t=this.slides,e=0;e<t.length&&this.gallery;e++){var i=this.gallery[t[e].media];i&&i.dom&&i.dom.loaded&&this.setMediaSize(i,t[e])}},e.isEl=function(t){return-1<(t="string"==typeof(t=t.target.className)?t:t.baseVal).indexOf(this.pre)},e.isRTL=function(){return this.options.rightToLeft?-1:1},e.addAttr=function(t,e){if(void 0===t[this.expando]){var i=this.cache.uid++;t[this.expando]=i,this.cache[i]={}}else i=t[this.expando];for(var s in e)e.hasOwnProperty(s)&&(this.cache[i][s]=e[s])},e.getAttr=function(t){return this.cache[t[this.expando]]||{}},e.getMedia=function(){var t=this.gallery;return t?t[t.index]:null},e.getCell=function(){var e=this.slides;return e=t.modulo(e.length,e.index),this.cells[e]},e.removeContent=function(){for(var t=0;t<this.slides.length;t++){var e=this.slides[t];this.unloadMedia(e),this.removeMedia(e),e.index=e.media=null}},e.insertMedia=function(t,e){var i=this.gallery[t];i&&(void 0===i.index&&(i.index=this.gallery.indexOf(i)),this.buildMedia(i),this.appendMedia(i,e),this.loadMedia(i,e))},e.buildMedia=function(e){void 0===e.dom&&("image"==e.type&&(e.dom=t.createEl("img",this.pre+"-img"),e.dom.src=e.src),e.type&&e.src||(e.dom=t.createEl("div",this.pre+"-error"),e.dom.textContent=this.options.noContent,e.dom.loaded=!0,e.dom.error=!0,t.dispatchEvent(this,"modulobox","noContent",this.gallery.name,parseInt(e.index,10))))},e.appendMedia=function(e,i){var s=this.slides[i],n=s.firstChild;if(n.childElementCount){var o=n.lastChild,r=n.firstChild;r.style.visibility="",e.dom!==o&&n[1===n.childElementCount?"appendChild":"replaceChild"](e.dom,o)}else o=document.createDocumentFragment(),r=t.createEl("div",this.pre+"-loader"),o.appendChild(r),o.appendChild(e.dom),n.appendChild(o);s.media=e.index},e.loadMedia=function(e,i){if(e.dom.loaded)this.showMedia(e,i);else{var s=this,n=e.dom.img=new Image,o=function(){e.dom.error||t.dispatchEvent(s,"modulobox","loadComplete",s.gallery.name,parseInt(e.index,10)),e.dom.loaded=!0,s.showMedia(e,i)};n.onload=o,n.onerror=function(){e.dom=t.createEl("p",s.pre+"-error"),e.dom.textContent=s.options.loadError,e.dom.error=!0,s.appendMedia(e,i),t.dispatchEvent(s,"modulobox","loadError",s.gallery.name,parseInt(e.index,10)),o()},n.src=e.src}},e.unloadMedia=function(t){this.gallery&&(t=this.gallery[t.media])&&t.dom&&this.options.unload&&"image"===t.type&&!t.dom.loaded&&!t.dom.complete&&!t.dom.naturalWidth&&(t.dom.onload=null,t.dom.onerror=null,t.dom.src="",t.dom.img&&(t.dom.img.onload=null,t.dom.img.onerror=null,t.dom.img.src="",delete t.dom.img),delete t.dom)},e.removeMedia=function(t){if(t=t.firstChild)for(;t.firstChild;)t.removeChild(t.firstChild)},e.showMedia=function(e,i){var s=this.slider;if(!this.options.fadeIfSettle||s.settle||e.dom.revealed){s=this.slides[i];var n=this.gallery,o=s.firstChild.firstChild,r=this.options.preload;this.setMediaSize(e,s),t.addClass(e.dom,this.pre+"-media-loaded"),e.dom.revealed=!0,s.media===e.index&&(o.style.visibility="hidden",n.loaded+=1,n.loaded===r&&4>r&&this.setMedia(r+2))}},e.setMediaSize=function(t,e){var i=t.dom,s=this.slider,n=i.viewport;i.error||(n&&n.width===s.width&&n.height===s.height||(this.getCaptionHeight(t,e),this.getMediaSize(t,e),this.fitMediaSize(t,e),this.setMediaOffset(t,e)),(s=i.style).width=i.size.width+"px",s.height=i.size.height+"px",s.left=i.offset.left+"px",s.top=i.offset.top+"px")},e.getCaptionHeight=function(t,e){var i=this.DOM.captionInner,s=this.DOM.topBar.height,n=i.innerHTML;this.options.caption&&this.states.caption&&t.caption?(i.innerHTML=t.caption,i.height=Math.max(s,parseInt(i.clientHeight,10))||s,i.innerHTML=n):i.height=s,e.width=this.slider.width,e.height=this.slider.height-s-i.height},e.getMediaSize=function(t,e){var i=t.dom.size={};i.width=t.dom.naturalWidth,i.height=t.dom.naturalHeight},e.fitMediaSize=function(t,e){var i,s,n=this.slider,o=this.options,r=t.dom.size,a=r.width/r.height,h=480>=n.width||680>=n.height,d=[e.height];(o.smartResize&&h||o.overflow)&&d.unshift(n.height),d.forEach(function(t){(!s||s<n.height)&&(i=(i=Math.min(r.width,a*t))>e.width?e.width:Math.round(i),s=2>(s=Math.ceil(1/a*i))%t?t:s)}),t.dom.size={width:i,height:s}},e.setMediaOffset=function(t,e){var i=t.dom.size,s=this.slider,n=this.DOM.topBar.height,o=0;i.height<=e.height&&(o=n+.5*(e.height-i.height)),t.dom.offset={top:0>o?0:Math.round(o),left:Math.round(.5*(e.width-i.width))},t.dom.viewport={width:s.width,height:s.height}},e.setMedia=function(e){var i,s=this.gallery,n=this.slides,o=this.states.loop,r=this.isRTL(),a=Math.round(-r*this.slider.position.x/n.width),h=s.initialLength-1,d=0;if(r=[],!e&&!s.loaded){for(i=e=0;i<n.length;i++)n[i].firstChild.childElementCount&&e++;e+=2,s.loaded=this.options.preload}switch(e){case 0:case 1:r=[0];break;case 2:case 3:r=[-1,0,1];break;default:e=5,r=[-2,-1,0,1,2]}for(o||(i=a+r[e-1],e=a+r[0],d=0>e?-e:0,d=i>h?h-i:d),r=r.map(function(e){return t.modulo(s.length,e+d+a)}),i=0;i<n.length;i++)h=n[i],e=t.modulo(s.length,h.index),!o&&h.index>e||!(-1<r.indexOf(e))||h.media===e||(this.unloadMedia(h),this.insertMedia(e,i))},e.updateMediaInfo=function(){var e=this.gallery;e.index=t.modulo(e.length,this.slides.index),this.updateCounter(),this.updateCaption(),t.dispatchEvent(this,"modulobox","updateMedia",this.getMedia())},e.updateCaption=function(){if(this.options.caption){var t=this.getMedia();t=t.caption?t.caption:"";var e=this.DOM.captionInner;e.innerHTML!==t&&(e.innerHTML=t)}},e.updateCounter=function(){if(this.options.counterMessage){var e=this.gallery,i=e.initialLength;e=t.modulo(i,e.index),i=this.options.counterMessage.replace("[index]",e+1).replace("[total]",i),(e=this.DOM.counter).textContent!==i&&(e.textContent=i)}},e.wrapAround=function(){var e=this.options.loop,i=this.gallery,s=i.length;if(i.initialLength||(i.initialLength=s),this.states.loop=!!(e&&e<=s),this.states.loop&&s<this.slides.length){e=Math.ceil(this.slides.length/s)*s-s;for(var n=0;n<e;n++){var o=s+n;i[o]=t.cloneObject(i[t.modulo(s,n)]),i[o].index=o}}},e.setSlider=function(){var t=this.slider,e=this.slides;this.setSizes(t,e),this.setSliderPosition(t,e),this.setSlidesPositions(e),this.DOM.overlay.style.opacity=1},e.setSizes=function(t,e){t.width=document.body.clientWidth,t.height=window.innerHeight,e.width=t.width+Math.round(t.width*this.options.spacing)},e.setSlidesPositions=function(t){for(var e=0;e<t.length;e++)t[e].position=null,this.setCellPosition(e);this.shiftSlides()},e.setCellPosition=function(e){this.cells[e].resetAnimate(),t.translate(this.slides[e].children[0],0,0,1)},e.setSliderPosition=function(e,i){var s=this.options.rightToLeft,n=-i.index*i.width;n=s?-n:n,e.resetAnimate(),e.position.x=e.attraction.x=n,e.bound={left:0,right:-(this.gallery.length-1)*i.width},s&&(e.bound.left=-e.bound.right,e.bound.right=0),t.translate(this.DOM.slider,n,0)},e.setAnimation=function(){var t=this.DOM.slider,e=this.options.friction,s=this.options.attraction;this.slider=new i(t,{x:0,y:0},Math.min(Math.max(e.slider,0),1),Math.min(Math.max(s.slider,0),1)),this.slider.on("settle.toanimate",this.settleSider.bind(this)),this.slider.on("render.toanimate",this.renderSlider.bind(this));for(var n=(t=t.children).length,o=0;o<n;o++)this.cells[o]=new i(t[o].children[0],{x:0,y:0,s:1},Math.min(Math.max(e.slide,0),1),Math.min(Math.max(s.slide,0),1)),this.cells[o].on("settle.toanimate",this.settleCell.bind(this)),this.cells[o].on("render.toanimate",this.renderCell.bind(this))},e.settleSider=function(e){if(t.dispatchEvent(this,"modulobox","sliderSettled",e.position),this.states.open&&this.setMedia(),this.options.fadeIfSettle)for(var i=this.slides,s=0;s<i.length;s++)e=this.gallery[i[s].media],e.dom.loaded&&this.showMedia(e,s)},e.settleCell=function(e){this.gesture.closeBy&&t.dispatchEvent(this,"modulobox","panYSettled",null,e.position)},e.renderSlider=function(e){this.shiftSlides();var i=this.isRTL(),s=this.gallery.initialLength;e=t.modulo(s,-i*e.position.x/this.slides.width),t.dispatchEvent(this,"modulobox","sliderProgress",null,Math.min(1,Math.max(0,(e>s-.5?0:e)/(s-1))))},e.renderCell=function(e){this.willClose(e),("panY"===this.gesture.type||this.gesture.closeBy||"dragSlider"===this.gesture.type&&0!==e.position.y)&&(e=1-Math.abs(e.position.y)/(.5*this.slider.height),t.dispatchEvent(this,"modulobox","panYProgress",null,e))},e.touchStart=function(e){var i=e.target.tagName;3===e.which||!this.isEl(e)||-1<["BUTTON","INPUT","A"].indexOf(i)||("IMG"===i&&1<this.gallery.length&&t.addClass(this.DOM.holder,this.pre+"-dragging"),e.preventDefault(),this.pointers.length||(this.gesture.canClose=void 0,t.handleEvents(this,window,this.dragEvents.move,"touchMove"),t.handleEvents(this,window,this.dragEvents.end,"touchEnd")),this.addPointer(e),this.slider.stopAnimate(),e=this.getCell(),(1!=Math.round(100*e.position.s)/100||2===this.pointers.length||this.gesture.closeBy)&&e.stopAnimate(),this.gestures("start"))},e.touchMove=function(e){this.updatePointer(e);var i=this.gesture,s=this.isSliderSettle();if(this.gestures("move"),i.type)this[i.type](e),t.dispatchEvent(this,"modulobox",i.type+"Move",e,i),i.move=!0;else if(Math.abs(i.dx)>this.options.threshold||Math.abs(i.dy)>this.options.threshold){if(i.sx+=i.dx,i.sy+=i.dy,i.closeBy=!1,i.type=!(Math.abs(i.dx)<Math.abs(i.dy)/2)&&"dragSlider",i.type=this.options.dragToClose&&!i.type&&s?"panY":i.type,"dragSlider"===i.type&&this.setMedia(),-1<["dragSlider"].indexOf(i.type)&&((s=this.getCell()).startAnimate(),s.releaseDrag(),s.animateTo({x:0,y:0,s:1})),"dragSlider"!==i.type){s=this.slider;var n=this.slides;-this.isRTL()*s.position.x!=n.index*n.width&&(s.startAnimate(),s.releaseDrag())}i.type&&(t.dispatchEvent(this,"modulobox",i.type+"Start",e,i),(1<this.gallery.length||"dragSlider"!==i.type)&&t.addClass(this.DOM.holder,this.pre+"-dragging"))}},e.touchEnd=function(e){if(this.deletePointer(e),!this.pointers.length){if(t.removeClass(this.DOM.holder,this.pre+"-dragging"),t.handleEvents(this,window,this.dragEvents.move,"touchMove",!1),t.handleEvents(this,window,this.dragEvents.end,"touchEnd",!1),this.isSliderSettle()){var i=e.target.className;if(this.options.tapToClose&&(i===this.pre+"-item-inner"||i===this.pre+"-top-bar")&&Math.abs(this.gesture.dx)<this.options.threshold)return void this.close()}i=this.gesture.type+"End",this.gesture.type&&"function"==typeof this[i]&&(this[i](e),t.dispatchEvent(this,"modulobox",i,e,this.gesture)),this.gesture.type=this.gesture.move=!1,this.states.open&&((e=this.getCell()).settle||(e.startAnimate(),e.releaseDrag()),(e=this.slider).settle||(e.startAnimate(),e.releaseDrag()))}},e.isSliderSettle=function(){if(this.gesture.type)return!1;var t=this.isRTL(),e=this.slides,i=e.width;return 3>=Math.abs(t*this.slider.position.x+e.index*i)/i*100},e.mapPointer=function(t){return t.touches?t.changedTouches:[t]},e.addPointer=function(t){t=this.mapPointer(t);for(var e=0;e<t.length;e++)if(2>this.pointers.length&&-1===["dragSlider","panY"].indexOf(this.gesture.type)){var i=t[e],s=void 0!==i.pointerId?i.pointerId:i.identifier;this.getPointer(s)||(this.pointers[this.pointers.length]={id:s,x:Math.round(i.clientX),y:Math.round(i.clientY)})}},e.updatePointer=function(t){t=this.mapPointer(t);for(var e=0;e<t.length;e++){var i=t[e],s=this.getPointer(void 0!==i.pointerId?i.pointerId:i.identifier);s&&(s.x=Math.round(i.clientX),s.y=Math.round(i.clientY))}},e.deletePointer=function(t){t=this.mapPointer(t);for(var e=0;e<t.length;e++){var i=t[e];i=void 0!==i.pointerId?i.pointerId:i.identifier;for(var s=0;s<this.pointers.length;s++)this.pointers[s].id===i&&this.pointers.splice(s,1)}},e.getPointer=function(t){for(var e in this.pointers)if(this.pointers[e].id===t)return this.pointers[e];return null},e.gestures=function(t){var e=this.gesture,i=this.pointers;if(i.length){if(e.direction=e.x?i[0].x>e.x?1:-1:0,e.x=i[0].x,e.y=i[0].y,2===i.length){var s=i[1].x;i=i[1].y;var n=this.getDistance([e.x,e.y],[s,i]);e.x-=(e.x-s)/2,e.y-=(e.y-i)/2}"start"===t?(e.dx=0,e.dy=0,e.sx=e.x,e.sy=e.y,e.distance=n||0):(e.dx=e.x-e.sx,e.dy=e.y-e.sy,e.scale=n&&e.distance?n/e.distance:1)}},e.getDistance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},e.panY=function(){var t=this.getCell();t.startAnimate(),t.updateDrag({x:t.position.x,y:t.start.y+this.gesture.dy,s:t.position.s})},e.panYEnd=function(){var t=this.getCell(),e=this.slider.height,i=t.resting.y;.8>1-Math.abs(i)/(.5*e)&&(e=Math.abs(i)<.5*e?Math.abs(i)/i*e*.5:i,this.close(),t.animateTo({x:0,y:e,s:e?t.resting.s:1}),t.startAnimate(),t.releaseDrag())},e.dragSlider=function(){if(1!==this.gallery.length){var t=this.slider,e=t.start.x+this.gesture.dx;if(!this.states.loop){var i=t.bound;this.gesture.move||(t.start.x+=e>i.left?e-i.left:e<i.right?e-i.right:0,e=t.start.x+this.gesture.dx),e=e>i.left?.5*(e+i.left):e<i.right?.5*(e+i.right):e}t.startAnimate(),t.updateDrag({x:e})}},e.dragSliderEnd=function(){if(1!==this.gallery.length){var t=this.slider,e=this.slides,i=e.index,s=this.isRTL();this.getRestingIndex(t.position.x,t.resting.x),i!==e.index&&this.updateMediaInfo(),this.slider.animateTo({x:-s*e.index*e.width,y:void 0,s:void 0}),t.startAnimate(),t.releaseDrag()}},e.getRestingIndex=function(t,e){var i=this.gesture.direction,s=this.gallery,n=this.slides,o=this.gesture.dx,r=this.isRTL(),a=Math.round(-r*t/n.width),h=Math.abs(e-t);Math.abs(o)<.5*n.width&&h&&(0<o&&0<i?a-=1*r:0>o&&0>i&&(a+=1*r)),i=Math.max(-1,Math.min(1,a-n.index)),!this.states.loop&&(0>s.index+i||s.index+i>s.length-1)||(n.index+=i)},e.shiftSlides=function(){var e=this.slides,i=this.gallery,s=this.states.loop,n=this.isRTL(),o=n*Math.round(-this.slider.position.x/e.width)-2,r=o+5;for(!s&&r>i.initialLength-1&&(r=(o=i.initialLength-5)+5),!s&&0>o&&(o=0,r=5),i=o;i<r;i++)s=n*i*e.width,o=t.modulo(e.length,i),o=e[o],(o.index!==i||o.position!==s)&&(o.index=i,o.position=s,o.style.left=s+"px");this.states.open&&this.setMedia(3)},e.willClose=function(e){var i=this.DOM.overlay.style.opacity,s=this.gesture.closeBy;"panY"===this.gesture.type||"panY"===s?(i=1-Math.abs(e.position.y)/(.5*this.slider.height),this.gesture.closeBy="panY"):i&&1>i&&(i=1,this.gesture.closeBy=!1),i=i?Math.max(0,Math.min(1,i)):1,t[(.8>=i||!i?"add":"remove")+"Class"](this.DOM.holder,this.pre+"-will-close"),this.DOM.overlay.style.opacity=i},e.prev=t.throttle(function(){this.gesture.move||this.slideTo(this.slides.index-1*this.isRTL())},120),e.next=t.throttle(function(){this.gesture.move||this.slideTo(this.slides.index+1*this.isRTL())},120),e.slideTo=function(e){var i=this.slides,s=this.gallery,n=this.DOM.slider,o=this.isRTL(),r=s.initialLength,a=t.modulo(r,e);s=a-(s=t.modulo(r,s.index));var h=r-Math.abs(s);!this.states.loop&&(0>e||e>this.gallery.initialLength-1)||(this.states.loop&&3>h&&2*h<r&&(s=0>s?h:-h),a===e&&(e=i.index+s),(s=e-i.index)&&(i.index=e,r=this.slider,2<Math.abs(s)&&(t.addClass(n,this.pre+"-hide"),this.setSliderPosition(r,i),this.setSlidesPositions(i),r.position.x=r.attraction.x=r.position.x+o*i.width*Math.min(2,Math.abs(s))*Math.abs(s)/s,t.translate(n,r.position.x,0),n.getClientRects()),this.updateMediaInfo(),t.removeClass(n,this.pre+"-hide"),r.startAnimate(),r.releaseDrag(),r.animateTo({x:-o*e*i.width,y:0,s:void 0})))},e.keyDown=function(t){var e=t.keyCode,i=this.options;i.prevNextKey&&(37===e?this.prev(t):39===e&&this.next(t)),27===e&&i.escapeToClose&&this.close()},e.destroy=function(){if(this.GUID){this.states.open&&this.close();var t=this.options.mediaSelector,e="";try{e=document.querySelectorAll(t)}catch(t){}t=0;for(var i=e.length;t<i;t++){var s=e[t];s.mobxListener&&(s.removeEventListener("click",s.mobxListener,!1),"undefined"!=typeof jQuery&&jQuery(s).off("click",s.mobxListener))}for(this.bindEvents(!1),this.slider.resetAnimate(),t=0;t<this.slides.length;t++)this.cells[t].resetAnimate();this.DOM.holder.parentNode.removeChild(this.DOM.holder),this.DOM.comment.parentNode.removeChild(this.DOM.comment),delete n[this.GUID],delete this.DOM.holder.GUID,delete this.GUID}},"undefined"!=typeof jQuery&&(jQuery.ModuloBox=function(t){return new h(t)}),h});
