<?php/** * 'apwp_player' Shortcode *  * @package Audio Player with Playlist Ultimate * @since 1.0.0 */if ( ! defined( 'ABSPATH' ) ) {	exit; // Exit if accessed directly}/** * Function to handle the `apwp_player` shortcode *  * @since 1.0 */function apwpultimate_shortcode( $atts, $content = null ) {	global $post, $apwpultimate_ultimate_options;	// Shortcode Parameter	extract(shortcode_atts(array(							'limit'			=> 10,							'audio_id'		=> '',							'playlist_id'	=> '',							'layout'		=> 'layout-1',							'playlist_hide'	=> false,							'order'			=> 'DESC',							'orderby'		=> 'date',	), $atts, 'apwp_player'));	$unique 			= apwpultimate_get_unique();	$shortcode_layout 	= apwpultimate_player_layout();	$limit 				= ! empty( $limit )					? $limit						: '10';	$audio_id			= ! empty( $audio_id )				? explode(',', $audio_id)		: array();	$playlist_id 		= ! empty( $playlist_id ) 			? explode(',', $playlist_id)	: '';	$layout 			= ( $layout && ( array_key_exists( trim( $layout ), $shortcode_layout ))) ? trim( $layout ) : 'layout-1';	$order				= ( strtolower( $order ) == 'asc')	? 'ASC'							: 'DESC';	$playlist_hide 		= ( $playlist_hide == 'true')		? true							: false;	$orderby			= ! empty( $orderby )				? $orderby						: 'date';	// Shortcode file	$design_file_path	= APWPULTIMATE_DIR . '/templates/playlist/' . $layout . '.php';	$design_file		= (file_exists($design_file_path)) ? $design_file_path : '';	// Taking some variables	$prefix = APWPULTIMATE_META_PREFIX; // Metabox prefix	// Enqueus required script	wp_enqueue_script( 'apwpultimate-jplayer-script' );	wp_enqueue_script( 'apwpultimate-jpplaylist-script');	wp_enqueue_script( 'apwpultimate-slimscroll-script' );	wp_enqueue_script( 'apwpultimate-public-script');	// WP Query Parameters	$args = array (		'post_type'			=> APWPULTIMATE_POST_TYPE,		'post_status'		=> array( 'publish' ),		'posts_per_page'	=> $limit,		'orderby'			=> $orderby,		'order'				=> $order,		'post__in'			=> $audio_id,	);	// Category Parameter	if( $playlist_id != "" ) {		$args['tax_query'] = array(			array(					'taxonomy'	=> APWPULTIMATE_CAT,					'field'		=> 'term_id',					'terms'		=> $playlist_id,				));	}	// WP Query Parameters	$query		= new WP_Query($args);	$post_count	= $query->post_count;	ob_start();	// If post is there	if ( $query->have_posts() ) { ?>		<div id="apwp-audio-player-wrp-<?php echo esc_attr($unique); ?>" class="apwp-audio-player-wrp apwp-jplayer-design-overide apwpultimate-clearfix apwpultimate-<?php echo esc_attr($layout); ?>" data-palyer="apwp-audio-player-<?php echo esc_attr($unique); ?>" data-id="<?php echo esc_attr($unique); ?>">				<?php			if( $design_file ) {				include( $design_file );			}			while ( $query->have_posts() ) : $query->the_post();				$title			= get_the_title( $post->ID );				$artist_name	= get_post_meta( $post->ID, $prefix.'artist_name', true );				$audio_file		= get_post_meta( $post->ID, $prefix.'audio_file', true );				$duration		= get_post_meta( $post->ID, $prefix.'duration', true );				$poster_image	= get_the_post_thumbnail_url( $post->ID, 'large' );				$record['playlist'][] = array(											'title'			=> wp_kses_post($title),											'artist_name'	=> esc_attr($artist_name),											'audio_file'	=> esc_url($audio_file),											'poster_image'	=> esc_url($poster_image),											'duration'		=> esc_attr($duration),											'playlistid'	=> 'playlistid-'.esc_attr($unique),										);			endwhile; ?>			<div class="apwpultimate-conf apwpultimate-hide"><?php echo htmlspecialchars(json_encode( $record )); ?></div>		</div>	<?php }	wp_reset_postdata(); // Reset WP Query	$content .= ob_get_clean();	return $content;}// 'audio player' shortcodeadd_shortcode('apwp_player', 'apwpultimate_shortcode');