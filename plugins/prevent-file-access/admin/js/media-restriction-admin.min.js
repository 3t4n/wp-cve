!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?module.exports=factory():root.Tagify=factory()}(this,(function(){"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);return Object.getOwnPropertySymbols&&keys.push.apply(keys,Object.getOwnPropertySymbols(object)),enumerableOnly&&(keys=keys.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++)if(i%2){var source=null!=arguments[i]?arguments[i]:{};ownKeys(source,!0).forEach((function(key){_defineProperty(target,key,source[key])}))}else Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(arguments[i])):ownKeys(source).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(arguments[i],key))}));return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function Tagify(input,settings){if(!input)return console.warn("Tagify: ","invalid input element ",input),this;this.applySettings(input,settings),this.state={},this.value=[],this.listeners={},this.DOM={},this.extend(this,new this.EventDispatcher(this)),this.build(input),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),input.autofocus&&this.DOM.input.focus()}return Tagify.prototype={isIE:window.document.documentMode,TEXTS:{empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},DEFAULTS:{delimiters:",",pattern:null,maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,keepInvalidTags:!1,autoComplete:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,backspace:!0,skipInvalid:!1,transformTag:function transformTag(){},dropdown:{classname:"",enabled:2,maxItems:10,itemTemplate:"",fuzzySearch:!0}},templates:{wrapper:function wrapper(input,settings){return'<tags class="tagify '.concat(settings.mode?"tagify--mix":""," ").concat(input.className,'"\n                          ').concat(settings.readonly?'readonly aria-readonly="true"':'aria-haspopup="true" aria-expanded="false"','\n                          role="tagslist">\n                <span contenteditable data-placeholder="').concat(input.placeholder||"&#8203;",'" aria-placeholder="').concat(input.placeholder||"",'"\n                      class="tagify__input"\n                      role="textbox"\n                      aria-multiline="false"></span>\n            </tags>')},tag:function tag(v,tagData){return"<tag title='".concat(tagData.title||v,"'\n                         contenteditable='false'\n                         spellcheck='false'\n                         class='tagify__tag ").concat(tagData.class?tagData.class:"","'\n                         ").concat(this.getAttributes(tagData),">\n                <x title='' class='tagify__tag__removeBtn' role='button' aria-label='remove tag'></x>\n                <div>\n                    <span class='tagify__tag-text'>").concat(v,"</span>\n                </div>\n            </tag>")},dropdownItem:function dropdownItem(item){var sanitizedValue=(item.value||item).replace(/`|'/g,"&#39;");return"<div ".concat(this.getAttributes(item),"\n                         class='tagify__dropdown__item ").concat(item.class?item.class:"",'\'\n                         tabindex="0"\n                         role="menuitem"\n                         aria-labelledby="dropdown-label">').concat(sanitizedValue,"</div>")}},customEventsList:["click","add","remove","invalid","input","edit"],applySettings:function applySettings(input,settings){var attr__whitelist=input.getAttribute("data-whitelist"),attr__blacklist=input.getAttribute("data-blacklist");if(this.DEFAULTS.templates=this.templates,this.DEFAULTS.dropdown.itemTemplate=this.templates.dropdownItem,this.settings=this.extend({},this.DEFAULTS,settings),this.settings.readonly=input.hasAttribute("readonly"),this.isIE&&(this.settings.autoComplete=!1),attr__blacklist&&(attr__blacklist=attr__blacklist.split(this.settings.delimiters))instanceof Array&&(this.settings.blacklist=attr__blacklist),attr__whitelist&&(attr__whitelist=attr__whitelist.split(this.settings.delimiters))instanceof Array&&(this.settings.whitelist=attr__whitelist),input.pattern)try{this.settings.pattern=new RegExp(input.pattern)}catch(e){}if(this.settings&&this.settings.delimiters)try{this.settings.delimiters=new RegExp(this.settings.delimiters,"g")}catch(e){}},parseHTML:function parseHTML(s){var parser,node;return(new DOMParser).parseFromString(s.trim(),"text/html").body.firstElementChild},escapeHTML:function escapeHTML(s){var text=document.createTextNode(s),p=document.createElement("p");return p.appendChild(text),p.innerHTML},build:function build(input){var that=this,DOM=this.DOM,template=this.settings.templates.wrapper(input,this.settings);DOM.originalInput=input,DOM.scope=this.parseHTML(template),DOM.input=DOM.scope.querySelector("[contenteditable]"),input.parentNode.insertBefore(DOM.scope,input),this.settings.dropdown.enabled>=0&&this.dropdown.init.call(this)},destroy:function destroy(){this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide.call(this,!0)},loadOriginalValues:function loadOriginalValues(){var value=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DOM.originalInput.value;if(value){this.removeAllTags();try{value=JSON.parse(value)}catch(err){}"mix"==this.settings.mode?this.parseMixTags(value):this.addTags(value).forEach((function(tag){tag&&tag.classList.add("tagify--noAnim")}))}},extend:function extend(o,o1,o2){function isObject(obj){var type=Object.prototype.toString.call(obj).split(" ")[1].slice(0,-1);return obj===Object(obj)&&"Array"!=type&&"Function"!=type&&"RegExp"!=type&&"HTMLUnknownElement"!=type}function copy(a,b){for(var key in b)b.hasOwnProperty(key)&&(isObject(b[key])?isObject(a[key])?copy(a[key],b[key]):a[key]=Object.assign({},b[key]):a[key]=b[key])}return o instanceof Object||(o={}),copy(o,o1),o2&&copy(o,o2),o},EventDispatcher:function EventDispatcher(instance){var target=document.createTextNode("");this.off=function(name,cb){return cb&&target.removeEventListener.call(target,name,cb),this},this.on=function(name,cb){return cb&&target.addEventListener.call(target,name,cb),this},this.trigger=function(eventName,data){var e;if(eventName)if(instance.settings.isJQueryPlugin)$(instance.DOM.originalInput).triggerHandler(eventName,[data]);else{try{e=new CustomEvent(eventName,{detail:data})}catch(err){console.warn(err)}target.dispatchEvent(e)}}},events:{customBinding:function customBinding(){var _this2=this;this.customEventsList.forEach((function(name){_this2.on(name,_this2.settings.callbacks[name])}))},binding:function binding(){var bindUnbind=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],_CB=this.events.callbacks,_CBR,action=bindUnbind?"addEventListener":"removeEventListener";for(var eventName in bindUnbind&&!this.listeners.main&&(this.DOM.input.addEventListener(this.isIE?"keydown":"input",_CB[this.isIE?"onInputIE":"onInput"].bind(this)),this.settings.isJQueryPlugin&&$(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),_CBR=this.listeners.main=this.listeners.main||{paste:["input",_CB.onPaste.bind(this)],focus:["input",_CB.onFocusBlur.bind(this)],blur:["input",_CB.onFocusBlur.bind(this)],keydown:["input",_CB.onKeydown.bind(this)],click:["scope",_CB.onClickScope.bind(this)],dblclick:["scope",_CB.onDoubleClickScope.bind(this)]})this.DOM[_CBR[eventName][0]][action](eventName,_CBR[eventName][1])},callbacks:{onFocusBlur:function onFocusBlur(e){var s=e.target.textContent.trim();"mix"!=this.settings.mode&&("focus"==e.type?(this.DOM.scope.classList.add("tagify--focus"),0===this.settings.dropdown.enabled&&this.dropdown.show.call(this)):"blur"==e.type?(this.DOM.scope.classList.remove("tagify--focus"),s&&this.settings.addTagOnBlur&&this.addTags(s,!0).length):(this.DOM.input.removeAttribute("style"),this.dropdown.hide.call(this)))},onKeydown:function onKeydown(e){var _this3=this,s=e.target.textContent,lastTag,tags;if("mix"==this.settings.mode){switch(e.key){case"Delete":case"Backspace":var values=[];tags=this.DOM.input.children,setTimeout((function(){[].forEach.call(tags,(function(tagElm){return values.push(tagElm.getAttribute("value"))})),_this3.value=_this3.value.filter((function(d){return-1!=values.indexOf(d.value)}))}),20);break;case"Enter":e.preventDefault()}return!0}switch(e.key){case"Backspace":""!=s&&8203!=s.charCodeAt(0)||(!0===this.settings.backspace?this.removeTag():"edit"==this.settings.backspace&&this.editTag());break;case"Esc":case"Escape":this.input.set.call(this),e.target.blur();break;case"ArrowRight":case"Tab":if(!s)return!0;case"Enter":e.preventDefault(),this.addTags(this.input.value||s,!0)}},onInput:function onInput(e){var value=this.input.normalize.call(this),showSuggestions=value.length>=this.settings.dropdown.enabled,data={value:value,inputElm:this.DOM.input};if("mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,e);value?this.input.value!=value&&(data.isValid=this.validateTag.call(this,value),this.input.set.call(this,value,!1),this.trigger("input",data),-1!=value.search(this.settings.delimiters)?this.addTags(value).length&&this.input.set.call(this):this.settings.dropdown.enabled>=0&&this.dropdown[showSuggestions?"show":"hide"].call(this,value)):this.input.set.call(this,"")},onMixTagsInput:function onMixTagsInput(e){var sel,range,split,tag,showSuggestions;if(this.maxTagsReached())return!0;window.getSelection&&(sel=window.getSelection()).rangeCount>0&&((range=sel.getRangeAt(0).cloneRange()).collapse(!0),range.setStart(window.getSelection().focusNode,0),(tag=(split=range.toString().split(this.settings.mixTagsAllowedAfter))[split.length-1].match(this.settings.pattern))&&(this.state.tag={prefix:tag[0],value:tag.input.split(tag[0])[1]},tag=this.state.tag,showSuggestions=this.state.tag.value.length>=this.settings.dropdown.enabled)),this.update(),this.trigger("input",this.extend({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[showSuggestions?"show":"hide"].call(this,this.state.tag.value)},onInputIE:function onInputIE(e){var _this=this;setTimeout((function(){_this.events.callbacks.onInput.call(_this,e)}))},onPaste:function onPaste(e){},onClickScope:function onClickScope(e){var tagElm=e.target.closest("tag"),tagElmIdx;"TAGS"==e.target.tagName?this.DOM.input.focus():"X"==e.target.tagName?this.removeTag(e.target.parentNode):tagElm&&(tagElmIdx=this.getNodeIndex(tagElm),this.trigger("click",{tag:tagElm,index:tagElmIdx,data:this.value[tagElmIdx]}))},onEditTagInput:function onEditTagInput(editableElm){var tagElm=editableElm.closest("tag"),tagElmIdx=this.getNodeIndex(tagElm),value=this.input.normalize(editableElm),isValid=value.toLowerCase()==editableElm.originalValue.toLowerCase()||this.validateTag(value);tagElm.classList.toggle("tagify--invalid",!0!==isValid),tagElm.isValid=isValid,this.trigger("input",{tag:tagElm,index:tagElmIdx,data:this.extend({},this.value[tagElmIdx],{newValue:value})})},onEditTagBlur:function onEditTagBlur(editableElm){var tagElm=editableElm.closest("tag"),tagElmIdx=this.getNodeIndex(tagElm),value=this.input.normalize(editableElm)||editableElm.originalValue,hasChanged=this.input.normalize(editableElm)!=editableElm.originalValue,isValid=tagElm.isValid,tagData=_objectSpread({},this.value[tagElmIdx],{value:value}),clone;hasChanged&&(this.settings.transformTag.call(this,tagData),isValid=this.validateTag(tagData.value)),void 0!==isValid&&!0!==isValid||(editableElm.textContent=tagData.value,this.value[tagElmIdx].value=tagData.value,this.update(),(clone=editableElm.cloneNode(!0)).removeAttribute("contenteditable"),tagElm.title=tagData.value,tagElm.classList.remove("tagify--editable"),editableElm.parentNode.replaceChild(clone,editableElm),this.trigger("edit",{tag:tagElm,index:tagElmIdx,data:this.value[tagElmIdx]}))},onEditTagkeydown:function onEditTagkeydown(e){switch(e.key){case"Esc":case"Escape":e.target.textContent=e.target.originalValue;case"Enter":case"Tab":e.preventDefault(),e.target.blur()}},onDoubleClickScope:function onDoubleClickScope(e){var tagElm=e.target.closest("tag"),_s=this.settings,isEditingTag=tagElm.classList.contains("tagify--editable"),isReadyOnlyTag=tagElm.hasAttribute("readonly");"mix"==_s.mode||_s.readonly||_s.enforceWhitelist||!tagElm||isEditingTag||isReadyOnlyTag||this.editTag(tagElm)}}},editTag:function editTag(){var _this4=this,tagElm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLastTag(),editableElm=tagElm.querySelector(".tagify__tag-text"),_CB=this.events.callbacks;editableElm?(tagElm.classList.add("tagify--editable"),editableElm.originalValue=editableElm.textContent,editableElm.setAttribute("contenteditable",!0),editableElm.addEventListener("blur",_CB.onEditTagBlur.bind(this,editableElm)),editableElm.addEventListener("input",_CB.onEditTagInput.bind(this,editableElm)),editableElm.addEventListener("keydown",(function(e){return _CB.onEditTagkeydown.call(_this4,e)})),editableElm.focus()):console.warn("Cannot find element in Tag template: ",".tagify__tag-text")},input:{value:"",set:function set(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",updateDOM=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.input.value=s,updateDOM&&(this.DOM.input.innerHTML=s),s||this.dropdown.hide.call(this),s.length<2&&this.input.autocomplete.suggest.call(this,""),this.input.validate.call(this)},setRangeAtStartEnd:function setRangeAtStartEnd(){var start=arguments.length>0&&void 0!==arguments[0]&&arguments[0],node=arguments.length>1?arguments[1]:void 0,range,selection;document.createRange&&((range=document.createRange()).selectNodeContents(node||this.DOM.input),range.collapse(start),(selection=window.getSelection()).removeAllRanges(),selection.addRange(range))},validate:function validate(){var isValid=!this.input.value||this.validateTag.call(this,this.input.value);this.DOM.input.classList.toggle("tagify__input--invalid",!0!==isValid)},normalize:function normalize(){var node=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DOM.input,clone=node,v=clone.innerText;return"settings"in this&&this.settings.delimiters&&(v=v.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(1))),v=v.replace(/\s/g," ").replace(/^\s+/,"")},autocomplete:{suggest:function suggest(s){s&&this.input.value?this.DOM.input.setAttribute("data-suggest",s.substring(this.input.value.length)):this.DOM.input.removeAttribute("data-suggest")},set:function set(s){var dataSuggest=this.DOM.input.getAttribute("data-suggest"),suggestion=s||(dataSuggest?this.input.value+dataSuggest:null);return!!suggestion&&(this.input.set.call(this,suggestion),this.input.autocomplete.suggest.call(this,""),this.dropdown.hide.call(this),this.input.setRangeAtStartEnd.call(this),!0)}}},getNodeIndex:function getNodeIndex(node){var index=0;if(node)for(;node=node.previousElementSibling;)index++;return index},getTagElms:function getTagElms(){return this.DOM.scope.querySelectorAll("tag")},getLastTag:function getLastTag(){var lastTag=this.DOM.scope.querySelectorAll("tag:not(.tagify--hide):not([readonly])");return lastTag[lastTag.length-1]},isTagDuplicate:function isTagDuplicate(s){return this.value.findIndex((function(item){return s.trim().toLowerCase()===item.value.toLowerCase()}))},getTagIndexByValue:function getTagIndexByValue(value){var result=[];return this.getTagElms().forEach((function(tagElm,i){tagElm.textContent.trim().toLowerCase()==value.toLowerCase()&&result.push(i)})),result},getTagElmByValue:function getTagElmByValue(value){var tagIdx=this.getTagIndexByValue(value)[0];return this.getTagElms()[tagIdx]},markTagByValue:function markTagByValue(value,tagElm){var tagsElms,tagsElmsLen;return!!(tagElm=tagElm||this.getTagElmByValue(value))&&(tagElm.classList.add("tagify--mark"),tagElm)},isTagBlacklisted:function isTagBlacklisted(v){return v=v.toLowerCase().trim(),this.settings.blacklist.filter((function(x){return v==x.toLowerCase()})).length},isTagWhitelisted:function isTagWhitelisted(v){return this.settings.whitelist.some((function(item){if((item.value||item).toLowerCase()===v.toLowerCase())return!0}))},validateTag:function validateTag(s){var value=s.trim(),result=!0;return value?this.settings.pattern&&!this.settings.pattern.test(value)?result=this.TEXTS.pattern:this.settings.duplicates||-1===this.isTagDuplicate(value)?(this.isTagBlacklisted(value)||this.settings.enforceWhitelist&&!this.isTagWhitelisted(value))&&(result=this.TEXTS.notAllowed):result=this.TEXTS.duplicate:result=this.TEXTS.empty,result},maxTagsReached:function maxTagsReached(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},normalizeTags:function normalizeTags(tagsItems){var _this$settings=this.settings,whitelist=_this$settings.whitelist,delimiters=_this$settings.delimiters,mode=_this$settings.mode,whitelistWithProps=!!whitelist&&whitelist[0]instanceof Object,isCollection=tagsItems instanceof Array&&tagsItems[0]instanceof Object&&"value"in tagsItems[0],temp=[],mapStringToCollection=function mapStringToCollection(s){return s.split(delimiters).filter((function(n){return n})).map((function(v){return{value:v.trim()}}))},_ref;if(isCollection)return tagsItems=(_ref=[]).concat.apply(_ref,_toConsumableArray(tagsItems.map((function(item){return mapStringToCollection(item.value).map((function(newItem){return _objectSpread({},item,{},newItem)}))}))));if("number"==typeof tagsItems&&(tagsItems=tagsItems.toString()),"string"==typeof tagsItems){if(!tagsItems.trim())return[];tagsItems=mapStringToCollection(tagsItems)}else if(!isCollection&&tagsItems instanceof Array){var _ref2;tagsItems=(_ref2=[]).concat.apply(_ref2,_toConsumableArray(tagsItems.map((function(item){return mapStringToCollection(item)}))))}return whitelistWithProps&&(tagsItems.forEach((function(item){var matchObj=whitelist.filter((function(WL_item){return WL_item.value.toLowerCase()==item.value.toLowerCase()}));matchObj[0]?temp.push(matchObj[0]):"mix"!=mode&&temp.push(item)})),tagsItems=temp),tagsItems},parseMixTags:function parseMixTags(s){for(var collect=!1,match="",parsedMatch,value=s,html=s,tagData,i=0;i<s.length;i++)"["==s[i]&&s[i]==s[i+1]&&(collect=!0),collect&&(match+=s[i]),"]"==s[i]&&s[i]==s[i-1]&&(collect=!1,parsedMatch=match.slice(2).slice(0,-2),this.isTagWhitelisted(parsedMatch)&&!this.settings.duplicates&&-1==this.isTagDuplicate(parsedMatch)&&(tagData=this.normalizeTags.call(this,parsedMatch)[0],html=this.replaceMixStringWithTag(html,match,tagData).html),match="");return this.DOM.input.innerHTML=html,this.update(),s},replaceMixStringWithTag:function replaceMixStringWithTag(html,tag,tagData,tagElm){return tagData&&html&&-1!=html.indexOf(tag)&&(tagElm=this.createTagElem(tagData),this.value.push(tagData),html=html.replace(tag,tagElm.outerHTML+"&#8288;")),{html:html,tagElm:tagElm}},addMixTag:function addMixTag(tagData){if(tagData&&this.state.tag){for(var tag=this.state.tag.prefix+this.state.tag.value,iter=document.createNodeIterator(this.DOM.input,NodeFilter.SHOW_TEXT),textnode,tagElm,idx,maxLoops=100,replacedNode;(textnode=iter.nextNode())&&maxLoops--;)if(textnode.nodeType===Node.TEXT_NODE){if(-1==(idx=textnode.nodeValue.indexOf(tag)))continue;replacedNode=textnode.splitText(idx),this.settings.transformTag.call(this,tagData),tagElm=this.createTagElem(tagData),replacedNode.nodeValue=replacedNode.nodeValue.replace(tag,""),textnode.parentNode.insertBefore(tagElm,replacedNode),tagElm.insertAdjacentHTML("afterend","&#8288;")}tagElm&&(this.value.push(tagData),this.update(),this.trigger("add",this.extend({},{index:this.value.length,tag:tagElm},tagData))),this.state.tag=null}},addTags:function addTags(tagsItems,clearInput){var _this5=this,skipInvalid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.settings.skipInvalid,tagElems=[];if(!tagsItems||!tagsItems.length)return console.warn("[addTags]","no tags to add:",tagsItems),tagElems;if(tagsItems=this.normalizeTags.call(this,tagsItems),"mix"==this.settings.mode)return this.addMixTag(tagsItems[0]);function appendTag(tagElm){var insertBeforeNode=this.DOM.scope.lastElementChild;insertBeforeNode===this.DOM.input?this.DOM.scope.insertBefore(tagElm,insertBeforeNode):this.DOM.scope.appendChild(tagElm)}return this.DOM.input.removeAttribute("style"),tagsItems.forEach((function(tagData){var tagValidation,tagElm,tagElmParams={};if(tagData=Object.assign({},tagData),_this5.settings.transformTag.call(_this5,tagData),!0!==(tagValidation=_this5.maxTagsReached()||_this5.validateTag.call(_this5,tagData.value))){if(skipInvalid)return;tagElmParams["aria-invalid"]=!0,tagElmParams.class=(tagData.class||"")+" tagify--notAllowed",tagElmParams.title=tagValidation,_this5.markTagByValue(tagData.value),_this5.trigger("invalid",{data:tagData,index:_this5.value.length,message:tagValidation})}tagElmParams.role="tag",tagData.readonly&&(tagElmParams["aria-readonly"]=!0),tagElm=_this5.createTagElem(_this5.extend({},tagData,tagElmParams)),tagElems.push(tagElm),appendTag.call(_this5,tagElm),!0===tagValidation?(_this5.value.push(tagData),_this5.update(),_this5.trigger("add",{tag:tagElm,index:_this5.value.length-1,data:tagData})):_this5.settings.keepInvalidTags||setTimeout((function(){_this5.removeTag(tagElm,!0)}),1e3)})),tagsItems.length&&clearInput&&this.input.set.call(this),tagElems},minify:function minify(html){return html.replace(new RegExp(">[\r\n ]+<","g"),"><")},createTagElem:function createTagElem(tagData){var tagElm,v=this.escapeHTML(tagData.value),template=this.settings.templates.tag.call(this,v,tagData);return this.settings.readonly&&(tagData.readonly=!0),template=this.minify(template),tagElm=this.parseHTML(template)},removeTag:function removeTag(){var tagElm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLastTag(),silent=arguments.length>1?arguments[1]:void 0,tranDuration=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;if("string"==typeof tagElm&&(tagElm=this.getTagElmByValue(tagElm)),tagElm instanceof HTMLElement){var tagData,tagIdx=this.getNodeIndex(tagElm);tranDuration&&tranDuration>10?animation():removeNode(),silent||(tagData=this.value.splice(tagIdx,1)[0],this.update(),this.trigger("remove",{tag:tagElm,index:tagIdx,data:tagData}),this.dropdown.render.call(this))}function animation(){tagElm.style.width=parseFloat(window.getComputedStyle(tagElm).width)+"px",document.body.clientTop,tagElm.classList.add("tagify--hide"),setTimeout(removeNode,400)}function removeNode(){tagElm.parentNode&&tagElm.parentNode.removeChild(tagElm)}},removeAllTags:function removeAllTags(){this.value=[],this.update(),Array.prototype.slice.call(this.getTagElms()).forEach((function(elm){return elm.parentNode.removeChild(elm)}))},getAttributes:function getAttributes(data){if("[object Object]"!=Object.prototype.toString.call(data))return"";var keys=Object.keys(data),s="",propName,i;for(i=keys.length;i--;)"class"!=(propName=keys[i])&&data.hasOwnProperty(propName)&&(s+=" "+propName+(data[propName]?'="'.concat(data[propName],'"'):""));return s},preUpdate:function preUpdate(){this.DOM.scope.classList.toggle("hasMaxTags",this.value.length>=this.settings.maxTags)},update:function update(){this.preUpdate(),this.DOM.originalInput.value="mix"==this.settings.mode?this.getMixedTagsAsString():this.value.length?JSON.stringify(this.value):""},getMixedTagsAsString:function getMixedTagsAsString(){var result="";return this.DOM.input.childNodes.forEach((function(node,i){1==node.nodeType?node.classList.contains("tagify__tag")&&(result+="[["+node.getAttribute("value")+"]]"):result+=node.textContent})),result},dropdown:{init:function init(){this.DOM.dropdown=this.dropdown.build.call(this)},build:function build(){var _this$settings$dropdo=this.settings.dropdown,position=_this$settings$dropdo.position,classname=_this$settings$dropdo.classname,_className="".concat("manual"==position?"":"tagify__dropdown"," ").concat(classname).trim(),template='<div class="'.concat(_className,'" role="menu"></div>');return this.parseHTML(template)},show:function show(value){var listHTML,isManual="manual"==this.settings.dropdown.position;if(this.settings.whitelist.length){if(this.suggestedListItems=this.dropdown.filterListItems.call(this,value),!this.suggestedListItems.length)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide.call(this);listHTML=this.dropdown.createListHTML.call(this,this.suggestedListItems),this.DOM.dropdown.innerHTML=this.minify(listHTML),this.settings.enforceWhitelist&&!isManual&&this.dropdown.highlightOption.call(this,this.DOM.dropdown.querySelector(".tagify__dropdown__item")),this.DOM.scope.setAttribute("aria-expanded",!0),this.trigger("dropdown:show",this.DOM.dropdown),document.body.contains(this.DOM.dropdown)||(isManual||(this.dropdown.position.call(this),document.body.appendChild(this.DOM.dropdown),this.events.binding.call(this,!1)),this.dropdown.events.binding.call(this))}},hide:function hide(force){var _this$DOM=this.DOM,scope=_this$DOM.scope,dropdown=_this$DOM.dropdown,isManual="manual"==this.settings.dropdown.position&&!force;dropdown&&document.body.contains(dropdown)&&!isManual&&(window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),this.events.binding.call(this),scope.setAttribute("aria-expanded",!1),dropdown.parentNode.removeChild(dropdown),this.trigger("dropdown:hide",dropdown))},render:function render(){this.suggestedListItems=this.dropdown.filterListItems.call(this,"");var listHTML=this.dropdown.createListHTML.call(this,this.suggestedListItems);this.DOM.dropdown.innerHTML=this.minify(listHTML)},position:function position(){var rect=this.DOM.scope.getBoundingClientRect();this.DOM.dropdown.style.cssText="left: "+(rect.left+window.pageXOffset)+"px;                                                  top: "+(rect.top+rect.height-1+window.pageYOffset)+"px;                                                  width: "+rect.width+"px"},events:{binding:function binding(){var bindUnbind=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],_CBR=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:this.dropdown.events.callbacks.onKeyDown.bind(this),onMouseOver:this.dropdown.events.callbacks.onMouseOver.bind(this),onClick:this.dropdown.events.callbacks.onClick.bind(this)},action=bindUnbind?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[action]("resize",_CBR.position),window[action]("keydown",_CBR.onKeyDown)),window[action]("mousedown",_CBR.onClick),this.DOM.dropdown[action]("mouseover",_CBR.onMouseOver)},callbacks:{onKeyDown:function onKeyDown(e){var _this6=this,activeListElm=this.DOM.dropdown.querySelector("[class$='--active']"),selectedElm=activeListElm||this.DOM.dropdown.children[0],newValue="";switch(e.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":e.preventDefault(),selectedElm&&(selectedElm=selectedElm[("ArrowUp"==e.key||"Up"==e.key?"previous":"next")+"ElementSibling"]),selectedElm||(selectedElm=this.DOM.dropdown.children["ArrowUp"==e.key||"Up"==e.key?this.DOM.dropdown.children.length-1:0]),this.dropdown.highlightOption.call(this,selectedElm,!0);break;case"Escape":case"Esc":this.dropdown.hide.call(this);break;case"ArrowRight":case"Tab":if(e.preventDefault(),!this.input.autocomplete.set.call(this,selectedElm?selectedElm.textContent:null))return!1;case"Enter":if(e.preventDefault(),activeListElm)return newValue=this.suggestedListItems[this.getNodeIndex(activeListElm)]||this.input.value,this.addTags([newValue],!0),this.dropdown.hide.call(this),setTimeout((function(){return _this6.DOM.input.focus()}),100),!1;this.addTags(this.input.value,!0)}},onMouseOver:function onMouseOver(e){e.target.className.includes("__item")&&this.dropdown.highlightOption.call(this,e.target)},onClick:function onClick(e){var _this7=this,value,listItemElm;0==e.button&&e.target!=this.DOM.dropdown&&((listItemElm=e.target.closest(".tagify__dropdown__item"))&&(value=this.suggestedListItems[this.getNodeIndex(listItemElm)]||this.input.value,this.addTags([value],!0),setTimeout((function(){return _this7.DOM.input.focus()}),100)),this.dropdown.hide.call(this))}}},highlightOption:function highlightOption(elm,adjustScroll){if(elm){var className="tagify__dropdown__item--active",value;this.DOM.dropdown.querySelectorAll("[class$='--active']").forEach((function(activeElm){activeElm.classList.remove(className),activeElm.removeAttribute("aria-selected")})),elm.classList.add(className),elm.setAttribute("aria-selected",!0),adjustScroll&&(elm.parentNode.scrollTop=elm.clientHeight+elm.offsetTop-elm.parentNode.clientHeight),this.settings.autoComplete&&!this.settings.dropdown.fuzzySearch&&(value=this.suggestedListItems[this.getNodeIndex(elm)].value||this.input.value,this.input.autocomplete.suggest.call(this,value))}},filterListItems:function filterListItems(value){var _this8=this,list=[],whitelist=this.settings.whitelist,suggestionsCount=this.settings.dropdown.maxItems||1/0,whitelistItem,valueIsInWhitelist,whitelistItemValueIndex,searchBy,isDuplicate,i=0;if(!value)return whitelist.filter((function(item){return-1==_this8.isTagDuplicate(item.value||item)})).slice(0,suggestionsCount);for(;i<whitelist.length&&(whitelistItemValueIndex=(searchBy=(((whitelistItem=whitelist[i]instanceof Object?whitelist[i]:{value:whitelist[i]}).searchBy||"")+" "+whitelistItem.value).toLowerCase()).indexOf(value.toLowerCase()),valueIsInWhitelist=this.settings.dropdown.fuzzySearch?whitelistItemValueIndex>=0:0==whitelistItemValueIndex,isDuplicate=!this.settings.duplicates&&this.isTagDuplicate(whitelistItem.value)>-1,valueIsInWhitelist&&!isDuplicate&&suggestionsCount--&&list.push(whitelistItem),0!=suggestionsCount);i++);return list},createListHTML:function createListHTML(list){var getItem=this.settings.templates.dropdownItem.bind(this);return list.map(getItem).join("")}}},Tagify}));