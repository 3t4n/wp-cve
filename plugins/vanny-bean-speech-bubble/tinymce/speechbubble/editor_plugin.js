(function(){tinymce.create('tinymce.plugins.SpeechBubblePlugin',{init:function(ed,url){ed.addCommand('mceSpeechBubble',function(){ed.onMouseDown.add(function(ed,e){var bubble_height=jQuery(e.target).height();jQuery(e.target).children('.tail').css('margin-top',bubble_height)});ed.onClick.add(function(ed,e){if(e.target.nodeName=="IMG"){if(e.pageX){var x=e.pageX-e.target.offsetLeft-10;var y=e.pageY-e.target.offsetTop-95;var height=60;var width=135;var padding_top=8}else{var x=e.clientX-e.target.offsetLeft-18;var y=e.clientY-e.target.offsetTop-94;var height=70;var width=155 var padding_top=2}jQuery(e.target).parent().prepend('<div class="speech-bubble" style="z-index:999999;;height:'+height+'px;padding:'+padding_top+'px 8px 8px 7px;position:absolute;text-align:center;color:#333;margin-left:'+x+'px;margin-top:'+y+'px;background-color:#FFF;border:1px solid #999999;-moz-border-radius: 15px;-webkit-border-radius: 15px;"><div style="background:url('+url+'/img/speech-bubble.gif) no-repeat bottom left;margin-top:58px;height:30px;width:30px;position:absolute;margin-left:0px;" class="tail">&nbsp;</div><p style="margin:0;padding:0;height:20px;font-size:10px"></p><p style="margin:0;padding:0;font-size:10px">[click to edit]</p><p style="margin:0;padding:0;font-size:10px"></p></div>');return ed.selection.collapse(ed.dom.select('#sbw')[0],false)}});jQuery(ed.dom.select('img')).each(function(){var len=jQuery(this).parents("div.speech-bubble-wrapper").length;if(len==0){var src=jQuery(this).attr("src");var width=jQuery(this).attr("width");var height=jQuery(this).attr("height");jQuery(this).wrap('<div id="sbw" class="speech-bubble-wrapper" style="width:'+width+'px; height:'+height+'px;z-index:999998;"></div>');jQuery(this).parent().after('<a href="http://www.vannybean.com/" style="font-size:10px;color:#999999">Baby Bubble By VannyBean</a>')}})});ed.addButton('SpeechBubble',{title:'Speech Bubble',cmd:'mceSpeechBubble',image:url+'/img/bubble-small.gif'});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('SpeechBubble',n.nodeName=='IMG')})},createControl:function(n,cm){return null},getInfo:function(){return{longname:'SpeechBubble plugin',author:'James Charlesworth',authorurl:'http://www.vannybean.com',infourl:'http://www.vannybean.com',version:"1.0"}}});tinymce.PluginManager.add('SpeechBubble',tinymce.plugins.SpeechBubblePlugin)})();