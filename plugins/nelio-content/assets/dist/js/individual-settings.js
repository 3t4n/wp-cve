(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{initField:()=>V});var n={};e.r(n),e.d(n,{getAttributes:()=>u,getValue:()=>c});var o={};e.r(o),e.d(o,{setAttributes:()=>f,setValue:()=>d});const r=window.wp.element,a=window.wp.data;var i="nelio-content/individual-settings",l={values:{},attributes:{}},s=function(){return s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function c(e,t){return e.values[t]}function u(e,t){return e.attributes[t]}function d(e,t){return{type:"SET_FIELD_VALUE",field:e,value:t}}function f(e,t){return{type:"SET_FIELD_ATTRIBUTES",field:e,attributes:t}}(0,a.registerStore)(i,{reducer:function(e,t){var n;return void 0===e&&(e=l),null!==(n=function(e,t){var n,o;switch(t.type){case"SET_FIELD_VALUE":return s(s({},e),{values:s(s({},e.values),(n={},n[t.field]=t.value,n))});case"SET_FIELD_ATTRIBUTES":return s(s({},e),{attributes:s(s({},e.attributes),(o={},o[t.field]=s(s({},e.attributes[t.field]),t.attributes),o))})}}(e,t))&&void 0!==n?n:e},controls:a.controls,actions:o,selectors:n});const p=window.NelioContent.components,m=window.lodash;var v={postTypes:[]},h=function(){return h=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},h.apply(this,arguments)};function g(e,t){var n=(0,a.useSelect)((function(t){return t(i).getAttributes(e)})),o=(0,a.useDispatch)(i).setAttributes;return[h(h({},t),n),function(t){return o(e,t)}]}function y(e){var t=(0,a.useSelect)((function(t){return t(i).getValue(e)})),n=(0,a.useDispatch)(i).setValue;return[t,function(t){return n(e,t)}]}const E=window.wp.apiFetch;var b=e.n(E);const w=window.wp.components,_=window.wp.i18n,x=window.NelioContent.data;var S={status:"loading"};const P=window.wp.url,R=window.NelioContent.utils;function N(e,t){t({isRefreshing:!0,isStartingRefresh:!0,isRefreshingOver:!1,refreshPostCount:0,refreshPostIndex:0}),C(e,1,t)}function C(e,t,n){t<1?O(0,n):b()({path:(0,P.addQueryArgs)("/nelio-content/v1/analytics/post",{period:e,page:t})}).then((function(o){var r=o.ids,a=o.more,i=o.total,l=o.ppp;if((0,R.isEmpty)(r))O(i,n);else{var s=l*(t-1);n({isStartingRefresh:!1,refreshPostCount:i,refreshPostIndex:Math.min(i,s)});var c=(0,m.map)(r,(function(e){return b()({path:"/nelio-content/v1/analytics/post/".concat(e,"/update"),method:"PUT"}).then((function(){++s,n({refreshPostIndex:Math.min(i,s)})}))}));Promise.all(c).then((function(){return a?C(e,t+1,n):O(i,n)}))}}))}function O(e,t){t({isRefreshing:!1,isStartingRefresh:!1,isRefreshingOver:!0,refreshPostCount:e,refreshPostIndex:e})}var A={disabled:!1,isRefreshDialogOpen:!1,isRefreshing:!1,isRefreshingOver:!1,isStartingRefresh:!1,isValidating:!1,refreshPeriod:"month",refreshPostCount:0,refreshPostIndex:0,mode:"init"},T=function(e){var t=e.className,n=e.name,o=e.disabled,a=g(n,A),i=a[0],l=a[1],s=i.isRefreshDialogOpen,c=i.isRefreshing,u=i.isStartingRefresh,d=i.isRefreshingOver,f=i.refreshPeriod,m=i.refreshPostCount,v=i.refreshPostIndex;return r.createElement(r.Fragment,null,r.createElement(w.Button,{variant:"secondary",isSmall:!0,disabled:o,onClick:function(){return l({isRefreshDialogOpen:!0,isRefreshing:!1,refreshPeriod:"month"})}},(0,_._x)("Refresh Analytics","command","nelio-content")),s&&r.createElement(w.Modal,{isDismissible:!1,title:(0,_._x)("Refresh Analytics","text","nelio-content"),onRequestClose:function(){}},r.createElement("div",{className:"".concat(t,"__dialog-content")},!c&&!d&&r.createElement(w.SelectControl,{disabled:c,value:f,onChange:function(e){return l({refreshPeriod:e})},options:I}),u&&r.createElement(p.ProgressBar,{label:(0,_._x)("Retrieving posts…","text","nelio-content")}),c&&!u&&r.createElement(p.ProgressBar,{current:v,total:m,label:"".concat(v," / ").concat(m)}),d&&r.createElement(p.ProgressBar,{current:v,total:m,label:(0,_.sprintf)(/* translators: number of posts */
(0,_._nx)("%d post updated!","%d posts updated!",m,"text","nelio-content"),m)})),r.createElement("div",{className:"".concat(t,"__dialog-actions")},r.createElement(w.Button,{variant:"secondary",disabled:c,onClick:function(){return l({isRefreshDialogOpen:!1,isRefreshing:!1,isStartingRefresh:!1,isRefreshingOver:!1,refreshPeriod:"month",refreshPostCount:0,refreshPostIndex:0})}},(0,_._x)("Close","command","nelio-content")),!d&&r.createElement(w.Button,{variant:"primary",isBusy:c,disabled:c,onClick:function(){return N(f,(function(e){return l(e)}))}},c?(0,_._x)("Refreshing…","text","nelio-content"):(0,_._x)("Refresh Analytics","command","nelio-content")))))},I=[{value:"month",label:(0,_._x)("Posts from last month","text","nelio-content")},{value:"year",label:(0,_._x)("Posts from last year","text","nelio-content")},{value:"all",label:(0,_._x)("All posts","text","nelio-content")}],k=function(e){var t=e.className,n=void 0===t?"":t,o=e.disabled,a=e.mode,i=e.name,l=e.selectProfile,s=void 0===l?function(){}:l;return r.createElement("div",{className:n},r.createElement("div",{className:"".concat(n,"__connection-actions")},r.createElement(w.Button,{variant:"secondary",isSmall:!0,disabled:o,onClick:s},(0,_._x)("Connect Google Analytics","command","nelio-content")),r.createElement(T,{name:i,className:n,disabled:o})),"awaiting-profile-selection"===a&&r.createElement("div",{className:"".concat(n,"__overlay")},r.createElement("div",{className:"".concat(n,"__overlay-content")},(0,_._x)("Please select a Google account…","user","nelio-content"))),"checking-google-analytics"===a&&r.createElement("div",{className:"".concat(n,"__overlay")},r.createElement("div",{className:"".concat(n,"__overlay-content")},(0,_._x)("Please wait a moment…","user","nelio-content"))))};const M=window.React;function B(e){return e.startsWith("{{/")?{type:"componentClose",value:e.replace(/\W/g,"")}:e.endsWith("/}}")?{type:"componentSelfClosing",value:e.replace(/\W/g,"")}:e.startsWith("{{")?{type:"componentOpen",value:e.replace(/\W/g,"")}:{type:"string",value:e}}function j(e,t){let n,o,r=[];for(let a=0;a<e.length;a++){const i=e[a];if("string"!==i.type){if(void 0===t[i.value])throw new Error(`Invalid interpolation, missing component node: \`${i.value}\``);if("object"!=typeof t[i.value])throw new Error(`Invalid interpolation, component node must be a ReactElement or null: \`${i.value}\``);if("componentClose"===i.type)throw new Error(`Missing opening component token: \`${i.value}\``);if("componentOpen"===i.type){n=t[i.value],o=a;break}r.push(t[i.value])}else r.push(i.value)}if(n){const a=function(e,t){const n=t[e];let o=0;for(let r=e+1;r<t.length;r++){const e=t[r];if(e.value===n.value){if("componentOpen"===e.type){o++;continue}if("componentClose"===e.type){if(0===o)return r;o--}}}throw new Error("Missing closing component token `"+n.value+"`")}(o,e),i=j(e.slice(o+1,a),t),l=(0,M.cloneElement)(n,{},i);if(r.push(l),a<e.length-1){const n=j(e.slice(a+1),t);r=r.concat(n)}}return r=r.filter(Boolean),0===r.length?null:1===r.length?r[0]:(0,M.createElement)(M.Fragment,null,...r)}function D(e){const{mixedString:t,components:n,throwErrors:o}=e;if(!n)return t;if("object"!=typeof n){if(o)throw new Error(`Interpolation Error: unable to process \`${t}\` because components is not an object`);return t}const r=function(e){return e.split(/(\{\{\/?\s*\w+\s*\/?\}\})/g).map(B)}(t);try{return j(r,n)}catch(e){if(o)throw new Error(`Interpolation Error: unable to process \`${t}\` because of error \`${e.message}\``);return t}}var F=function(e){var t=e.className,n=e.disabled,o=e.name,a=y(o),i=a[0],l=void 0===i?"":i,s=a[1],c=g(o,A),u=(c[0],c[1]);return r.createElement("div",{className:t},r.createElement("div",{className:"".concat(t,"__property-control")},r.createElement("input",{type:"hidden",name:o,value:l}),r.createElement(w.TextControl,{placeholder:(0,_._x)("GA4 Property Identifier","text","nelio-content"),value:l,onChange:s,help:D({mixedString:(0,_.sprintf)("{{span}}%s{{/span}}",(0,_._x)("To determine your GA4 Property Id, please <a>follow these instructions</a>","user","nelio-content").replace("<a>","{{a}}").replace("</a>","{{/a}}")),components:{a:r.createElement(w.ExternalLink,{href:"https://developers.google.com/analytics/devguides/reporting/data/v1/property-id#google_analytics"}),span:r.createElement("span",{className:"description"})}})})),r.createElement("div",{className:"".concat(t,"__property-control-actions")},r.createElement(w.Button,{variant:"secondary",isSmall:!0,disabled:n,onClick:function(){return u({mode:"init"})}},(0,_._x)("Change Google Account","command","nelio-content")),r.createElement(T,{name:o,className:t,disabled:n})))},G={CalendarPostTypeSetting:function(e){var t=e.name,n=y(t),o=n[0],a=void 0===o?[]:o,i=n[1],l=g(t,v)[0].postTypes,s=l.filter((function(e){var t=e.value;return a.includes(t)}));return r.createElement("div",{className:"nelio-content-calendar-post-type-setting"},r.createElement("input",{type:"hidden",name:t,value:a}),r.createElement(p.StylizedSelectControl,{isMulti:!0,options:l,value:s,onChange:function(e){return i((0,m.map)(e,"value"))}}))},CloudNotificationEmailsSetting:function(e){var t=e.name,n=g(t,S),o=n[0],i=n[1],l=y(t),s=l[0],c=void 0===s?[]:s,u=l[1],d=(0,a.useSelect)((function(e){return e(x.STORE_NAME).getSiteId()})),f=(0,a.useSelect)((function(e){return e(x.STORE_NAME).getApiRoot()})),p=(0,a.useSelect)((function(e){return e(x.STORE_NAME).getAuthenticationToken()})),m=o.status;return(0,r.useEffect)((function(){var e,t,n,o;e=void 0,t=void 0,o=function(){var e,t;return function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}(this,(function(n){switch(n.label){case 0:if(!d||!p)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,b()({url:"".concat(f,"/site/").concat(d),method:"GET",credentials:"omit",mode:"cors",headers:{Authorization:"Bearer ".concat(p)}})];case 2:return e=n.sent(),t=e.notificationEmails,u(void 0===t?[]:t),i({status:"ready"}),[3,4];case 3:return n.sent(),u([]),i({status:"error"}),[3,4];case 4:return[2]}}))},new((n=void 0)||(n=Promise))((function(r,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function l(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((o=o.apply(e,t||[])).next())}))}),[d,p]),r.createElement("div",{className:"nelio-content-cloud-notification-emails-setting"},"loading"===m&&r.createElement(w.Spinner,null),"error"===m&&r.createElement("p",{className:"nelio-content-cloud-notification-emails-setting__error-message"},(0,_._x)("Unable to retrieve cloud notification emails. Please try again later.","user","nelio-content")),"ready"===m&&r.createElement(r.Fragment,null,r.createElement("input",{type:"hidden",name:t,value:c.map((function(e){return e.replace(/\s/g,"")})).filter(Boolean).join(",")}),r.createElement("p",null,(0,_._x)("Please write one email address per line:","user","nelio-content")),r.createElement("textarea",{className:"nelio-content-cloud-notification-emails-setting__input",placeholder:(0,_._x)("user@example.com","text","nelio-content"),value:c.join("\n"),onChange:function(e){return u(e.target.value.split("\n"))}}),r.createElement("p",null,r.createElement("span",{className:"description"},(0,_._x)("Send email notifications to the addresses above when a social profile expires and requires re-authentication.","text","nelio-content")))))},GoogleAnalyticsSetting:function(e){var t=e.name,n=g(t,A),o=n[0],i=n[1],l=function(e){return i({mode:e})},s=o.disabled,c=o.mode;return"ga4-property-id"===c?r.createElement(F,{className:"nelio-content-google-analytics-setting",disabled:s,name:t}):r.createElement(k,{className:"nelio-content-google-analytics-setting",name:t,disabled:s,mode:c,selectProfile:function(){return function(e){var t=e.onOpen,n=e.onClose,o=void 0===n?function(){}:n;(void 0===t?function(){}:t)();var r=(0,a.select)(x.STORE_NAME).getSiteId(),i=(0,a.select)(x.STORE_NAME).getRestUrl("/nelio-content/v1/analytics/connect"),l=(0,a.select)(x.STORE_NAME).getApiRoot(),s=window.open((0,P.addQueryArgs)("".concat(l,"/connect/ga"),{siteId:r,redirect:i}),"","width=640,height=480"),c=setInterval((function(){(null==s?void 0:s.closed)&&(clearInterval(c),o())}),500)}({onOpen:function(){return l("awaiting-profile-selection")},onClose:function(){l("checking-google-analytics"),b()({path:"/nelio-content/v1/analytics/check"}).then((function(e){return l(e?"ga4-property-id":"init")}))}})}})}};function V(e,t){var n=t.component,o=G[n];if(o){var l=document.getElementById(e);if(l){var s=t.name,c=t.value,u=t.attributes,d=(0,a.dispatch)(i),f=d.setValue,p=d.setAttributes;f(s,c),p(s,u),(0,r.render)(r.createElement(o,{name:s}),l)}}}})();var n=NelioContent="undefined"==typeof NelioContent?{}:NelioContent;for(var o in t)n[o]=t[o];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();