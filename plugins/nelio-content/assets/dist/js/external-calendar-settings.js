(()=>{var e={4184:(e,n)=>{var t;!function(){"use strict";var r={}.hasOwnProperty;function a(){for(var e=[],n=0;n<arguments.length;n++){var t=arguments[n];if(t){var l=typeof t;if("string"===l||"number"===l)e.push(t);else if(Array.isArray(t)){if(t.length){var i=a.apply(null,t);i&&e.push(i)}}else if("object"===l){if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]")){e.push(t.toString());continue}for(var o in t)r.call(t,o)&&t[o]&&e.push(o)}}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(t=function(){return a}.apply(n,[]))||(e.exports=t)}()}},n={};function t(r){var a=n[r];if(void 0!==a)return a.exports;var l=n[r]={exports:{}};return e[r](l,l.exports,t),l.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";t.r(r),t.d(r,{initPage:()=>Y});var e={};t.r(e),t.d(e,{getEditingExternalCalendarName:()=>A,getEditingExternalCalendarUrl:()=>g,getExternalCalendar:()=>m,getExternalCalendarUrl:()=>p,getExternalCalendars:()=>v,isAddingAnExternalCalendar:()=>C,isDeletingAnExternalCalendar:()=>y,isDeletingExternalCalendar:()=>_,isSavingAnExternalCalendar:()=>h});var n={};t.r(n),t.d(n,{closeEditor:()=>D,markAsAddingExternalCalendar:()=>w,markAsDeleting:()=>L,markAsSaving:()=>T,openEditor:()=>b,receiveExternalCalendars:()=>O,removeExternalCalendar:()=>N,setEditingExternalCalendarName:()=>R,setNewExternalCalendarUrl:()=>S});var a={};t.r(a),t.d(a,{addExternalCalendar:()=>P,deleteExternalCalendar:()=>U,saveExternalCalendar:()=>B});const l=window.wp.element,i=window.wp.apiFetch;var o=t.n(i);const d=window.wp.data,c=window.lodash;var u="nelio-content/external-calendar-settings",s={externalCalendars:{},addExternalCalendarForm:{url:"",isAddingExternalCalendar:!1},externalCalendarEditor:void 0,externalCalendarsBeingDeleted:[]},E=function(){return E=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},E.apply(this,arguments)},x=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,l=n.length;a<l;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))};const f=window.NelioContent.utils;function v(e){return(0,c.values)(e.externalCalendars)}function m(e,n){return e.externalCalendars[n]}function p(e){return e.addExternalCalendarForm.url}function C(e){return e.addExternalCalendarForm.isAddingExternalCalendar}function g(e){var n;return null===(n=e.externalCalendarEditor)||void 0===n?void 0:n.url}function A(e){var n,t;return null!==(t=null===(n=e.externalCalendarEditor)||void 0===n?void 0:n.name)&&void 0!==t?t:""}function h(e){var n;return!!(null===(n=e.externalCalendarEditor)||void 0===n?void 0:n.isSaving)}function _(e,n){return e.externalCalendarsBeingDeleted.includes(n)}function y(e){return!(0,f.isEmpty)(e.externalCalendarsBeingDeleted)}function N(e){return{type:"REMOVE_EXTERNAL_CALENDAR",url:e}}function S(e){return{type:"SET_NEW_EXTERNAL_CALENDAR_URL",url:e}}function w(e){return{type:"MARK_AS_ADDING_EXTERNAL_CALENDAR",isAddingExternalCalendar:e}}function b(e){return{type:"OPEN_EDITOR",url:e.url,name:e.name}}function D(){return{type:"CLOSE_EDITOR"}}function R(e){return{type:"SET_EDITING_EXTERNAL_CALENDAR_NAME",name:e}}function T(e){return{type:"MARK_AS_SAVING",isSaving:e}}function L(e,n){return{type:"MARK_AS_DELETING",url:e,isDeleting:n}}function O(e){return{type:"RECEIVE_EXTERNAL_CALENDARS",externalCalendars:(0,c.castArray)(e)}}const k=window.wp.url;var I=function(e,n,t,r){return new(t||(t=Promise))((function(a,l){function i(e){try{d(r.next(e))}catch(e){l(e)}}function o(e){try{d(r.throw(e))}catch(e){l(e)}}function d(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,o)}d((r=r.apply(e,n||[])).next())}))},M=function(e,n){var t,r,a,l,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(d){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(i=0)),i;)try{if(t=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=n.call(e,i)}catch(e){o=[6,e],r=0}finally{t=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,d])}}};function P(e){return I(this,void 0,void 0,(function(){var n;return M(this,(function(t){switch(t.label){case 0:(0,d.dispatch)(u).markAsAddingExternalCalendar(!0),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,o()({path:"/nelio-content/v1/external-calendars/",method:"POST",data:{url:e}})];case 2:return n=t.sent(),(0,d.dispatch)(u).receiveExternalCalendars(n),(0,d.dispatch)(u).setNewExternalCalendarUrl(""),[3,4];case 3:return t.sent(),[3,4];case 4:return(0,d.dispatch)(u).markAsAddingExternalCalendar(!1),[2]}}))}))}function B(e){var n=e.url,t=e.name;return I(this,void 0,void 0,(function(){var e;return M(this,(function(r){switch(r.label){case 0:(0,d.dispatch)(u).markAsSaving(!0),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,o()({path:"/nelio-content/v1/external-calendars/",method:"PUT",data:{url:n,name:t}})];case 2:return e=r.sent(),(0,d.dispatch)(u).receiveExternalCalendars(e),[3,4];case 3:return r.sent(),[3,4];case 4:return(0,d.dispatch)(u).closeEditor(),(0,d.dispatch)(u).markAsSaving(!1),[2]}}))}))}function U(e){return I(this,void 0,void 0,(function(){return M(this,(function(n){switch(n.label){case 0:(0,d.dispatch)(u).markAsDeleting(e,!0),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o()({path:(0,k.addQueryArgs)("/nelio-content/v1/external-calendars/",{url:e}),method:"DELETE"})];case 2:return n.sent(),(0,d.dispatch)(u).removeExternalCalendar(e),[3,4];case 3:return n.sent(),[3,4];case 4:return(0,d.dispatch)(u).markAsDeleting(e,!1),[2]}}))}))}var j=function(){return j=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},j.apply(this,arguments)},X=j(j({},n),a);(0,d.registerStore)(u,{reducer:function(e,n){var t;return void 0===e&&(e=s),null!==(t=function(e,n){switch(n.type){case"RECEIVE_EXTERNAL_CALENDARS":return E(E({},e),{externalCalendars:E(E({},e.externalCalendars),(0,c.keyBy)(n.externalCalendars,"url"))});case"REMOVE_EXTERNAL_CALENDAR":return E(E({},e),{externalCalendars:(0,c.omit)(e.externalCalendars,n.url)});case"SET_NEW_EXTERNAL_CALENDAR_URL":return E(E({},e),{addExternalCalendarForm:E(E({},e.addExternalCalendarForm),{url:n.url})});case"MARK_AS_ADDING_EXTERNAL_CALENDAR":return E(E({},e),{addExternalCalendarForm:E(E({},e.addExternalCalendarForm),{isAddingExternalCalendar:!!n.isAddingExternalCalendar})});case"OPEN_EDITOR":return E(E({},e),{externalCalendarEditor:{isSaving:!1,url:n.url,name:n.name}});case"CLOSE_EDITOR":return E(E({},e),{externalCalendarEditor:void 0});case"SET_EDITING_EXTERNAL_CALENDAR_NAME":return e.externalCalendarEditor?E(E({},e),{externalCalendarEditor:E(E({},e.externalCalendarEditor),{name:n.name})}):e;case"MARK_AS_SAVING":return e.externalCalendarEditor?E(E({},e),{externalCalendarEditor:E(E({},e.externalCalendarEditor),{isSaving:n.isSaving})}):e;case"MARK_AS_DELETING":return E(E({},e),{externalCalendarsBeingDeleted:n.isDeleting?(0,c.uniq)(x(x([],e.externalCalendarsBeingDeleted,!0),[n.url],!1)):(0,c.without)(e.externalCalendarsBeingDeleted,n.url)})}}(e,n))&&void 0!==t?t:e},controls:d.controls,actions:X,selectors:e}),o()({path:"/nelio-content/v1/external-calendars"}).then((0,d.dispatch)(u).receiveExternalCalendars);const F=window.wp.components,G=window.wp.i18n;var K=t(4184),V=t.n(K);const q=window.NelioContent.components;var W=function(e){var n,t=e.url,r=(0,d.useSelect)((function(e){return e(u).isAddingAnExternalCalendar()})),a=(0,d.useSelect)((function(e){return e(u).isDeletingExternalCalendar(t)})),i=(0,d.useSelect)((function(e){return e(u).getExternalCalendar(t)})),o=null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"",c=(0,d.useDispatch)(u),s=c.openEditor,E=c.deleteExternalCalendar;return l.createElement("div",{className:V()({"nelio-content-external-calendar":!0,"nelio-content-external-calendar--is-deleting":a})},l.createElement("div",{className:"nelio-content-external-calendar__name"},o),l.createElement("div",{className:"nelio-content-external-calendar__url"},a?l.createElement("span",null,t):l.createElement(F.ExternalLink,{href:t},t)),a?l.createElement("div",{className:"nelio-content-external-calendar__feedback"},l.createElement(q.DeleteButton,{isDeleting:!0,onClick:function(){}})):l.createElement("div",{className:"nelio-content-external-calendar__actions"},l.createElement(F.Button,{variant:"link",disabled:r,onClick:function(){return s({url:t,name:o})}},(0,G._x)("Edit","command","nelio-content"))," | ",l.createElement(q.DeleteButton,{disabled:r,onClick:function(){return E(t)}})))},Q=function(){var e=(0,d.useSelect)((function(e){return e(u).getExternalCalendars()}));return(0,f.isEmpty)(e)?l.createElement("div",{className:"nelio-content-empty-external-calendar-list"},(0,G._x)("Add your first calendar using the form above","user","nelio-content")):l.createElement("div",{className:"nelio-content-external-calendar-list"},e.map((function(e){var n=e.url;return l.createElement(W,{key:n,url:n})})))},z=function(){var e=(0,d.useSelect)((function(e){return e(u).getExternalCalendarUrl()})),n=(0,d.useSelect)((function(e){return e(u).isSavingAnExternalCalendar()})),t=(0,d.useSelect)((function(e){return(0,c.map)(e(u).getExternalCalendars(),"url")})),r=(0,d.useDispatch)(u).addExternalCalendar,a=(0,d.useDispatch)(u).setNewExternalCalendarUrl,i=(0,c.trim)(e),o=(0,f.isUrl)(i)?i:void 0,s=!!o&&!t.includes(o);return l.createElement("div",{className:"nelio-content-new-external-calendar-form"},l.createElement(F.TextControl,{className:"nelio-content-new-external-calendar-form__input-text",value:e,onChange:a,disabled:n,placeholder:(0,G._x)("Write the URL of an ical calendar…","user","nelio-content")}),l.createElement(F.Button,{className:"nelio-content-new-external-calendar-form__add-button",variant:"primary",isBusy:n,onClick:function(){return o&&r(o)},disabled:n||!s},n?(0,G._x)("Adding…","text","nelio-content"):(0,G._x)("Add","command","nelio-content")))},H=function(){var e=(0,d.useSelect)((function(e){return e(u).getEditingExternalCalendarUrl()})),n=(0,d.useSelect)((function(e){return e(u).getEditingExternalCalendarName()})),t=(0,d.useSelect)((function(n){var t=n(u).getExternalCalendar,r=e?t(e):void 0;return(null==r?void 0:r.name)||""})),r=(0,d.useSelect)((function(e){return e(u).isSavingAnExternalCalendar()})),a=(0,d.useDispatch)(u),i=a.closeEditor,o=a.saveExternalCalendar,s=a.setEditingExternalCalendarName;if(!e)return null;var E=n!==t,x=function(e){return(0,f.isEmpty)((0,c.trim)(e))?(0,G._x)("Calendar name is missing","text","nelio-content"):""}(n);return l.createElement(F.Modal,{title:(0,G._x)("Rename Calendar","text","nelio-content"),className:"nelio-content-edit-external-calendar-modal",isDismissible:!r,shouldCloseOnEsc:!r,shouldCloseOnClickOutside:!r,onRequestClose:function(){return!r&&i()}},l.createElement(F.TextControl,{required:!0,label:(0,G._x)("Name","text","nelio-content"),disabled:r,value:n,onChange:s,placeholder:(0,G._x)("Name this calendar…","user","nelio-content")}),l.createElement("div",{className:"nelio-content-edit-external-calendar-modal__actions"},l.createElement(q.SaveButton,{variant:"primary",isUpdate:!0,isSaving:r,disabled:!E,error:x,onClick:function(){return o({url:e,name:n})}})))},J=function(){return l.createElement("div",{className:"nelio-content-external-calendar-settings-layout"},l.createElement(l.StrictMode,null,l.createElement(F.SlotFillProvider,null,l.createElement(z,null),l.createElement(Q,null),l.createElement(H,null),l.createElement(F.Popover.Slot,null))))};function Y(e){var n=document.getElementById(e);(0,l.render)(l.createElement(J,null),n)}})();var a=NelioContent="undefined"==typeof NelioContent?{}:NelioContent;for(var l in r)a[l]=r[l];r.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();