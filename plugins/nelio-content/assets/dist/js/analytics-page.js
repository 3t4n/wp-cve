(()=>{var e={4184:(e,t)=>{var n;!function(){"use strict";var o={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var r=typeof n;if("string"===r||"number"===r)e.push(n);else if(Array.isArray(n)){if(n.length){var i=a.apply(null,n);i&&e.push(i)}}else if("object"===r){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var l in n)o.call(n,l)&&n[l]&&e.push(l)}}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{"use strict";n.r(o),n.d(o,{initPage:()=>Te});var e={};n.r(e),n.d(e,{arePostsFullyLoaded:()=>x,arePostsWithCriteriaFullyLoaded:()=>P,getAuthorFilter:()=>_,getFilterCriteria:()=>h,getNextPageToLoad:()=>N,getPeriodFilterMode:()=>y,getPeriodFilterValue:()=>g,getPostIds:()=>C,getPostIdsMatchingCriteria:()=>S,getPostTypeFilter:()=>E,getSortingCriterion:()=>v,isLoadingPosts:()=>w,isLoadingPostsWithCriteria:()=>T});var t={};n.r(t),n.d(t,{markFilterCriteriaAsLoading:()=>M,receivePostsMatchingCriteria:()=>F,setAuthorFilter:()=>I,setPeriodFilter:()=>b,setPostTypeFilter:()=>R,sortBy:()=>A,updateFilterCriteriaPagination:()=>L});var a={};n.r(a),n.d(a,{loadPosts:()=>j});const r=window.wp.element,i=window.wp.data,l=window.NelioContent.data,s=window.lodash;function c(e){var t=e.sortBy,n=e.author,o=void 0===n?"nc-all-authors":n,a=e.postType,r=void 0===a?"nc-all-types":a,i=e.periodMode,l=e.periodValue,s="custom"===i?"".concat(l.from,">").concat(l.to):i;return"".concat(t,",").concat(s,",").concat(o,",").concat(r)}var u="nelio-content/analytics",d={sortBy:"pageviews",filters:{author:void 0,period:{mode:"all-time",value:{from:"",to:""}},postType:void 0},status:{loading:[],pagination:{}},postsByCriteria:{}},m=function(){return m=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},m.apply(this,arguments)},p=function(e,t,n){if(n||2===arguments.length)for(var o,a=0,r=t.length;a<r;a++)!o&&a in t||(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))};const f=window.NelioContent.utils;function v(e){return e.sortBy}function y(e){return e.filters.period.mode}function g(e){return e.filters.period.value}function _(e){return e.filters.author}function E(e){return e.filters.postType}function h(e){return{sortBy:v(e),author:_(e),postType:E(e),periodMode:y(e),periodValue:g(e)}}function S(e,t){return e.postsByCriteria[c(t)]||[]}function T(e,t){return e.status.loading.includes(c(t))}function P(e,t){var n=e.status.pagination[c(t)];return!(0,f.isEmpty)(n)&&!!n.isFullyLoaded}function N(e,t){var n,o=e.status.pagination[c(t)];return(null!==(n=null==o?void 0:o.lastLoadedPage)&&void 0!==n?n:0)+1}function C(e){return S(e,h(e))}function w(e){return T(e,h(e))}function x(e){return P(e,h(e))}function A(e){return{type:"SORT_BY",criterion:e}}function b(e,t){return{type:"SET_PERIOD_FILTER",mode:e,value:t}}function I(e){return{type:"SET_AUTHOR_FILTER",author:e}}function R(e){return{type:"SET_POST_TYPE_FILTER",postType:e}}function F(e,t){return{type:"RECEIVE_POSTS_MATCHING_CRITERIA",criteria:e,posts:t}}function M(e,t){return{type:"MARK_FILTER_CRITERIA_AS_LOADING",criteria:e,isLoading:t}}function L(e,t){return{type:"UPDATE_FILTER_CRITERIA_PAGINATION",criteria:e,pagination:t}}const O=window.wp.apiFetch;var B=n.n(O);const k=window.wp.url;var D=function(e,t,n,o){return new(n||(n=Promise))((function(a,r){function i(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((o=o.apply(e,t||[])).next())}))},Y=function(e,t){var n,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(i=0)),i;)try{if(n=1,o&&(a=2&l[0]?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],o=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};function j(){return D(this,void 0,void 0,(function(){var e,t,n,o,a,r,s,c;return Y(this,(function(d){switch(d.label){case 0:if(e=(0,i.select)(u).getFilterCriteria(),t=e.periodMode,n=e.periodValue,!("custom"!==t||n.from&&n.to))return[2];if((0,i.select)(u).arePostsWithCriteriaFullyLoaded(e))return[2];if((0,i.select)(u).isLoadingPostsWithCriteria(e))return[2];(0,i.dispatch)(u).markFilterCriteriaAsLoading(e,!0),o=(0,i.select)(u).getNextPageToLoad(e),d.label=1;case 1:return d.trys.push([1,3,,4]),a=e.sortBy,r=e.author,s=e.postType,[4,B()({path:(0,k.addQueryArgs)("/nelio-content/v1/analytics/top-posts",{sortBy:a,from:n.from||void 0,to:n.to||void 0,author:r||void 0,postType:"_nc-all"!==s?s:void 0,perPage:10,page:o})})];case 2:return c=d.sent(),(0,i.dispatch)(l.STORE_NAME).receivePosts(c.results),(0,i.dispatch)(u).receivePostsMatchingCriteria(e,c.results),(0,i.dispatch)(u).updateFilterCriteriaPagination(e,{lastLoadedPage:o,isFullyLoaded:!c.pagination.more}),[3,4];case 3:return d.sent(),[3,4];case 4:return(0,i.dispatch)(u).markFilterCriteriaAsLoading(e,!1),[2]}}))}))}var q=function(){return q=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},q.apply(this,arguments)},G=q(q({},t),a);(0,i.registerStore)(u,{reducer:function(e,t){var n;return void 0===e&&(e=d),null!==(n=function(e,t){var n,o;switch(t.type){case"SORT_BY":return m(m({},e),{sortBy:t.criterion});case"SET_PERIOD_FILTER":return m(m({},e),{filters:m(m({},e.filters),{period:{mode:t.mode,value:t.value}})});case"SET_AUTHOR_FILTER":return m(m({},e),{filters:m(m({},e.filters),{author:t.author})});case"SET_POST_TYPE_FILTER":return m(m({},e),{filters:m(m({},e.filters),{postType:t.postType})});case"MARK_FILTER_CRITERIA_AS_LOADING":return m(m({},e),{status:m(m({},e.status),{loading:t.isLoading?(0,s.uniq)(p(p([],e.status.loading,!0),[c(t.criteria)],!1)):(0,s.without)(e.status.loading,c(t.criteria))})});case"UPDATE_FILTER_CRITERIA_PAGINATION":return m(m({},e),{status:m(m({},e.status),{pagination:m(m({},e.status.pagination),(n={},n[c(t.criteria)]=t.pagination,n))})});case"RECEIVE_POSTS_MATCHING_CRITERIA":var a=e.postsByCriteria[c(t.criteria)]||[];return m(m({},e),{postsByCriteria:m(m({},e.postsByCriteria),(o={},o[c(t.criteria)]=p(p([],a,!0),(0,s.map)(t.posts,"id"),!0),o))})}}(e,t))&&void 0!==n?n:e},controls:i.controls,actions:G,selectors:e});const V=window.wp.components,U=window.wp.i18n,H=window.NelioContent.socialMessageEditor,W=window.NelioContent.components,$=window.moment;var K=n.n($);const Q=window.NelioContent.date;var z=function(e){var t=e.mode,n=e.from,o=e.to,a=e.onChange,i=(0,l.useUtcNow)(),s=(0,l.useToday)();return"custom"===t?r.createElement("div",{style:{alignItems:"center",display:"flex"}},r.createElement(W.DateInput,{value:n,max:s,onChange:function(e){void 0===e&&(e="");var n="";e<o&&(n=o),e===s&&(n=s),a({mode:t,value:{from:e,to:n}})}}),r.createElement(W.DateInput,{value:o,min:n,max:s,onChange:function(e){void 0===e&&(e=""),a({mode:t,value:{from:n,to:n&&n>e?"":e}})}}),r.createElement(V.Button,{variant:"link",onClick:function(){return a({mode:"all-time",value:{from:"",to:""}})}},r.createElement("span",{className:"screen-reader-text"},(0,U._x)("Back","command","nelio-content")),r.createElement(V.Dashicon,{icon:"undo"}))):r.createElement(V.SelectControl,{options:J,value:t,onChange:function(e){switch(e){case"month-to-date":return a({mode:e,value:{from:(0,Q.date)("Y-m",i)+"-01",to:(0,Q.date)("Y-m-d",i)}});case"last-30-days":return a({mode:e,value:{from:(0,Q.date)("Y-m-d",K()(i).add(-30,"days")),to:(0,Q.date)("Y-m-d",i)}});case"year-to-date":return a({mode:e,value:{from:(0,Q.date)("Y",i)+"-01-01",to:(0,Q.date)("Y-m-d",i)}});case"last-12-months":return a({mode:e,value:{from:(0,Q.date)("Y-m-d",K()(i).add(-12,"months")),to:(0,Q.date)("Y-m-d",i)}});case"custom":var t=o||i;return a({mode:e,value:{from:(0,Q.date)("Y",t)+"-01-01",to:(0,Q.date)("Y-m-d",t)}});default:return a({mode:"all-time",value:{from:"",to:""}})}}})},J=[{value:"all-time",label:(0,U._x)("All Time","text","nelio-content")},{value:"month-to-date",label:(0,U._x)("Month to date","text","nelio-content")},{value:"last-30-days",label:(0,U._x)("Last 30 days","text","nelio-content")},{value:"year-to-date",label:(0,U._x)("Year to date","text","nelio-content")},{value:"last-12-months",label:(0,U._x)("Last 12 months","text","nelio-content")},{value:"custom",label:(0,U._x)("Custom Period","text","nelio-content")}],X=function(e,t,n){if(n||2===arguments.length)for(var o,a=0,r=t.length;a<r;a++)!o&&a in t||(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))},Z=function(e){var t=e.value,n=e.onChange,o=(0,l.usePostTypes)();return r.createElement(V.SelectControl,{options:X([{value:"__nc-all__",label:(0,U._x)("All Content","text","nelio-content")}],o.map((function(e){return{value:e.name,label:e.labels.plural}})),!0),value:t,onChange:function(e){return n("__nc-all__"===e?void 0:e)}})},ee=function(){var e=(0,i.useSelect)((function(e){return e(u).getFilterCriteria()})),t=(0,i.useSelect)((function(e){return e(l.STORE_NAME).isMultiAuthor()})),n=1<(0,l.usePostTypes)().length,o=e.author,a=e.postType,s=e.periodMode,c=e.periodValue,d=te(),m=ne(),p=oe();return r.createElement("div",{className:"nelio-content-analytics-post-filter"},r.createElement("div",{className:"nelio-content-analytics-post-filter__criterion"},r.createElement(z,{mode:s,from:c.from,to:c.to,onChange:m})),t&&r.createElement("div",{className:"nelio-content-analytics-post-filter__criterion"},r.createElement(W.AuthorSearcher,{value:o,onChange:d,hasAllAuthors:!0})),n&&r.createElement("div",{className:"nelio-content-analytics-post-filter__criterion"},r.createElement(Z,{value:a,onChange:p})))},te=function(){var e=(0,i.useDispatch)(u),t=e.loadPosts,n=e.setAuthorFilter;return function(e){n(e),t()}},ne=function(){var e=(0,r.useState)({fn:ie}),t=e[0].fn,n=e[1],o=(0,i.useDispatch)(u),a=o.loadPosts,l=o.setPeriodFilter;return(0,r.useEffect)((function(){ie===t&&n({fn:(0,s.debounce)(a,600)})}),[t]),function(e){var n=e.mode,o=e.value;if(l(n,o),"custom"!==n||re(o))return"custom"===n?t():a()}},oe=function(){var e=(0,i.useDispatch)(u),t=e.loadPosts,n=e.setPostTypeFilter;return function(e){n(e),t()}},ae=/^\d{4}-\d{2}-\d{2}$/,re=function(e){var t=e.from,n=void 0===t?"":t,o=e.to,a=void 0===o?"":o;return ae.test(n)&&ae.test(a)},ie=(0,s.debounce)((function(){return new Promise((function(e){return e()}))}),0),le=n(4184),se=n.n(le),ce=function(e){var t=e.className,n=e.postId,o=ue(n),a=de(n),i=me(n),l=i.published,s=i.total,c=pe(n);return o?r.createElement("div",{className:"nelio-content-analytics-social-queue nelio-content-analytics-social-queue--is-loading ".concat(t)},r.createElement(V.Spinner,null)):r.createElement("div",{className:"nelio-content-analytics-social-queue ".concat(t)},r.createElement("div",{className:"nelio-content-analytics-social-queue__title"},(0,U._x)("Social Queue","text","nelio-content"),r.createElement(V.Tooltip,{text:(0,U._x)("Total number of scheduled social messages.","text","nelio-content"),position:"bottom center"},r.createElement("span",{className:"nelio-content-analytics-social-queue__help-icon"},r.createElement(V.Dashicon,{icon:"editor-help"})))),r.createElement("div",{className:"nelio-content-analytics-social-queue__message-count"},s-l),r.createElement("div",{className:"nelio-content-analytics-social-queue__published-message-count"},l!==s?(0,U.sprintf)(/* translators: 1 -> number of social messages sent, 2 -> total number of social messages */
(0,U._x)("Sent: %1$d/%2$d","text","nelio-content"),l,s):(0,U.sprintf)(/* translators: 1 -> number of social messages sent */
(0,U._x)("Sent: %d","text","nelio-content"),l)),r.createElement("div",{className:"nelio-content-analytics-social-queue__actions"},r.createElement(V.Button,{variant:"secondary",isSmall:!0,disabled:!a,onClick:c},(0,U._x)("Add Message","command","nelio-content"))))},ue=function(e){return(0,i.useSelect)((function(t){return t(l.STORE_NAME).isLoadingPostRelatedItems(e)}))},de=function(e){return(0,i.useSelect)((function(t){var n=t(l.STORE_NAME),o=n.canCurrentUserCreateMessagesRelatedToPost,a=n.getPost,r=n.isSubscribed,i=a(e);return r()&&o(i)}))},me=function(e){return(0,i.useSelect)((function(t){var n=t(l.STORE_NAME),o=n.getSocialMessage,a=n.getSocialMessageIdsRelatedToPost,r=(0,s.map)(a(e),o);return{published:(0,s.filter)(r,{status:"publish"}).length,total:r.length}}))},pe=function(e){var t=(0,i.useSelect)((function(t){return t(l.STORE_NAME).getPost(e)})),n=(0,i.useDispatch)(H.STORE_NAME).openNewSocialMessageEditor;return function(){return n({},{context:"analytics",post:t})}},fe=function(e){var t,n=e.postId,o=(0,l.usePost)(n),a=(0,l.useAuthor)(null==o?void 0:o.author),s=(0,i.useSelect)((function(e){return e(l.STORE_NAME).isGAConnected()}));if(!o)return null;var c=o.title,u=o.excerpt,d=o.permalink,m=o.date,p=o.imageSrc,f=null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"",v=o.author;return r.createElement("div",{className:se()({"nelio-content-analytics-post":!0,"nelio-content-analytics-post--has-no-pageviews":!s})},r.createElement("div",{className:"nelio-content-analytics-post__post"},r.createElement("div",{className:"nelio-content-analytics-post__title"},r.createElement(V.ExternalLink,{href:d},c)),r.createElement("div",{className:"nelio-content-analytics-post__excerpt"},u||r.createElement("br",null)),r.createElement("div",{className:"nelio-content-analytics-post__image"},r.createElement("div",{className:"nelio-content-analytics-post__actual-image",style:{backgroundImage:p?"url(".concat(p,")"):void 0}})),r.createElement("div",{className:"nelio-content-analytics-post__author"},r.createElement(W.AuthorIcon,{className:"nelio-content-analytics-post__author-icon",authorId:v}),r.createElement("span",{className:"nelio-content-analytics-post__author-name"},f||(0,U._x)("Unknown Author","text","nelio-content"))),r.createElement("div",{className:"nelio-content-analytics-post__details"},o.typeName||o.type," • ",(0,Q.dateI18n)((0,Q.getSettings)().formats.date,m||""))),r.createElement(W.PostPageviewsAnalytics,{className:"nelio-content-analytics-post__pageviews",postId:n}),r.createElement(W.PostEngagementAnalytics,{className:"nelio-content-analytics-post__engagement",postId:n}),r.createElement(ce,{className:"nelio-content-analytics-post__social-queue",postId:n}))},ve=function(){var e=ge(),t=_e(),n=ye(),o=!Ee(),a=(0,i.useDispatch)(u).loadPosts;return t?null:e&&(0,f.isEmpty)(n)?r.createElement("div",{className:"nelio-content-analytics-post-list"},r.createElement(W.LoadingAnimation,null)):(0,f.isEmpty)(n)?r.createElement("div",{className:"nelio-content-analytics-post-list nelio-content-analytics-post-list--empty-list"},r.createElement(V.Dashicon,{className:"nelio-content-analytics-post-list__no-posts-icon",icon:"info"}),r.createElement("div",{className:"nelio-content-analytics-post-list__no-posts-message"},(0,U._x)("No posts matched your criteria","text","nelio-content"))):r.createElement("div",{className:"nelio-content-analytics-post-list"},n.map((function(e){return r.createElement(fe,{key:e,postId:e})})),r.createElement("div",{className:"nelio-content-analytics-post-list__action"},o&&r.createElement(V.Button,{disabled:e,isBusy:e,variant:"secondary",onClick:a},e?(0,U._x)("Loading…","text","nelio-content"):(0,U._x)("Load More","command","nelio-content"))))},ye=function(){return(0,i.useSelect)((function(e){return e(u).getPostIds()||[]}))},ge=function(){return(0,i.useSelect)((function(e){return e(u).isLoadingPosts()}))},_e=function(){return(0,i.useSelect)((function(e){var t=(0,e(u).getFilterCriteria)(),n=t.periodMode,o=t.periodValue||{},a=o.from,r=o.to;return!("custom"!==n||a&&r)}))},Ee=function(){return(0,i.useSelect)((function(e){return e(u).arePostsFullyLoaded()}))},he=function(){var e=(0,i.useSelect)((function(e){return e(l.STORE_NAME).isGAConnected()})),t=(0,i.useSelect)((function(e){return e(u).getFilterCriteria().sortBy})),n=(0,i.useDispatch)(u),o=n.sortBy,a=n.loadPosts,s=function(e){o(e),a()};return e?r.createElement("div",{className:"nelio-content-analytics-sorting-criterion"},"pageviews"===t?r.createElement(r.Fragment,null,(0,U._x)("Sorted by pageviews.","text","nelio-content")," ",r.createElement(V.Button,{className:"nelio-content-analytics-sorting-criterion__button",variant:"link",onClick:function(){return s("engagement")}},(0,U._x)("Sort by engagement","command","nelio-content"))):r.createElement(r.Fragment,null,(0,U._x)("Sorted by engagement.","text","nelio-content")," ",r.createElement(V.Button,{className:"nelio-content-analytics-sorting-criterion__button",variant:"link",onClick:function(){return s("pageviews")}},(0,U._x)("Sort by pageviews","command","nelio-content")))):null},Se=function(){return r.createElement(r.StrictMode,null,r.createElement(V.SlotFillProvider,null,r.createElement("div",{className:"nelio-content-analytics"},r.createElement("div",{className:"nelio-content-analytics__title"},r.createElement("h1",{className:"nelio-content-analytics__actual-title wp-heading-inline"},(0,U._x)("Analytics","text","nelio-content")),r.createElement(ee,null)),r.createElement(he,null),r.createElement(ve,null)),r.createElement(H.SocialMessageEditor,null),r.createElement(V.Popover.Slot,null)))};function Te(e){var t=document.getElementById(e);(0,r.render)(r.createElement(Se,null),t),(0,(0,i.select)(l.STORE_NAME).isGAConnected)()||(0,(0,i.dispatch)(u).sortBy)("engagement"),(0,(0,i.dispatch)(u).loadPosts)()}})();var a=NelioContent="undefined"==typeof NelioContent?{}:NelioContent;for(var r in o)a[r]=o[r];o.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();