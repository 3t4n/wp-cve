/**
 * File Un-Attach - Admin
 *
 * @file admin.js
 * @package File Un-Attach
 * @author Hafid Trujillo
 * @copyright 20010-2013
 * @filesource  wp-content/plugins/file-un-attach/admin.js
 * Object Copied from wp media-dev.js and renamed
 * @since 1.0.0
 */

var funFindPosts;(function(e){funFindPosts={open:function(t,n){overlay=e(".ui-find-overlay");var r=document.documentElement.scrollTop||e(document).scrollTop();if(overlay.length==0){e("body").append('<div class="ui-find-overlay"></div>');funFindPosts.overlay()}overlay.show();if(t&&n){e("#fun-affected").attr("name",t).val(n)}e("#fun-find-posts").show().draggable({handle:"#fun-find-posts-head"}).css({top:r+30+"px",left:"50%",marginLeft:"-250px"});e("#fun-find-posts-input").val("");e("#fun-find-posts-input").focus().keyup(function(e){if(e.which==27){funFindPosts.close()}});return false},close:function(){e("#fun-find-posts-response").html("");e("#fun-find-posts").draggable("destroy").hide();e(".ui-find-overlay").hide()},overlay:function(){e(".find-box-inside").unbind("click");e(".ui-find-overlay").css({"z-index":"999",width:e(document).width()+"px",height:e(document).height()+"px"}).bind("click",function(){funFindPosts.close()})},send:function(){var t={action:"find_posts",type:e("#fun_post_type").val(),ps:e("#fun-find-posts-input").val(),exclude:e("input[name='fun-current-attached']").val(),_wpnonce:funlocal.nonceajax};e.ajax({data:t,type:"POST",url:funlocal.adminurl+"ajax.php",success:function(e){funFindPosts.show(e)},error:function(e){funFindPosts.error(e)}})},is_attached:function(t){var n={img:t,postid:funlocal.postid,action:"is_attached",_wpnonce:funlocal.nonceajax};e.ajax({data:n,type:"POST",url:funlocal.adminurl+"ajax.php",success:function(t){e(" div.fun-actions").html(t)}})},attchd:function(t){var n={img:t,action:"find_attached",ps:e("#fun-find-posts-input").val(),_wpnonce:funlocal.nonceajax};e.ajax({data:n,type:"POST",url:funlocal.adminurl+"ajax.php",success:function(e){funFindPosts.show(e)},error:function(e){funFindPosts.error(e)}})},show:function(t){e(".fun-search-results").remove();if(typeof t=="string"){this.error({responseText:t});return}var n=wpAjax.parseAjaxResponse(t);if(n.errors){this.error({responseText:wpAjax.broken})}n=n.responses[0];e("#fun-find-posts-response").append(n.data)},error:function(t){e(".fun-search-results").remove();var n=t.statusText;if(t.responseText){n=t.responseText}if(n){e("#fun-find-posts-response").append(n)}}};e(document).ready(function(){e("#fun-find-posts-submit").click(function(t){if(""==e("#fun-find-posts-response").html())t.preventDefault()});e("#fun-find-posts .find-box-search :input").keypress(function(e){if(13==e.which){funFindPosts.send();return false}});e("#fun-find-posts-search").click(funFindPosts.send);e("#fun-find-posts-close").click(funFindPosts.close);e("#doaction, #doaction2").click(function(t){e('select[name^="action"]').each(function(){if(e(this).val()=="attach"){t.preventDefault();funFindPosts.open()}})})})})(jQuery);jQuery(document).ready(function(e){e("body").delegate(".funattach","click",function(){id=e(this).attr("id").replace("unattach-","");e(".fun-mess-"+id).show();return false});e("body").delegate(".fun-no","click",function(){e(this).parents(".fun-message").hide();return false});e("body").delegate(".fun-yes","click",function(){id=e(this).attr("id").replace("file-unattch-","");count=parseInt(e("#attachments-count").html());if(count>0)e("#attachments-count").html(count-1);post_id=e("#post_id").val();if(!post_id)post_id=e("#post_ID").val();e.post(funlocal.adminurl+"ajax.php",{imageid:id,postid:post_id,action:"unattach",_wpnonce:funlocal.nonceajax});if(e(this).parents(".attachment-details")[0])e(".media-sidebar .attachment-details, "+".media-sidebar .attachment-display-settings").fadeOut("slow");else e(this).parents(".media-item").fadeOut("slow");return false});e("body").delegate(".fun-unattach-row","click",function(){id=e(this).attr("id").replace("file-unattch-","");post_id=e("#post_id").val();if(!post_id)post_id=e("#post_ID").val();e.post(funlocal.adminurl+"ajax.php",{imageid:id,postid:post_id,action:"unattach",_wpnonce:funlocal.nonceajax});td=e(this).parents("td");td.find("span").remove();td.find("strong").replaceWith("( "+funlocal.detach+" )");e(this).remove();return false});e("body").delegate(".fileattach","click",function(){e(this).hide();id=e(this).attr("id").replace("attach-","");e(".fun-mess-"+id).show();postid=!funlocal.postid?post_id:funlocal.postid;e("#attachments-count").html(parseInt(e("#attachments-count").html())+1);e.post(funlocal.adminurl+"ajax.php",{imageid:id,postid:postid,action:"attach",_wpnonce:funlocal.nonceajax});return false});e("body").delegate(".fun-all-attach, .fun-all-detach","click",function(){var t=[];$link=e(this),directive=e(this).attr("class").replace("fun-all-","");postid=!funlocal.postid?post_id:funlocal.postid;if(directive=="attach")labels=[funlocal.attach,funlocal.attached];else labels=[funlocal.detach,funlocal.detached];e(".media-frame-content .attachments li.selected").each(function(){t.push(e(this).find("img").attr("data-attach"))});var n=function(){$link.html(labels[0]);e(".media-frame-content .attachments li").off("click",n)};e.post(funlocal.adminurl+"ajax.php",{postid:postid,images:t,directive:directive,action:"attach_multiple",_wpnonce:funlocal.nonceajax},function(){$link.fadeOut().fadeIn().html(labels[1]);e(".media-frame-content .attachments li").on("click",n)});return false});e(".fun-find-posts").click(function(){id=e(this).attr("id").replace("fun-find-posts-","");funFindPosts.open("media[]",id);return false});e(".attached-list").click(function(){id=e(this).attr("id").replace("attached-list-","");funFindPosts.open("media[]",id);funFindPosts.attchd(id);return false})})