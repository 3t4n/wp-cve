"use strict";jQuery(document).ready(function(i){i("body, .list-item-content").on("keydown",".add-list-item",function(t){if(13==t.keyCode&&""!=i(this).val()){var e=i(this).closest(".postbox").attr("id"),o='<div class="list-item"><div class="dashicons dashicons-menu wpdn-note-sortable"></div><input type="checkbox"><span class="list-item-content" contenteditable="true">'+i(this).val()+'</span><div class="delete-item dashicons dashicons-no-alt"></div></div>';i("#"+e+" div.wp-dashboard-note").append(o),i(this).val(""),i(this).trigger("note-sortable"),i(this).trigger("wpdn-update",this)}}),i(document.body).on("click",".delete-item",function(){var t=i(this).closest(".postbox").attr("id");i(this).parent(".list-item").remove(),i(document.body).trigger("wpdn-update",["",t])}),i(document.body).on("click",".wpdn-visibility",function(){i(this).toggleClass("dashicons-admin-users dashicons-groups"),"public"==i(this).parent().attr("data-visibility")?(i(this).parent(".wpdn-toggle-visibility").attr("data-visibility","private"),i(this).parent(".wpdn-toggle-visibility").attr("title","Visibility: Just me")):(i(this).parent(".wpdn-toggle-visibility").attr("data-visibility","public"),i(this).parent(".wpdn-toggle-visibility").attr("title","Visibility: Everyone")),i(this).trigger("wpdn-update",this)}),i(document.body).on("click",".wpdn-note-type",function(){i(this).toggleClass("dashicons-list-view dashicons-welcome-write-blog");var t=i(this).closest("[data-note-type]").attr("data-note-type");"regular"==t?i(this).closest("[data-note-type]").attr("data-note-type","list"):i(this).closest("[data-note-type]").attr("data-note-type","regular");var e={action:"wpdn_toggle_note",post_id:i(this).closest(".postbox").attr("id").replace("note_",""),note_type:"regular"==t?"list":"regular",nonce:wpdn.nonce};i.post(ajaxurl,e,function(t){i("#note_"+e.post_id+" .inside").html(t).trigger("note-sortable")}),i(this).trigger("wpdn-update",this)}),i(document.body).on("wpdn-update",function(t,e,o){if(""!=e&&(o=i(e).closest(".postbox").attr("id")),o){i("#"+o+" .hndle .status").html('<span class="saving-icon"><img src="images/wpspin_light.gif"/> saving...</span>');var n={action:"wpdn_update_note",post_id:o.replace("note_",""),post_content:i("#"+o+" div.wp-dashboard-note").html(),post_title:i("#"+o+" .hndle .wpdn-title").html(),note_visibility:i("#"+o+" [data-visibility]").attr("data-visibility"),note_color_text:i("#"+o+" [data-color-text]").attr("data-color-text"),note_color:i("#"+o+" [data-note-color]").attr("data-note-color"),note_type:i("#"+o+" [data-note-type]").attr("data-note-type"),nonce:wpdn.nonce};i.post(ajaxurl,n,function(t){i("#"+o+" .hndle .status").html('<span class="saved-icon"><div class="dashicons dashicons-yes"></div> saved!</span>'),i("#"+o+" .hndle .status *").fadeOut(1e3,function(){i(this).html("")})})}}),i(document.body).on("click",".wpdn-delete-note",function(){var t=i(this).closest(".postbox").attr("id");i("#"+t).slideUp(500,function(){i(this).remove()});var e={action:"wpdn_delete_note",post_id:t.replace("note_",""),nonce:wpdn.nonce};i.post(ajaxurl,e)}),i(document.body).on("click",".wpdn-add-note, #wp-admin-bar-wpdn-add-note a",function(t){var e={action:"wpdn_add_note",nonce:wpdn.nonce};i.post(ajaxurl,e,function(t){t=jQuery.parseJSON(t),jQuery("#postbox-container-1 #normal-sortables").append(t.note),jQuery("body, html").animate({scrollTop:i("#note_"+t.post_id).offset().top-50},750),jQuery("#note_"+t.post_id+" .add-list-item").focus()}),i("html, body").bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(t){(0<t.which||"mousedown"===t.type||"mousewheel"===t.type)&&i("html, body").stop().unbind("scroll mousedown DOMMouseScroll mousewheel keyup")}),t.preventDefault()}),i(document.body).on("click",".color",function(){var t=i(this).attr("data-select-color"),e=i(this).attr("data-select-color-text");i(this).closest(".postbox").css("background-color",t),i(this).closest(".wp-dashboard-note-wrap").attr("data-color-text",e),i(this).closest("[data-note-color]").attr("data-note-color",t),i(this).closest("[data-color-text]").attr("data-color-text",e),i(this).trigger("wpdn-update",this)}),i(document.body).on("blur",".list-item-content, [contenteditable=true]",function(){i(this).trigger("wpdn-update",this)}),i(document.body).on("keydown","[data-note-type=list], .wpdn-title, .list-item-content",function(t){if(13==t.keyCode)return i(this).trigger("wpdn-update",this),i(this).blur(),!1}),i(document.body).on("keydown","[data-note-type=regular] .wp-dashboard-note",function(t){if(13==t.keyCode&&(t.ctrlKey||t.metaKey))return i(this).trigger("wpdn-update",this),i(this).blur(),!1}),i("body, .postbox .hndle").on("click",".wpdn-edit-title",function(t){i(this).prev().focus(),document.execCommand("selectAll",!1,null),t.stopPropagation()}),i("input[type=checkbox]").change(function(){this.checked?i(this).attr("checked","checked"):i(this).removeAttr("checked"),i(this).trigger("wpdn-update",this)}),i(document.body).on("note-sortable",function(){i(".wp-dashboard-note").sortable({handle:".wpdn-note-sortable",update:function(t,e){i(this).trigger("wpdn-update",this)},connectWith:[".wp-dashboard-note"],axis:"y"})}).trigger("note-sortable"),i(".wp-dashboard-note-wrap a").hover(function(){i(this).append('<span class="link-hover" contenteditable="false"><a href="'+i(this).attr("href")+'" target="_blank" contenteditable="false">Open link</a></span>')},function(){i(".link-hover").remove()}),i(document.body).on("paste","[contenteditable]",function(t){t.preventDefault();var e=(t.originalEvent||t).clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)})});