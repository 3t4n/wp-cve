function clipboardCopy(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).catch(function(e){throw void 0!==e?e:new DOMException("The request is not allowed","NotAllowedError")});var t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",document.body.appendChild(t);var r=window.getSelection(),i=window.document.createRange();r.removeAllRanges(),i.selectNode(t),r.addRange(i);var s=!1;try{s=window.document.execCommand("copy")}catch(e){console.log("error",e)}return r.removeAllRanges(),window.document.body.removeChild(t),s?Promise.resolve():Promise.reject(new DOMException("The request is not allowed","NotAllowedError"))}var currentElement=null;function getCurrentElement(){return currentElement}jQuery("body").on("focus",".wunderauto-action-fields input, .wunderauto-action-fields textarea",function(e){currentElement=document.activeElement});var parametersComponent={template:document.querySelector("#parameters-component").innerHTML,props:["stepkey"],data:function(){var e=document.querySelector("#parameters-data"),t=JSON.parse(e.textContent);return parameters={parameters:t.parameters,editor:{visible:!1,phpClass:null,result:"",values:editorValues,config:editorConfig},selectedTab:!1,selectedGroup:!1,stepKey:this.stepkey},parameters},updated:function(){this.stepKey=this.stepkey},computed:{editorResult:function(){var e=this.parameterTag,t=[];for([key,value]of Object.entries(this.editor.values))if("counter"!==key&&this.editor.values[key]){var r=this.editor.config[key].variable;t.push(r+": '"+value+"'")}var i="{{ "+e;return t.length>0&&(i=i+" | "+t.join(" , ")),i+=" }}",this.editor.result=i,i},parameterTag:function(){return("general"===this.editor.object||this.editor.object.includes("general")?"":this.editor.object+".")+this.parameters[this.editor.phpClass].title}},methods:{openEditor:function(e,t,r){if(this.editor.phpClass!==e||this.editor.object!==t)for([key,value]of Object.entries(this.editor.values))"counter"!==key&&this.editor.values[key]&&(this.editor.values[key]=null);this.editor.values.counter++,this.editor.phpClass=e,this.editor.object=t,this.editor.proPromo=r,this.editor.visible=!0},closeEditor:function(e){if("copy"==e&&clipboardCopy(this.editorResult),"insert"==e){var t=getCurrentElement();if(t){var r=t.selectionStart,i=t.selectionEnd,s=t.value;t.value=s.slice(0,r)+this.editorResult+s.slice(i),t.focus(),t.selectionStart=r+this.editorResult.length,t.selectionEnd=t.selectionStart;var o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!0),t.dispatchEvent(o)}}this.editor.visible=!1},paramsForObjectIds:function(e){var t={};return e="general"===e?"*":e,Object.entries(parameters.parameters).forEach(function(r){if(r[1].objects.includes(e)){var i=r[1].group;void 0===t[i]&&(t[i]={}),t[i][r[0]]=r[1]}}),t}}},stepsComponent={template:document.querySelector("#steps-component").innerHTML,data:function(){var e=document.querySelector("#steps-data"),t=JSON.parse(e.textContent);steps={steps:t.steps,filters:t.filters,actions:t.actions,filterGroups:t.filterGroups,actionGroups:t.actionGroups,key:0,pwdField:!0,counter:0};var r=-1;return steps.steps.forEach(function(e){void 0!==e.key&&(r=Math.max(r,e.key))}),r++,steps.steps.forEach(function(e){void 0===e.key&&(e.key=r++)}),steps.key=r,steps},mixins:stepsMixins,mounted:function(){this.updateProvidedObjects()},updated:function(){this.updateProvidedObjects()},methods:{updateProvidedObjects:function(){var e=this.actions,t=this.$root;this.steps.forEach(function(r,i){if("action"===r.type)if(0!==r.action.action.length){var s=[],o=e[r.action.action];o.emittedObjects.length>0&&(s=o.emittedObjects.slice()),Array.isArray(r.action.value.objectRows)&&r.action.value.objectRows.forEach(function(e){s.push({id:e.name,type:e.type,source:"action"})}),t.updateObjects(i,s)}else t.updateObjects(i,[]);else t.updateObjects(i,[])})},addFilter:function(e,t,r){this.steps[e].filterGroups[t].filters.push(this.newFilter())},removeFilter:function(e,t,r){this.steps[e].filterGroups[t].filters.splice(r,1),0==this.steps[e].filterGroups[t].filters.length&&this.steps[e].filterGroups.splice(t,1)},addFilterGroup:function(e){this.steps[e].filterGroups.push(this.newFilterGroup())},addFilterStep:function(){this.steps.push({key:this.key++,type:"filters",filterGroups:[this.newFilterGroup()]}),this.counter++},addActionStep:function(){this.steps.push({key:this.key++,type:"action",action:this.newAction()}),this.counter++},removeStep:function(e){this.steps.splice(e,1)},reorderStep:function(e,t){var r=this.steps[e];this.steps[e]=this.steps[e+t],this.steps[e+t]=r,this.updateProvidedObjects()},toggleStep:function(e){this.steps[e].minimized=!this.steps[e].minimized},newFilterGroup:function(){return{filters:[this.newFilter()]}},newFilter:function(){return{filter:"",object:"",compare:"",value:null,arrValue:null}},newAction:function(){return{action:"",value:{}}},filterClass:function(e,t,r){return this.steps[e].filterGroups[t].filters[r].filterKey.split("::").slice(-1)[0]},filterChange:function(e,t,r){var i=this.steps[e].filterGroups[t].filters[r].value;if(null!==i){var s=this.steps[e].filterGroups[t].filters[r].filter,o=this.filters[s];this.arrayTypeInputType(o.inputType)?Array.isArray(i)||(this.steps[e].filterGroups[t].filters[r].value=[]):Array.isArray(i)&&(this.steps[e].filterGroups[t].filters[r].value=null)}},arrayTypeInputType:function(e){return["multiselect","ajaxmultiselect"].includes(e)},actionClass:function(e){return this.steps[e].action.action},stepCaption:function(e){var t=this.steps[e];return"action"===t.type&&t.action.action?": "+steps.actions[t.action.action].title:""},addActionValueRow:function(e,t){void 0===t&&(t={}),Array.isArray(this.steps[e].action.value.rows)||(this.steps[e].action.value.rows=[]),this.steps[e].action.value.rows.push(t)},removeActionValueRow:function(e,t){this.steps[e].action.value.rows.splice(t,1)},addActionValueObjectRow:function(e,t){Array.isArray(this.steps[e].action.value.objectRows)||(this.steps[e].action.value.objectRows=[]),this.steps[e].action.value.objectRows.push(t),this.updateProvidedObjects()},removeActionValueObjectRow:function(e,t){this.steps[e].action.value.objectRows.splice(t,1),this.updateProvidedObjects()},filtersForObjectIds:function(e,t){var r={};return Object.entries(steps.filters).forEach(function(i){i[1].objects.includes(t)&&(i[1].objectFilterKey=e+"::"+i[0],r[i[0]]=i[1])}),r},ajaxMultiSelectSearch:function(e,t){if(null===e||""===e)return[];var r=t._object.ajaxaction,i=t._object.noncename,s=t._object.term2,o=t._object.term3,n=WunderAutoData[i],a=[],u=new URLSearchParams;return u.append("action",r),u.append("security",n),u.append("term",e),u.append("term2",s),u.append("term3",o),axios.post(ajaxurl,u).then(function(e){for(var[t,r]of Object.entries(e.data))console.log({value:t,label:r}),a.push({value:t,label:r});return a}).catch(function(e){return console.log(e),a})},handleClick:function(e,t,r){var i=window[e];if(i)return i(t,r)}}},triggersComponent={template:document.querySelector("#triggers-component").innerHTML,data:function(){var e=document.querySelector("#trigger-data"),t=JSON.parse(e.textContent);return trigger={trigger:t.trigger,triggers:t.triggers,groups:t.groups,pwdField:!0,lastTrigger:null},trigger},mixins:triggerMixins,mounted:function(){this.lastTrigger=this.trigger.trigger,this.updateProvidedObjects()},beforeUpdate:function(){this.updateProvidedObjects()},methods:{updateProvidedObjects:function(){if(this.trigger.trigger){this.lastTrigger!==this.trigger.trigger&&(this.trigger.value=trigger.triggers[this.trigger.trigger].defaultValue),this.lastTrigger=this.trigger.trigger;var e=this.triggers[this.trigger.trigger].providedObjects.slice();Array.isArray(this.trigger.value.objects)&&this.trigger.value.objects.forEach(function(t){t.type&&(t.name=t.name?t.name:t.type,e.push({id:t.name,type:t.type}))}),this.$root.updateObjects(-1,e)}},addTriggerValueObject:function(e){void 0===e&&(e={}),Array.isArray(this.trigger.value.objects)||(this.trigger.value.objects=[]),this.trigger.value.objects.push(e)},removeTriggerValueObject:function(e){this.trigger.value.objects.splice(e,1)}}},scheduleComponent={template:document.querySelector("#schedule-component").innerHTML,data:function(){var e=document.querySelector("#schedule-data"),t=JSON.parse(e.textContent);return schedule={schedule:t.schedule},schedule},mounted:function(){this.$root.delayed=this.delayed},updated:function(){this.$root.delayed=this.delayed,"delayed"!=this.schedule.when||this.schedule.delayFor||(this.schedule.delayFor=12,this.schedule.delayTimeUnit="hours")},computed:{delayed:function(){var e="direct"!==this.schedule.when;return this.$root.delayed=e,e}}},optionsComponent={template:document.querySelector("#options-component").innerHTML,data:function(){var e=document.querySelector("#options-data"),t=JSON.parse(e.textContent);return options={options:t.options},options}},workflowEditorApp=Vue.createApp({data:function(){var e=document.querySelector("#shared-data");return{objects:[],delayed:!1,formData:"",shared:JSON.parse(e.textContent)}},mixins:appMixins,methods:{save:function(){this.formData=JSON.stringify({trigger:this.$refs.trigger.$data.trigger,steps:this.$refs.steps.$data.steps,schedule:this.$refs.schedule.$data.schedule,options:this.$refs.options.$data.options,version:WunderAutoData.workflowVersion})},updateObjects:function(e,t){-1==e&&trigger.trigger.trigger&&(t.push({id:"currentuser",type:"user",description:"The currently logged in user (if any)"}),t.push({id:"general",type:"*",description:"General WordPress variables"})),this.objects[e+1]=t},currentObjects:function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=[]);var i={};return this.objects.forEach(function(s,o){e<o-1||s.forEach(function(e){r.includes(e.id)||t.length>0&&!t.includes(e.type)||(i[e.id]=e)})}),i}}});VueformMultiselect.props.ajaxaction={type:String,required:!1,default:""},VueformMultiselect.props.noncename={type:String,required:!1,default:""},VueformMultiselect.props.term2={type:String,required:!1,default:""},VueformMultiselect.props.term3={type:String,required:!1,default:""},workflowEditorApp.component("triggers",triggersComponent),workflowEditorApp.component("parameters",parametersComponent),workflowEditorApp.component("schedule",scheduleComponent),workflowEditorApp.component("options",optionsComponent),workflowEditorApp.component("steps",stepsComponent),workflowEditorApp.component("multiselect",VueformMultiselect),workflowEditorApp.mount("#workflow-editor-app");