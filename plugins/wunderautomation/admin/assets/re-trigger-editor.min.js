var retriggerQueryComponent={template:document.querySelector("#retriggerquery-component").innerHTML,data:function(){var e=document.querySelector("#retriggerquery-query-data"),t=JSON.parse(e.textContent);return{query:t.query,triggers:t.triggers}},mounted:function(){this.updateProvidedObjects()},updated:function(){this.updateProvidedObjects()},methods:{updateProvidedObjects:function(){if(this.query.objectType&&null!==this.query.objectType){var e=this.triggers[this.query.objectType].providedObjects.slice();this.$root.updateObjects(-1,e)}}}},reTriggerScheduleComponent={template:document.querySelector("#retriggerschedule-component").innerHTML,data:function(){var e=document.querySelector("#retriggerquery-schedule-data");return{schedule:JSON.parse(e.textContent).schedule}}};jQuery("body").on("focus",".wunderauto-action-fields input, .wunderauto-action-fields textarea",function(e){});var stepsComponent={template:document.querySelector("#steps-component").innerHTML,data:function(){var e=document.querySelector("#steps-data"),t=JSON.parse(e.textContent);steps={steps:t.steps,filters:t.filters,actions:t.actions,filterGroups:t.filterGroups,actionGroups:t.actionGroups,key:0,pwdField:!0,counter:0};var r=-1;return steps.steps.forEach(function(e){void 0!==e.key&&(r=Math.max(r,e.key))}),r++,steps.steps.forEach(function(e){void 0===e.key&&(e.key=r++)}),steps.key=r,steps},mixins:stepsMixins,mounted:function(){this.updateProvidedObjects()},updated:function(){this.updateProvidedObjects()},methods:{updateProvidedObjects:function(){var e=this.actions,t=this.$root;this.steps.forEach(function(r,i){if("action"===r.type)if(0!==r.action.action.length){var s=[],n=e[r.action.action];n.emittedObjects.length>0&&(s=n.emittedObjects.slice()),Array.isArray(r.action.value.objectRows)&&r.action.value.objectRows.forEach(function(e){s.push({id:e.name,type:e.type,source:"action"})}),t.updateObjects(i,s)}else t.updateObjects(i,[]);else t.updateObjects(i,[])})},addFilter:function(e,t,r){this.steps[e].filterGroups[t].filters.push(this.newFilter())},removeFilter:function(e,t,r){this.steps[e].filterGroups[t].filters.splice(r,1),0==this.steps[e].filterGroups[t].filters.length&&this.steps[e].filterGroups.splice(t,1)},addFilterGroup:function(e){this.steps[e].filterGroups.push(this.newFilterGroup())},addFilterStep:function(){this.steps.push({key:this.key++,type:"filters",filterGroups:[this.newFilterGroup()]}),this.counter++},addActionStep:function(){this.steps.push({key:this.key++,type:"action",action:this.newAction()}),this.counter++},removeStep:function(e){this.steps.splice(e,1)},reorderStep:function(e,t){var r=this.steps[e];this.steps[e]=this.steps[e+t],this.steps[e+t]=r,this.updateProvidedObjects()},toggleStep:function(e){this.steps[e].minimized=!this.steps[e].minimized},newFilterGroup:function(){return{filters:[this.newFilter()]}},newFilter:function(){return{filter:"",object:"",compare:"",value:null,arrValue:null}},newAction:function(){return{action:"",value:{}}},filterClass:function(e,t,r){return this.steps[e].filterGroups[t].filters[r].filterKey.split("::").slice(-1)[0]},filterChange:function(e,t,r){var i=this.steps[e].filterGroups[t].filters[r].value;if(null!==i){var s=this.steps[e].filterGroups[t].filters[r].filter,n=this.filters[s];this.arrayTypeInputType(n.inputType)?Array.isArray(i)||(this.steps[e].filterGroups[t].filters[r].value=[]):Array.isArray(i)&&(this.steps[e].filterGroups[t].filters[r].value=null)}},arrayTypeInputType:function(e){return["multiselect","ajaxmultiselect"].includes(e)},actionClass:function(e){return this.steps[e].action.action},stepCaption:function(e){var t=this.steps[e];return"action"===t.type&&t.action.action?": "+steps.actions[t.action.action].title:""},addActionValueRow:function(e,t){void 0===t&&(t={}),Array.isArray(this.steps[e].action.value.rows)||(this.steps[e].action.value.rows=[]),this.steps[e].action.value.rows.push(t)},removeActionValueRow:function(e,t){this.steps[e].action.value.rows.splice(t,1)},addActionValueObjectRow:function(e,t){Array.isArray(this.steps[e].action.value.objectRows)||(this.steps[e].action.value.objectRows=[]),this.steps[e].action.value.objectRows.push(t),this.updateProvidedObjects()},removeActionValueObjectRow:function(e,t){this.steps[e].action.value.objectRows.splice(t,1),this.updateProvidedObjects()},filtersForObjectIds:function(e,t){var r={};return Object.entries(steps.filters).forEach(function(i){i[1].objects.includes(t)&&(i[1].objectFilterKey=e+"::"+i[0],r[i[0]]=i[1])}),r},ajaxMultiSelectSearch:function(e,t){if(null===e||""===e)return[];var r=t._object.ajaxaction,i=t._object.noncename,s=t._object.term2,n=t._object.term3,o=WunderAutoData[i],u=[],c=new URLSearchParams;return c.append("action",r),c.append("security",o),c.append("term",e),c.append("term2",s),c.append("term3",n),axios.post(ajaxurl,c).then(function(e){for(var[t,r]of Object.entries(e.data))console.log({value:t,label:r}),u.push({value:t,label:r});return u}).catch(function(e){return console.log(e),u})},handleClick:function(e,t,r){var i=window[e];if(i)return i(t,r)}}},reTriggerEditorApp=Vue.createApp({data:function(){var e=document.querySelector("#shared-data");return{objects:[],formData:"",shared:JSON.parse(e.textContent)}},methods:{save:function(){this.formData=JSON.stringify({query:this.$refs.query.$data.query,schedule:this.$refs.schedule.$data.schedule,steps:this.$refs.steps.$data.steps,version:WunderAutoData.reTriggerVersion})},updateObjects:function(e,t){JSON.stringify(t)!==JSON.stringify(this.objects[e+1])&&(this.objects[e+1]=t)},currentObjects:function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=[]);var i={};return this.objects.forEach(function(s,n){e<n-1||s.forEach(function(e){r.includes(e.id)||t.length>0&&!t.includes(e.type)||(i[e.id]=e)})}),i}}});VueformMultiselect.props.ajaxaction={type:String,required:!1,default:""},VueformMultiselect.props.noncename={type:String,required:!1,default:""},VueformMultiselect.props.term2={type:String,required:!1,default:""},VueformMultiselect.props.term3={type:String,required:!1,default:""},reTriggerEditorApp.component("retriggerquery",retriggerQueryComponent),reTriggerEditorApp.component("retriggerschedule",reTriggerScheduleComponent),reTriggerEditorApp.component("multiselect",VueformMultiselect),reTriggerEditorApp.component("steps",stepsComponent),reTriggerEditorApp.mount("#retrigger-editor-app");