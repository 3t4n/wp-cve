!function(){"use strict";var e=window.React;const{__:__}=wp.i18n,{addFilter:t}=wp.hooks,{Fragment:s,Component:o}=wp.element,{InspectorControls:n}=wp.editor,{createHigherOrderComponent:l}=wp.compose,{ToggleControl:a,PanelBody:r,SelectControl:u}=wp.components,c=["core/button"],i=l((t=>class extends o{componentDidMount(){const{use_ls:e}=this.props.attributes;this.setState({products:[],stores:[],checkingApi:!1}),e&&(this.getStores(),this.checkApi())}getStores(){return fetch("/wp-json/lsq/v1/stores").then((e=>e.json())).then((e=>{if(1==e.success&&(this.setState({stores:e.stores}),e.stores.length)){let t=e.stores.findIndex((e=>e.value==this.props.attributes.store));-1===t&&(t=0),this.getProducts(e.stores[t].value)}}))}checkApi(){return this.setState({checkingApi:!0}),fetch("/wp-json/lsq/v1/validate").then((e=>e.json())).then((e=>{let t=!1;1==e.success&&(t=!0),this.setState({isApiConnectable:t,checkingApi:!1})}))}getProducts(e){return this.setState({products:[],isLoadingProducts:!0}),fetch("/wp-json/lsq/v1/products?store_id="+e).then((e=>e.json())).then((e=>{if(1==e.success&&(this.setState({products:e.products}),e.products.length)){let t=e.products.findIndex((e=>e.value==this.props.attributes.product));-1===t&&(t=0),this.props.setAttributes({product:e.products[t].value})}})).finally((()=>{this.setState({isLoadingProducts:!1})}))}onChangeProduct=e=>{this.props.setAttributes({product:e})};onChangeStore=e=>{this.props.setAttributes({store:e}),this.getProducts(e)};onChangeOverlay=e=>{this.props.setAttributes({overlay:e})};onChangeUserData=e=>{this.props.setAttributes({prefillUserData:e})};changeUseLS=e=>{this.props.setAttributes({use_ls:e}),e&&!this.state.stores.length&&(this.getStores(),this.checkApi())};onChangeURLData=e=>{this.props.setAttributes({prefillFromURL:e})};render(){const{attributes:o}=this.props,{store:l,product:c,overlay:i,use_ls:h,prefillUserData:m,prefillFromURL:p}=o;return"core/button"!==this.props.name?(0,e.createElement)(t,{...this.props}):(0,e.createElement)(s,null,(0,e.createElement)(t,{...this.props}),(0,e.createElement)(n,null,(0,e.createElement)(r,{title:__("Lemon Squeezy","lemonsqueezy"),initialOpen:!1},(0,e.createElement)(s,null,(0,e.createElement)("p",null,(0,e.createElement)(a,{label:__("Apply Lemon Squeezy Checkout","lemonsqueezy"),checked:h,help:__(h?"Your button will be used for Lemon Squeezy Checkout.":"Your button will not be used for Lemon Squeezy Checkout.","lemonsqueezy"),onChange:this.changeUseLS}))),h&&(()=>this.state?[this.state.isApiConnectable?(0,e.createElement)(s,null,(0,e.createElement)("p",null,(0,e.createElement)(u,{label:__("Select Store","lemonsqueezy"),value:l,options:this.state.stores,onChange:this.onChangeStore})),(0,e.createElement)("p",null,this.state.isLoadingProducts?(0,e.createElement)("span",{style:{fontSize:"14px",color:"rgb(117, 117, 117)"}},__("Loading...","lemonsqueezy")):this.state.products.length?(0,e.createElement)(u,{value:c,options:this.state.products,onChange:this.onChangeProduct}):(0,e.createElement)("span",{style:{fontSize:"14px",color:"rgb(117, 117, 117)"}},__("No products found","lemonsqueezy"))),(0,e.createElement)("p",null,(0,e.createElement)(a,{label:__("Use checkout overlay?","lemonsqueezy"),checked:i,help:__(i?"Your checkout will be opened in a modal window.":"Your customer will be redirected to your checkout page.","lemonsqueezy"),onChange:this.onChangeOverlay})),(0,e.createElement)("p",null,(0,e.createElement)(a,{label:__("Pre-fill User Data","lemonsqueezy"),checked:m,help:__(m?"If logged-in, pre-fill user's data on checkout.":"It won't pre-fill user's data on checkout.","lemonsqueezy"),onChange:this.onChangeUserData})),(0,e.createElement)("p",null,(0,e.createElement)(a,{label:__("Pre-fill from URL","lemonsqueezy"),checked:p,help:__(p?"If there are checkout query strings in URL, it'll pre-fill the checkout.":"It won't pre-fill URL data on checkout.","lemonsqueezy"),onChange:this.onChangeURLData}))):(0,e.createElement)("p",null,this.state.checkingApi&&(0,e.createElement)("small",null,__("Checking connection status","lemonsqueezy")),!this.state.checkingApi&&(0,e.createElement)("small",null,__("Uh oh! Looks like you haven't connected your store yet! Please visit the","lemonsqueezy")," ",(0,e.createElement)("a",{href:lsData.settings_url},__("Lemon Squeezy Settings","lemonsqueezy"))," ",__("and connect to Lemon Squeezy.","lemonsqueezy")))]:(0,e.createElement)("p",null,(0,e.createElement)("small",null,__("We're fetching your data, hold on for a second!","lemonsqueezy"))))())))}}),"extendControls");t("blocks.registerBlockType","lemon-squeezy/custom-attributes",(function(e){return void 0!==e.attributes&&c.includes(e.name)&&(e.attributes=Object.assign(e.attributes,{overlay:{type:"boolean",default:!1},use_ls:{type:"boolean",default:!1},prefillUserData:{type:"boolean",default:!1},store:{type:"string",default:""},product:{type:"string",default:""},prefillFromURL:{type:"boolean",default:!1}})),e})),t("editor.BlockEdit","lemon-squeezy/custom-advanced-control",i),t("blocks.getSaveContent.extraProps","lemon-squeezy/saveExtendedOptions",(function(e,t,s){const{overlay:o,product:n}=s;return c.includes(t.name)&&(e.overlay=o,e.product=n),e}));var h=window.wp.blocks,m=window.wp.blockEditor,p=window.wp.i18n,g=window.wp.element,d=window.wp.components;class y extends g.Component{constructor(e){super(e),this.state={stores:[],products:[],isCheckingApi:!0,isApiConnectable:!1,isLoadingProducts:!1,newCustomDataKey:"",newCustomDataValue:""}}componentDidMount(){fetch("/wp-json/lsq/v1/stores").then((e=>e.json())).then((e=>{if(1==e.success&&(this.setState({stores:e.stores}),e.stores.length)){let t=e.stores.findIndex((e=>e.value==this.props.attributes.store));-1===t&&(t=0),this.getProducts(e.stores[t].value)}})),this.checkApi()}checkApi(){return fetch("/wp-json/lsq/v1/validate").then((e=>e.json())).then((e=>{1==e.success?this.setState({isApiConnectable:!0}):this.setState({isApiConnectable:!1})})).finally((()=>{this.setState({isCheckingApi:!1})}))}getProducts(e){return this.setState({products:[],isLoadingProducts:!0}),fetch("/wp-json/lsq/v1/products?store_id="+e).then((e=>e.json())).then((e=>{if(1==e.success&&(this.setState({products:e.products}),e.products.length)){let t=e.products.findIndex((e=>e.value==this.props.attributes.product));-1===t&&(t=0),this.props.setAttributes({product:e.products[t].value})}})).finally((()=>{this.setState({isLoadingProducts:!1})}))}onChangeContent=e=>{this.props.setAttributes({content:e})};onChangeProduct=e=>{this.props.setAttributes({product:e})};onChangeStore=e=>{this.props.setAttributes({store:e}),this.getProducts(e)};onChangeOverlay=e=>{this.props.setAttributes({overlay:e})};onChangeUserData=e=>{this.props.setAttributes({prefillUserData:e})};onChangeURLData=e=>{this.props.setAttributes({prefillFromURL:e})};handleRemoveCustomData=e=>{const t=[...this.props.attributes.customData];t.splice(e,1),this.props.setAttributes({customData:t})};handleCustomDataKeyChange=(e,t)=>{const s=[...this.props.attributes.customData];s[t].key=e,this.props.setAttributes({customData:s})};handleCustomDataValueChange=(e,t)=>{const s=[...this.props.attributes.customData];s[t].value=e,this.props.setAttributes({customData:s})};handleAddCustomData(){if(!this.state.newCustomDataKey||!this.state.newCustomDataValue)return void alert("Please Insert Key & Value");const e=[...this.props.attributes.customData];e.push({key:this.state.newCustomDataKey,value:this.state.newCustomDataValue}),this.setState({newCustomDataKey:"",newCustomDataValue:""}),this.props.setAttributes({customData:e})}render(){const{attributes:t,textColor:s,setTextColor:o,backgroundColor:n,setBackgroundColor:l}=this.props,{content:a,store:r,product:u,overlay:c,prefillUserData:i,prefillFromURL:h,customData:y}=t;let C=[];return y.length&&(C=y.map(((t,s)=>(0,e.createElement)(g.Fragment,{key:s},(0,e.createElement)("div",{className:"lemonsqueezy-custom-data-row"},(0,e.createElement)(d.TextControl,{placeholder:"Examples: user_name, user_id",value:t.key,onChange:e=>this.handleCustomDataKeyChange(e,s)}),(0,e.createElement)(d.TextControl,{placeholder:"Examples: JoshSmith, 123",value:t.value,onChange:e=>this.handleCustomDataValueChange(e,s)}),(0,e.createElement)(d.Button,{onClick:()=>this.handleRemoveCustomData(s),isSecondary:!0,isSmall:!0},"- Remove")))))),(0,e.createElement)("div",{className:"lsq-block"},(0,e.createElement)("h4",null,(0,e.createElement)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjBweCIgaGVpZ2h0PSIxOHB4IiB2aWV3Qm94PSIwIDAgMTI4IDE3NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00My4yODY3IDEwNi43OTVMOTAuMjE1NSAxMjguMzc1Qzk2LjAzMTkgMTMxLjA1MSAxMDAuMTM4IDEzNS41NDIgMTAyLjM1NSAxNDAuNjk0QzEwNy45NjMgMTUzLjczOSAxMDAuMjk4IDE2Ny4wODEgODguMjY1OCAxNzEuODc5Qzc2LjIzMTYgMTc2LjY3NiA2My40MDYxIDE3My41ODkgNTcuNTc0NCAxNjAuMDIzTDM3LjE1MTEgMTEyLjM5NEMzNS41Njg0IDEwOC43MDIgMzkuNTQ0MSAxMDUuMDc0IDQzLjI4NjcgMTA2Ljc5NSIgZmlsbD0iI0ZGQzIzMyIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQ2LjEwNTQgOTIuODI2NEw5NC41NDggNzQuNjEyNkMxMTAuNjQ4IDY4LjU1OTEgMTI4LjIzNSA4MC4wMTI3IDEyNy45OTggOTYuNjU0N0MxMjcuOTk0IDk2Ljg3MTkgMTI3Ljk5IDk3LjA4OTEgMTI3Ljk4NCA5Ny4zMDgxQzEyNy42MzYgMTEzLjUxNCAxMTAuNTM5IDEyNC40MDYgOTQuNzkyNyAxMTguNjczTDQ2LjE1MTMgMTAwLjk2NUM0Mi4yNzExIDk5LjU1MzUgNDIuMjQyNSA5NC4yNzg2IDQ2LjEwNTQgOTIuODI2NCIgZmlsbD0iI0ZGQzIzMyIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQzLjM5IDg2LjUxNzVMOTEuMDEwNyA2Ni4zOTE0QzEwNi44MzUgNTkuNzAyOSAxMTAuODUxIDM5LjYyODMgOTguNDU3NSAyOC4wMjk0Qzk4LjI5NTEgMjcuODc2NiA5OC4xMzI2IDI3LjcyNTcgOTcuOTY4MiAyNy41NzQ3Qzg1LjgxNzQgMTYuMzU2NyA2NS43MzA1IDIwLjMwNjUgNTguODEzMSAzNS4wODIyTDM3LjQ0MzYgODAuNzMyOEMzNS43Mzg2IDg0LjM3MzMgMzkuNTkyIDg4LjEyMjUgNDMuMzkgODYuNTE3NSIgZmlsbD0iI0ZGQzIzMyIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMxLjEzNTYgNzguNTY0Mkw0OC40NDkxIDMxLjM0NTZDNTAuNTk1NiAyNS40OTA5IDUwLjE5OCAxOS41MjAyIDQ3Ljk3ODkgMTQuMzY4NkM0Mi4zNTk0IDEuMzI4NDggMjcuMTQwOCAtMi44ODA4IDE1LjExMDQgMS45MjQ4MUMzLjA4MTkxIDYuNzMyMjYgLTMuNzE1MDQgMTcuNjUwMiAyLjEyODEyIDMxLjIxMTJMMjIuNjg1MyA3OC43ODg4QzI0LjI3OTQgODIuNDc1MyAyOS43NTU2IDgyLjMyOTkgMzEuMTM1NiA3OC41NjQyIiBmaWxsPSIjRkZDMjMzIi8+Cjwvc3ZnPg=="}),(0,p.__)("Lemon Squeezy Buy Button","lemonsqueezy")),this.state&&!this.state.isCheckingApi?[this.state.isApiConnectable?(0,e.createElement)(g.Fragment,null,(0,e.createElement)(m.InspectorControls,null,(0,e.createElement)(m.PanelColorSettings,{title:(0,p.__)("Color settings"),colorSettings:[{value:s.color,onChange:o,label:(0,p.__)("Text color")},{value:n.color,onChange:l,label:(0,p.__)("Background color")}]})),(0,e.createElement)("p",null,(0,e.createElement)(d.SelectControl,{value:r,options:this.state.stores,onChange:this.onChangeStore})),(0,e.createElement)("p",null,this.state.isLoadingProducts?(0,e.createElement)("span",{style:{fontSize:"14px",color:"rgb(117, 117, 117)"}},(0,p.__)("Loading...","lemonsqueezy")):this.state.products.length?(0,e.createElement)(d.SelectControl,{value:u,options:this.state.products,onChange:this.onChangeProduct}):(0,e.createElement)("span",{style:{fontSize:"14px",color:"rgb(117, 117, 117)"}},(0,p.__)("No products found","lemonsqueezy"))),(0,e.createElement)("p",null,(0,e.createElement)(m.RichText,{placeholder:(0,p.__)("Button text*","lemonsqueezy"),tagName:"p",className:"lsq-link-text",onChange:this.onChangeContent,value:a})),(0,e.createElement)("p",null,(0,e.createElement)(d.ToggleControl,{label:(0,p.__)("Use checkout overlay?","lemonsqueezy"),help:c?(0,p.__)("Your checkout will be opened in a modal window.","lemonsqueezy"):(0,p.__)("Your customer will be redirected to your checkout page.","lemonsqueezy"),checked:c,onChange:this.onChangeOverlay})),(0,e.createElement)("p",null,(0,e.createElement)(d.ToggleControl,{label:(0,p.__)("Pre-fill User Data","lemonsqueezy"),checked:i,help:i?(0,p.__)("If logged-in, pre-fill user's data on checkout.","lemonsqueezy"):(0,p.__)("It won't pre-fill user's data on checkout.","lemonsqueezy"),onChange:this.onChangeUserData})),(0,e.createElement)("p",null,(0,e.createElement)(d.ToggleControl,{label:(0,p.__)("Pre-fill from URL","lemonsqueezy"),checked:h,help:h?(0,p.__)("If there are checkout query strings in URL, it'll pre-fill the checkout.","lemonsqueezy"):(0,p.__)("It won't pre-fill URL data on checkout.","lemonsqueezy"),onChange:this.onChangeURLData})),(0,e.createElement)("p",null,(0,e.createElement)("small",{className:"lemonsqueezy-custom-data-header"},(0,e.createElement)("strong",null,"Custom Data"),(0,e.createElement)("br",null),(0,e.createElement)(d.Button,{isSmall:!0,isLink:!0,href:"https://docs.lemonsqueezy.com/help/checkout/passing-custom-data",target:"_blank"},"Read more about custom data"))),(0,e.createElement)("div",null,(0,e.createElement)("div",{className:"lemonsqueezy-custom-data-row"},(0,e.createElement)(d.TextControl,{label:(0,p.__)("Data Key","lemonsqueezy"),placeholder:(0,p.__)("Data Key","lemonsqueezy"),value:this.state.newCustomDataKey,onChange:e=>this.setState({newCustomDataKey:e})}),(0,e.createElement)(d.TextControl,{label:(0,p.__)("Data Value","lemonsqueezy"),placeholder:(0,p.__)("Data Value","lemonsqueezy"),value:this.state.newCustomDataValue,onChange:e=>this.setState({newCustomDataValue:e})}),(0,e.createElement)(d.Button,{onClick:()=>this.handleAddCustomData(),isSecondary:!0,isSmall:!0},"+ Add Data")),C)):(0,e.createElement)("p",null,(0,e.createElement)("small",null,(0,p.__)("Uh oh! Looks like you haven't connected your store yet! Please visit the","lemonsqueezy")," ",(0,e.createElement)("a",{href:lsData.settings_url},(0,p.__)("Lemon Squeezy Settings","lemonsqueezy"))," ",(0,p.__)("and connect to Lemon Squeezy.","lemonsqueezy")))]:(0,e.createElement)("p",null,(0,e.createElement)("small",null,(0,p.__)("We're fetching your data, hold on for a second!","lemonsqueezy"))))}}var C=(0,m.withColors)("backgroundColor",{textColor:"color"})(y);const D={content:{type:"string"},overlay:{type:"boolean"},store:{type:"string"},product:{type:"string"},textColor:{type:"string"},customTextColor:{type:"string"},backgroundColor:{type:"string"},customBackgroundColor:{type:"string"},prefillUserData:{type:"boolean",default:!1},prefillFromURL:{type:"boolean",default:!1},customData:{type:"array",default:[]}};(0,h.registerBlockType)("lemonsqueezy/ls-button",{title:"Lemon Squeezy",description:(0,p.__)("The Lemon Squeezy Product Block","lemonsqueezy"),category:"lemonsqueezy",icon:(0,e.createElement)("svg",{width:"118",height:"160",viewBox:"0 0 118 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)("path",{d:"M39.5904 98.2021L82.512 118.046C87.8317 120.507 91.5868 124.636 93.6147 129.373C98.7439 141.369 91.7337 153.638 80.7288 158.05C69.7222 162.46 57.9919 159.622 52.6582 147.147L33.9787 103.35C32.5312 99.9554 36.1675 96.6196 39.5904 98.2021",fill:"#000000"}),(0,e.createElement)("path",{d:"M42.1685 85.3576L86.4746 68.6093C101.2 63.0429 117.285 73.5749 117.068 88.8779C117.064 89.0776 117.061 89.2773 117.056 89.4787C116.738 104.381 101.1 114.396 86.6984 109.124L42.2105 92.8416C38.6616 91.5435 38.6354 86.693 42.1685 85.3576",fill:"#000000"}),(0,e.createElement)("path",{d:"M39.6849 79.5563L83.2393 61.0496C97.7126 54.8992 101.386 36.4398 90.0502 25.7741C89.9017 25.6336 89.7531 25.4949 89.6027 25.3561C78.4895 15.0407 60.1177 18.6727 53.791 32.2595L34.2463 74.237C32.6869 77.5847 36.2112 81.0321 39.6849 79.5563",fill:"#000000"}),(0,e.createElement)("path",{d:"M28.4769 72.243L44.312 28.8235C46.2753 23.4399 45.9116 17.9496 43.882 13.2125C38.7423 1.22159 24.8232 -2.64901 13.8201 1.76994C2.81875 6.19058 -3.39781 16.2301 1.9464 28.7L20.7482 72.4494C22.2062 75.8394 27.2147 75.7057 28.4769 72.243",fill:"#000000"})),keywords:[(0,p.__)("ecommerce","lemonsqueezy","product","digital"),(0,p.__)("digital products","lemonsqueezy")],attributes:D,deprecated:[{attributes:D,save:({attributes:t})=>{const{content:s,overlay:o,product:n}=t;let l=n,a=["wp-block-button__link"];return o&&(a.push("lemonsqueezy-button"),l=n+"?embed=1"),(0,e.createElement)("div",{className:"wp-block-buttons"},(0,e.createElement)("div",{className:"wp-block-button"},(0,e.createElement)("a",{className:a.join(" "),href:l},s)))}}],edit:C,save:({attributes:t})=>{const{content:s,overlay:o,product:n,textColor:l,customTextColor:a,backgroundColor:r,customBackgroundColor:u}=t;let c=n,i={},h=["wp-block-button__link"];return o&&(h.push("lemonsqueezy-button"),c=n+"?embed=1"),null!=l&&h.push((0,m.getColorClassName)("color",l)),null!=r&&h.push((0,m.getColorClassName)("background-color",r)),null!=a&&(i.color=a),null!=u&&(i.backgroundColor=u),(0,e.createElement)("div",{className:"wp-block-buttons"},(0,e.createElement)("div",{className:"wp-block-button"},(0,e.createElement)("a",{style:i,className:h.join(" "),href:c},s)))}})}();