function Vn(){import.meta.url,import("_").catch(()=>1);async function*e(){}}function Pe(){const{cart_condition_fields:e,cart_condition_field_groups:t,product_table_buttons:o,add_new_and_rule:n}=acfw_edit_coupon,i=Object.keys(e).map(c=>e[c]);return'\n    <div class="condition-group-actions">\n      <div class="add-condition-form" style="display: none;">\n        <select class="condition-types" data-placeholder="Search/select condition fields">\n          <option value="">Search</option>\n          '.concat(t.map(c=>Ue(c,i)).join(""),'\n        </select>\n        <button type="button" class="add-condition-field button-primary">').concat(o.add,'</button>\n        <button type="button" class="cancel-add-condition-field button">').concat(o.cancel,'</button>\n      </div>\n      <button type="button" class="add-condition-trigger button">\n        <i class="dashicons dashicons-plus"></i>\n        ').concat(n,"\n      </button>\n    </div>\n  ")}function Ue(e,t){const{group:o,label:n}=e,i=t.filter(c=>c.group===o||o==="others"&&c.group===void 0);if(i.length)return'\n    <optgroup label="'.concat(n,'">\n      ').concat(i.map(c=>'<option value="'.concat(c.key,'">').concat(c.title,"</option>")).join(""),"\n    </optgroup>\n  ")}function We(){jQuery("select.condition-types").select2()}const O=jQuery,X=document.querySelector("#acfw_cart_conditions");function me(){const e=O(this),t=e.closest("div.condition-group-actions");e.hasClass("add-condition-trigger")?(t.find(".add-condition-form").show(),We(),e.hide()):(t.find(".add-condition-form").hide(),t.find(".add-condition-trigger").show())}function T(e){O(X).data("editing",e),O(X).find("#save-cart-conditions").prop("disabled",!e)}function Re(){const e=O(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"",i=t.data("selected_terms"),c=O(X).data("custom_tax_options"),a=c.filter(l=>l.slug==n),s=a.length?a[0].terms:[];if(o.val(null).find("option").remove(),!!s.length){for(let l of s){let{name:d,term_id:u}=l,r=new Option(d,u);o.append(r)}o.val(i).trigger("change")}}function Ye(){const e=O(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"";if(!n)return;const i=t.data("regions"),c=O(X).data("shipping_regions"),a=t.data("zones")[n].regions;if(o.val(null).find("option").remove(),!(typeof a!="object"||!a.length)){for(let s of a){const l=new Option(c[s],s);o.append(l)}o.val(i).trigger("change")}}function Ge(){var e=O(this),t=O("select.non-qualifying-notice-type-field"),o=t.closest(".condition-settings-field");e.is(":checked")?(o.show(),t.prop("disabled",!1)):(o.hide(),t.prop("disabled",!0))}function E(e,t=""){t||(t="show");let o=t==="show"?"block":"none";jQuery(e).css("display",o)}function j(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039"};return e.replace(/[&<>"']/g,o=>t[o])}function Ze(){const{decimal_separator:e}=acfw_edit_coupon,t=jQuery(this);let o=t.val()+"";o=="0"+e&&t.val("0"),!(o=="0"||o.substring(0,2)=="0"+e)&&(o=o.replace(/^0+/,""),o=o.substring(0,1)==e?"0"+o:o,t.val(o))}function _e(e){return e=="<"?1:0}function L(e,t){return e==t?"selected":""}function fe(e,t){return e.indexOf(t)>=0?"selected":""}function Fe(e=""){const{exactly:t,anyexcept:o,morethan:n,lessthan:i}=acfw_edit_coupon.condition_field_options;return'\n        <option value="=" '.concat(L(e,"="),">").concat(t,'</option>\n        <option value="!=" ').concat(L(e,"!="),">").concat(o,'</option>\n        <option value=">" ').concat(L(e,">"),">").concat(n,'</option>\n        <option value="<" ').concat(L(e,"<"),">").concat(i,"</option>\n    ")}function Ke(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function le(e){const{decimal_separator:t}=acfw_edit_coupon;return parseFloat(e.replace(t,"."))}function qe(e,t){return e==="percent"||e==="fixed"?0<le(t):!0}function Xe(e){return new RegExp(/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i).test(e)}function je(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'\n        <div class="condition-group-logic">\n            <div class="field-control">\n                <select class="cgroup-logic">\n                    <option value="and" '.concat(L(e,"and"),">").concat(o,'</option>\n                    <option value="or" ').concat(L(e,"or"),">").concat(n,"</option>\n                </select>\n            </div>\n        </div>\n    ")}function de(e=""){const{empty_cart_conditions_field:t}=acfw_edit_coupon,o=Pe(),n='<div class="empty-conditions">'.concat(t,"</div>");return'\n        <div class="condition-group '.concat(e?"":"new",'">\n            <a class="remove-condition-group" href="javascript:void(0);">\n                <i class="dashicons dashicons-trash"></i>\n            </a>\n            <div class="condition-group-fields">\n                ').concat(e||n,"\n            </div>\n            ").concat(o,"\n        </div>\n    ")}var S=jQuery;function et(){const e=document.querySelector("#acfw_cart_conditions .condition-data-wrap .condition-groups");S(e).find(".condition-group").length&&S(e).append(je("or")),S(e).find(".no-condition-group").remove(),S(e).append(de()),S(this).blur(),S(e).find(".condition-group.new .add-condition-trigger").trigger("click"),S(e).find(".condition-group").removeClass("new"),T(!0)}function tt(){const e=S(this),t=document.querySelector("#acfw_cart_conditions"),o=e.closest(".condition-group"),n=o.index()==0?o.next(".condition-group-logic"):o.prev(".condition-group-logic"),{no_condition_group_msg:i}=acfw_edit_coupon;o.remove(),n.remove(),S(t).find(".condition-group").length<1&&S(t).find(".condition-groups").append('\n            <div class="no-condition-group">\n                '.concat(i,"\n            </div>\n        ")),T(!0)}function Ce(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'<div class="logic-condition-field condition-field" data-type="logic">\n        <div class="field-control">\n            <select class="condition-logic">\n                <option value="and" '.concat(L(e,"and"),">").concat(o,'</option>\n                <option value="or" ').concat(L(e,"or"),">").concat(n,"</option>\n            </select>\n        </div>\n    </div>")}const{cart_condition_fields:re,condition_field_options:ot}=acfw_edit_coupon;function nt(e){const{value:t,condition:o,quantity:n}=e,{title:i,placeholder:c,field:a}=re.product_category,{field:s}=re.cart_quantity,{condition_label:l}=acfw_edit_coupon,{exactly:d,anyexcept:u,morethan:r,lessthan:y}=ot,$=o||">";return'\n    <div class="product-category-field condition-field" data-type="product-category">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(i,'</h3>\n        <div class="field-control categories">\n            <label>').concat(a,'</label>\n            <select class="condition-value wc-enhanced-select" multiple data-placeholder="').concat(c,'">\n                ').concat(it(t),'\n            </select>\n        </div>\n        <div class="field-control condition">\n            <label>').concat(l,'</label>\n            <select class="condition-select">\n                <option value="=" ').concat($=="="?"selected":"",">").concat(d,'</option>\n                <option value="!=" ').concat($=="!="?"selected":"",">").concat(u,'</option>\n                <option value=">" ').concat($==">"?"selected":"",">").concat(r,'</option>\n                <option value="<" ').concat($=="<"?"selected":"",">").concat(y,'</option>\n            </select>\n        </div>\n        <div class="field-control quantity">\n            <label>').concat(s,'</label>\n            <input type="number" class="condition-quantity" value="').concat(n,'" min="').concat(o=="<"?1:0,'">\n        </div>\n    </div>\n    ')}function it(e=[]){const{options:t}=re.product_category;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(fe(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:Se}=acfw_edit_coupon;function ct(e){const{title:t}=Se.customer_logged_in_status;return'\n        <div class="customer-logged-in-status-field condition-field" data-type="customer-logged-in-status">\n\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n\n        <h3 class="condition-field-title">'.concat(t,'</h3>\n\n        <div class="field-control">\n            <select class="condition-value">\n                ').concat(at(e),"\n            </select>\n        </div>\n    </div>")}function at(e){const{options:t}=Se.customer_logged_in_status;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(L(n,e),">").concat(t[n],"</option>");return o}const{cart_condition_fields:st}=acfw_edit_coupon;function lt(e){const{title:t,placeholder:o}=st.customer_user_role;return'\n        <div class="customer-user-role-field condition-field" data-type="customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(dt(e),"\n                </select>\n            </div>\n        </div>\n    ")}function dt(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(fe(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:rt}=acfw_edit_coupon;function ut(e){const{title:t,placeholder:o}=rt.disallowed_customer_user_role;return'\n        <div class="disallowed-customer-user-role-field condition-field" data-type="disallowed-customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(pt(e),"\n                </select>\n            </div>\n        </div>\n    ")}function pt(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(fe(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:_t}=acfw_edit_coupon;function ft(e){const{condition:t,value:o}=e,{title:n,desc:i,field:c}=_t.cart_quantity,{condition_label:a}=acfw_edit_coupon;return'\n    <div class="cart-quantity-field condition-field" data-type="cart-quantity">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(n,"</h3>\n        <label>").concat(i,'</label>\n        <div class="field-control">\n            <label>').concat(a,'</label>\n            <select class="condition-select">\n                ').concat(Fe(t),'\n            </select>\n        </div>\n        <div class="field-control">\n            <label>').concat(c,'</label>\n            <input class="condition-value" type="number" min="0" value="').concat(o>=0?o:"",'">\n        </div>\n    </div>\n    ')}function gt(e){const{condition:t,value:o,include_tax:n}=e,{cart_condition_fields:i,condition_label:c}=acfw_edit_coupon,{title:a,desc:s,field:l,tax_label:d}=i.cart_subtotal;return'\n    <div class="cart-subtotal-field condition-field" data-type="cart-subtotal">\n    <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n    <h3 class="condition-field-title">'.concat(a,"</h3>\n    <label>").concat(s,'</label>\n    <div class="field-control">\n      <label>').concat(c,'</label>\n      <select class="condition-select">\n        ').concat(Fe(t),'\n      </select>\n    </div>\n    <div class="field-control">\n      <label>').concat(l,'</label>\n      <input class="condition-value wc_input_price" type="text" value="').concat(o||"",'">\n    </div>\n    <div class="field-control no-label">\n      <label><input type="checkbox" class="condition-include-tax" type="checkbox" ').concat(n==="yes"?"checked":""," /> ").concat(d,"</label>\n    </div>\n    </div>\n    ")}const{cart_condition_fields:mt}=acfw_edit_coupon;function ht(e,t){const o=t.replace(/-/g,"_"),{title:n}=mt[o],{cart_condition_field_premium_notice:i}=acfw_edit_coupon;return'\n  <div class="'.concat(t,' condition-field condition-field-premium" data-type="').concat(t,"\" data-premium='").concat(JSON.stringify(e),'\'>\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">').concat(n,'</h3>\n      <div class="field-control">\n          ').concat(i.label,"\n      </div>\n  </div>\n  ")}const Z=jQuery,{cart_condition_premium_notice:he,cart_condition_fields:ve,upsell:vt}=acfw_edit_coupon;function bt(){const e=Z(this),t=e.closest(".condition-group-actions").find("select.condition-types"),o=e.closest(".condition-group"),n=o.find(".condition-group-fields"),i=document.querySelector("#acfw_cart_conditions .acfw-overlay"),c=Z("#acfw_cart_conditions").data("premium-conditions"),a=t.val()+"",s=n.find(".condition-field,.condition-set").length;if(E(i,"show"),c&&c.indexOf(a)>-1)vex.dialog.alert({unsafeMessage:vt.cart_condition_field});else{const l=De(a,null,s);l?(n.find(".empty-conditions").remove(),n.show().append(l),n.find(".".concat(a,"-field")).find("input,select").trigger("change"),Z("body").trigger("wc-enhanced-select-init"),T(!0)):vex.dialog.alert(acfw_edit_coupon.fail_add_condition_field)}E(i,"hide"),o.find(".condition-group-actions .add-condition-form").hide(),o.find(".condition-group-actions .add-condition-trigger").show()}function yt(){const e=Z(this),t=e.closest(".condition-field,.condition-set"),o=t.closest(".condition-group"),n=t.index()==0?t.next(".logic-condition-field"):t.prev(".logic-condition-field"),{empty_cart_conditions_field:i}=acfw_edit_coupon;t.remove(),n.remove(),o.find(".condition-field,.condition-set").length<1&&o.find(".condition-group-fields").append('\n            <div class="empty-conditions">\n                '.concat(i,"\n            </div>\n        ")),T(!0)}function De(e,t=null,o=0){let n="";switch(e){case"product-category":t=t||{},t.length&&(t={condition:">",value:t,quantity:0}),n+=nt(t);break;case"customer-logged-in-status":n+=ct(t);break;case"customer-user-role":t=t||[],n+=lt(t);break;case"disallowed-customer-user-role":t=t||[],n+=ut(t);break;case"cart-quantity":t=t||{},n+=ft(t);break;case"cart-subtotal":t=t||{},n+=gt(t);break;default:const i=e.replace(/-/g,"_");if(ve[i]){const{template_callback:c,default_data_value:a,title:s}=ve[i];if(a&&(t=t||a),c&&(n+=c(t,i)),he){let{label_premium:l}=he;s&&s.includes(l)&&(t=t||{},n+=ht(t,e))}}break}return n&&o?Ce()+n:n}function $t(e){return acfw_edit_coupon.cart_conditon_field_options.indexOf(e)>-1}const I=jQuery,{cart_condition_premium_notice:be,cart_condition_fields:ye}=acfw_edit_coupon;function wt(e){var n;const t=e.querySelectorAll(".condition-set,.condition-field");let o=[];return e.classList.contains("condition-group-logic")?{type:"group_logic",value:(n=e.querySelector("select"))==null?void 0:n.value}:(t.forEach(i=>o.push(xt(i))),o.length?{type:"group",fields:o}:null)}function xt(e){const{type:t}=e.dataset;let o={type:t,data:null},n,i,c;switch(t){case"logic":n=e.querySelector("select.condition-logic"),o.data=n.value;break;case"product-category":n=e.querySelector(".condition-value"),i=e.querySelector(".condition-select"),c=e.querySelector(".condition-quantity"),o.data={condition:I(i).val(),value:I(n).val(),quantity:I(c).val()};break;case"customer-logged-in-status":case"customer-user-role":case"disallowed-customer-user-role":n=e.querySelector(".condition-value"),o.data=I(n).val();break;case"cart-quantity":n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:I(n).val(),value:parseInt(I(i).val())};break;case"cart-subtotal":const a=e.querySelector("input.condition-include-tax");n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:I(n).val(),value:I(i).val(),include_tax:a.checked?"yes":"no"};break;default:const s=t==null?void 0:t.replace(/-/g,"_");if(ye[s]){const{scraper_callback:l,title:d}=ye[s];if(l&&(o.data=l(e)),be){let{label_premium:u}=be;if(d&&d.includes(u)){const{premium:r}=e.dataset;o.data=r?JSON.parse(r):""}}}break}return o}const F=jQuery,{post_id:kt}=woocommerce_admin_meta_boxes;function Ft(){const e=document.querySelector("#acfw_cart_conditions"),t=e.querySelectorAll(".condition-groups .condition-group, .condition-groups .condition-group-logic"),o=e.querySelector(".acfw-overlay"),{post_status:n}=acfw_edit_coupon,{post_id:i}=woocommerce_admin_meta_boxes;let c=[];if(F(e).find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click"),t.forEach(l=>{const d=wt(l);d&&c.push(d)}),!Ct(c)){vex.dialog.alert(acfw_edit_coupon.cart_conditions_invalid),F(e).addClass("save-error");return}const a={message:F(e).find(".text-input.non-qualifying-message-field").val(),btn_text:F(e).find(".text-input.non-qualifying-btn-text-field").val(),btn_url:F(e).find(".text-input.non-qualifying-btn-url-field").val(),notice_type:F(e).find(".non-qualifying-notice-type-field").val()},s=F(e).find(".display-notice-auto-apply-field").is(":checked")?"yes":"";if(a.btn_url&&!Ke(a.btn_url)){vex.dialog.alert(acfw_edit_coupon.cart_notice_url_invalid),F(e).addClass("save-error");return}E(o,"show"),jt({cart_conditions:c,notice_settings:a,auto_apply_display:s,nonce:F(e).data("nonce")},l=>{l.status=="success"?n!=="publish"&&(F("input[name='post_title']").val()||F("input[name='post_title']").val("coupon-"+i),F("select[name='post_status']").append(new Option("Published","publish")).val("publish"),F("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),F("input#publish").click()):l.error_msg&&vex.dialog.alert(l.error_msg),T(!1),F(e).find("#save-cart-conditions").prop("disabled",!0),E(o,"hide")})}function qt(e){const t=document.querySelector("#acfw_cart_conditions");F(t).data("editing")&&(e.preventDefault(),F(t).find("#save-cart-conditions").trigger("click"),setTimeout(()=>{F(t).hasClass("save-error")?F(t).removeClass("save-error"):F("form#post").submit()},1e3))}function jt(e,t){return e.action="acfw_save_cart_conditions",e.coupon_id=kt,F.post(ajaxurl,e,t,"json")}function Ct(e){var u;let t,o,n,i,c,a,s,l;if(e.length===1&&((u=e[0].fields)==null?void 0:u.length)<1)return!0;let d="";for(t of e){if(t.type==="group_logic"){if(!d||d==="group_logic")return!1;d="group_logic";continue}if(d=t.type,t.fields===void 0||t.fields.length<1)return!1;for(o of t.fields)if(i=o.type,n=o.data,n===void 0||n===""||n===null||(typeof n=="object"&&typeof n.length=="number"?c=n:i==="product-category"?(c=n.value,a=n.condition,s=n.quantity):typeof n=="object"&&n.length===void 0?(c=n.products,a=n.condition,s=n.value):s=n,l=_e(a),c!==void 0&&c.length<1||a!==void 0&&!a||!Number.isInteger(s)&&s!==void 0&&!s||Number.isInteger(s)&&s<l||typeof s=="number"&&s<l))return!1}return!0}const U=jQuery,{product_table_buttons:St,condition_field_options:Dt,bogo_form_fields:Lt}=acfw_edit_coupon;function Ot(){const e=U(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("exclude");o.find("tr.no-result").remove(),o.append(Oe(n)),U("body").trigger("wc-enhanced-select-init")}function Tt(){const e=U(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product");let c=o.data("exclude");c.splice(c.indexOf(i.product_id),1),n.find("tr.no-result").remove(),t.replaceWith(Oe(c,i)),o.data("exclude",c),o.find(".wc-product-search").data("exclude",c),U("body").trigger("wc-enhanced-select-init")}function Mt(){const e=U(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=t.find(".wc-product-search"),i=t.find(".condition-select"),c=t.find(".condition-quantity"),a=i.val()==="<"?1:0;let s=o.data("exclude");if(!n.val()||!i.val()||!c.val()||parseInt(c.val())<a){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}const l=parseInt(n.val());if(s.includes(l)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}const d={product_id:l,condition:i.val(),quantity:parseInt(c.val()+""),product_label:n.find("option:selected").text(),condition_label:i.find("option:selected").text()};let u='\n        <tr>\n            <td class="product" data-product="'.concat(j(JSON.stringify(d)),'">').concat(d.product_label,'</td>\n            <td class="condition">').concat(d.condition_label,'</td>\n            <td class="quantity">').concat(d.quantity,'</td>\n            <td class="actions">\n                <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n            </td>\n        </tr>\n    ');s.push(d.product_id),t.replaceWith(u),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),T(!0)}function Qt(){const e=jQuery(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product"),c=t.find("td").length;let a=o.data("exclude");if(a.includes(i.product_id)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(typeof i=="object"){const{product_id:s,product_label:l,condition_label:d,quantity:u}=i;let r='\n            <tr>\n                <td class="product" data-product="'.concat(j(JSON.stringify(i)),'">').concat(l,'</td>\n                <td class="condition">').concat(d,'</td>\n                <td class="quantity">').concat(u,'</td>\n                <td class="actions">\n                    <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                    <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n                </td>\n            </tr>\n        ');a.push(s),t.replaceWith(r),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a)}else t.remove(),Le(n,c)}function It(){const e=jQuery(this),t=e.closest("tr"),o=t.closest("table"),n=o.find("tbody"),i=t.find("td").length;t.remove();let c=t.find("td.product").data("product"),a=o.data("exclude"),s=a.indexOf(parseInt(c.product_id));s!==-1&&a.splice(s,1),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a),Le(n,i),T(!0)}function Le(e,t=3){e.find("tr").length>0||e.append('\n        <tr class="no-result">\n            <td colspan="'.concat(t,'">').concat(acfw_edit_coupon.no_products_added,"</td>\n        </tr>\n    "))}function Oe(e=[],t=!1){let o="",n="";if(typeof t=="object"){const{product_id:x,product_label:D}=t;o='<option value="'.concat(x,'">').concat(D,"</option>"),n=t.condition}const{add:i,edit:c,cancel:a}=St,{exactly:s,anyexcept:l,morethan:d,lessthan:u}=Dt,{type_to_search:r}=Lt,y=typeof t=="object"?c:i;return'\n        <tr class="add-edit-form adding">\n            <td class="product" data-product="'.concat(typeof t=="object"?j(JSON.stringify(t)):0,'">\n                <div class="object-search-wrap">\n                    <select class="product-in-cart wc-product-search"\n                        data-placeholder="').concat(r,'"\n                        data-action="acfw_search_products"\n                        data-exclude="').concat(j(JSON.stringify(e)),'">').concat(o,'</select>\n                </div>\n            </td>\n            <td class="condition">\n                <select class="condition-select">\n                    <option value="=" ').concat(n=="="?"selected":"",">").concat(s,'</option>\n                    <option value="!=" ').concat(n=="!="?"selected":"",">").concat(l,'</option>\n                    <option value=">" ').concat(n==">"?"selected":"",">").concat(d,'</option>\n                    <option value="<" ').concat(n=="<"?"selected":"",">").concat(u,'</option>\n                </select>\n            </td>\n            <td class="quantity">\n                <input type="number" class="condition-quantity" value="').concat(typeof t=="object"?t.quantity:1,'" min="').concat(n=="<"?1:0,'">\n            </td>\n            <td class="actions">\n                <button type="button" class="condition-product-add button-primary">').concat(y,'</button>\n                <button type="button" class="cancel button">').concat(a,"</button>\n            </td>\n        </tr>\n        ")}const B=jQuery;function Nt(){const e=B(this),t=parseInt(e.attr("min"));parseFloat(e.val()+"")<t&&e.val(t)}function At(){const e=B(this),t=e.closest(".condition-field,.condition-set"),o=t.data("type"),n=o=="product-quantity"||o=="has-ordered-before"||o=="product-category"?"input.condition-quantity":"input.condition-value",i=t.find(n),c=e.val()+"";let a=_e(c);i.attr("min",a).trigger("change")}function Et(){const{within_a_period_label:e,number_of_orders_label:t}=acfw_edit_coupon,o=B(this),n=o.closest(".cart-quantity-field"),i=n.find(".condition-type-value label");o.val()=="within-a-period"?i.text(e):i.text(t)}function zt(){const e=B(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=o.val()+"";let i=e.val()+"",c=_e(n);acfw_edit_coupon.decimal_separator!=="."&&(i=i.replace(acfw_edit_coupon.decimal_separator,".")),!(!o||parseFloat(i)>c-1)&&e.val(c)}function Ht(){const e=B(this);let t=e.val();t=="0"+acfw_edit_coupon.decimal_separator&&e.val("0"),!(t=="0"||t.substring(0,2)=="0"+acfw_edit_coupon.decimal_separator)&&(t=t.replace(/^0+/,""),t=t.substring(0,1)==acfw_edit_coupon.decimal_separator?"0"+t:t,e.val(t))}function Jt(){const e=B(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=t.find("input.condition-value");switch(e.val()){case"string":n.prop("type","text"),n.removeClass("wc_input_price"),(o.val()==">"||o.val()=="<")&&o.val("="),o.find("option[value='>'],option[value='<']").prop("disabled",!0);break;case"number":n.prop("type","number"),n.removeClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break;case"price":n.prop("type","text"),n.addClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break}o.trigger("change")}function Vt(){window.acfw_edit_coupon_triggers=window.acfw_edit_coupon_triggers||{},window.acfw_edit_coupon_triggers.remove_all_premium_condition=()=>{jQuery(".condition-field-premium .remove-condition-field").each(function(){jQuery(this).trigger("click")}),jQuery(".condition-notice").remove(),jQuery(".empty-conditions").each(function(){jQuery(this).closest(".condition-group").find(".remove-condition-group").trigger("click")})}}const Bt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;if(!o)return{};let n={};for(const[i,c]of Object.entries(t))if(c.type!=="group_logic")for(let[a,s]of Object.entries(c.fields)){let l=Object.entries(e).find(([d,u])=>u.key===s.type);if(l){let[d,u]=l,{label_premium:r}=o;u.title.includes(r)&&(n[d]=u)}}return n},Pt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;let n=[],i="";i='<div class="condition-notice">',i+='<a id="remove-all-premium-condition" href="javascript:void(0);" onclick="acfw_edit_coupon_triggers.remove_all_premium_condition()"><i class="dashicons dashicons-trash"></i></a>',i+='<img src="'.concat(o.logo_img,'">');let{label_premium:c}=o;return Object.keys(t).map(a=>{let s=t[a];n.push("<b>".concat(s.title.replace(" (".concat(c,")"),""),"</b>"))}),o.label.map(a=>{a=n.length&&a.includes("{{premium}}")?a.replace("{{premium}}",n.join(", ")):a,i+="<p>".concat(a,"</p>")}),i+='<div class="action-wrap">',o.actions.map(a=>{let s=a.url.includes("action=")?"":"target='_blank'";i+='<a href="'.concat(a.url,'" ').concat(s,' class="action-button primary">').concat(a.label,"</a>")}),i+="</div>",i+="</div>",i};function Ut(e){const{cart_condition_fields:t}=acfw_edit_coupon;let o="";if(e.length){let n=Bt(t,e);Object.keys(n).length&&(o+=Pt(t,n),Vt())}return o}const Te=jQuery;function Wt(){const e=Te(this),t=e.closest(".woocommerce").find("#acfw_cart_conditions"),o=e.data("tab");t.find(".panel").hide(),t.find('.panel[data-tab="'.concat(o,'"]')).show(),Rt(e)}function Rt(e){Te(".acfw-cart-condition-tabs li").removeClass("active"),e.closest("li").addClass("active")}const _=jQuery,h=document.querySelector("#acfw_cart_conditions");function Yt(){_(h).on("click","#add-cart-condition-group",et),_(h).on("click","a.remove-condition-group",tt),_(h).on("click",".add-condition-field",bt),_(h).on("click","a.remove-condition-field",yt),_(h).on("click",".add-condition-trigger",me),_(h).on("click",".cancel-add-condition-field",me),_(h).on("click",".acfw-styled-table tfoot .add-table-row",Ot),_(h).on("click",".acfw-styled-table td.actions a.edit",Tt),_(h).on("click","tr.add-edit-form .actions .condition-product-add",Mt),_(h).on("click","tr.add-edit-form .actions .cancel",Qt),_(h).on("click",".acfw-styled-table td.actions a.remove",It),_(h).on("click","#save-cart-conditions",Ft),_(h).on("change","input[type='number']",Nt),_(h).on("change","select.condition-select",At),_(h).on("change","select.has-ordered-before-type",Et),_(h).on("change",".wc_input_price",zt),_(h).on("change","select.custom-taxonomy",Re),_(h).on("change",".shipping-zone-region-field select.condition-select",Ye),_(h).on("blur",".wc_input_price",Ht),_(h).on("change","select.value-type",Jt),_("form#post").on("submit",qt),_(h).find("select").trigger("change"),_(h).css("min-height",_("#coupon_options").height()),_(h).on("change","input,select,textarea",()=>{T(!0)}),_(h).find(".condition-groups").each(function(){_(this).find(".condition-group-fields").length&&_(this).show()}),_(".acfw-cart-condition-tabs").on("click","li a",Wt),_(h).on("change","input.display-notice-auto-apply-field",Ge),_(h).find("input.display-notice-auto-apply-field").trigger("change"),setTimeout(Gt,500)}function Gt(){const e=h.querySelector(".condition-groups"),t=_(h).data("cart_conditions");(async()=>{let n="";if(n+=Ut(t),t.length)for(let i of t)if(i.type=="group"){const c=Zt(i.fields);n+=de(c)}else n+=je(i.value);else n=de();_(e).html(n),_(e).find("input,select").trigger("change"),_(e).find(".condition-group.new .add-condition-trigger").trigger("click"),_(e).find(".condition-group").removeClass("new")})().then(()=>{setTimeout(()=>_("body").trigger("wc-enhanced-select-init"),1500),T(!1)})}function Zt(e){let t="",o="",n=!0;for(let i of e){const{type:c,data:a}=i;if(!$t(c)){n=!1;continue}if(c=="logic"){o=n?Ce(a):"";continue}const s=De(c,a);s?(t+=o+s,n=!0):n=!1,o=""}return t}function ne(){const{upsell:e}=acfw_edit_coupon;return e?'\n  <div class="upsell">\n    '.concat(e.bogo_deals_type,"\n  </div>"):""}function Kt(e,t=!1){const{products:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:l,products:d,price_discount:u,type_to_search:r}=a,y=i?e.discount_type:"override",$=t?Xt(y,c):"",x=t?'<th class="price">'.concat(u,"</th>"):"",D=eo(o),Q=t?"".concat(s.combination_get," ").concat(s.combination_get_2):s.combination_buy;return'\n      <p class="instructions">'.concat(Q,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="product">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(d,'</th>\n                  <th class="quantity">').concat(l,"</th>\n                  ").concat(x,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="combined-products-list wc-product-search"\n                      data-placeholder="').concat(r,'"\n                      data-action="acfw_search_products"\n                      data-exclude="" multiple>').concat(D,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ne(),"\n    ")}function Xt(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function eo(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.product_id,'" selected>').concat(o.label,"</option>");return t}function to(e,t=!1){const{categories:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:l,categories:d,price_discount:u,type_to_search:r}=a,y=i?e.discount_type:"override",$=t?oo(y,c):"",x=t?'<th class="price">'.concat(u,"</th>"):"",D=no(o),Q=t?"".concat(s.categories_get):s.categories_buy;return'\n      <p class="instructions">'.concat(Q,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="category">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(d,'</th>\n                  <th class="quantity">').concat(l,"</th>\n                  ").concat(x,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="product-categories-list wc-product-search"\n                      data-placeholder="').concat(r,'"\n                      data-action="acfw_search_product_category"\n                      data-exclude="" multiple>').concat(D,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ne(),"\n    ")}function oo(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function no(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.category_id,'" selected>').concat(o.label,"</option>");return t}function Me(e){const{product_id:t,product_label:o}=e;return'\n    <td class="product product-'.concat(t,' object" data-product="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function W(e=3,t="product"){const{no_products_added:o,no_categories_added:n}=acfw_edit_coupon;return'\n    <tr class="no-result">\n        <td colspan="'.concat(e,'">').concat(t=="category"?n:o,"</td>\n    </tr>\n    ")}function io(e,t,o=!1){const{add_product_label:n,bogo_form_fields:i,bogo_instructions:c}=acfw_edit_coupon,{quantity:a,product:s}=i,l=o?"".concat(c.specific_get):c.specific_buy,d=o?4:3,u=o?'<th class="price">Price/Discount</th>':"";let r="",y=[];if(e.length>=1&&t=="specific-products")for(let x of e){let{quantity:D,discount_type:Q,discount_value:H}=x,R=o?co(Q,H):"";y.push(x.product_id),r+="\n        <tr>\n          ".concat(Me(x),'\n          <td class="quantity">').concat(D,"</td>\n          ").concat(R,'\n          <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n          </td>\n        </tr>\n      ')}else r=W(d);return'\n    <p class="instructions">'.concat(l,'</p>\n    <table class="product-quantity-condition-table acfw-styled-table" \n      data-type="product" data-exclude="').concat(j(JSON.stringify(y)),'" \n      data-isdeals="').concat(o,'">\n      <thead>\n        <tr>\n          <th class="product">').concat(s,'</th>\n          <th class="quantity">').concat(a,"</th>\n          ").concat(u,'\n          <th class="actions"></th>\n        </tr>\n      </thead>\n      <tbody>').concat(r,'</tbody>\n      <tfoot>\n        <tr>\n          <td colspan="').concat(d,'">\n            <a class="add-table-row" href="javascript:void(0);">\n              <i class="dashicons dashicons-plus"></i>\n              ').concat(n,"\n            </a>\n          </td>\n        </tr>\n      </tfoot>\n    </table>\n  ")}function co(e="override",t="0"){return'<td class="price">\n    ('.concat(e,") ").concat(t,"\n  </td>")}function ao(e,t=!1){return t?lo(e):so(e)}function so(e){const{quantity:t}=e,{bogo_instructions:o,bogo_form_fields:n}=acfw_edit_coupon;return'\n    <p class="instructions">'.concat(o.anyproducts_buy,'</p>\n    <div class="any-products-trigger-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <div class="trigger-field-row trigger-quantity-field-row">\n        <label for="any_products_trigger_qty">').concat(n.trigger_quantity,'</label>\n        <input type="number" id="any_products_trigger_qty" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1" />\n      </div>\n    </div>\n    ').concat(ne(),"\n  ")}function lo(e){const{quantity:t,discount_type:o,discount_value:n}=e,{currency_symbol:i,discount_field_options:c,bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{override:l,percent:d,fixed:u}=c,{quantity:r,price_discount:y,discount_type:$}=a,x=o?e.discount_type:"override";return'\n    <p class="instructions">'.concat(s.anyproducts_get,'</p>\n    <table class="acfw-styled-table any-products-apply-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <thead>\n        <tr>\n          <th class="quantity">').concat(r,'</th>\n          <th class="type">').concat($,'</th>\n          <th class="price">').concat(y,'</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td class="quantity object">\n            <input type="number" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1">\n          </td>\n          <td class="type">\n            <select class="discount_type">\n              <option value="override" ').concat(x=="override"?"selected":"",">").concat(i," : ").concat(l,'</option>\n              <option value="percent" ').concat(x=="percent"?"selected":"",">% : ").concat(d,'</option>\n              <option value="fixed" ').concat(x=="fixed"?"selected":"",">-").concat(i," : ").concat(u,'</option>\n            </select>\n          </td>\n          <td class="price">\n            <input type="text" class="discount_value short wc_input_price" value="').concat(n!=null?n:"0",'">\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    ').concat(ne(),"\n  ")}const C=jQuery,J=document.querySelector("#acfw_bogo_deals");function M(e){C(J).data("editing",e),C(J).find("#save-bogo-deals").prop("disabled",!e)}function ro(e){const t=C(this),o=t.data("block"),n=J.querySelector(".bogo-conditions-block"),i=J.querySelector(".bogo-product-deals-block"),c=C(J).data("bogo_deals"),a=c.conditions?c.conditions:null,s=c.deals?c.deals:null,l=o=="conditions"?c.conditions_type:c.deals_type;let d=null;o==="conditions"?d=c.conditions_type==t.val()?a:d:d=c.deals_type==t.val()?s:d;const u=o=="deals";let r=!1,y,$;switch(t.val()){case"combination-products":y=Kt(d!=null?d:{},u),r=!0;break;case"product-categories":y=to(d!=null?d:[],u),r=!0;break;case"any-products":y=ao(d!=null?d:{},u),r=!0;break;case"specific-products":default:y=io(d!=null?d:{},l,u),r=!1;break}if(o=="conditions")C(n).html(y).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=n;else{const x=C(J).find(".multiple-items-desc");t.val()!=="specific-products"?x.show():x.hide(),C(i).html(y).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=i}r&&acfw_edit_coupon.upsell!==void 0?C($).addClass("premium-only"):C($).removeClass("premium-only"),C("body").trigger("wc-enhanced-select-init"),C("body").trigger("init_tooltips")}function uo(){const e=C(this),t=e.closest("#acfw_bogo_deals");e.val()==="repeat"?(t.find(".repeat-limit-field-wrap").addClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!1)):(t.find(".repeat-limit-field-wrap").removeClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!0))}const p=jQuery,w=document.querySelector("#acfw_bogo_deals"),{post_id:ee}=woocommerce_admin_meta_boxes;function po(){var H,R;p("#acfw_bogo_deals").find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click");const{post_status:e,upsell:t}=acfw_edit_coupon,o=w.querySelectorAll(".bogo-conditions-block table.acfw-styled-table tbody td.object,.bogo-conditions-block .any-products-trigger-form"),n=w.querySelectorAll(".bogo-product-deals-block table.acfw-styled-table tbody td.object"),i=w.querySelector(".acfw-overlay"),c=w.querySelector("input[name='bogo_type']:checked"),a=p(w).find("#bogo-condition-type").val(),s=p(w).find("#bogo-deals-type").val(),l=parseInt(p(w).find("#bogo-repeat-limit").val()),d=p(w).find(".notice-option"),u=$e(o,a),r=$e(n,s),y=c?c.value:null;let $=!1,x=!1;if(a==="any-products"&&($=(u==null?void 0:u.quantity)<1),s==="any-products"&&(x=!(r!=null&&r.discount_type)||!(r!=null&&r.discount_value)||(r==null?void 0:r.quantity)<1),a==="combination-products"&&($=!((H=u==null?void 0:u.products)!=null&&H.length)||(u==null?void 0:u.quantity)<1),s==="combination-products"&&(x=!((R=r==null?void 0:r.products)!=null&&R.length)||!(r!=null&&r.discount_type)||!(r!=null&&r.discount_value)||(r==null?void 0:r.quantity)<1),(u==null?void 0:u.length)<1||(r==null?void 0:r.length)<1||!y||$||x){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),p(w).addClass("save-error");return}if(t!==void 0&&(a!=="specific-products"||s!=="specific-products")){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),p(w).addClass("save-error");return}if(["any-products","combination-products"].includes(s)&&!qe(r==null?void 0:r.discount_type,r==null?void 0:r.discount_value)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg),p(w).addClass("save-error");return}const D={message:d.find("textarea[name='acfw_bogo_notice_message_text']").val(),button_text:d.find("input[name='acfw_bogo_notice_button_text']").val(),button_url:d.find("input[name='acfw_bogo_notice_button_url']").val(),notice_type:d.find("select[name='acfw_bogo_notice_type']").val()};E(i,"show"),p(w).trigger("save_bogo_deals");const Q={conditions:u,deals:r,conditions_type:a,deals_type:s,repeat_limit:l,type:y,notice_settings:D,nonce:p(w).data("nonce")};p.post(ajaxurl,{action:"acfw_save_bogo_deals",coupon_id:ee,...Q},ie=>{ie.status=="success"?(p(w).data("bogo_deals",Q),e!=="publish"&&(p("input[name='post_title']").val()||p("input[name='post_title']").val("coupon-"+ee),p("select[name='post_status']").append(new Option("Published","publish")).val("publish"),p("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),p("input#publish").click())):ie.error_msg&&vex.dialog.alert(ie.error_msg),p(w).find("#clear-bogo-deals").prop("disabled",!1),M(!1),E(i,"hide")},"json")}function $e(e,t){let o=[],n;switch(t){case"any-products":o=p(e).closest(".any-products-form").data("anyproducts");break;case"combination-products":case"product-categories":o=p(e).closest("table.combined-objects-form").data("combined");break;case"specific-products":default:e.forEach(i=>{n=jQuery(i).data("product"),n&&o.push(n)});break}return o}function _o(){const e=p(this);if(!confirm(e.data("prompt")))return;const t=w.querySelector(".bogo-conditions-block table.acfw-styled-table tbody"),o=w.querySelector(".bogo-product-deals-block table.acfw-styled-table tbody"),n=w.querySelector(".acfw-overlay"),i=w.querySelector("input[name='bogo_type']:checked");E(n,"show"),p.post(ajaxurl,{action:"acfw_clear_bogo_deals",coupon_id:ee,_wpnonce:e.data("nonce")},c=>{c.status=="success"?(p(t).html(W(3)),p(o).html(W(4)),p(i).prop("checked",!1),e.prop("disabled",!0),M(!1),p("#post-status-display").text()!="Published"&&(p("input[name='post_title']").val()||p("input[name='post_title']").val("coupon-"+ee),p("input#publish").click())):c.error_msg&&vex.dialog.alert(c.error_msg),E(n,"hide")},"json")}function fo(){const e=p(this).closest("table.combined-objects-form"),t=e.data("combined"),o=e.find(".wc-product-search option:selected"),n=parseInt(e.find("input.condition-quantity").val()+""),i=e.data("type").toString(),c=i==="category"?{categories:[],quantity:n}:{products:[],quantity:n};if(e.data("isdeals")){const d=e.find("select.discount_type"),u=e.find("input.discount_value"),r=parseFloat(u.val());if(r<0||isNaN(r)){u.val(t?t.discount_value:""),vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}else c.discount_type=d.val(),c.discount_value=u.val()}let s,l;for(l=0;l<o.length;l++)s=p(o[l]),i==="category"?c.categories.push({category_id:s.val(),label:s.text()}):c.products.push({product_id:s.val(),label:s.text()});e.data("combined",c),M(!0)}function go(e){p(w).data("editing")&&(e.preventDefault(),p(w).find("#save-bogo-deals").trigger("click"),setTimeout(()=>{p(w).hasClass("save-error")?p(w).removeClass("save-error"):p("form#post").submit()},1e3))}function mo(e){const t=p(this).closest(".any-products-trigger-form"),o=parseInt(t.find("input#any_products_trigger_qty").val()),n={quantity:o&&!isNaN(o)?o:0};t.data("anyproducts",n),e.type==="change"&&M(!0)}function ho(e){const t=p(this).closest(".any-products-apply-form"),o=parseInt(t.find("input.condition-quantity").val()),n=t.find("select.discount_type").val().toString(),i=t.find("input.discount_value").val().toString(),c={quantity:o&&!isNaN(o)?o:0,discount_type:n!=null?n:"",discount_value:i!=null?i:""};t.data("anyproducts",c),e.type==="change"&&M(!0)}function Qe(e,t,o,n=!1){const{type_to_search:i}=acfw_edit_coupon.bogo_form_fields,{add:c,edit:a,cancel:s}=acfw_edit_coupon.product_table_buttons,{quantity:l}=n,d=typeof n=="object"?vo(e,n):"",u=o?bo(n):"",r=typeof n=="object"?a:c;return'\n    <tr class="add-edit-form adding">\n        <td class="product" data-object="'.concat(typeof n=="object"?j(JSON.stringify(n)):0,'">\n            <div class="object-search-wrap">\n                <select class="').concat(e=="category"?"product-category-in-cart":"product-in-cart",' wc-product-search"\n                    data-placeholder="').concat(i,'"\n                    data-action="').concat(e=="category"?"acfw_search_product_category":"acfw_search_products",'"\n                    data-exclude="').concat(j(JSON.stringify(t)),'">').concat(d,'</select>\n            </div>\n        </td>\n        <td class="quantity">\n            <input type="number" class="condition-quantity" value="').concat(typeof n=="object"?l:1,'" min="1">\n        </td>\n        ').concat(u,'\n        <td class="actions">\n            <button type="button" class="condition-product-add button-primary">').concat(r,'</button>\n            <button type="button" class="cancel button">').concat(s,"</button>\n        </td>\n    </tr>\n    ")}function vo(e,t){const{category_id:o,product_id:n,category_label:i,product_label:c}=t,a=e=="category"?o:n,s=e=="category"?i:c;return'<option value="'.concat(a,'">').concat(s,"</option>")}function bo(e){const{currency_symbol:t,discount_field_options:o}=acfw_edit_coupon,{override:n,percent:i,fixed:c}=o,{discount_type:a,discount_value:s}=e,l=typeof e=="object"&&s?s:"0";return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(a=="override"?"selected":"",">").concat(t," : ").concat(n,'</option>\n            <option value="percent" ').concat(a=="percent"?"selected":"",">% : ").concat(i,'</option>\n            <option value="fixed" ').concat(a=="fixed"?"selected":"",">-").concat(t," : ").concat(c,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(l,'">\n        </div>\n    </td>\n    ')}function yo(e){const{category_id:t,category_label:o}=e;return'\n    <td class="category category-'.concat(t,' object" data-category="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function Ie(e,t,o){const{quantity:n,discount_type:i,discount_value:c}=e,a=o?'<td class="price">('.concat(i,") ").concat(c,"</td>"):"";return"\n    <tr>\n      ".concat($o(e,t),'\n      <td class="quantity">').concat(n,"</td>\n      ").concat(a,'\n      <td class="actions">\n        <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n        <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n      </td>\n    </tr>')}function $o(e,t){switch(t){case"category":return yo(e);case"product":return Me(e)}return""}const V=jQuery;acfw_edit_coupon;function wo(){const e=V(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("isdeals"),i=t.data("type"),c=t.data("exclude");o.find("tr.no-result").remove(),o.append(Qe(i,c,n)),V("body").trigger("wc-enhanced-select-init"),o.find("tr.add-edit-form select.enhanced").trigger("focus")}function xo(){const e=jQuery(this),t=e.closest("tr"),o=e.closest(".acfw-styled-table"),n=o.find("tbody"),i=o.data("isdeals"),c=o.data("type"),a=t.find(".object").data(c),{category_id:s,product_id:l}=a,d=o.data("exclude"),u=c=="category"?s:l;d.splice(d.indexOf(u),1),n.find("tr.no-result").remove(),t.replaceWith(Qe(c,d,i,a)),o.data("exclude",d),o.find(".wc-product-search").data("exclude",d),V("body").trigger("wc-enhanced-select-init")}function ko(){const e=V(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=o.data("isdeals"),c=t.find("td").length,a=o.data("type"),s=t.find("td.product").data("object"),{category_id:l,product_id:d}=s,u=o.data("exclude"),r=a=="category"?l:d;if(u.includes(r)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}typeof s=="object"?(u.push(r),t.replaceWith(Ie(s,a,i)),o.data("exclude",u),o.find(".wc-product-search").data("exclude",u)):(t.remove(),n.find("tr").length<=0&&n.append(W(c,a)))}function Fo(){const e=V(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=o.data("isdeals"),i=o.data("type"),c=t.find(".wc-product-search"),a=t.find(".condition-quantity"),s=o.data("exclude");if(!c.val()||!a.val()||a.val()<1){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}if(s.includes(parseInt(c.val()))){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(n){const r=t.find("input.discount_value").val();if(!qe(t.find("select.discount_type").val(),r)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg);return}if(le(r)<0||isNaN(le(r))){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}}const l=jo(t,i,n),{category_id:d,product_id:u}=l;s.push(i=="category"?d:u),t.replaceWith(Ie(l,i,n)),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),M(!0)}function qo(){const e=V(this),t=e.closest("tr"),o=t.closest("table"),n=t.closest("tbody"),i=t.find("td").length,c=o.data("type"),a=t.find("td.object").data(c),s=o.data("exclude");let l;switch(c){case"category":l=s.indexOf(parseInt(a.category_id));break;case"product":default:l=s.indexOf(parseInt(a.product_id));break}l!==-1&&s.splice(l,1),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),t.remove(),n.find("tr").length<=0&&n.append(W(i,c)),M(!0)}function jo(e,t,o){let n={};return t=="category"?n={category_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),category_label:e.find(".wc-product-search option:selected").text()}:n={product_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),product_label:e.find(".wc-product-search option:selected").text()},o&&(n.discount_type=e.find("select.discount_type").val(),n.discount_value=e.find("input.discount_value").val()),n}const f=jQuery,k=document.querySelector("#acfw_bogo_deals");acfw_edit_coupon={...acfw_edit_coupon,bogo_toggle_editing_mode:M};function Co(){f(k).on("click",".acfw-styled-table tfoot .add-table-row",wo),f(k).on("click",".acfw-styled-table td.actions a.edit",xo),f(k).on("click","tr.add-edit-form .actions .cancel",ko),f(k).on("click","tr.add-edit-form .actions .condition-product-add",Fo),f(k).on("click",".acfw-styled-table td.actions a.remove",qo),f(k).on("click","button#save-bogo-deals",po),f(k).on("click","button#clear-bogo-deals",_o),f(k).on("change acfw_load","select#bogo-condition-type,select#bogo-deals-type",ro),f(k).on("change acfw_fetch_data",".combined-objects-form select,.combined-objects-form input",fo),f(k).on("change acfw_fetch_data",".any-products-trigger-form input",mo),f(k).on("change acfw_fetch_data",".any-products-apply-form input,.any-products-apply-form select",ho),f(k).on("change",".condition-quantity",Do),f(k).on("blur",".wc_input_price",Ze),f(k).css("min-height",f("#coupon_options").height()),f(k).on("change","input[name='bogo_type']",Y),f(k).on("change acfw_load","input[name='bogo_type']",uo),f(k).on("change","#bogo-repeat-limit",Y),f(k).on("click",".acfw-styled-table .actions .remove",Y),f(k).find(".notice-option").on("change","input,textarea,select",Y),f("form#post").on("submit",go),f(k).find("select#bogo-condition-type,select#bogo-deals-type").trigger("acfw_load"),f("#woocommerce-coupon-data").on("change acfw_load","select#discount_type",So),f("#woocommerce-coupon-data select#discount_type").trigger("acfw_load"),f(k).find("input[name='bogo_type']:checked").trigger("acfw_load")}function So(){const e=f(this),t=e.closest("#general_coupon_data"),o=t.find("p.form-field input");if(e.val()==="acfw_bogo"){t.addClass("acfw-bogo-type"),f("#acfw_bogo_deals").show();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","_acfw_show_on_my_coupons_page","_acfw_force_apply_url_coupon","_acfw_coupon_label","coupon_amount"].includes(f(o[n]).prop("name"))||f(o[n]).prop("disabled",!0)}else{t.removeClass("acfw-bogo-type"),f("#acfw_bogo_deals").hide();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","coupon_amount"].includes(f(o[n]).prop("name"))||f(o[n]).prop("disabled",!1)}}function Y(){M(!0)}function Do(){const e=jQuery(this);e.val()<1&&e.val(1)}var Ne=jQuery;function Lo(){const e=Ne(".toggle-enable-fields");e.on("change",".toggle-trigger-field",Oo),e.find(".toggle-trigger-field").trigger("change")}function Oo(){const e=Ne(this),t=e.closest(".toggle-enable-fields"),o=t.find("select,textarea,input:not(.toggle-trigger-field)"),n=!e.prop("checked");o.prop("disabled",n),n?o.closest(".form-field").addClass("disabled"):o.closest(".form-field").removeClass("disabled")}var te=jQuery;function To(){const e=document.querySelector("#acfw_url_coupon");te(e).on("click",".copy-coupon-url",Qo),Mo()}function Mo(){te("input#_acfw_coupon_url").after('<button type="button" class="copy-coupon-url" data-clipboard-target="#_acfw_coupon_url">\n    <svg width="15" height="15" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 460 460" style="enable-background:new 0 0 460 460;" xml:space="preserve">\n      <g>\n        <path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272\n          c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729\n          c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"/>\n        <path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272\n          c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068\n          c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001\n          C291.206,428.715,289.92,430,288.341,430z"/>\n      </g>\n    </svg>\n    </button>'),new ClipboardJS(".copy-coupon-url")}function Qo(){te(this).after('<span class="coupon-url-copied">'.concat(acfw_edit_coupon.copied_label,"</span>")),setTimeout(()=>{te("span.coupon-url-copied").fadeOut(500)},1e3)}const b=jQuery;function Io(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=document.querySelector("#general_coupon_data p.expiry_date_field");b(e).on("change",".date-field,.date-hour,.date-minute",Eo),b(e).on("click",".clear-scheduler-fields",zo),b(n).css("display","none"),b(t).trigger("change acfw_load"),b(o).trigger("change acfw_load"),b(e).on("change acfw_load",".acfw-section-toggle input",Ho),b(e).find(".acfw-section-toggle input").trigger("acfw_load"),b(".wrap").on("submit","form#post",Ao),No()}function No(){var i,c;const e=document.querySelector("#_acfw_schedule_start"),t=document.querySelector("#_acfw_schedule_expire"),o=(i=flatpickr.parseDate(t.value,"Y-m-d H:i:S"))!=null?i:null,n=(c=flatpickr.parseDate(e.value,"Y-m-d H:i:S"))!=null?c:null;o&&o.setMinutes(o.getMinutes()-1),n&&n.setMinutes(n.getMinutes()+1),b(e).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,allowInvalidPreload:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",maxDate:o,onChange:function([a],s,l){a?(a.setMinutes(a.getMinutes()+1),t._flatpickr.set("minDate",a),we()):t._flatpickr.set("minDate",null)}}),b(t).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",minDate:n,onChange:function([a],s,l){a?(a.setMinutes(a.getMinutes()-1),e._flatpickr.set("maxDate",a),we()):e._flatpickr.set("maxDate",null)}})}function we(){const e=flatpickr.parseDate(b("#_acfw_schedule_start").val(),"Y-m-d H:i:S"),t=flatpickr.parseDate(b("#_acfw_schedule_expire").val(),"Y-m-d H:i:S");e>=t?(b("#_acfw_schedule_start").parent().addClass("error"),b("#_acfw_schedule_expire").parent().addClass("error")):(b("#_acfw_schedule_start").parent().removeClass("error"),b("#_acfw_schedule_expire").parent().removeClass("error"))}function Ao(e){b(".acfw-date-range-schedules-section span.date-time-field").hasClass("error")&&(e.preventDefault(),vex.dialog.alert({unsafeMessage:acfw_edit_coupon.invalid_scheduler_time}),b("#publishing-action .spinner").removeClass("is-active"),b("#publishing-action #publish").removeClass("disabled"))}function Eo(){const e=b(this).closest(".date-time-field"),t=e.find(".date-field");t.val()?t.prop("required",!0):t.prop("required",!1)}function zo(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=b(this).siblings(".date-time-field");n.find("input").prop("required",!1).val(""),n.find("input")[0]._flatpickr.clear(),b(t).trigger("change"),b(o).trigger("change")}function Ho(){const e=b(this),o=e.closest(".acfw-scheduler-section").find(".options_group");e.is(":checked")?(o.removeClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!1),b("#acfw_scheduler .options_group input").trigger("acfw_load")):(o.addClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!0)),o.find("input").trigger("change")}const g=jQuery;let ce=!1;function Jo(){g("#usage_limit_coupon_data").on("change","#reset_usage_limit_period",Bo),g("#usage_restriction_coupon_data .acfw_exclude_coupons_field,#usage_restriction_coupon_data .acfw_allowed_customers_field").on("click change focus","input,select",Po),g("#acfw-auto-apply-coupon").on("change","#acfw_auto_apply_coupon_field",Uo),g("#acfw-virtual-coupon").on("change","#acfw_enable_virtual_coupons",Wo),g("#acfw_cart_conditions").on("change",".condition-types",Ro),g("#woocommerce-coupon-data").on("change acfw_load","#discount_type",Yo),g("#woocommerce-coupon-data").on("change acfw_load","#discount_type",Zo),g("#woocommerce-coupon-data").on("focusin","#discount_type",Go),g("#acfw_bogo_deals").on("change acfw_load","select#bogo-deals-type",Ko),g("#acfw_bogo_deals").on("change","input[name='acfw_bogo_auto_add_products']",Xo),g("#acfw_scheduler").on("change",".acfw-daytime-schedules-section .acfw-section-toggle input[type='checkbox']",en),g("#woocommerce-coupon-data #discount_type").trigger("acfw_load"),Vo()}function Vo(){g("p.acfw_exclude_coupons_field").insertAfter("p.form-field.individual_use_field")}function Bo(){const{usage_limits:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(e,"</div>")}),g(this).val("none")}function Po(){if(ce)return;ce=!0;const{usage_restriction:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert exclude-coupon">'.concat(e,"</div>"),afterClose:()=>ce=!1}),g(this).val("").blur()}function Uo(){const{auto_apply:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),g(this).prop("checked",!1)}function Wo(){const{virtual_coupons:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),g(this).prop("checked",!1)}function Ro(){const e=g(this),t=e.closest("#acfw_cart_conditions"),o=e.closest(".add-condition-form"),n=t.data("premium-conditions"),i=t.find(".acfw-dyk-notice-holder");let c=o.find(".acfw-dyk-notice");c.length||(o.append(i.html()),c=o.find(".acfw-dyk-notice")),g.inArray(e.val(),n)>=0?c.show():c.hide()}function Yo(){g(this).val()==="acfw_bogo"?g("p.acfw-dyk-notice-general").hide():g("p.acfw-dyk-notice-general").show()}function Go(){g(this).data("cachedval",g(this).val())}function Zo(){var o;const e=g(this).val(),{cashback_coupon:t}=acfw_edit_coupon.upsell;(e==="acfw_percentage_cashback"||e==="acfw_fixed_cashback")&&(vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),g(this).val((o=g(this).data("cachedval"))!=null?o:"percent"))}function Ko(){const e=g(this),o=e.closest("#acfw_bogo_deals").find(".bogo-auto-add-products-field"),n=o.find("input[type='checkbox']");e.val()==="specific-products"?(n.prop("disabled",!1),o.addClass("show")):(n.prop("disabled",!1),o.removeClass("show"))}function Xo(){g(this).prop("checked",!1);const{bogo_auto_add_get_products:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),g(this).val("none")}function en(){const e=g(this),{day_time_schedules:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert day-time-schedules">'.concat(t,"</div>")}),e.prop("checked",!1).trigger("acfw_load")}function tn(e){const{slug:t,action:o,placeholder:n}=e;return'\n    <div class="search-widget search-'.concat(t,'">\n      <input class="search-input" type="text" placeholder="').concat(n,'" data-action="').concat(o,'" />\n      <button type="button" class="clear-search dashicons-before dashicons-no-alt"></button>\n      <div class="search-results"></div>\n    </div>\n  ')}function on(e,t){const o=e.map(({url:n,title:i})=>'<li><a href="'.concat(nn(n,t),'" rel="noopener noreferrer nofollow" target="_blank">').concat(i,"</a></li>")).join("");return"<ul>".concat(o,"</ul>")}function nn(e,t){return"".concat(e,"?utm_source=acfwf&utm_medium=help_modal&utm_campaign=kb_search&utm_term=").concat(t)}function ae(e){const{title:t,className:o}=e;let{links:n}=e;const{is_premium:i}=acfw_edit_coupon.help_modal;return i&&(n=n.filter(c=>(c==null?void 0:c.freeOnly)===void 0||!(c!=null&&c.freeOnly))),'\n    <div class="links-list '.concat(o,'">\n      <h3>').concat(t,"</h3>\n\n      ").concat(e!=null&&e.search?tn(e==null?void 0:e.search):"","\n\n      <ul>\n        ").concat(n.map(c=>"<li>".concat(cn(c),"</li>")).join(""),"\n      </ul>\n    </div>\n  ")}function cn(e){const{title:t,url:o}=e,{is_premium:n}=acfw_edit_coupon.help_modal;return'<a href="'.concat(n&&(e!=null&&e.premiumUrl)?e==null?void 0:e.premiumUrl:o,'">').concat(t,"</a>")}function xe(e){const{labels:t,images_url:o,is_premium:n}=acfw_edit_coupon.help_modal,{target:i,left:{title:c,content:a,videos:s},right:{links:l,kbs:d,tutorials:u}}=e,r={slug:"kb-articles",action:"acfw_search_help_kb_articles",placeholder:t.search_placeholder},y=n?"acfwp":"acfwf",$="https://advancedcouponsplugin.com/pricing/?utm_source=acfwf&utm_medium=help_modal&utm_campaign=help_modal_".concat(i,"_upgrade_link"),x="https://advancedcouponsplugin.com/?utm_source=".concat(y,"&utm_medium=help_modal&utm_campaign=help_brand_link_").concat(i);return'\n    <div class="header">\n      <div class="logo">\n        <a href="'.concat(x,'" target="_blank"><img src="').concat(o,'acfw-logo.png" alt="Advanced Coupons logo" /></a>\n      </div>\n      ').concat(n?"":'\n        <div class="upgrade-link">\n          <a href="'.concat($,'" target="_blank">\n            <span>').concat(t.upgrade_to_premium,'</span>\n            <i class="dashicons dashicons-external"></i>\n          </a>\n        </div>\n      '),'\n    </div>\n    <main>\n      <h1 class="title">').concat(c,'</h1>\n      <div class="content">\n        ').concat(a,"\n      </div>\n      ").concat(s.length?'<div class="video-gallery-placeholder"><img src="'.concat(o,'spinner-2x.gif" alt="Loading videos" /><p>').concat(t.loading_videos,"</p></div>"):"","\n    </main>\n    <aside>\n      ").concat(ae({title:t.rel_links,className:"relevant-links",links:l}),"\n      ").concat(ae({title:t.kb_articles,className:"knowledge-base-articles",links:d,search:r}),"\n      ").concat(ae({title:t.tut_guides,className:"tutorials-guides",links:u}),"\n    </aside>\n  ")}function an(e){const{errorMsg:t}=e;return'\n    <div class="acfw-help-modal-error">\n      <p>'.concat(t,"</p>\n    </div>\n  ")}function sn(e){const{images_url:t}=acfw_edit_coupon.help_modal,{permission_request:o,allow:n,cancel:i}=acfw_edit_coupon.help_modal.labels;return'\n  <div id="acfw-help-modal-permission-request" data-module="'.concat(e,'">\n    <img src="').concat(t,'acfw-logo.png" />\n    <p>').concat(o,'</p>\n    <p class="actions">\n      <button class="button-primary allow" type="button">').concat(n,'</button>\n      <button class="button cancel" type="button">').concat(i,"</button>\n    </p>\n  </div>\n  ")}function Ae(){const{images_url:e,labels:t}=acfw_edit_coupon.help_modal;return'<div id="acfw-help-modal-placeholder">\n    <img src="'.concat(e,'spinner-2x.gif" />\n    <p>').concat(t.loading_content,"</p>\n  </div>")}function ln(e){return'\n  <div class="acfw-help-video-gallery">\n    <div class="videos">\n      '.concat(e[0].embed?e[0].embed:Ee(e[0]),"\n    </div>\n    ").concat(e.length>1?'\n      <ul class="thumbnails">\n        '.concat(e.map((t,o)=>"\n            <li ".concat(o===0?'class="active"':"",'>\n              <a href="javascript:void(0);" data-videoid="').concat(t.videoid,'">\n                <img src="').concat(t.thumbnail,'" title="').concat(t.title,'" />\n              </a>\n              <span class="title">').concat(t.title,"</span>\n            </li>\n            ")).join(""),"\n      </ul>\n      "):"","\n    \n  </div>\n  ")}function Ee(e){return'\n  <div class="no-video" style="background-image:url('.concat(e.thumbnail,');">\n    <a href="').concat(e.url,'" rel="noreferer noopener" >\n      <span>').concat(acfw_edit_coupon.help_modal.labels.no_video,"</span>\n    </a>\n  </div>\n  ")}const ue=jQuery;let z=[],ze="";function He(e,t){const{_secure_nonce:o}=acfw_edit_coupon.help_modal;e.length&&ue.post(ajaxurl,{action:"acfw_get_help_videos_oembed",urls:e.map(n=>n.url),width:ue(".acfw-help-vex .vex-content main").width(),_nonce:o},n=>{n=n.map(i=>{const c=e.findIndex(a=>a.url===i.url);return i.title=c>=0?e[c].title:"",i}),z=n,ze=t,Je(n)},"json")}function dn(e,t){if(!z.length||t!==ze){He(e,t);return}Je(z)}function Je(e){const t=ue(".acfw-help-vex .video-gallery-placeholder");t.length&&t.replaceWith(ln(e))}function rn(){const e=jQuery(this),t=e.closest("li"),o=e.closest(".acfw-help-video-gallery"),n=o.find(".videos"),i=o.find("ul.thumbnails li"),c=e.data("videoid");if(t.hasClass("active"))return;i.removeClass("active"),t.addClass("active");const a=z.findIndex(s=>s.videoid===c);a>=0&&n.html(z[a].embed?z[a].embed.replace("oembed","oembed&autoplay=1"):Ee(z[a]))}const oe=jQuery,pe=[];function un(){const{allow_fetch:e}=acfw_edit_coupon.help_modal,o=oe(this).closest(".acfw-help-link").data("module");vex.dialog.open({unsafeMessage:'\n      <a class="vex-close" href="javascript:void(0);"></a>\n      '.concat(e?Ae():sn(o),"\n    "),className:"vex-theme-plain acfw-help-vex",showCloseButton:!1,buttons:{}}),e&&Ve(o)}function se(e){const t=oe("#acfw-help-modal-placeholder");t.length&&(t.replaceWith(e),oe(".acfw-help-vex").find("main a,aside a").attr("target","_blank").attr("rel","noopener noreferrer nofollow"))}function Ve(e){const{_secure_nonce:t}=acfw_edit_coupon.help_modal;let o=null;if(o=pn(e)){se(xe(o)),dn(o.left.videos,e);return}oe.post(ajaxurl,{action:"acfw_fetch_help_data",module:e,_nonce:t},n=>{pe.push(n),se(xe(n)),He(n.left.videos,e)},"json").fail(n=>{se(an(n.responseJSON))})}function pn(e){const t=pe.findIndex(o=>o.target===e);return t>=0?pe[t]:null}const ge=jQuery;let A=null,P=null;function _n(){const t=ge(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results"),{labels:i,images_url:c,_secure_nonce:a}=acfw_edit_coupon.help_modal,s=o.val();if(!s){clearTimeout(A),A=null,n.height(0).html(""),t.removeClass("show-clear");return}t.addClass("show-clear"),fn({action:o.data("action"),term:o.val(),_nonce:a},()=>{n.height(35).html('<div class="loading"><img src="'.concat(c,'spinner.gif" /></div>'))},l=>{t.hasClass("show-clear")&&(l.length?(P={term:s,results:l},n.html(on(l,s))):n.html('<div class="no-result">'.concat(i.search_no_results,"</div>")),n.height(n.find("ul,.no-result").height()+3))})}function fn(e,t,o){if(A&&(clearTimeout(A),A=null),e.term===(P==null?void 0:P.term)){o(P.results);return}A=setTimeout(()=>{t(),ge.post(ajaxurl,e,o,"json")},1e3)}function gn(){const t=ge(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results");clearTimeout(A),A=null,o.val(""),n.height(0).html(""),t.removeClass("show-clear")}const mn=jQuery;function hn(){const{_secure_nonce:e}=acfw_edit_coupon.help_modal,o=jQuery(this).closest("#acfw-help-modal-permission-request"),n=o.data("module");o.replaceWith(Ae()),mn.post(ajaxurl,{action:"acfw_save_fetch_help_permission",_nonce:e},()=>{Ve(n),acfw_edit_coupon.help_modal.allow_fetch=!0},"json")}function vn(){vex.closeAll()}const N=jQuery;function bn(){N("#post-body").on("click",".acfw-help-modal-trigger",un),N("body").on("click",".acfw-help-vex .vex-close",()=>vex.closeAll()),N("body").on("click",".acfw-help-vex .acfw-help-video-gallery ul.thumbnails li a",rn),N("body").on("keyup",".acfw-help-vex .search-widget input.search-input",_n),N("body").on("click",".acfw-help-vex .search-widget button.clear-search",gn),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.allow",hn),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.cancel",vn)}function yn(){const e=document.querySelectorAll("#post-body .acfw-help-link"),{help_text:t,images_url:o}=acfw_edit_coupon.help_modal;e.forEach(n=>{const i='\n      <a class="acfw-help-modal-trigger" href="javascript:void(0);">'.concat(t,' \n        <img class="acfw-icon" src="').concat(o,'help-icon.svg" alt="').concat(t,'" />\n      </a>\n    ');N(n).html(i)})}const{labels:q}=acfw_edit_coupon.send_coupon;function $n(){return'<button type="button" class="button acfw-send-coupon-btn">'.concat(q.title,"</button>")}function wn(e=!1){return'\n  <div class="acfw-send-coupon-form-section '.concat(e?"current":"",'" data-section="send_coupon_to">\n    <div class="section-number">\n      <span>1</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(q.send_coupon_to,'</h3>\n      <div class="section-content">\n        <label>\n          <input type="radio" name="acfw_send_coupon[to]" value="user" data-key="send_to" checked />\n           <span>').concat(q.existing_customer_account,'<span>\n        </label>\n        <label>\n          <input type="radio" name="acfw_send_coupon[to]" value="email" data-key="send_to" />\n           <span>').concat(q.new_customer,'<span>\n        </label>\n        <button type="button" class="button-primary acfw-next-section-btn" data-next_section="customer_details">').concat(q.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function xn(e=!1){return'\n  <div class="acfw-send-coupon-form-section '.concat(e?"current":"",'" data-section="customer_details">\n    <div class="section-number">\n      <span>2</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(q.customer_details,'</h3>\n      <div class="section-content">\n        <div class="customer-details-form user-form show">\n          <select data-placeholder="').concat(q.search,'" name="acfw_send_coupon[user]" data-key="user" class="wc-customer-search" style="width:100%"></select>\n        </div>\n        <div class="customer-details-form guest-form">\n          <input type="text" placeholder="').concat(q.name,'" name="acfw_send_coupon[name]" data-key="name" />\n          <input type="email" placeholder="').concat(q.email,'" name="acfw_send_coupon[email]" data-key="email" />\n          <label>\n            <input type="checkbox" data-key="create_account" value="yes" /> \n            <span>').concat(q.create_new_user_account,'</span>\n        </div>\n        <button type="button" class="button-primary acfw-next-section-btn" data-next_section="confirm_and_send">').concat(q.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}const kn=jQuery,m=new Map;function Be(e="send_coupon_to"){m.set("section",e),m.set("send_to","user"),m.set("user_id","0"),m.set("name",""),m.set("email",""),m.set("create_account","")}function Fn(){const e=kn(this),t=e.data("key");let o=e.val()?e.val().toString():"";switch(t){case"user":const n=e.find("option:selected");m.set("user_id",o),m.set("name",lodash.first(n.text().split(" ("))),m.set("email",lodash.last(n.text().split("&ndash; ")).replace(")",""));break;case"email":e.removeClass("error"),Xe(o)||o===""?(m.set(t,o),m.set("user_id","0")):(m.set(t,""),e.addClass("error"));break;case"create_account":o=e.is(":checked")?o:"",m.set(t,o);break;default:m.set(t,o)}Ln("confirm_and_send",m.get("section")==="confirm_and_send")}function qn(e=!1){var o;const t=!m.get("name")||!m.get("email")?"disabled":"";return'\n  <div class="acfw-send-coupon-form-section '.concat(e?"current":"",'" data-section="confirm_and_send">\n    <div class="section-number">\n      <span>3</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(q.confirm_and_send,'</h3>\n      <div class="section-content">\n        <p>\n          <strong>').concat(q.customer,":</strong> ").concat((o=m.get("name"))!=null?o:"","\n          ").concat(m.get("email")?"&lt;".concat(m.get("email"),">"):"",'\n        </p>\n        <p><a class="preview-email-link  ').concat(t,'" href="#">').concat(q.preview_email," ").concat(jn(),'</a></p>\n        <button type="button" class="button-primary acfw-send-email-btn" ').concat(t,">").concat(q.send_email," ").concat(Cn(),'</button>\n        <p class="request-message"></p>\n      </div>\n    </div>\n  </div>\n  ')}function jn(){return'\n  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.90625 8.59363V1.40613C8.90625 1.23328 8.7666 1.09363 8.59375 1.09363L1.40625 1.09363C1.2334 1.09363 1.09375 1.23328 1.09375 1.40613V4.92175C1.09375 4.96472 1.12891 4.99988 1.17188 4.99988H1.71875C1.76172 4.99988 1.79688 4.96472 1.79688 4.92175V1.79675L8.20313 1.79675V8.203H5.07813C5.03516 8.203 5 8.23816 5 8.28113V8.828C5 8.87097 5.03516 8.90613 5.07813 8.90613H8.59375C8.7666 8.90613 8.90625 8.76648 8.90625 8.59363ZM4.14648 6.37976L4.65625 6.88953C4.66663 6.89985 4.6797 6.90706 4.69397 6.91033C4.70824 6.91359 4.72314 6.91279 4.73697 6.90801C4.75081 6.90323 4.76303 6.89466 4.77224 6.88328C4.78145 6.8719 4.78728 6.85816 4.78906 6.84363L4.99414 5.09167C5 5.04187 4.95801 4.9989 4.90723 5.00476L3.15527 5.20984C3.09082 5.21765 3.06348 5.29675 3.10938 5.34265L3.62109 5.85437L1.11914 8.35632C1.08887 8.3866 1.08887 8.4364 1.11914 8.46667L1.5332 8.88074C1.56348 8.91101 1.61328 8.91101 1.64356 8.88074L4.14648 6.37976Z" fill="#3A6FAC"/>\n  </svg>\n  '}function Cn(){return'\n  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.875 1.87512H1.125C0.917578 1.87512 0.75 2.0427 0.75 2.25012V9.75012C0.75 9.95754 0.917578 10.1251 1.125 10.1251H10.875C11.0824 10.1251 11.25 9.95754 11.25 9.75012V2.25012C11.25 2.0427 11.0824 1.87512 10.875 1.87512ZM10.4062 3.17356V9.28137H1.59375V3.17356L1.27031 2.92161L1.73086 2.32981L2.23242 2.72004H9.76875L10.2703 2.32981L10.7309 2.92161L10.4062 3.17356ZM9.76875 2.71887L6 5.64856L2.23125 2.71887L1.72969 2.32864L1.26914 2.92043L1.59258 3.17239L5.5957 6.28489C5.71083 6.37433 5.85246 6.42288 5.99824 6.42288C6.14403 6.42288 6.28566 6.37433 6.40078 6.28489L10.4062 3.17356L10.7297 2.92161L10.2691 2.32981L9.76875 2.71887Z" fill="white"/>\n  </svg>\n  '}const Sn=jQuery;function Dn(e){return'\n    <div id="acfw-send-coupon">\n      <h2>'.concat(q.title,'</h2>\n      <div class="description">\n        <p>').concat(q.description,'</p>\n      </div>\n\n      <div class="acfw-send-coupon-form-sections">\n        ').concat(K("send_coupon_to")(e==="send_coupon_to"),"\n        ").concat(K("customer_details")(e==="customer_details"),"\n        ").concat(K("confirm_and_send")(e==="confirm_and_send"),"\n      </div>\n    </div>\n  ")}function Ln(e,t=!1){Sn(".acfw-send-coupon-modal").find("[data-section='".concat(e,"']")).replaceWith(K(e)(t))}function K(e){switch(e){case"send_coupon_to":return wn;case"customer_details":return xn;case"confirm_and_send":return qn}return()=>{}}const v=jQuery;function On(){Tn(),Be(),v("body").on("click","button.acfw-send-coupon-btn",Mn),v("body").on("change clearForm",".acfw-send-coupon-form-section input[type='radio']:checked",Qn),v("body").on("click",".acfw-send-coupon-form-section .acfw-next-section-btn",In),v("body").on("click",".acfw-send-coupon-form-section .section-number,.acfw-send-coupon-form-section h3",Nn),v("body").on("change",".acfw-send-coupon-form-section input, .acfw-send-coupon-form-section select",Fn),v("body").on("click",".acfw-send-coupon-form-section .preview-email-link",An),v("body").on("click",".acfw-send-coupon-form-section .acfw-send-email-btn",En)}function Tn(){v(".page-title-action").after($n())}function Mn(){vex.dialog.open({unsafeMessage:Dn(m.get("section")),className:"vex-theme-plain acfw-send-coupon-modal",showCloseButton:!0,buttons:{},afterOpen:()=>v(document.body).trigger("wc-enhanced-select-init")})}function Qn(){const o=v(this).val().toString()==="user"?".user-form":".guest-form";v(".acfw-send-coupon-form-section .customer-details-form").removeClass("show").find("input,select").prop("disabled",!0),v(".acfw-send-coupon-form-section ".concat(o)).addClass("show").find("input,select").prop("disabled",!1)}function In(){const t=v(this).data("next_section");v(".acfw-send-coupon-form-section").removeClass("current"),v(".acfw-send-coupon-form-section[data-section='".concat(t,"']")).addClass("current")}function Nn(){const e=v(this).closest(".acfw-send-coupon-form-section");e.hasClass("current")||(v(".acfw-send-coupon-form-section").removeClass("current"),e.addClass("current"))}function An(){if(v(this).hasClass("disabled"))return;const t=new URLSearchParams;t.append("action","acfw_advanced_coupon_preview_email"),t.append("email_id","acfw_coupon_email"),t.append("args[coupon_id]",v("#post_ID").val()),t.append("args[name]",m.get("name")),t.append("args[email]",m.get("email")),t.append("args[user_id]",m.get("user_id")),t.append("_wpnonce",acfw_edit_coupon.send_coupon.form_nonce),window.open("".concat(ajaxurl,"?").concat(t.toString()),"_blank")}function En(){v(this).prop("disabled",!0),v("#acfw-send-coupon .request-message").html("").removeClass("success error"),wp.apiFetch({path:"/coupons/v1/sendcoupon",method:"POST",data:{coupon_id:v("#post_ID").val(),customer:parseInt(m.get("user_id"))?m.get("user_id"):m.get("email"),name:m.get("name"),create_account:m.get("create_account")}}).then(t=>{zn(),ke("success",t.message)}).catch(t=>ke("error",t.message))}function zn(){Be("confirm_and_send"),v("#acfw-send-coupon").find("select,input[type='text'],input[type='email']").val("").trigger("change"),v("#acfw-send-coupon").find("input[type='radio']").prop("checked",!1),v("#acfw-send-coupon").find("label:first-child input[type='radio']").prop("checked",!0).trigger("clearForm"),v("#acfw-send-coupon").find("input[type='checkbox']").prop("checked",!1)}function ke(e,t){v("#acfw-send-coupon .request-message").html(t).addClass(e)}const{modules:G,upsell:Hn}=acfw_edit_coupon;jQuery(document).ready(e=>{G.indexOf("acfw_cart_conditions_module")>-1&&Yt(),G.indexOf("acfw_bogo_deals_module")>-1&&Co(),G.indexOf("acfw_url_coupons_module")>-1&&To(),G.indexOf("acfw_scheduler_module")>-1&&Io(),Hn&&Jo(),Lo(),yn(),bn(),Jn(),On()});function Jn(){const t=new URLSearchParams(window.location.search).get("type");t&&window.location.pathname.includes("post-new.php")&&jQuery("select#discount_type").val(t).trigger("change")}export{Vn as __vite_legacy_guard};
