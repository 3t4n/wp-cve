!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.apiFetch,r=e.n(t);!function(){const e=(e,t,r)=>{e.addEventListener(t,r)},t=(e,t,r)=>{e.removeEventListener(t,r)},s=(e,t)=>Array.prototype.slice.call(e.querySelectorAll(t)),i=(e,t)=>e.querySelector(t),o=window,l=o.document,a=o.setTimeout,n=o.clearTimeout,c="click",d="mouseout",u="scroll",f="touchstart",m="mousedown",p="mousemove",v="keydown",b="keyup",h="keypress";function g(){const g=l.documentElement,w=s(l,".mailster-block-form"),A=o.mailsterBlockEvents||{};Array.prototype.forEach.call(w,(w=>{const _=i(w,".mailster-block-form-data"),S=JSON.parse(_.textContent),T=w.closest(".wp-block-mailster-form-outside-wrapper"),O=s(T,".mailster-block-form-close, .mailster-block-form-inner-close"),D=O[O.length-1],P=i(T,'button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])'),C=i(w,".mailster-block-form-info"),x=3600*(S.cooldown||0),H="submission"==S.type;let I=null,j=null;const M={delay:()=>{I=a((()=>{K()&&G()}),1e3*S.trigger_delay)},inactive:()=>{e(o,m,J),e(o,p,J),e(o,h,J),e(o,u,J),e(o,f,J)},scroll:function(){e(o,u,N),e(o,f,N)},click:()=>{const t=s(l,S.trigger_click);Array.prototype.forEach.call(t,((t,r)=>{e(t,c,G)}))},exit:()=>{e(l,d,q)}},J=L((function(e){n(j),j=a((()=>{K()&&G()}),1e3*S.trigger_inactive)}),100),N=L((function(e){if(k()>=S.trigger_scroll/100){if(!K())return;G()}}),50);function q(e){if(!e.toElement&&!e.relatedTarget){if(!K())return;G()}}function F(e){e.preventDefault();let t=new FormData(w),o={},n=[],c=i(w,".submit-button"),d=i(C,".mailster-block-form-info-success"),u=i(C,".mailster-block-form-info-error");w.classList.remove("completed"),s(w,".is-error").forEach((e=>{e.classList.remove("is-error")})),s(w,"[aria-invalid]").forEach((e=>{e.removeAttribute("aria-invalid")})),w.classList.add("loading"),w.setAttribute("disabled",!0),l.referrer&&new URL(l.referrer).origin!==l.location.origin?t.append("_referer",l.referrer):t.append("_referer",l.location.href);let f,m=t.getAll("_lists[]");m.length||t.append("_lists[]",[]);for(let e of t.keys())"_lists[]"==e?(f=m,e=e.replace("[]","")):f=t.get(e),o[e]=f;r()({path:"mailster/v1/forms/"+S.id+"/"+S.type,method:H?"POST":"PATCH",data:o}).then((e=>{z("conversion"),X("submit",{...e.data,formdata:o}),C.classList.remove("is-error"),w.classList.remove("has-errors"),H&&e.data.redirect?a((()=>location.href=e.data.redirect),150):(e.message&&n.push(e.message),n.length&&(d.innerHTML=n.join("<br>")),C.setAttribute("role","alert"),C.classList.add("is-success"),H&&(w.classList.add("completed"),l.activeElement.blur(),X("complete",{...e.data,formdata:o}),S.triggers&&a((()=>{R(),w.reset()}),3e3)))})).catch((e=>{e.data.fields&&(w.classList.add("has-errors"),Object.keys(e.data.fields).map((t=>{var r;const s=i(w,".wp-block-mailster-"+t+", .wp-block-mailster-field-"+t),o="hint-"+S.identifier+"-"+t;if(s){const e=i(s,"input, select, textarea");e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",o),s.classList.add("is-error")}let l=(null==s||null===(r=s.dataset)||void 0===r?void 0:r.errorMessage)||e.data.fields[t];console.error("["+t+"]",l),n.push('<div id="'+o+'" role="alert">'+l+"</div>")}))),C.classList.remove("is-success"),C.classList.add("is-error"),u.innerHTML=n.join(""),X("error",{...e.data,formdata:o})})).finally((()=>{z("show"),w.classList.remove("loading"),w.removeAttribute("disabled"),c.removeAttribute("disabled"),C.setAttribute("aria-hidden","false")}))}function K(){return!!S.isPreview||!Q("conversion")&&!B("closed",x)}function B(e,t){return!(Q(e,0)<+new Date-1e3*t)}function G(r){T&&!T.classList.contains("active")&&(n(I),n(j),t(l,d,q),t(o,u,N),t(o,f,N),t(o,m,J),t(o,p,J),t(o,h,J),t(o,p,J),t(o,u,J),t(o,f,J),e(l,b,V),e(l,v,$),a((()=>e(T,c,U)),1500),O.forEach((t=>e(t,c,U))),e(w,c,y),T.classList.add("active"),C.classList.remove("is-success"),w.classList.remove("completed"),T.setAttribute("aria-hidden","false"),T.focus(),g.classList.add("mailster-form-active"),r&&r.type===c&&(r.preventDefault(),P.focus()),X("open"),W())}function R(){t(l,b,V),t(l,v,$),t(T,c,R),t(T,c,U),O.forEach((e=>t(e,c,U))),t(w,c,y),T.classList.add("closing"),g.classList.remove("mailster-form-active"),X("close"),a((()=>{T.classList.remove("closing"),T.classList.remove("active"),T.setAttribute("aria-hidden","true")}),500)}function U(e){e&&e.preventDefault(),R(),z("closed")}function V(e){"Escape"!==e.key&&27!=e.keyCode||U()}function $(e){"Tab"!==e.key&&9!==e.keyCode||(P===e.target&&e.shiftKey&&(D.focus(),e.preventDefault()),D!==e.target||e.shiftKey||(P.focus(),e.preventDefault())),"Enter"!==e.key&&13!=e.keyCode||(F(e),e.preventDefault())}function z(e,t){return H?E(S.identifier,e,t||+new Date):null}function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!H)return null;let r=E(S.identifier,e);return r||t}function W(){if(S.isPreview||!H)return!1;B("impression",3600)||r()({path:"mailster/v1/forms/"+S.id+"/impression",method:"POST",data:S}).catch((e=>{e.message&&console.error(e.message)})).finally((()=>{X("impression"),z("impression")}))}function X(e,t){const r={type:e,el:w,form:S,data:t},s=new CustomEvent("mailster:"+e,{bubbles:!0,detail:r});return r.event=s,A[S.id]&&A[S.id][e]&&A[S.id][e].apply(r),w.dispatchEvent(s)}if(S){if(S.triggers)S.triggers.forEach((e=>{M[e]&&M[e].call(this)})),T.classList.add(function(e){let t=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)$/);return(299*t[1]+587*t[2]+114*t[3])/1e3>=128?"is-light-bg":"is-dark-bg"}(o.getComputedStyle(T,"").getPropertyValue("background-color")));else{const e=new IntersectionObserver((t=>{t[0].isIntersecting&&(W(),e.unobserve(t[0].target))}),{threshold:1});e.observe(w),X("load")}H||(w.classList.add("loading","silent"),w.setAttribute("disabled",!0),r()({path:"mailster/v1/forms/"+S.id+"/data",method:"GET"}).then((e=>{for(const t in e.data){const r=i(w,'[name="'+t+'"]'),o=e.data[t];if(r&&o)switch(r.type){case"checkbox":r.checked=!!o;break;case"radio":const e=s(w,'[name="'+t+'"]');for(let t=0;t<e.length;t++)e[t].checked=e[t].value==o;break;default:r.value=o}}if(e.lists){const t=s(w,'[name="_lists[]"]');for(let r=0;r<t.length;r++)t[r].checked=e.lists.includes(t[r].value)}})).catch((e=>{})).finally((()=>{w.classList.remove("loading","silent"),w.removeAttribute("disabled"),C.setAttribute("aria-hidden","false")})))}e(w,"submit",F)}))}function y(e){e.stopPropagation()}function k(){return scroll.el=scroll.el||html,scroll.body=scroll.body||l.body,(scroll.el.scrollTop||scroll.body.scrollTop)/((scroll.el.scrollHeight||scroll.body.scrollHeight)-scroll.el.clientHeight)}function L(e,t,r){let s;return()=>{let i=this,o=arguments,l=r&&!s;n(s),s=a((()=>{s=null,r||e.apply(i,o)}),t),l&&e.apply(i,o)}}function w(e,t,r){const s="mailster-form-"+e;if(void 0===r){const e=JSON.parse(o.localStorage.getItem(s));return t?e&&e[t]?e[t]:null:e}{const i=w(e)||{};i[t]=r,o.localStorage.setItem(s,JSON.stringify(i))}}function A(e,t,r){const s="mailster_form_"+e,i=o[s]||{};if(void 0===r)return t?i[t]:i;i[t]=r,o[s]=i}function E(e,t,r){try{const e="__test__";o.localStorage.setItem(e,e),o.localStorage.removeItem(e),E=w}catch(e){E=A}return E(e,t,r)}"complete"===l.readyState?g():e(o,"DOMContentLoaded",g)}()}();