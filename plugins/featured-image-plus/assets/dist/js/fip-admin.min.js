var FIP=FIP||{};FIP.ajaxUrl=fip.ajax_url,FIP.pluginUrl=fip.plugin_url,FIP.ajaxNonce=fip.ajax_nonce,FIP.bulkPostIds=[],FIP.selectBulkImages=function(e){for(var t of e){var i;"attributes"!==t.type&&(t=jQuery("#bulk-titles-list li"),i=new Array,jQuery.each(t,function(e,t){i.push(jQuery(t).find("button").prop("id").replace("_",""))}),FIP.bulkPostIds=i)}},FIP.selectBulkImagesObserverMutation=function(){var e;jQuery("#bulk-titles").length&&(e=jQuery("#bulk-titles")[0],new MutationObserver(FIP.selectBulkImages).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0}))},FIP.addFeaturedImage=function(){var t="",t=window.inlineEditPost.edit;window.inlineEditPost.edit=function(e){t.apply(this,arguments),FIP.inlineEdit(this,e)}},FIP.inlineEdit=function(e,t){var i,a=0;0<(a="object"==typeof t?parseInt(e.getId(t)):a)&&(e=jQuery("#post-"+a),t=jQuery("#edit-"+a),i=jQuery(".fip-thumb",e).prop("src"),FIP.attachFeaturedImage(t),jQuery('div[id^="__wp-uploader-id"]').remove(),jQuery("#fip-preview",t).prop("src",i),jQuery('input[name="_thumbnail_id"]',t).val(jQuery('input[name="fip-url"]',e).val()),jQuery('input[name="fip-url"]',t).val(i),jQuery('button[name="fip-button-remove"]',t).show().val(a),void 0===i)&&jQuery('button[name="fip-button-remove"]',t).hide()},FIP.attachBulkImage=function(e){e.preventDefault();var t,e=jQuery(e.target).closest("fieldset"),i=e.find("img#fip-preview"),a=e.find('input[name="fip-url"]'),u=e.find('input[name="_thumbnail_id"]'),n=e.find('button[name="fip-button-remove"]');jQuery('div[id^="__wp-uploader-id"]').remove(),(t=wp.media.frames.meta_image_frame=wp.media({title:a.title,button:{text:a.button}})).on("select",function(){var e=t.state().get("selection").first().toJSON();a.val(e.url),u.val(e.id),n.val(e.id),i.prop("src",e.url),i.show(),a.show()}),t.open()},FIP.ajaxRequest=function(e,t,i,a){jQuery.ajax({method:"post",url:FIP.ajaxUrl,data:jQuery.extend({action:e,security:FIP.ajaxNonce},i),beforeSend:()=>FIP.beforeSendCallback(t),success:e=>a(JSON.parse(e)[0]),complete:()=>FIP.completeCallback(t),error:()=>FIP.errorCallback(t)})},FIP.resetSettings=function(e){e.preventDefault();var t=jQuery(e.target).closest(".fip-admin");window.confirm("Are you sure you want to RESET ALL the options to their defaults?")&&FIP.ajaxRequest("fip_reset_options_default",t,"",function(e){e&&!1===e.success||(FIP.outputCallback(t,e.status,e.message),jQuery("html, body").animate({scrollTop:0},"fast"),setTimeout(()=>document.location.reload(!0),1e3))})},FIP.attachFeaturedImage=function(r){jQuery(document).on("click",'button[name="fip-button-upload-image"]',function(e){e.preventDefault();var t,i=r.prop("id").replace("edit-",""),a=r.find("img#fip-preview"),u=r.find('input[name="fip-url"]'),n=r.find('input[name="_thumbnail_id"]'),o=r.find('button[name="fip-button-remove"]');jQuery('div[id^="__wp-uploader-id"]').remove(),(t=wp.media.frames.meta_image_frame=wp.media({title:u.title,button:{text:u.button}})).on("open",function(){var e=jQuery("<div/>").addClass("fip-admin");e.html('<div class="fip-loading-bar"></div>'),t.$el.append(e)}),t.on("select",function(){var e=t.state().get("selection").first().toJSON(),e=(u.val(e.url),n.val(e.id),o.val(e.id),a.prop("src",e.url),a.show(),u.show(),{id:i,thumb_id:e.id});FIP.ajaxRequest("fip_add_single_featured_image",t.$el,e,function(e){e&&!1===e.success||setTimeout(()=>document.location.reload(!0),1e3)})}),t.open()})},FIP.removeFeaturedImage=function(e){e.preventDefault();var t=jQuery(e.target),e=t.val(),i=jQuery("#edit-"+e),a=t.closest(".fip-admin"),e={id:e};window.confirm("Are you sure you want to REMOVE the featured image?")&&FIP.ajaxRequest("fip_remove_single_featured_image",a,e,function(e){i.find('input[name="fip-id"]').val(""),i.find('input[name="fip-thumb"]').val(""),i.find("#fip-preview").prop("src",""),t.hide(),jQuery('div[id^="__wp-uploader-id"]').remove(),i.find(".button.button-primary.save").trigger("click"),setTimeout(()=>document.location.reload(!0),400)})},FIP.removeBulkImages=function(e){e.preventDefault();var t=jQuery(e.target),e=t.closest(".fip-admin"),i={post_ids:FIP.bulkPostIds};window.confirm("Are you sure you want to REMOVE ALL featured images?")&&FIP.ajaxRequest("fip_remove_all_featured_images",e,i,function(e){e&&!1===e.success||(t.hide(),jQuery('div[id^="__wp-uploader-id"]').remove(),setTimeout(()=>jQuery('input[type="submit"]#bulk_edit').trigger("click"),1e3))})},FIP.beforeSendCallback=function(e){e.find(".fip-loading-bar").show()},FIP.completeCallback=function(e){e.find(".fip-loading-bar").hide()},FIP.errorCallback=function(e){e=e.find(".fip-output").empty();e.addClass("fip-output-active fip-output-active-error"),e.html("Internal Server Error! Contact your hosting provider and access your logs to learn more about what is causing the error.")},FIP.outputCallback=function(e,t,i){e=e.find(".fip-output").empty();e.removeClass("fip-output-active-success fip-output-active-error").addClass("fip-output-active-"+(1===t?"success":"error")),e.addClass("fip-output-active").show().html(i)},function(e){FIP.selectBulkImagesObserverMutation(),void 0!==window.inlineEditPost&&(window.inlineEditPost,1)&&FIP.addFeaturedImage(),e(document).on("click",'button[name="fip-button-remove"]',FIP.removeFeaturedImage),e(document).on("click",'button[name="fip-button-upload-bulk-image"]',FIP.attachBulkImage),e(document).on("click",'button[name="fip-button-remove-bulk"]',FIP.removeBulkImages),e(document).on("click",'button[name="fip-reset-button"]',FIP.resetSettings)}(jQuery);