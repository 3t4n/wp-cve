"use strict";!function(f){var h=null,v=null,P=null,a=null,e=null,g=[],c={autoClose:!0,sourceUrl:"api/getInpostMachines.xml",type:"point",title:"Wybierz punkt nadania",country:"PL"},k=null,w=!1,y=0,b=0,l={},u=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},C={red:new L.Icon.Default({iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"",shadowSize:[0,0]})};function d(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(Promise.all([m(h.getCenter().lat,h.getCenter().lng)]).then(function(){null!=k&&f(".pointsList").scrollTo(f(k),1e3)}));case 2:case"end":return t.stop()}})}function m(n,i){return new Promise(function(e,t){var o=u({lat:n,lon:i,map:!0},l.additionalData);null!=a&&a.abort(),w=!0,y=(new Date).getTime(),a=f.post(epaka_object.api_endpoint+"/map?endpoint="+c.sourceUrl,o,function(o){var n;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=null,void 0===(n=JSON.parse(o))){t.next=7;break}if(jQuery.isEmptyObject(n)){t.next=7;break}if("OK"==n.status)return t.next=7,regeneratorRuntime.awrap(Promise.all([function(m){return new Promise(function(t,o){f(".choose-point-searching").css("display","none");var i=null;if(void 0!==(i=Array.isArray(m.points.point)?m.points.point:[m.points.point]))if(y<b)o();else{b=y;var a=[],s=[];g.forEach(function(t,o){for(var n=!1,e=0;e<i.length;e++)if(t.fullPointData.id==i[e].id){s.push(t),n=!0;break}n||a.push(t)}),a.forEach(function(t){f("#mapPopup #point-details-"+t.fullPointData.id).remove(),void 0!==t.fullPointData.source&&f("#mapPopup  #point-details-"+t.fullPointData.id+"---"+t.fullPointData.source.id).remove(),v.removeLayer(t)}),g=[].concat(s);for(var n=0;n<i.length;n++){var e=i[n];if(void 0!==e){for(var p,r,c,l,u=!0,d=0;d<s.length;d++)if(e.id==s[d].fullPointData.id){u=!1;break}u&&(p=C.red,void 0!==e.source&&void 0!==e.source.marker&&(p=C[e.source.marker]),r=L.marker({lat:e.lat,lng:e.lng},{title:e.name,icon:p}),g.push(r),void 0!==e.source?r.customPointId=e.id+"---"+e.source.id:r.customPointId=e.id,r.fullPointData=e,v.addLayer(r),c="<div id='point-details-"+r.customPointId+"' class='row choose-point-details py-2 font-size-14px cursor-pointer mx-0 px-0'><div class='col-3 d-flex flex-column align-items-center justify-content-center px-3'><img class='img-fluid' src=''/></div><div class='col-9 d-flex flex-column'><div class='point-details-content'>"+(e.street||e.post_code||e.other||!e.description?"<div class='font-weight-bold'>"+e.name+"</div>":"<div class='font-weight-bold'>"+e.description+"</div>")+(e.street?"<div>"+e.street+" "+e.number+("string"==typeof e.local_number?"/"+e.local_number+" ":" ")+"</div>":"")+(e.post_code?"<div>"+e.post_code+" "+e.city+"</div>":"")+"</div>"+(void 0!==e.other&&"function"==typeof e.other.replace?"<div class='font-size-12px font-size-md-14px font-weight-semibold mt-3'>"+e.other.replace(/;/g,"<br />")+"</div>":"")+"</div><div style='display: none;' class='listDbClickButton pointButton'><span style='text-align: center;'>Wybierz punkt</span></div></div>",f("#mapPopup .pointsList").append(c),r.bindPopup("<div style='width: 63px;'><img class='img-fluid' src=''/></div><div class='mt-3' style='width: 100%;'><span class='font-size-13px font-weight-bold text-center'>"+e.name+"</span><div class='font-size-13px font-weight-regular'>"+(e.street||e.post_code||e.other?"":"<div>"+(e.description?e.description:e.name?e.name:"")+"</div>")+(e.street?"<div>"+e.street+" "+e.number+("string"==typeof e.local_number?"/"+e.local_number+" ":" ")+"</div>":"")+(e.post_code?"<div>"+e.post_code+" "+e.city+"</div>":"")+(void 0!==e.other&&"function"==typeof e.other.replace?"<div>"+e.other.replace(/;/g,"<br />")+"</div>":"")+"</div><div id='choosePoint' class='pointButton' style='margin-left: auto;margin-right: auto;' data-id='"+r.customPointId+"'><span style='text-align: center;'>Wybierz punkt</span></div></div>",{className:void 0!==e.source?e.id+"---"+e.source.id:e.id}),l=!1,r.on("click",function(){var t=f("#point-details-"+this.customPointId);t.hasClass("active")&&l?(f(".accept-point").click(),l=!1):(window.dontZoomOnPointClick=1,t.click(),f(document).off("click","#choosePoint"),f(document).on("click","#choosePoint",function(){f("#mapPopup .pointsList #point-details-"+f(this).attr("data-id")+" .listDbClickButton").click()}),this.openPopup(),setTimeout(function(){setTimeout(function(){l=!1},500),l=!0},50))}),f("#mapPopup .pointsList .choose-point-details").click(function(){f("#mapPopup .pointsList .choose-point-details").removeClass("active"),f("#mapPopup .pointsList .choose-point-details .listDbClickButton").css("display","none");var t,o=f(this).attr("id").split("point-details-")[1];void 0===window.dontZoomOnPointClick&&((t=g.filter(function(t){return t.customPointId==o}))[0].openPopup(),h.setView(t[0]._latlng,20),k=f(this)),window.dontZoomOnPointClick=void 0,f(this).addClass("active"),f(this).find(".listDbClickButton").css("display","inline-block")}),f("#mapPopup .pointsList .listDbClickButton").off("click"),f("#mapPopup .pointsList .listDbClickButton").click(function(){var o=f(this).parent().attr("id").split("point-details-")[1],t=g.filter(function(t){return t.customPointId==o});f(f(P).siblings()[0]).val(t[0].fullPointData.id),f(P).val(t[0].fullPointData.name),f("#epaka_paczkomat").val(t[0].fullPointData.id),f("#epaka_paczkomat_opis").val(t[0].fullPointData.name),f(P).change(),f(".popupCloseButton").click()}))}}w=!1,x(h,g),t()}else o()})}(n)]));t.next=7;break;case 7:e();case 8:case"end":return t.stop()}})},"text")})}function x(t,o){if(o.length){var n=t.getBounds(),e=0;for(var i in o)n.contains(o[i].getLatLng())?(f("#point-details-"+o[i].customPointId).show(),e++):f("#point-details-"+o[i].customPointId).hide();s(!e&&w?"searching":e?"":"empty")}}function s(t){f("#mapPopup .pointsList .choose-point-info").show(),f("#mapPopup .pointsList .choose-point-info").hide(),f("#mapPopup .pointsList .choose-point-"+t).show()}function i(t){var i=0<arguments.length&&void 0!==t?t:17;return function(t){t=JSON.parse(t);var o,n=Array.isArray(t),e=!!n&&0===t.length;t&&!e?(n&&(t=t[0]),o={lat:parseFloat(t.lat),lng:parseFloat(t.lon)},h.setView(o,i),setTimeout(function(){x(h,g)},50)):(x(h,g),s("notfound"))}}window.ShowMap=function(a,s,p,r){return new Promise(function(o,n){var e,i;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return f("#mapPopup #search-input").val(""),P=null,P=a.target,l=u({},c=s,l),e=["49.0020468","55.0336963","14.1229707","24.145783"],i=10,i=void 0!==p&&void 0!==r?12:6,void 0===p&&(p=52.209402),void 0===r&&(r=19.302979),h?(g.forEach(function(t){f("#mapPopup #point-details-"+t.fullPointData.id).remove(),void 0!==t.fullPointData.source&&f("#mapPopup  #point-details-"+t.fullPointData.id+"---"+t.fullPointData.source.id).remove(),v.removeLayer(t)}),h.setView(new L.LatLng(p,r),i,{animation:!1}),h.fire("moveend")):(h=L.map("placeMapHere",{center:[p,r],zoom:i,maxBounds:[[e[0],e[2]],[e[1],e[3]]]}),L.tileLayer("https://b.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',maxZoom:18}).addTo(h),h.addLayer(v=L.markerClusterGroup({maxClusterRadius:50})),h.on("zoomend",d),h.on("moveend",d)),t.next=13,regeneratorRuntime.awrap(Promise.all([m(p,r)]).then(o).catch(n));case 13:case"end":return t.stop()}})})},window.mapBind=function(){f(".showMapOnClick").off("click"),f(".showMapOnClick").off("change"),f(".pointClear").off("click"),f(".popupCloseButton").off("click"),f("#search").off("click"),f("#mapPopup .menu-control-button").off("click"),f(".showMapOnClick").click(function(o){var n;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return f("#mapPopup").show(),n={autoClose:!0,sourceUrl:f(this).attr("data-map-source-url"),type:"point",title:"Wybierz punkt odbioru "+f(this).attr("data-map-source-name"),country:"PL"},t.next=4,regeneratorRuntime.awrap(Promise.all([window.ShowMap(o,n)]));case 4:case"end":return t.stop()}},null,this)}),f(".showMapOnClick").each(function(){""!=f(this).val()?f(this).parent().find(".pointClear").show():f(this).parent().find(".pointClear").hide()}),f(".showMapOnClick").change(function(){""!=f(this).val()?f(this).parent().find(".pointClear").show():f(this).parent().find(".pointClear").hide()}),f(".pointClear").click(function(){f(this).parent().find("input").each(function(){f(this).val(""),f(this).change()})}),f(".popupCloseButton").click(function(){g.forEach(function(t){f("#mapPopup #point-details-"+t.fullPointData.id).remove(),void 0!==t.fullPointData.source&&f("#mapPopup  #point-details-"+t.fullPointData.id+"---"+t.fullPointData.source.id).remove(),v.removeLayer(t)}),g=[],f("#mapPopup").hide()}),f("#search").click(function(){var t,o,n;n=/([0-9]{2}-[0-9]{3})|([0-9]{5})/,e!=f("#search-input").val()&&(e=f("#search-input").val(),f(".choose-point-details").css("display","none"),f(".choose-point-searching").css("display","inline-block"),""==e?(f(".choose-point-details").css("display","inline-block"),f(".choose-point-searching").css("display","none"),h.setView({lat:52.209402,lng:19.302979},5)):/(\P\O\P\-)?[a-zA-Z]{3}[0-9]{1,3}[a-zA-Z]{0,2}/.test(e)?f.post(epaka_object.api_endpoint+"/map?endpoint="+encodeURIComponent("map_popup/searchInpost"),{q:e},i(),"json"):/[a-zA-Z0-9]{2}-[0-9]{6}-[0-9]{2}-[0-9]{2}/.test(e)?f.post(epaka_object.api_endpoint+"/map?endpoint="+encodeURIComponent("map_popup/searchPWR"),{q:e},i(),"json"):/[a-zA-Z]{2}[0-9]{5,6}/.test(e)?f.post(epaka_object.api_endpoint+"/map?endpoint="+encodeURIComponent("map_popup/searchDPD"),{q:e},i(),"json"):/[0-9]{6,8}/.test(e)?f.post(epaka_object.api_endpoint+"/map?endpoint="+encodeURIComponent("map_popup/searchDHLSP"),{q:e},i(),"json"):/(UP|PP|DER|FUP)\W[a-zA-ZęĘóÓąĄśŚłŁżŻźŹćĆńŃ]{3,}/.test(e)?f.post(epaka_object.api_endpoint+"/map?endpoint="+encodeURIComponent("map_popup/searchPP"),{q:e},i(),"json"):(t={limit:"1",countrycodes:l.country,format:"json",addressdetails:"1"},n.test(e)?t.postalcode=n.exec(e)[0]:(t.q=e,t.limit=10),o=encodeURIComponent("map.php?"+f.param(t)),f.ajax({type:"GET",dataType:"json",url:epaka_object.api_endpoint+"/map?endpoint=mapSearch&payload="+o,success:i(14)})))}),f("#mapPopup .menu-control-button").click(function(){return f("#mapPopup .menu").is(":visible")?f("#mapPopup .menu").hide():f("#mapPopup .menu").show(),!1}),f("#mapPopup .localise-me").click(function(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){var o={lat:t.coords.latitude,lng:t.coords.longitude};h.setView(o,11)}):alert("Lokalizacja nie jest wspierana przez twoją przeglądarkę.")})},f(window).load(function(){window.mapBind()})}(jQuery);