(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cfa18"],{6514:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"wbs-content"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isLoaded,expression:"!isLoaded"}],staticClass:"wbs-content-inner",class:{"wb-page-loaded":t.isLoaded}},[e("div",{staticClass:"wbs-main"},[t.isLoaded?e("table",{staticClass:"wbs-form-table"},[e("tr",[e("th",{staticClass:"row w8em"},[t._v(" 保留周期 "),e("wbs-tooltip",{attrs:{"data-msg":t.tooltips.log_keep}})],1),e("td",{staticClass:"info"},[e("el-radio-group",{model:{value:t.opt.log_keep,callback:function(a){t.$set(t.opt,"log_keep",a)},expression:"opt.log_keep"}},t._l(t.log_keep,(function(a,s){return e("el-radio",{key:s,attrs:{label:s}},[t._v(" "+t._s(a)+" ")])})),1)],1)]),e("tr",[e("th",{staticClass:"row"},[t._v(" 日志记录 "),e("wbs-tooltip",{attrs:{"data-msg":t.tooltips.log_info}})],1),e("td",{staticClass:"info"},[t._v(" 当前日志共"+t._s(t.logStat.num)+"行"),t.logStat.updated?e("span",[t._v("（"+t._s(t.logStat.updated)+" 更新）")]):t._e()])]),e("tr",[e("th",{staticClass:"row"},[t._v(" 更新方式 "),e("wbs-tooltip",{attrs:{"data-msg":t.tooltips.update_info}})],1),e("td",{staticClass:"info"},[e("el-radio-group",{model:{value:t.opt.log_update,callback:function(a){t.$set(t.opt,"log_update",a)},expression:"opt.log_update"}},t._l({db:"即时更新",hour:"每小时更新（推荐）",day:"每天更新"},(function(a,s){return e("el-radio",{key:s,attrs:{label:s}},[t._v(" "+t._s(a)+" ")])})),1)],1)]),e("tr",[e("th",{staticClass:"row"},[t._v(" 备份与删除 "),e("wbs-tooltip",{attrs:{"data-msg":t.tooltips.del_backup}})],1),e("td",{staticClass:"info"},[e("label",[e("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(a){return t.down_log()}}},[t._v("日志备份")])],1),e("label",{staticClass:"ml"},[e("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.del_spider_log()}}},[t._v("日志删除")])],1)])]),e("tr",[e("th",{staticClass:"row"},[t._v(" 自定义蜘蛛 "),e("wbs-tooltip",{staticClass:"on-top",attrs:{"data-msg":t.tooltips.custom_spider}})],1),e("td",[e("wbs-custom-spider",{attrs:{items:t.opt.user_define,mode:1,placeholder:"蜘蛛名称"},on:{"set-tags":function(a){t.opt.user_define=a}}})],1)])]):t._e(),e("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],staticClass:"mt"})],1),t.$cnf.is_pro?t._e():e("wbs-more-sources")],1),e("wbs-ctrl-bar",{on:{submit:t.update_data}})],1)},o=[],i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{class:t.mode?"wb-tags-mode-b":"wb-tags-ctrl"},[t.mode?e("div",{staticClass:"wb-tags-input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.cur_input,expression:"cur_input"}],staticClass:"wbs-input wbs-input-short",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.cur_input},on:{keyup:t.wbTagInput,input:function(a){a.target.composing||(t.cur_input=a.target.value)}}}),e("a",{staticClass:"ml link",on:{click:t.wbTagPush}},[t._v("添加 +")])]):e("input",{directives:[{name:"model",rawName:"v-model",value:t.cur_input,expression:"cur_input"}],staticClass:"wb-tag-input",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.cur_input},on:{keyup:t.wbTagInput,input:function(a){a.target.composing||(t.cur_input=a.target.value)}}}),t.items.length?e("div",{staticClass:"tag-items"},t._l(t.items,(function(a,s){return e("div",{key:s,staticClass:"tag-item"},[e("span",{staticClass:"vam ib",domProps:{innerHTML:t._s(t.displayFormat(a))}}),e("a",{staticClass:"del",attrs:{"data-del-val":a},on:{click:function(a){return t.delItem(s)}}})])})),0):t._e()])},n=[],l={name:"wbsCustomSpider",props:{items:Array,mode:Number,placeholder:String},data(){return{cur_input:"",taglist:[],keycode:null}},template:"#wbs_tpl_custom_spider",created(){this.taglist=this.items?this.items:[]},methods:{wbTagInput(t){var a=this,e=t.keyCode;188===e&&(a.cur_input=a.cur_input.replace(/(^,)|(,$)/,"")),13===e&&(a.wbTagPush(),event.stopPropagation())},wbTagPush(t){var a=this;return""!=a.cur_input&&(a.taglist.indexOf(a.cur_input.trim())>-1?(a.$wbui.toast("已存在"),a.cur_input="",!1):(a.taglist.push(a.cur_input),a.$emit("set-tags",a.taglist),a.cur_input="",!1))},delItem(t){var a=this;a.$wbui.confirm("确认删除？",()=>{a.taglist.splice(t,1),a.$emit("set-tags",a.taglist),a.$wbui.toast("已移除")})},displayFormat(t){return t}}},r=l,p=e("2877"),d=Object(p["a"])(r,i,n,!1,null,null,null),u=d.exports,c={name:"SettingLog",components:{"wbs-custom-spider":u},data(){const t=this;return{formChanged:0,isLoaded:!1,is_pro:t.$cnf.is_pro,opt:{user_define:[],log_keep:"",log_update:"day"},logStat:{num:0,updated:""},log_keep:{1:"近7天",2:"近30天（推荐）",3:"近3个月",6:"近6个月",12:"近1年",120:"永久"},tooltips:{del_backup:"如历史日志体积过大，可以考虑备份与删除日志。",log_keep:"如蜘蛛日志过大导致数据库访问性能下降，建议选择保留周期为最近30天。",custom_spider:"可添加插件未记录的蜘蛛日志，请准确填写蜘蛛名称。",log_info:"站长可以根据日志记录行数判断蜘蛛日志是否太大，以作出日志备份或者删除操作，降低数据库压力。",update_info:"站长可以根据网站的蜘蛛爬取压力，选择蜘蛛日志更新方式，推荐使用默认选项-每小时更新。"}}},created(){this.loadData()},methods:{down_log(){const t=this;window.open(ajaxurl+"?action="+t.$cnf.action.act+"&op=down_log","down_log")},del_spider_log(){const t=this;t.$wbui.confirm("删除日志操作，将会永久性删除所有蜘蛛历史数据。请谨慎操作！",()=>{t.$api.saveData({_ajax_nonce:_wb_spider_analyser_ajax_nonce,action:t.$cnf.action.act,op:"clean_log"}).then(a=>{t.$wbui.toast("删除成功",()=>{location.reload()})})})},loadData(){const t=this;t.$api.getData({action:t.$cnf.action.act,tab:"log",op:"get_setting"}).then(a=>{t.opt.user_define=a["data"]["user_define"],t.opt.log_keep=a["data"]["log_keep"],t.opt.log_update=a["data"]["log_update"],t.logStat=a["data"]["logStat"],t.isLoaded=!0})},update_data(t){const a=this,e={_ajax_nonce:_wb_spider_analyser_ajax_nonce,action:a.$cnf.action.act,op:"update_setting",tab:"log",opt:a.opt};a.$api.saveData(e).then(e=>{a.$wbui.toast("设置保存成功"),a.formChanged=1,t&&t()})}},watch:{opt:{handler(){this.formChanged++},deep:!0}},beforeRouteLeave(t,a,e){const s=this;s.formChanged>1?s.$wbui.open({content:"您修改的设置尚未保存，确定离开此页面吗？",btn:["保存并离开","放弃修改"],yes(){return e(!1),s.update_data(()=>{e()}),!1},no(){return e(),!1}}):e()}},_=c,g=Object(p["a"])(_,s,o,!1,null,null,null);a["default"]=g.exports}}]);