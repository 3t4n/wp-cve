(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c699"],{f2b9:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wbs-content"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isLoaded,expression:"!isLoaded"}],staticClass:"wbs-content-inner",class:{"wb-page-loaded":t.isLoaded}},[a("div",{staticClass:"wbs-main"},[a("div",{staticClass:"table-wp table-wp-m"},[t.isLoaded?a("table",{staticClass:"wbs-table table-border table-rule-type"},[t._m(0),a("tbody",[t._l(t.spider.url_type,(function(e,s){return a("tr",[a("td",[t._v(t._s(e))]),a("td",[t.url_type_editing==s?a("wbs-tags-module",{attrs:{tags:t.opt.extral_rule[s],placeholder:"输入规则，按回车确认"},on:{"set-tags":function(e){t.opt.extral_rule[s]=e}}}):a("div",{staticClass:"display-rule"},[a("span",{staticClass:"wb-status-tag rule"},[t._v("默认WP规则")]),t._l(t.opt.extral_rule[s].split(","),(function(e){return t.opt.extral_rule[s]?a("span",{staticClass:"wb-status-tag rule"},[t._v(t._s(e))]):t._e()}))],2)],1),a("td",{staticClass:"align-center"},[t.url_type_editing!=s?a("a",{staticClass:"link",attrs:{title:"编辑"},on:{click:function(e){t.url_type_editing=s}}},[a("svg",{staticClass:"wb-icon sico-edit"},[a("use",{attrs:{"xlink:href":"#sico-edit"}})])]):t._e(),t.url_type_editing==s?a("a",{staticClass:"link",on:{click:function(e){t.url_type_editing=-1}}},[t._v("完成编辑")]):t._e()])])})),t._l(t.opt.user_rule,(function(e,s){return a("tr",{class:{"cur-editing":t.url_type_editing==s}},[a("td",[t.url_type_editing==s?a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"v.name"}],staticClass:"wbs-input",attrs:{placeholder:"输入url类型"},domProps:{value:e.name},on:{input:function(a){a.target.composing||t.$set(e,"name",a.target.value)}}}):a("span",{staticClass:"display-value"},[t._v(t._s(e.name))])]),a("td",[t.url_type_editing==s?a("wbs-tags-module",{attrs:{tags:e.rule,placeholder:"输入规则，按回车确认"},on:{"set-tags":function(t){e.rule=t}}}):a("div",{staticClass:"display-rule"},t._l(e.rule.split(","),(function(s){return e.rule?a("span",{staticClass:"wb-status-tag rule"},[t._v(t._s(s))]):t._e()})),0)],1),a("td",{staticClass:"align-center"},[t.url_type_editing!=s?a("a",{staticClass:"link",attrs:{title:"编辑"},on:{click:function(e){t.url_type_editing=s}}},[a("svg",{staticClass:"wb-icon sico-edit"},[a("use",{attrs:{"xlink:href":"#sico-edit"}})])]):t._e(),t.url_type_editing==s?a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.saveRuleItem(e)}}},[t._v("完成")]),a("a",{staticClass:"button-link-delete ml",attrs:{title:"取消"},on:{click:function(e){return t.removeRule(s)}}},[t._v("取消")])],1):t._e(),t.url_type_editing!=s?a("a",{staticClass:"button-link-delete",attrs:{title:"删除"},on:{click:function(e){return t.removeRule(s)}}},[a("svg",{staticClass:"wb-icon sico-del"},[a("use",{attrs:{"xlink:href":"#sico-del"}})])]):t._e()])])}))],2),a("tfoot",[a("tr",[a("td"),a("td"),a("td",[a("el-button",{attrs:{plain:"",type:"primary",size:"mini",icon:"el-icon-circle-plus"},on:{click:t.addRule}},[t._v("添加定义")])],1)])])]):t._e()]),a("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:t.isLoaded,expression:"isLoaded"}],staticClass:"mt"})],1),t.$cnf.is_pro?t._e():a("wbs-more-sources")],1),a("wbs-ctrl-bar",{on:{submit:t.update_data}})],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",{staticClass:"w30"},[t._v("类型")]),a("th",[t._v("规则")]),a("th",{staticClass:"w8em align-center"},[t._v("操作")])])])}],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{staticClass:"wb-tags-ctrl"},[a("div",{staticClass:"tag-items"},t._l(t.taglist,(function(e,s){return t.taglist.length?a("div",{staticClass:"tag-item"},[a("span",{staticClass:"vam ib",domProps:{innerHTML:t._s(t.displayFormat(e))}}),a("a",{staticClass:"del",attrs:{"data-del-val":e},on:{click:function(e){return t.delItem(s)}}})]):t._e()})),0),a("input",{directives:[{name:"model",rawName:"v-model",value:t.cur_input,expression:"cur_input"}],staticClass:"wb-tag-input",attrs:{type:"text",placeholder:"输入选项值, 回车确认 *"},domProps:{value:t.cur_input},on:{keyup:t.wbTagInput,input:function(e){e.target.composing||(t.cur_input=e.target.value)}}})])},n=[],r={name:"wbsTags",props:{tags:String,format:String},data(){return{cur_input:"",taglist:[],keycode:null}},created(){this.taglist=this.tags?this.tags.split(","):[]},methods:{wbTagInput(t){var e=this,a=t.keyCode;13===a&&e.wbTagPush()},wbTagPush(t){var e=this;return""!=e.cur_input&&(e.taglist.indexOf(e.cur_input.trim())>-1?(e.$wbui.toast("已存在"),e.cur_input="",!1):(e.taglist.push(e.cur_input),e.$emit("set-tags",e.taglist.join(",")),e.cur_input="",!1))},delItem(t){var e=this;e.$wbui.confirm("确认删除该选项？",()=>{e.taglist.splice(t,1),e.$emit("set-tags",e.taglist.join(",")),e.$wbui.toast("已移除")})},displayFormat(t){var e=t.split(":");return e.length>1?e[1]+'<em class="wk">(别名:'+e[0]+")</em>":t}}},u=r,o=a("2877"),c=Object(o["a"])(u,l,n,!1,null,null,null),d=c.exports,p={name:"SettingRule",components:{"wbs-tags-module":d},data(){const t=this;return{formChanged:0,isLoaded:!1,is_pro:t.$cnf.is_pro,spider:{url_type:[]},opt:{user_rule:[],extral_rule:[]},url_type_editing:-1}},created(){this.loadData()},methods:{removeRule(t){var e=this;e.$wbui.confirm("确认删除？",()=>{e.opt.user_rule.splice(t,1),e.$wbui.toast("已移除")})},addRule(){var t=this;t.opt.user_rule.push({name:"",rule:""}),t.url_type_editing=t.opt.user_rule.length-1},saveRuleItem(t){var e=this;return""!=t.name&&""!=t.rule?e.url_type_editing=-1:e.$wbui.toast('请填写完整的"类型"及"规则"'),!1},loadData(){const t=this;t.$api.getData({action:t.$cnf.action.act,op:"get_setting",tab:"rule"}).then(e=>{t.spider.url_type=e["data"]["url_type"],t.opt=e["data"]["opt"],t.isLoaded=!0})},update_data(t){const e=this,a={_ajax_nonce:_wb_spider_analyser_ajax_nonce,action:e.$cnf.action.act,op:"update_setting",tab:"rule",rule:e.spider.url_type,user_rule:e.opt.user_rule,extral_rule:e.opt.extral_rule};e.$api.saveData(a).then(a=>{e.$wbui.toast("设置保存成功"),e.formChanged=1,t&&t()})}},watch:{opt:{handler(){this.formChanged++},deep:!0}},beforeRouteLeave(t,e,a){const s=this;s.formChanged>1?s.$wbui.open({content:"您修改的设置尚未保存，确定离开此页面吗？",btn:["保存并离开","放弃修改"],yes(){return a(!1),s.update_data(()=>{a()}),!1},no(){return a(),!1}}):a()}},_=p,g=Object(o["a"])(_,s,i,!1,null,null,null);e["default"]=g.exports}}]);