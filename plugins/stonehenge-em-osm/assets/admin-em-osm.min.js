function apiSearch(){geoAddress(jQuery("#location-address").val()+", "+jQuery("#location-town").val()+", "+jQuery("#location-postcode").val()+", "+jQuery("#location-state").val())}function geoAddress(e){jQuery.ajax({url:"https://api.opencagedata.com/geocode/v1/json",method:"GET",data:{key:OSM.apiKey,q:e,no_annotations:1,add_request:1,pretty:1,language:OSM.locale},dataType:"json",statusCode:{200:function(e){var t=e.results[0];console.log(t);var o=t.formatted,a=t.components;if(a.city&&jQuery("#location-town").val(a.city),a.town&&jQuery("#location-town").val(a.town),a.village&&jQuery("#location-town").val(a.village),a.state&&jQuery("#location-state").val(a.state),a.county&&jQuery("#location-region").val(a.county),a.postcode&&jQuery("#location-postcode").val(a.postcode),a.country_code){var n=a.country_code.toUpperCase();jQuery("#location-country").val(n)}var i=t.geometry.lat,l=t.geometry.lng,r=new L.LatLng(i,l);jQuery("#location-latitude").val(i),jQuery("#location-longitude").val(l),marker.setLatLng(r).bindPopup(o).openPopup(),map.setView(r,zoomLevel),marker.dragging.enable(),marker.on("dragend",function(e){jQuery("#location-latitude").val(marker.getLatLng().lat),jQuery("#location-longitude").val(marker.getLatLng().lng)})},402:function(){console.log("hit free-trial daily limit"),console.log("become a customer: https://opencagedata.com/pricing")}}})}jQuery.noConflict(),function(e){e(document).ready(function(){e("#osm_per_location_no").length>0&&(e("#osm_per_location_no").is(":checked")?e(".osm-per-admin").hide():e(".osm-per-admin").show()),e('[name="stonehenge_em_osm[per_location]"]').click(function(){e(".osm-per-admin").toggle(500)}),e("#apply_filters .stonehenge-section-content").toggle(),9==e("#location_marker_color option:selected").index()&&e("#location_marker_color").attr("disabled",!0),13==e("#location_map_type option:selected").index()&&e("#location_map_type").attr("disabled",!0),e("#location_marker_color").change(function(){selectedMarker=e("#location_marker_color option:selected").val(),0==selectedMarker.length&&(selectedMarker=OSM.defaultMarker),thisIcon=new LeafIcon({iconUrl:pluginUrl+selectedMarker+".png"}),marker.setLatLng([Lat,Lng]).setIcon(thisIcon).addTo(map).bindPopup(balloon).openPopup()}).trigger("focusout"),e("#location_map_type").change(function(){selectedMapTile=e("#location_map_type option:selected").val(),0==selectedMapTile.length&&(selectedMapTile=OSM.defaultMap),new L.tileLayer(selectedMapTile).addTo(map)}).trigger("focusout"),e("#location-select-id").length>0&&(marker.dragging.disable(),e("#location-select-id").change(function(){var t=e("#location-select-id option:selected").val(),o=e("#location-select-id option:selected").attr("title").split(","),a=o[0],n=o[1],i=e("#location-select-id option:selected").attr("balloon");e("#location-id").val(t),e("#location-latitude").val(a),e("#location-longitude").val(n),getMapTile=e("#location-select-id option:selected").attr("data-maptile"),thisMapTile=getMapTile.length>0?getMapTile:OSM.defaultMap,e("#location-map").val(thisMapTile),thisMarker=e("#location-select-id option:selected").attr("data-marker"),e("#location-marker").val(thisMarker),thisMarker.indexOf("|")>=0?(customMarker=thisMarker.split("|"),thisIcon=L.ExtraMarkers.icon({shape:customMarker[0],markerColor:customMarker[1],icon:customMarker[2],iconColor:customMarker[3],prefix:customMarker[4]})):thisIcon=new LeafIcon({iconUrl:pluginUrl+thisMarker+".png"}),"0"===t?(new L.tileLayer(OSM.defaultMap).addTo(map),marker.setLatLng([0,0]).setIcon(thisIcon).bindPopup(i).openPopup(),map.setView([0,0],1)):(new L.tileLayer(thisMapTile).addTo(map),marker.setLatLng([a,n]).setIcon(thisIcon).addTo(map).bindPopup(i).openPopup(),map.setView([a,n],zoomLevel))}).trigger("change")),e("#no-location").length>0&&(e("#no-location").is(":checked")&&e(".location-form-where").hide(),e("#no-location").click(function(){e(".location-form-where").slideToggle(250),setTimeout(function(){map.invalidateSize()},500)})),e(".location-form-where input#location-name").length>0&&("0"!=e("input#location-id").val()&&""!=e("input#location-id").val()?(e("#osm-location-table input, #osm-location-table select").not(":input[type=button]").attr("disabled",!0),e("#osm-button").hide(),e("#osm-location-reset").show(),marker.dragging.disable()):(new L.tileLayer(OSM.defaultMap).addTo(map),OSM.defaultMarker.indexOf("|")>=0?(customMarker=OSM.defaultMarker.split("|"),thisIcon=L.ExtraMarkers.icon({shape:customMarker[0],markerColor:customMarker[1],icon:customMarker[2],iconColor:customMarker[3],prefix:customMarker[4]})):thisIcon=new LeafIcon({iconUrl:pluginUrl+OSM.defaultMarker+".png"}),marker.setLatLng([0,0]).setIcon(thisIcon).bindPopup(balloon).closePopup(),map.setView([0,0],1),marker.dragging.enable(),marker.on("dragend",function(t){e("#location-latitude").val(marker.getLatLng().lat),e("#location-longitude").val(marker.getLatLng().lng)})),e("#osm-location-reset a").click(function(){return e("#location-id, #location-latitude, #location-longitude, #location-marker, #location-map").val(""),e("#osm-location-table input, #osm-location-table select").not(":input[type=button]").attr("disabled",!1).val(""),e("#osm-button").show(150),e("#osm-location-reset").hide(150),new L.tileLayer(OSM.defaultMap).addTo(map),OSM.defaultMarker.indexOf("|")>=0?(customMarker=OSM.defaultMarker.split("|"),thisIcon=L.ExtraMarkers.icon({shape:customMarker[0],markerColor:customMarker[1],icon:customMarker[2],iconColor:customMarker[3],prefix:customMarker[4]})):thisIcon=new LeafIcon({iconUrl:pluginUrl+OSM.defaultMarker+".png"}),marker.setLatLng([0,0]).setIcon(thisIcon).bindPopup(" ").closePopup(),map.setView([0,0],1),marker.dragging.enable(),marker.on("dragend",function(t){e("#location-latitude").val(marker.getLatLng().lat),e("#location-longitude").val(marker.getLatLng().lng)}),!1}),e(".location-form-where input#location-name").autocomplete({source:OSM.AutoComplete,delay:500,minLength:3,focus:function(t,o){return e("input#location-id").val(o.item.value),!1},select:function(t,o){var a=o.item.id,n=o.item.latitude,i=o.item.longitude,l="<b>"+o.item.value+"</b><br>"+o.item.address+", "+o.item.town;return e("#location-id").val(a),e("#location-latitude").val(n),e("#location-longitude").val(i),e("#location-name").val(o.item.value),e("#location-address").val(o.item.address),e("#location-town").val(o.item.town),e("#location-state").val(o.item.state),e("#location-region").val(o.item.region),e("#location-postcode").val(o.item.postcode),e("#location-country").val(o.item.country),e("#osm-location-table input, #osm-location-table select").not(":input[type=button]").attr("disabled",!0),e("#osm-button").hide(),e("#osm-location-reset").show(),thisMarker=o.item.marker,thisMaptile=o.item.maptype,e("#location-marker").val(thisMarker),e("#location-map").val(thisMaptile),thisMarker==OSM.defaultMarker?e("location_marker_color").val(o.item.marker):thisMarker.indexOf("|")>=0?e("#location_marker_color").append(new Option("Filter Applied",thisMarker)).val(thisMarker):e("#location_marker_color").val(thisMarker),thisMarker.indexOf("|")>=0?(customMarker=thisMarker.split("|"),thisIcon=L.ExtraMarkers.icon({shape:customMarker[0],markerColor:customMarker[1],icon:customMarker[2],iconColor:customMarker[3],prefix:customMarker[4]})):thisIcon=new LeafIcon({iconUrl:pluginUrl+thisMarker+".png"}),marker.setLatLng([n,i]).setIcon(thisIcon).addTo(map).bindPopup(l).openPopup(),o.item.maptype===OSM.defaultMap?e("#location_map_type").val(""):(mapUrl=o.item.maptype,e("#location_map_type").append(new Option("Filter Applied",mapUrl)),e("#location_map_type").val(o.item.maptype)),new L.tileLayer(mapUrl).addTo(map),map.setView([n,i],zoomLevel),marker.dragging.disable(),!1}}).data("ui-autocomplete")._renderItem=function(t,o){return html_val="<a>"+em_esc_attr(o.label)+'<br><span style="font-size:12px"><em>'+em_esc_attr(o.address)+", "+em_esc_attr(o.town)+"</em></span></a>",e("<li></li>").data("item.autocomplete",o).append(html_val).appendTo(t)})})}(jQuery);