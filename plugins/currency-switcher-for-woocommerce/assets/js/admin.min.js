/*! Currency Switcher for WooCommerce - v0.1.0
 * #
 * Copyright (c) 2019; * Licensed GPL-2.0+ */

"use strict";jQuery(document).ready(function(n){void 0===PMCS_Admin_Args.max_currencies?PMCS_Admin_Args.max_currencies=2:PMCS_Admin_Args.max_currencies=parseInt(PMCS_Admin_Args.max_currencies)||2,n(".pmcs-form-currencies .form-table").removeClass("form-table").addClass("pmcs-form-table");var a=function(){var s=n(".pmcs-currencies-list .the-list").attr("data-name")||"";n(".pmcs-currencies-list .tbody .tr").each(function(a){var e=n(this),c=!1;n(".pmcs_default_currency",e).eq(0).is(":checked")&&(c=!0),n(".riname",e).each(function(e){var c=n(this).attr("data-name")||"";if(c){var r=c.replace(/__name__/g,s);r=r.replace(/__i__/g,a),n(this).attr("name",r)}var t=n(this).attr("id")||!1;t||(t="_"+a+e+(new Date).getTime(),n(this).attr("id",t))}),c&&(n(".pmcs-currencies-list .tbody .tr").removeClass("pmcs_default_row"),n(".pmcs-currencies-list .riname.pmcs-rate").removeAttr("disabled"),e.addClass("pmcs_default_row"),n(".riname.pmcs-rate",e).attr("disabled","disabled").val(1))})};function s(){i()?n(".pmcs-limit-currency-msg").show():n(".pmcs-limit-currency-msg").hide()}a();var c,r,i=function(){var e=n(".pmcs-table-lm .the-list tr").length;return PMCS_Admin_Args.max_currencies<=e};if(c=0,n(".pmcs-currencies-list .the-list tr:not(.pmcs_default_row)").each(function(e){c++,e>=PMCS_Admin_Args.max_currencies-1&&n(this).remove()}),c>=PMCS_Admin_Args.max_currencies-1&&s(),n(".pmcs-table-lm").show(),r=0,n(".pmcs-geoip-list .the-list tr:not(.default-currency)").each(function(e){r++,e>=PMCS_Admin_Args.max_currencies-1&&n(this).remove()}),r>=PMCS_Admin_Args.max_currencies-1&&s(),n("pmcs-table-lm").show(),n(document).on("change",".pmcs_default_currency",function(){a()}),n(".pmcs-currencies-list .tbody").sortable({handle:".handle",containment:"parent",update:function(e,c){a()}}),n(".pmcs-add-currency-list").on("click",function(e){if(e.preventDefault(),i())s();else{var c=n(this).parent().find(".the-list"),r=n("#wc_pmcs_currency_row").html(),t=(r=n(r)).find(".td_currency_code");t.find("select").removeClass("select2-hidden-accessible enhanced"),t.find(".select2").remove(),c.append(r),a(),n(document.body).trigger("wc-enhanced-select-init"),s()}}),n(document).on("click",".the-list .remove",function(e){e.preventDefault();n(this).closest(".the-list");var c=n(this).closest(".tr"),r=!1;n(".pmcs_default_currency",c).eq(0).is(":checked")&&(r=!0),r||(c.remove(),a()),s()}),n(document).on("change",".pmcs-currency-select",function(){var e=n(this).val(),c=n(this).closest(".tr"),r="";void 0!==PMCS_List_Currency[e]&&(r=PMCS_List_Currency[e].label),n("input.pmcs_default_currency",c).val(e);var t=c.find(".currency_flag img"),a=(t.attr("data-url")||"")+e.toLowerCase()+".png";t.attr("src",a),n("input.pmcs-currency-display",c).val(r)}),n(".pmcs-currency-sync-all").on("click",function(e){e.preventDefault();var c=n(this);c.addClass("updating-message");var r=n('input[name="pmcs_default_currency"]:checked').val(),t=[];n(".pmcs-currency-select").each(function(){var e=n(this).val();e&&t.push(e)}),n.ajax({url:ajaxurl,type:"get",data:{action:"load_exchange_rates",form_currency:r,to_currency:t.join(","),nonce:PMCS_Admin_Args.nonce},success:function(a){c.removeClass("updating-message"),"object"==typeof a&&"object"==typeof a.rates&&n(".tr select.pmcs-currency-select").each(function(){var e=n(this).val(),c=n(this).closest(".tr"),r=Number(a.rates[e]),t=n("input.num_decimals",c).val();0===t.length&&(t=2),t=Number(t),isNaN(t)&&(t=2),r&&n(".pmcs-rate",c).val(r)})}})}),n(".tr .pmcs-sync-rate").on("click",function(e){e.preventDefault();var t=n(this),a=t.closest(".tr"),s=n("select.pmcs-currency-select",a).val();t.addClass("loading");var c=n('input[name="pmcs_default_currency"]:checked').val(),r=[];n(".pmcs-currency-select").each(function(){var e=n(this).val();e&&r.push(e)}),s&&n.ajax({url:ajaxurl,type:"get",data:{action:"load_exchange_rates",form_currency:c,to_currency:r.join(","),nonce:PMCS_Admin_Args.nonce},success:function(e){if(t.removeClass("loading"),"object"==typeof e&&"object"==typeof e.rates){var c=Number(e.rates[s]),r=n("input.num_decimals",a).val();0===r.length&&(r=2),r=Number(r),isNaN(r)&&(r=2),c&&n(".pmcs-rate",a).val(c)}}})}),n("select.pmsc_exchange_rate_server").on("change init_change",function(){var c=n(this).val();n("tr .pmsc_exc_server").each(function(){var e=n(this).closest("tr");n(this).hasClass(c)?e.show():e.hide()})}),n("select.pmsc_exchange_rate_server").trigger("init_change"),n(document).on("click",".pmcs-show-price-variable",function(e){e.preventDefault();var c=n(this).closest(".variable_pricing");n(".pmcs-price-variable-wrapper",c).toggle()}),"shop_order"===window.pagenow){var t=window.woocommerce_admin_meta_boxes.ajax_url,o="?";0<t.indexOf("?")&&(o="&");var e=n("#pmcs_order_currency").val();window.woocommerce_admin_meta_boxes.ajax_url+="?currency="+e,console.log(window.woocommerce_admin_meta_boxes.ajax_url),n("#pmcs_order_currency").on("change",function(){var e=n(this).val();window.woocommerce_admin_meta_boxes.ajax_url=t+o+"currency="+e})}});