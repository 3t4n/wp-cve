function UpdraftCentral_Events_Management(){var n=this,i=jQuery,e=(new UpdraftCentral_Collection,UpdraftCentral.get_debug_level(),!1);function s(e,t){i("#updraftcentral_events_table_site").html("<label>"+udclion.events.website+":</label>"),i("<select/>",{name:"updraftcentral_events_table_site","aria-controls":"updraftcentral_events_table",change:function(){i("#updraftcentral_events_table").DataTable().columns.adjust().draw()}}).html(e).appendTo(i("#updraftcentral_events_table_site > label")).val(t)}function r(s){UpdraftCentral.send_ajax("load_event_sites",{},null,"via_mothership_encrypting",i("#updraftcentral_panel_events"),function(e,t,a){var n,r;"ok"===t&&e.hasOwnProperty("message")&&"success"===e.message&&(n=e.event_sites.length?"":null,r=null,i.each(e.event_sites,function(e,t){t.hasOwnProperty("site_id")&&(null===r&&(r=t.site_id),n+='<option value="'+t.site_id+'">'+t.description+"</option>")}),"function"==typeof s)&&s.apply(this,[n,r])})}this.container_visible_state={search:!0,sites:!0},this.initial_load=0,this.update_listener_on_mobile_view=function(){e||(UpdraftCentral.subscribe_to_node_changes(i("table#updraftcentral_events_table > tbody"),function(e,t){for(var a=[],n=0;n<e.length;n++){var r=e[n];r.addedNodes.length&&a.push(r.addedNodes[0].className)}-1!==a.indexOf("child")&&i("a.updraftcentral_events_result_view").off("click").on("click",function(){var e=atob(i(this).attr("data-event_result_data"));UpdraftCentral_Library.dialog.alert("<h2>"+udclion.events.events_result_data+'</h2><p><div class="updraftcentral_events_result_data">'+e+"</div></p>")})},"events-table"),e=!0)},i("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set",function(e,t){t&&t.hasOwnProperty("new_mode")&&"events"===t.new_mode?(n.container_visible_state.search=i("#updraftcentral_sites_search_area").is(":visible"),n.container_visible_state.sites=i("#updraftcentral_dashboard_existingsites_container").is(":visible"),i("#updraftcentral_sites_search_area").hide(),i("#updraftcentral_dashboard_existingsites_container").hide(),r(function(e,t){var a,r;e=e,a=t,n.initial_load=1,i.fn.DataTable.fnIsDataTable(i("#updraftcentral_events_table").get(0))||(i("#updraftcentral_events_table").on("draw.dt",function(){i("a.updraftcentral_events_result_view").on("click",function(){var e=atob(i(this).attr("data-event_result_data"));UpdraftCentral_Library.dialog.alert("<h2>"+udclion.events.events_result_data+'</h2><p><div class="updraftcentral_events_result_data">'+e+"</div></p>")}),n.update_listener_on_mobile_view()}).on("preXhr.dt",function(e,t,a){0===(r=i(this).find(".updraftcentral_spinner")).length&&i(this).prepend('<div class="updraftcentral_spinner"></div>')}).on("xhr.dt",function(e,t,a,n){(r=i(this).find(".updraftcentral_spinner")).length&&r.remove()}).DataTable({dom:'l<"#updraftcentral_events_table_site.dataTables_site">frtip',autoWidth:!0,bStateSave:!1,lengthMenu:[[10,25,50,100],[10,25,50,100]],responsive:!0,processing:!1,serverSide:!0,infoCallback:function(e,t,a,n,r,s){t=0===r?0:t;t=sprintf(udclion.events.showing,t,a,r);return r!==n&&(t+=" ("+sprintf(udclion.events.filtered_from,n)+")"),t},ajax:{url:udclion.ajaxurl,type:"POST",data:function(e){dtp_data=i.extend({},e);var t=i("#updraftcentral_events_table_site select").val();return null==a&&(a=0),dtp_data.site_id=void 0!==t?t:a,dtp_data.initial_load=n.initial_load,n.initial_load&&(n.initial_load=0),e.action="updraftcentral_dashboard_ajax",e.subaction="events",e.component="dashboard",e.nonce=udclion.updraftcentral_dashboard_nonce,e.data=dtp_data,e},dataFilter:function(t){try{var e=JSON.parse(t);return e.recordsTotal=parseInt(e.recordsTotal),e.recordsFiltered=parseInt(e.recordsTotal),JSON.stringify(e)}catch(e){return t}}},columns:[{data:"event_name"},{data:"description"},{data:"event_status"},{data:"time"},{data:"event_result_data"}]}),e?s(e,a):i("#updraftcentral_events_table_site").html(""))})):(t&&t.hasOwnProperty("previous_mode")&&t.hasOwnProperty("new_mode")&&"events"===t.previous_mode&&"events"!==t.new_mode&&"notices"!==t.new_mode&&(n.container_visible_state.search&&i("#updraftcentral_sites_search_area").show(),n.container_visible_state.sites)&&i("#updraftcentral_dashboard_existingsites_container").show(),UpdraftCentral.register_event_handler("click","button#uc-btn-refresh-list",function(){var a=i("#updraftcentral_events_table").DataTable(),e=(a.search(""),a.page.len(10),n.initial_load=1,i("#updraftcentral_events_table_site"));e.length&&!e.get(0).hasChildNodes()?r(function(e,t){e&&(s(e,t),a.columns.adjust().draw())}):((e=i("#updraftcentral_events_table_site label > select")).length&&(e.get(0).selectedIndex=0),a.columns.adjust().draw())}))})}jQuery(function(e){new UpdraftCentral_Events_Management});