(()=>{"use strict";window.wp.i18n;const e=window.wp.blocks;function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function a(e,a,l){return s=function(e,a){if("object"!=t(e)||!e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var s=l.call(e,"string");if("object"!=t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a),(a="symbol"==t(s)?s:String(s))in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l,e;var s}const l=window.React,s=window.wp.element,n=window.wp.blockEditor,r=window.wp.components,i=window.wp.primitives,o=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{fillRule:"evenodd",d:"M6.863 13.644L5 13.25h-.5a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5H5L18 6.5h2V16h-2l-3.854-.815.026.008a3.75 3.75 0 01-7.31-1.549zm1.477.313a2.251 2.251 0 004.356.921l-4.356-.921zm-2.84-3.28L18.157 8h.343v6.5h-.343L5.5 11.823v-1.146z",clipRule:"evenodd"}));window.wp.serverSideRender,s.Component,window.wp.compose;class d extends s.Component{constructor(e){super(e),a(this,"onChange",(e=>{"-1"!=e.target.value&&(this.addOption(e.target.value),this.props.onChange(this.data.options),e.target.value="-1")})),a(this,"onChangeSingle",(e=>{"-1"!=e.target.value?(this.data.options=[e.target.value],this.props.onChange(this.data.options)):this.data.options=[]})),a(this,"maybeSelected",(e=>"multi"!==this.props.mode&&!!this.data.options.includes(e)&&"selected")),a(this,"onCustomizeQuery",(e=>{})),a(this,"onMove",((e,t)=>{this.data.options=this.arrayMove(this.data.options,e,t),this.props.onChange(this.data.options)})),a(this,"onTrashClick",(e=>{this.data.options.splice(e,1),this.props.onChange(this.data.options)})),a(this,"getOptionLabel",(e=>{for(var t=0;t<this.props.data.builtin.data.length;t++)if(this.props.data.builtin.data[t].name===e)return this.props.data.builtin.data[t].label;for(t=0;t<this.props.data.meta.data.length;t++)if(this.props.data.meta.data[t].name===e)return this.props.data.meta.data[t].label;for(var a=0;a<this.props.data.length;a++)for(t=0;t<this.props.data[a].data.length;t++)if(this.props.data[a].data[t].name===e)return this.props.data[a].data[t].label;return e})),this.data={text:this.props.placeholder,options:[],...e.data},this.data.options=[...this.props.value],this.state={mode:"normal"},void 0===this.props.mode&&(this.props.mode="multi")}shouldComponentUpdate(e){return!0}addOption(e){this.data.options.push({name:e})}arrayMove(e,t,a){if(a>=e.length)for(var l=a-e.length+1;l--;)e.push(void 0);return e.splice(a,0,e.splice(t,1)[0]),e}render(){const{options:e}=this.data;if("multi"===this.props.mode)var t=this.onChange,a="multi";else t=this.onChangeSingle,a="single";if(void 0===this.props.label)var s="List Data";else s=this.props.label;if(void 0===this.props.placeholder)var n="";else n=this.props.placeholder;return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(r.BaseControl,{label:s,labelPosition:"top"},(0,l.createElement)("select",{style:{width:"100%"},className:"components-select-control__input",onChange:t},(0,l.createElement)("option",{key:"-1",value:"-1"}),(0,l.createElement)("optgroup",{label:this.props.data.builtin.label},this.props.data.builtin.data.map(((e,t)=>(0,l.createElement)("option",{key:t,value:e.name,selected:this.maybeSelected(e.name)},e.label)))),this.props.data.meta.data.length>0&&(0,l.createElement)("optgroup",{label:this.props.data.meta.label},this.props.data.meta.data.map(((e,t)=>(0,l.createElement)("option",{key:t,value:e.name},e.label)))),this.props.data.taxonomies.data.length>0&&(0,l.createElement)("optgroup",{label:this.props.data.taxonomies.label},this.props.data.taxonomies.data.map(((e,t)=>(0,l.createElement)("option",{key:t,value:e.name},e.label))))),"multi"==a&&e.length>0&&(0,l.createElement)(l.Fragment,null,e.map(((t,a)=>(0,l.createElement)(r.Flex,{key:a},(0,l.createElement)(r.FlexBlock,{title:this.getOptionLabel(t.name),style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},this.getOptionLabel(t.name)),(0,l.createElement)(r.FlexItem,null,(0,l.createElement)(r.Button,{label:"",variant:"trynitary",icon:"arrow-down-alt2",value:t.name,isSmall:!0,onClick:e=>this.onMove(a,a+1,t),disabled:a+1>=e.length}),(0,l.createElement)(r.Button,{label:"",variant:"trynitary",icon:"arrow-up-alt2",isSmall:!0,onClick:e=>this.onMove(a,a-1,t),disabled:a<=0}),(0,l.createElement)(r.Button,{label:"",variant:"trynitary",icon:"trash",isSmall:!0,onClick:e=>this.onTrashClick(a)})))))),"multi"==a&&0===e.length&&n.length>0&&(0,l.createElement)(l.Fragment,null,(0,l.createElement)("div",null,(0,l.createElement)("em",null,n)))))}}const p=d;s.Component;class c extends s.Component{render(){return(0,l.createElement)(l.Fragment,null,(0,l.createElement)("div",{class:"atw-flex atw-px-2 atw-py-4 atw-mb-4 atw-bg-gray-100 atw-rounded-lg"},(0,l.createElement)("span",{class:"fas fa-circle-info atw-mr-2 atw-py-2"}),(0,l.createElement)("div",null,(0,l.createElement)("span",{class:"atw-inline-block atw-pb-2 atw-mx-0"},"In this ection you can enter here data that will be used in the preview,"),(0,l.createElement)("span",{class:"atw-inline-block atw-pt-2 atw-mx-0"},"This will allow you to get a better idea of how the page will look like in the frontend."))))}}const m=c;class h extends s.Component{constructor(e){super(e),a(this,"onChangeColor",(e=>{this.props.setAttributes({color:e})})),a(this,"onFormStyleChange",(e=>{this.props.setAttributes({form_style:e})})),a(this,"onSelectPostType",(e=>{this.props.setAttributes({post_type:e,form_scheme:""})})),a(this,"onSelectFormScheme",(e=>{this.props.setAttributes({form_scheme:e})})),a(this,"onCustomizeQuery",((e,t)=>{var a={...this.props.attributes.query};0===t.length?delete a[e]:a[e]=t,this.props.setAttributes({query:a})})),a(this,"getQueryParam",(e=>void 0===this.props.attributes.query[e]?"":this.props.attributes.query[e])),a(this,"getAvailablePostTypes",(()=>{var e=[{label:"",value:""}];return this.state.post_types.forEach((function(t,a){e.push({label:t.label,value:t.post_type})})),e})),a(this,"getCurrentPostType",(()=>this.state.post_types[0])),a(this,"getSelectedFormScheme",(e=>{if(""===this.props.attributes.form_scheme)return null;for(var t=this.getCurrentPostType(),a=0;a<t.form_schemes[e].length;a++)if(t.form_schemes[e][a].name===this.props.attributes.form_scheme)return t.form_schemes[e][a];return null})),a(this,"getSelectedFormSchemeData",(e=>{var t=this.getSelectedFormScheme(e);return null===t?[]:t.data})),a(this,"getAvailableSearchForms",(e=>{var t=this.getCurrentPostType();return[{label:"",value:""}].concat(t.form_schemes.search)})),a(this,"getCurrentPostType",(()=>this.state.post_types[0])),a(this,"getSelectedFormScheme",(e=>{if(""===this.props.attributes.form_scheme)return null;for(var t=this.getCurrentPostType(),a=0;a<t.form_schemes[e].length;a++)if(t.form_schemes[e][a].name===this.props.attributes.form_scheme)return t.form_schemes[e][a];return null})),a(this,"getSelectedFormSchemeData",(e=>{for(var t=this.getCurrentPostType(),a=[],l=0;l<t.form_schemes[e].length;l++)Object.entries(t.form_schemes[e][l].data).map((([e,t])=>{a.push(t)})),(a=this.getUnique(a,"name")).sort(((e,t)=>e.label>t.label?1:-1));return a})),a(this,"getUnique",((e,t)=>{if("function"!=typeof t){const e=t;t=function(t){return t[e]}}return Array.from(e.reduce((function(e,a){const l=t(a);return e.has(l)||e.set(l,a),e}),new Map).values())})),a(this,"getAvailableSearchForms",(e=>{var t=this.getCurrentPostType();return[{label:"",value:""}].concat(t.form_schemes.search)})),a(this,"getAdvertsListData",(()=>{for(var e=this.getCurrentPostType(),t={builtin:{label:"Builtin",data:e.form_schemes_default.publish},meta:{label:"Custom Fields",data:this.getSelectedFormSchemeData("publish")},taxonomies:{label:"Taxonomies",data:[]}},a=0;a<e.taxonomies.length;a++)t.taxonomies.data.push({name:"taxonomy__"+e.taxonomies[a].name,label:e.taxonomies[a].label});return t})),a(this,"onChangeLayout",(e=>{this.props.setAttributes({layout:e})})),a(this,"onChangeColumns",(e=>{this.props.setAttributes({columns:parseInt(e)})})),a(this,"onChangeClosedTop",(e=>{this.props.setAttributes({closed_top:e})})),a(this,"onChangeIncludeFields",(e=>{this.props.setAttributes({include_fields:[...e]})})),a(this,"onChangeExcludeFields",(e=>{this.props.setAttributes({exclude_fields:[...e]})})),a(this,"onChangeIncludeFieldTypes",(e=>{this.props.setAttributes({include_types:[...e]})})),a(this,"onChangeExcludeFieldTypes",(e=>{this.props.setAttributes({exclude_types:[...e]})})),a(this,"initVisuals",(()=>{const{post_type:e}=this.props.attributes;""!==e&&this.setState({initiated:!0})})),a(this,"resetVisuals",(()=>{this.props.setAttributes({post_type:""}),this.setState({initiated:!1,loading:!0}),this.runApiFetchForms()})),a(this,"previewOnly",(()=>(0,l.createElement)("div",{class:"atw-block atw-bg-gray-100 atw-px-4 atw-py-2 atw-rounded-t-lg atw-text-sm atw-text-center"},(0,l.createElement)("span",{class:"fas fa-warning atw-not-italic atw-text-gray-400 atw-mr-2"}),(0,l.createElement)("span",{class:"atw-text-xs atw-text-gray-600"},"This is a preview only only, the number of rows on an actual page might be different.")))),this.state={initiated:!1,post_types:[],loading:!0,show_instructions:!1},this.initVisuals()}componentDidMount(){this.runApiFetchForms()}runApiFetchForms(){wp.apiFetch({path:"wpadverts/v1/classifieds-types"}).then((e=>{this.setState({post_types:e.data,loading:!1,initiated:""!==this.props.attributes.post_type})}))}getDataOptions(){var e=this.getAdvertsListData(),t=0,a=[{label:"Builtin",options:[]},{label:"Patterns",options:[]},{label:"Custom Fields",options:[]},{label:"Taxonomies",options:[]}];for(t=0;t<e.builtin.data.length;t++)a[e.builtin.data[t].name.startsWith("pattern__")?1:0].options.push({value:e.builtin.data[t].name,label:e.builtin.data[t].label});for(t=0;t<e.meta.data.length;t++)a[2].options.push({value:e.meta.data[t].name,label:e.meta.data[t].label});for(t=0;t<e.taxonomies.data.length;t++)a[3].options.push({value:e.taxonomies.data[t].name,label:e.taxonomies.data[t].label});return a}getFieldTypes(){return{builtin:{label:"Builtin",data:[{name:"__builtin",label:"Builtin Fields"}]},meta:{label:"Fields",data:[{name:"adverts_field_text",label:"Short Text"},{name:"adverts_field_textarea",label:"Text Area"},{name:"adverts_field_select",label:"Dropdown"},{name:"adverts_field_checkbox",label:"Checkbox"},{name:"adverts_field_radio",label:"Radio"},{name:"adverts_field_autocomplete",label:"Autocomplete"}]},taxonomies:{label:"Other",data:[{name:"adverts_cf_field_date",label:"Date and Time"}]}}}renderInit(){const{post_type:e}=this.props.attributes,{show_instructions:t}=this.state;return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(r.Placeholder,{icon:o,label:"Classifieds Single Data Table",instructions:"Select custom post type and search form scheme to continue.",isColumnLayout:"true"},!0===this.state.loading?(0,l.createElement)(r.Spinner,null):(0,l.createElement)(l.Fragment,null,(0,l.createElement)(r.SelectControl,{label:"Custom Post Type",labelPosition:"top",value:e,options:this.getAvailablePostTypes(),onChange:this.onSelectPostType,style:{lineHeight:"1rem"}}),(0,l.createElement)("div",null,(0,l.createElement)(r.Button,{variant:"primary",disabled:""===e,onClick:this.initVisuals},"Apply")))))}render(){const{className:e,attributes:t}=this.props,{layout:a,columns:s,closed_top:i,include_fields:o,exclude_fields:d,include_types:c,exclude_types:h}=t;[].join(" ");const{show_instructions:u}=this.state;return(0,l.createElement)(l.Fragment,null,!0===this.state.initiated?(0,l.createElement)(l.Fragment,null,(0,l.createElement)(n.InspectorControls,null,(0,l.createElement)(r.PanelBody,{title:"Display Options"},(0,l.createElement)(r.SelectControl,{label:"Layout",value:a,options:[{label:"List",value:"list"},{label:"Grid",value:"grid"},{label:"Text",value:"text"}],onChange:this.onChangeLayout}),"list"==a&&(0,l.createElement)(r.ToggleControl,{label:"Closed Top",checked:i,onChange:this.onChangeClosedTop}),"grid"==a&&(0,l.createElement)(r.TextControl,{label:"Columns",value:s,onChange:this.onChangeColumns,type:"number",min:1,max:10,step:1})),(0,l.createElement)(r.PanelBody,{title:"Filters"},(0,l.createElement)(p,{label:"Include Field Types",data:this.getFieldTypes(),onChange:this.onChangeIncludeFieldTypes,value:c,mode:"multi",placeholder:"All"}),(0,l.createElement)(p,{label:"Exclude Field Types",data:this.getFieldTypes(),onChange:this.onChangeExcludeFieldTypes,value:h,mode:"multi",placeholder:"None"}),(0,l.createElement)(p,{label:"Include Fields",data:this.getAdvertsListData(),onChange:this.onChangeIncludeFields,value:o,mode:"multi",placeholder:"All"}),(0,l.createElement)(p,{label:"Exclude Fields",data:this.getAdvertsListData(),onChange:this.onChangeExcludeFields,value:d,mode:"multi",placeholder:"None"})),(0,l.createElement)(r.PanelBody,{title:"Preview"},(0,l.createElement)(m,null))),(0,l.createElement)(n.BlockControls,null,(0,l.createElement)(r.Toolbar,{controls:[{icon:"controls-repeat",title:"Reset post type and form scheme",onClick:this.resetVisuals}]})),(0,l.createElement)(r.Disabled,null,"list"==a&&(0,l.createElement)(l.Fragment,null,this.previewOnly(),(0,l.createElement)("div",{class:"atw-border atw-border-solid atw-border-gray-100 atw-px-3"},(0,l.createElement)("div",{class:"atw-grid atw-grid-cols-1 md:atw-grid-cols-1 --atw-mt-6 atw-border-x-0 atw-border-b-0 atw-border-t-0 atw-border-solid atw-border-gray-100"},[...Array(3)].map((e=>(0,l.createElement)("div",{class:"atw-border-x-0 atw-border-t-0 atw-border-b atw-border-solid atw-border-gray-100 atw-pb-2"},(0,l.createElement)("div",{class:"atw-flex atw-pt-3 atw-pb-1 atw-mx-0"},(0,l.createElement)("div",{class:"atw-hidden md:atw-flex atw-justify-center atw-items-center atw-bg-gray-200 atw-w-10 atw-h-10 atw-rounded-full atw-mr-3"},(0,l.createElement)("div",{class:" "},(0,l.createElement)("i",{class:"--fas --fa-icon-wordpress atw-text-gray-400 atw-text-lg"}))),(0,l.createElement)("div",{class:"atw-flex atw-flex-col md:atw-flex-row atw-grow"},(0,l.createElement)("div",{class:"atw-flex atw-flex-none atw-items-center atw-w-1/3 atw-h-10 atw-text-gray-700 atw-text-base atw-mb-1 md:atw-mb-0"},(0,l.createElement)("span",{class:"atw-inline-block atw-font-bold md:atw-font-normal --- atw-bg-gray-200 atw-w-1/2"}," ")),(0,l.createElement)("div",{class:"atw-flex atw-grow atw-items-center atw-text-gray-800  --- atw-h-10 atw-rounded atw-text-base"},(0,l.createElement)("span",{class:"atw-inline-block --- atw-rounded atw-bg-gray-200 atw-w-3/4 "}," ")))))))))),"grid"==a&&(0,l.createElement)(l.Fragment,null,this.previewOnly(),(0,l.createElement)("div",{class:"atw-block atw-border atw-border-solid atw-border-gray-100 atw-px-3"},(0,l.createElement)("div",{class:"atw-grid atw-mt-6 atw-grid-cols-1 md:atw-grid-cols-"+s.toString()},[...Array(s)].map((e=>(0,l.createElement)("div",{class:"atw-border-0 atw-pb-2"},(0,l.createElement)("div",{class:"atw-flex atw-items-center atw-py-3 atw-mx-0"},(0,l.createElement)("div",{class:"atw-flex atw-justify-center atw-items-center atw-flex-none atw-bg-gray-200 atw-w-10 atw-h-10 atw-rounded-full atw-mr-3"},(0,l.createElement)("div",{class:" "},(0,l.createElement)("i",{class:"atw-text-gray-300 atw-text-3xl"}))),(0,l.createElement)("div",{class:"atw-flex atw-flex-col atw-grow"},(0,l.createElement)("div",{class:"atw-flex atw-flex-none atw-items-center atw-text-gray-600 atw-text-base"},(0,l.createElement)("span",{class:"atw-inline-block atw-font-normal --- atw-bg-gray-200 atw-w-1/2 atw-rounded-lg"}," ")),(0,l.createElement)("div",{class:"atw-flex atw-grow atw-items-center atw-text-gray-800 --- atw-h-10 atw-rounded-lg atw-text-base"},(0,l.createElement)("span",{class:"atw-inline-block --- atw-rounded atw-bg-gray-200 atw-w-3/4 "}," ")))))))))),"text"==a&&(0,l.createElement)("div",{class:"atw-mb-6"},this.previewOnly(),(0,l.createElement)("div",{class:"atw-border atw-border-solid atw-border-gray-100 atw-px-3 atw-pb-3"},[0,1].map((e=>(0,l.createElement)("div",{class:"atw-mt-3"},(0,l.createElement)("div",null,(0,l.createElement)("span",{class:"atw-inline-block atw-text-gray-700 atw-text-xl atw-font-bold atw-py-3 atw-w-full"},(0,l.createElement)("span",{class:"atw-inline-block atw-bg-gray-300 atw-w-1/2 atw-text-xl atw-rounded-lg"}," "))),(0,l.createElement)("div",null,[0,1,2,3,4].map((e=>(0,l.createElement)("div",{class:"atw-bg-gray-200 atw-w-full atw-rounded atw-text-sm atw-my-1"}," "))),(0,l.createElement)("div",{class:"atw-bg-gray-200 atw-w-3/4 atw-rounded atw-text-sm atw-my-1"}," "))))))))):(0,l.createElement)(l.Fragment,null,this.renderInit()))}}const u=h,w=JSON.parse('{"name":"wpadverts/single-data-table","textdomain":"wpadverts","apiVersion":1,"title":"Classifieds Single Data Table","icon":"megaphone","category":"wpadverts","example":{},"attributes":{"post_type":{"type":"string","default":""},"layout":{"type":"string","default":"list"},"columns":{"type":"integer","default":3},"closed_top":{"type":"boolean","default":true},"include_fields":{"type":"array","default":[]},"exclude_fields":{"type":"array","default":[]},"include_types":{"type":"array","default":[]},"exclude_types":{"type":"array","default":[]}}}');(0,e.registerBlockType)(w,{edit:u,save:({attributes:e})=>null})})();