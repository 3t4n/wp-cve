(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var l in a)e.o(a,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:a[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};window.wp.i18n;const t=window.wp.blocks;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t,l){return i=function(e,t){if("object"!=a(e)||!e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var i=l.call(e,"string");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==a(i)?i:String(i))in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e;var i}const i=window.React,s=window.wp.element,o=window.wp.blockEditor,n=window.wp.components,r=window.wp.primitives,p=(0,i.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,i.createElement)(r.Path,{fillRule:"evenodd",d:"M6.863 13.644L5 13.25h-.5a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5H5L18 6.5h2V16h-2l-3.854-.815.026.008a3.75 3.75 0 01-7.31-1.549zm1.477.313a2.251 2.251 0 004.356.921l-4.356-.921zm-2.84-3.28L18.157 8h.343v6.5h-.343L5.5 11.823v-1.146z",clipRule:"evenodd"})),h=window.wp.serverSideRender;var u=e.n(h);class m extends s.Component{constructor(e){super(e),l(this,"getOptionLabel",(e=>{for(var t=0;t<this.props.data.builtin.data.length;t++)if(this.props.data.builtin.data[t].name===e)return this.props.data.builtin.data[t].label;for(var a=0;a<this.props.data.length;a++)for(t=0;t<this.props.data[a].data.length;t++)if(this.props.data[a].data[t].name===e)return this.props.data[a].data[t].label;return e})),l(this,"onChange",(e=>{this.value=e.target.value,this.props.onChange(this.value)})),this.value=this.props.value,this.state={mode:"normal"}}render(){const{label:e,labelPosition:t}=this.props;return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(n.BaseControl,{label:e,labelPosition:t},(0,i.createElement)("select",{className:"components-select-control__input",onChange:this.onChange,value:this.value},(0,i.createElement)("option",{key:"-1",value:"-1"}),this.props.options.map(((e,t,a)=>0===e.options.length?null:(0,i.createElement)("optgroup",{key:t,label:e.label},e.options.map(((e,t)=>(0,i.createElement)("option",{key:t,value:e.value},e.label)))))))))}}const d=m;window.wp.compose;class g extends s.Component{constructor(e){super(e),l(this,"onChange",(e=>{"-1"!=e.target.value&&(this.addOption(e.target.value),this.props.onChange(this.data.options),e.target.value="-1")})),l(this,"onChangeSingle",(e=>{"-1"!=e.target.value?(this.data.options=[e.target.value],this.props.onChange(this.data.options)):this.data.options=[]})),l(this,"maybeSelected",(e=>"multi"!==this.props.mode&&!!this.data.options.includes(e)&&"selected")),l(this,"onCustomizeQuery",(e=>{})),l(this,"onMove",((e,t)=>{this.data.options=this.arrayMove(this.data.options,e,t),this.props.onChange(this.data.options)})),l(this,"onTrashClick",(e=>{this.data.options.splice(e,1),this.props.onChange(this.data.options)})),l(this,"getOptionLabel",(e=>{for(var t=0;t<this.props.data.builtin.data.length;t++)if(this.props.data.builtin.data[t].name===e)return this.props.data.builtin.data[t].label;for(t=0;t<this.props.data.meta.data.length;t++)if(this.props.data.meta.data[t].name===e)return this.props.data.meta.data[t].label;for(var a=0;a<this.props.data.length;a++)for(t=0;t<this.props.data[a].data.length;t++)if(this.props.data[a].data[t].name===e)return this.props.data[a].data[t].label;return e})),this.data={text:this.props.placeholder,options:[],...e.data},this.data.options=[...this.props.value],this.state={mode:"normal"},void 0===this.props.mode&&(this.props.mode="multi")}shouldComponentUpdate(e){return!0}addOption(e){this.data.options.push({name:e})}arrayMove(e,t,a){if(a>=e.length)for(var l=a-e.length+1;l--;)e.push(void 0);return e.splice(a,0,e.splice(t,1)[0]),e}render(){const{options:e}=this.data;if("multi"===this.props.mode)var t=this.onChange,a="multi";else t=this.onChangeSingle,a="single";if(void 0===this.props.label)var l="List Data";else l=this.props.label;if(void 0===this.props.placeholder)var s="";else s=this.props.placeholder;return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(n.BaseControl,{label:l,labelPosition:"top"},(0,i.createElement)("select",{style:{width:"100%"},className:"components-select-control__input",onChange:t},(0,i.createElement)("option",{key:"-1",value:"-1"}),(0,i.createElement)("optgroup",{label:this.props.data.builtin.label},this.props.data.builtin.data.map(((e,t)=>(0,i.createElement)("option",{key:t,value:e.name,selected:this.maybeSelected(e.name)},e.label)))),this.props.data.meta.data.length>0&&(0,i.createElement)("optgroup",{label:this.props.data.meta.label},this.props.data.meta.data.map(((e,t)=>(0,i.createElement)("option",{key:t,value:e.name},e.label)))),this.props.data.taxonomies.data.length>0&&(0,i.createElement)("optgroup",{label:this.props.data.taxonomies.label},this.props.data.taxonomies.data.map(((e,t)=>(0,i.createElement)("option",{key:t,value:e.name},e.label))))),"multi"==a&&e.length>0&&(0,i.createElement)(i.Fragment,null,e.map(((t,a)=>(0,i.createElement)(n.Flex,{key:a},(0,i.createElement)(n.FlexBlock,{title:this.getOptionLabel(t.name),style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},this.getOptionLabel(t.name)),(0,i.createElement)(n.FlexItem,null,(0,i.createElement)(n.Button,{label:"",variant:"trynitary",icon:"arrow-down-alt2",value:t.name,isSmall:!0,onClick:e=>this.onMove(a,a+1,t),disabled:a+1>=e.length}),(0,i.createElement)(n.Button,{label:"",variant:"trynitary",icon:"arrow-up-alt2",isSmall:!0,onClick:e=>this.onMove(a,a-1,t),disabled:a<=0}),(0,i.createElement)(n.Button,{label:"",variant:"trynitary",icon:"trash",isSmall:!0,onClick:e=>this.onTrashClick(a)})))))),"multi"==a&&0===e.length&&s.length>0&&(0,i.createElement)(i.Fragment,null,(0,i.createElement)("div",null,(0,i.createElement)("em",null,s)))))}}const c=g;s.Component;class b extends s.Component{constructor(e){super(e),l(this,"onChangeColor",(e=>{this.props.setAttributes({color:e})})),l(this,"onFormStyleChange",(e=>{this.props.setAttributes({form_style:e})})),l(this,"onSelectPostType",(e=>{this.props.setAttributes({post_type:e,form_scheme:""})})),l(this,"onSelectFormScheme",(e=>{this.props.setAttributes({form_scheme:e})})),l(this,"onCustomizeQuery",((e,t)=>{var a={...this.props.attributes.query};0===t.length?delete a[e]:a[e]=t,this.props.setAttributes({query:a})})),l(this,"getQueryParam",(e=>void 0===this.props.attributes.query[e]?"":this.props.attributes.query[e])),l(this,"getAvailablePostTypes",(()=>{var e=[{label:"",value:""}];return this.state.post_types.forEach((function(t,a){e.push({label:t.label,value:t.post_type})})),e})),l(this,"getCurrentPostType",(()=>this.state.post_types[0])),l(this,"getSelectedFormScheme",(e=>{if(""===this.props.attributes.form_scheme)return null;for(var t=this.getCurrentPostType(),a=0;a<t.form_schemes[e].length;a++)if(t.form_schemes[e][a].name===this.props.attributes.form_scheme)return t.form_schemes[e][a];return null})),l(this,"getSelectedFormSchemeData",(e=>{var t=this.getSelectedFormScheme(e);return null===t?[]:t.data})),l(this,"getAvailableSearchForms",(e=>{var t=this.getCurrentPostType();return[{label:"",value:""}].concat(t.form_schemes.search)})),l(this,"getAdvertsListData",(()=>{for(var e=this.getCurrentPostType(),t={builtin:{label:"Builtin",data:e.form_schemes_default.publish},meta:{label:"Custom Fields",data:this.getSelectedFormSchemeData("publish")},taxonomies:{label:"Taxonomies",data:[]}},a=0;a<e.taxonomies.length;a++)t.taxonomies.data.push({name:"taxonomy__"+e.taxonomies[a].name,label:e.taxonomies[a].label});return t})),l(this,"initVisuals",(()=>{const{post_type:e}=this.props.attributes;""!==e&&this.setState({initiated:!0})})),l(this,"resetVisuals",(()=>{this.props.setAttributes({post_type:""}),this.setState({initiated:!1,loading:!0}),this.runApiFetchForms()})),l(this,"toggleShowResultsCounter",(e=>{this.props.setAttributes({show_results_counter:e})})),l(this,"toggleSwitchViews",(e=>{this.props.setAttributes({switch_views:e})})),l(this,"toggleAllowSorting",(e=>{this.props.setAttributes({allow_sorting:e})})),l(this,"toggleShowPagination",(e=>{this.props.setAttributes({show_pagination:e})})),l(this,"onChangePostsPerPage",(e=>{this.props.setAttributes({posts_per_page:e})})),l(this,"onChangeDisplay",(e=>{this.props.setAttributes({display:e})})),l(this,"onChangeDefaultImageUrl",(e=>{this.props.setAttributes({default_image_url:e})})),l(this,"toggleShowPriceColumn",(e=>{this.props.setAttributes({show_price_column:e})})),l(this,"onListDataChange",(e=>{console.log(e),this.props.setAttributes({data:[...e]})})),l(this,"onChangeTitleSource",(e=>{this.props.setAttributes({title_source:e})})),l(this,"toggleShowImageColumn",(e=>{this.props.setAttributes({show_image_column:e})})),l(this,"onChangeListImageWidth",(e=>{this.props.setAttributes({list_img_width:e})})),l(this,"onChangeListImageHeight",(e=>{this.props.setAttributes({list_img_height:e})})),l(this,"onChangeListImageFit",(e=>{this.props.setAttributes({list_img_fit:e})})),l(this,"onChangeListImageSource",(e=>{this.props.setAttributes({list_img_source:e})})),l(this,"onChangeGridColumns",(e=>{this.props.setAttributes({grid_columns:e})})),l(this,"onChangeGridColumnsMobile",(e=>{this.props.setAttributes({grid_columns_mobile:e})})),l(this,"onChangeGridImgHeight",(e=>{this.props.setAttributes({grid_img_height:e})})),l(this,"onChangeGridImgFit",(e=>{this.props.setAttributes({grid_img_fit:e})})),l(this,"onChangeGridImgSource",(e=>{this.props.setAttributes({grid_img_source:e})})),l(this,"onChangeOrderBy",(e=>{this.props.setAttributes({order_by:e})})),this.state={initiated:!1,post_types:[],loading:!0,show_instructions:!1},this.initVisuals()}componentDidMount(){this.runApiFetchForms()}runApiFetchForms(){wp.apiFetch({path:"wpadverts/v1/classifieds-types"}).then((e=>{this.setState({post_types:e.data,loading:!1,initiated:""!==this.props.attributes.post_type})}))}getDataOptions(){var e=this.getAdvertsListData(),t=0,a=[{label:"Builtin",options:[]},{label:"Patterns",options:[]},{label:"Custom Fields",options:[]},{label:"Taxonomies",options:[]}];for(t=0;t<e.builtin.data.length;t++)a[e.builtin.data[t].name.startsWith("pattern__")?1:0].options.push({value:e.builtin.data[t].name,label:e.builtin.data[t].label});for(t=0;t<e.meta.data.length;t++)a[2].options.push({value:e.meta.data[t].name,label:e.meta.data[t].label});for(t=0;t<e.taxonomies.data.length;t++)a[3].options.push({value:e.taxonomies.data[t].name,label:e.taxonomies.data[t].label});return a}renderInit(){const{post_type:e}=this.props.attributes,{show_instructions:t}=this.state;return(0,i.createElement)(i.Fragment,null,(0,i.createElement)(n.Placeholder,{icon:p,label:"Classifieds Manage",instructions:"Select custom post type to continue.",isColumnLayout:"true"},!0===this.state.loading?(0,i.createElement)(n.Spinner,null):(0,i.createElement)(i.Fragment,null,(0,i.createElement)(n.SelectControl,{label:"Custom Post Type",labelPosition:"top",value:e,options:this.getAvailablePostTypes(),onChange:this.onSelectPostType,style:{lineHeight:"1rem"}}),(0,i.createElement)("div",null,(0,i.createElement)(n.Button,{variant:"primary",disabled:""===e,onClick:this.initVisuals},"Apply")))))}render(){const{className:e,attributes:t}=this.props,{show_results_counter:a,switch_views:l,allow_sorting:s,show_pagination:r,posts_per_page:p,data:h,display:m,default_image_url:g,order_by:b,order_by_featured:v,list_type:_,list_img_width:y,list_img_height:C,list_img_fit:f,list_img_source:w,grid_columns:E,grid_columns_mobile:S,grid_img_height:A,grid_img_fit:F,grid_img_source:P,show_price_column:x,show_image_column:I,title_source:L,alt_source:T,color_price:k,color_title:O,color_bg_featured:D}=t,{show_instructions:B}=this.state;return(0,i.createElement)(i.Fragment,null,!0===this.state.initiated?(0,i.createElement)(i.Fragment,null,(0,i.createElement)(o.InspectorControls,null,(0,i.createElement)(n.PanelBody,{title:"Display Options",initialOpen:!0},(0,i.createElement)(n.ToggleControl,{label:"Show number of found results.",checked:a,onChange:this.toggleShowResultsCounter}),(0,i.createElement)(n.ToggleControl,{label:"Allow switching views.",checked:l,onChange:this.toggleSwitchViews}),(0,i.createElement)(n.ToggleControl,{label:"Allow sorting.",checked:s,onChange:this.toggleAllowSorting}),(0,i.createElement)(n.TextControl,{label:"Results Per Page.",value:p,onChange:this.onChangePostsPerPage,type:"number",min:"1",max:"100",step:"1"}),(0,i.createElement)(n.SelectControl,{label:"Default View",labelPosition:"top",value:m,options:[{label:"List",value:"list"},{label:"Grid",value:"grid"},{label:"Map (requires MAL extension)",value:"map"}],onChange:this.onChangeDisplay}),(0,i.createElement)(n.TextControl,{label:"Default Image URL",value:g,onChange:this.onChangeDefaultImageUrl})),(0,i.createElement)(n.PanelBody,{title:"Display Information",initialOpen:!1},(0,i.createElement)(n.ToggleControl,{label:"Show image column/row.",checked:I,onChange:this.toggleShowImageColumn}),(0,i.createElement)(c,{data:this.getAdvertsListData(),onChange:this.onListDataChange,value:h,mode:"multi"}),(0,i.createElement)(d,{label:"Title Text",labelPosition:"top",value:L,options:this.getDataOptions(),onChange:this.onChangeTitleSource})),(0,i.createElement)(n.PanelBody,{title:"List View Options",initialOpen:!1},(0,i.createElement)(n.RangeControl,{label:"Image Width",value:y,onChange:this.onChangeListImageWidth,min:0,max:10,withInputField:!1}),(0,i.createElement)(n.RangeControl,{label:"Image Height",value:C,onChange:this.onChangeListImageHeight,min:0,max:10,withInputField:!1}),(0,i.createElement)(n.SelectControl,{label:"Image Fit",labelPosition:"top",value:f,onChange:this.onChangeListImageFit,options:[{value:"none",label:"Default"},{value:"contain",label:"Contain"},{value:"cover",label:"Cover"},{value:"scale-down",label:"Scale Down"}]}),(0,i.createElement)(n.SelectControl,{label:"Use Image",labelPosition:"top",value:w,onChange:this.onChangeListImageSource,options:[{value:"adverts-upload-thumbnail",label:"Adverts - Upload Thumbnail"},{value:"adverts-list",label:"Adverts - List"},{value:"adverts-gallery",label:"Adverts - Gallery"},{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"},{value:"full",label:"Full Size"}]})),(0,i.createElement)(n.PanelBody,{title:"Grid View Options",initialOpen:!1},(0,i.createElement)(n.TextControl,{label:"Columns in the Grid view.",value:E,onChange:this.onChangeGridColumns,type:"number",min:"1",max:"6",step:"1"}),(0,i.createElement)(n.TextControl,{label:"Columns in the mobile Grid view.",value:S,onChange:this.onChangeGridColumnsMobile,type:"number",min:"1",max:"2",step:"1"}),(0,i.createElement)(n.RangeControl,{label:"Image Height",value:A,onChange:this.onChangeGridImgHeight,min:0,max:15,withInputField:!1}),(0,i.createElement)(n.SelectControl,{label:"Image Fit",labelPosition:"top",value:F,onChange:this.onChangeGridImgFit,options:[{value:"none",label:"Default"},{value:"contain",label:"Contain"},{value:"cover",label:"Cover"},{value:"scale-down",label:"Scale Down"}]}),(0,i.createElement)(n.SelectControl,{label:"Use Image",labelPosition:"top",value:P,onChange:this.onChangeGridImgSource,options:[{value:"adverts-upload-thumbnail",label:"Adverts - Upload Thumbnail"},{value:"adverts-list",label:"Adverts - List"},{value:"adverts-gallery",label:"Adverts - Gallery"},{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"},{value:"full",label:"Full Size"}]})),(0,i.createElement)(n.PanelBody,{title:"Filters / Basic",initialOpen:!1},(0,i.createElement)(n.SelectControl,{label:"Default Sorting and Order",labelPosition:"top",value:b,options:[{label:"Newest First",value:"date-desc"},{label:"Oldest First",value:"date-asc"},{label:"Most Expensive First",value:"price-desc"},{label:"Cheapest First",value:"price-asc"},{label:"From A to Z",value:"title-asc"},{label:"From Z to A",value:"title-desc"}],onChange:this.onChangeOrderBy}))),(0,i.createElement)(o.BlockControls,null,(0,i.createElement)(n.Toolbar,{controls:[{icon:"controls-repeat",title:"Reset post type and form scheme",onClick:this.resetVisuals}]})),(0,i.createElement)(n.Disabled,null,(0,i.createElement)(u(),{block:"wpadverts/manage",attributes:this.props.attributes}))):(0,i.createElement)(i.Fragment,null,this.renderInit()))}}const v=b,_=JSON.parse('{"name":"wpadverts/manage","apiVersion":1,"textdomain":"wpadverts","title":"Classifieds Manage","icon":"megaphone","category":"wpadverts","editor_style":"wpadverts-blocks-manage","editor_script":"block-wpadverts-list","example":{},"attributes":{"post_type":{"type":"string","default":""},"query":{"type":"object","default":{}},"show_results_counter":{"type":"boolean","default":true},"switch_views":{"type":"boolean","default":true},"allow_sorting":{"type":"boolean","default":true},"show_pagination":{"type":"boolean","default":true},"posts_per_page":{"type":"integer","default":20},"display":{"type":"string","default":"grid"},"order_by":{"type":"string","default":"date-desc"},"order_by_featured":{"type":"boolean","default":true},"list_type":{"type":"string","default":"all"},"list_img_width":{"type":"integer","default":1},"list_img_height":{"type":"integer","default":1},"list_img_fit":{"type":"string","default":"contain"},"list_img_source":{"type":"string","default":"adverts-list"},"grid_columns":{"type":"string","default":"2"},"grid_columns_mobile":{"type":"string","default":"2"},"grid_img_height":{"type":"integer","default":8},"grid_img_fit":{"type":"string","default":"contain"},"grid_img_source":{"type":"string","default":"adverts-list"},"data":{"type":"array","default":[]},"default_image_url":{"type":"string","default":""},"show_image_column":{"type":"boolean","default":true},"show_price_column":{"type":"boolean","default":true},"title_source":{"type":"string","default":"default__post_title"},"alt_source":{"type":"string","default":"pattern__price"},"color_price":{"type":"string","default":"#b91c1c"},"color_title":{"type":"string","default":""},"color_bg_featured":{"type":"string","default":""},"form":{"type":"object","default":{}},"primary_button":{"type":"object","default":{}},"secondary_button":{"type":"object","default":{}}}}');(0,t.registerBlockType)(_,{edit:v,save:({attributes:e})=>null})})();