(()=>{"use strict";window.wp.i18n;const e=window.wp.blocks;function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function a(e,a,s){return r=function(e,a){if("object"!=t(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(a),(a="symbol"==t(r)?r:String(r))in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,e;var r}const s=window.React,r=window.wp.element,o=window.wp.blockEditor,l=window.wp.components,n=window.wp.primitives,i=(0,s.createElement)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.createElement)(n.Path,{fillRule:"evenodd",d:"M6.863 13.644L5 13.25h-.5a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5H5L18 6.5h2V16h-2l-3.854-.815.026.008a3.75 3.75 0 01-7.31-1.549zm1.477.313a2.251 2.251 0 004.356.921l-4.356-.921zm-2.84-3.28L18.157 8h.343v6.5h-.343L5.5 11.823v-1.146z",clipRule:"evenodd"}));window.wp.serverSideRender,r.Component,window.wp.compose,r.Component,r.Component;class u extends r.Component{constructor(e){super(e),a(this,"onChangeColor",(e=>{this.props.setAttributes({color:e})})),a(this,"onFormStyleChange",(e=>{this.props.setAttributes({form_style:e})})),a(this,"onSelectPostType",(e=>{this.props.setAttributes({post_type:e,form_scheme:""})})),a(this,"onSelectFormScheme",(e=>{this.props.setAttributes({form_scheme:e})})),a(this,"onCustomizeQuery",((e,t)=>{var a={...this.props.attributes.query};0===t.length?delete a[e]:a[e]=t,this.props.setAttributes({query:a})})),a(this,"getQueryParam",(e=>void 0===this.props.attributes.query[e]?"":this.props.attributes.query[e])),a(this,"getAvailablePostTypes",(()=>{var e=[{label:"",value:""}];return this.state.post_types.forEach((function(t,a){e.push({label:t.label,value:t.post_type})})),e})),a(this,"getCurrentPostType",(()=>this.state.post_types[0])),a(this,"getSelectedFormScheme",(e=>{if(""===this.props.attributes.form_scheme)return null;for(var t=this.getCurrentPostType(),a=0;a<t.form_schemes[e].length;a++)if(t.form_schemes[e][a].name===this.props.attributes.form_scheme)return t.form_schemes[e][a];return null})),a(this,"getSelectedFormSchemeData",(e=>{var t=this.getSelectedFormScheme(e);return null===t?[]:t.data})),a(this,"getAvailableSearchForms",(e=>{var t=this.getCurrentPostType();return[{label:"",value:""}].concat(t.form_schemes.search)})),a(this,"getCurrentPostType",(()=>this.state.post_types[0])),a(this,"getSelectedFormScheme",(e=>{if(""===this.props.attributes.form_scheme)return null;for(var t=this.getCurrentPostType(),a=0;a<t.form_schemes[e].length;a++)if(t.form_schemes[e][a].name===this.props.attributes.form_scheme)return t.form_schemes[e][a];return null})),a(this,"getSelectedFormSchemeData",(e=>{for(var t=this.getCurrentPostType(),a=[],s=0;s<t.form_schemes[e].length;s++)Object.entries(t.form_schemes[e][s].data).map((([e,t])=>{a.push(t)})),(a=this.getUnique(a,"name")).sort(((e,t)=>e.label>t.label?1:-1));return a})),a(this,"getUnique",((e,t)=>{if("function"!=typeof t){const e=t;t=function(t){return t[e]}}return Array.from(e.reduce((function(e,a){const s=t(a);return e.has(s)||e.set(s,a),e}),new Map).values())})),a(this,"getAvailableSearchForms",(e=>{var t=this.getCurrentPostType();return[{label:"",value:""}].concat(t.form_schemes.search)})),a(this,"getAdvertsListData",(()=>{for(var e=this.getCurrentPostType(),t={builtin:{label:"Builtin",data:e.form_schemes_default.publish},meta:{label:"Custom Fields",data:this.getSelectedFormSchemeData("publish")},taxonomies:{label:"Taxonomies",data:[]}},a=0;a<e.taxonomies.length;a++)t.taxonomies.data.push({name:"taxonomy__"+e.taxonomies[a].name,label:e.taxonomies[a].label});return t})),a(this,"onChangeLayout",(e=>{this.props.setAttributes({layout:e})})),a(this,"onToggleShowAvatar",(e=>{this.props.setAttributes({show_avatar:e})})),a(this,"onChangeAvatarSize",(e=>{this.props.setAttributes({avatar_size:e})})),a(this,"onChangeAvatarRadius",(e=>{this.props.setAttributes({avatar_radius:e})})),a(this,"setDataSecondaryChecked",((e,t)=>{var a=[];this.props.attributes.data_secondary.map((e=>{a.push(e)}));var s=a.indexOf(t);e&&-1===s?a.push(t):!e&&s>=0&&a.splice(s,1),this.props.setAttributes({data_secondary:a})})),a(this,"initVisuals",(()=>{const{post_type:e}=this.props.attributes;""!==e&&this.setState({initiated:!0})})),a(this,"resetVisuals",(()=>{this.props.setAttributes({post_type:""}),this.setState({initiated:!1,loading:!0}),this.runApiFetchForms()})),this.state={initiated:!1,post_types:[],loading:!0,show_instructions:!1},this.initVisuals()}componentDidMount(){this.runApiFetchForms()}runApiFetchForms(){wp.apiFetch({path:"wpadverts/v1/classifieds-types"}).then((e=>{this.setState({post_types:e.data,loading:!1,initiated:""!==this.props.attributes.post_type})}))}getDataOptions(){var e=this.getAdvertsListData(),t=0,a=[{label:"Builtin",options:[]},{label:"Patterns",options:[]},{label:"Custom Fields",options:[]},{label:"Taxonomies",options:[]}];for(t=0;t<e.builtin.data.length;t++)a[e.builtin.data[t].name.startsWith("pattern__")?1:0].options.push({value:e.builtin.data[t].name,label:e.builtin.data[t].label});for(t=0;t<e.meta.data.length;t++)a[2].options.push({value:e.meta.data[t].name,label:e.meta.data[t].label});for(t=0;t<e.taxonomies.data.length;t++)a[3].options.push({value:e.taxonomies.data[t].name,label:e.taxonomies.data[t].label});return a}renderInit(){const{post_type:e}=this.props.attributes,{show_instructions:t}=this.state;return(0,s.createElement)(s.Fragment,null,(0,s.createElement)(l.Placeholder,{icon:i,label:"Classifieds Single Author",instructions:"Select custom post type and search form scheme to continue.",isColumnLayout:"true"},!0===this.state.loading?(0,s.createElement)(l.Spinner,null):(0,s.createElement)(s.Fragment,null,(0,s.createElement)(l.SelectControl,{label:"Custom Post Type",labelPosition:"top",value:e,options:this.getAvailablePostTypes(),onChange:this.onSelectPostType,style:{lineHeight:"1rem"}}),(0,s.createElement)("div",null,(0,s.createElement)(l.Button,{variant:"primary",disabled:""===e,onClick:this.initVisuals},"Apply")))))}render(){const{className:e,attributes:t}=this.props,{layout:a,show_avatar:r,avatar_size:n,avatar_radius:i,data_main:u,data_secondary:h}=t;[].join(" ");const{show_instructions:c}=this.state;return(0,s.createElement)(s.Fragment,null,!0===this.state.initiated?(0,s.createElement)(s.Fragment,null,(0,s.createElement)(o.InspectorControls,null,(0,s.createElement)(l.PanelBody,{title:"Display Options"},(0,s.createElement)(l.SelectControl,{label:"Layout",value:a,options:[{label:"List",value:"list"},{label:"Grid",value:"grid"},{label:"Text",value:"text"}],onChange:this.onChangeLayout})),(0,s.createElement)(l.PanelBody,{title:"Avatar Options"},(0,s.createElement)(l.ToggleControl,{label:"Show Avatar.",checked:r,onChange:this.onToggleShowAvatar}),(0,s.createElement)(l.SelectControl,{label:"Avatar Size",value:n,options:[{label:"16px",value:16},{label:"32px",value:32},{label:"64px",value:64}],onChange:this.onChangeAvatarSize}),(0,s.createElement)(l.SelectControl,{label:"Border Radius",labelPosition:"top",value:i,options:[{label:"None",value:"atw-rounded-none"},{label:"Extra Small",value:"atw-rounded-sm"},{label:"Small",value:"atw-rounded"},{label:"Medium",value:"atw-rounded-md"},{label:"Large",value:"atw-rounded-lg"},{label:"Extra Large",value:"atw-rounded-xl"},{label:"Full",value:"atw-rounded-full"}],onChange:this.onChangeAvatarRadius})),(0,s.createElement)(l.PanelBody,{title:"Data - Main Row"},(0,s.createElement)(l.CheckboxControl,{label:"Name",value:"name",readOnly:"readOnly",checked:!0,onChange:()=>alert("Cannot disable showing a name")})),(0,s.createElement)(l.PanelBody,{title:"Data - Second Row"},(0,s.createElement)(l.CheckboxControl,{label:"Published",value:"published",checked:h.includes("published"),onChange:e=>this.setDataSecondaryChecked(e,"published")}))),(0,s.createElement)(o.BlockControls,null,(0,s.createElement)(l.Toolbar,{controls:[{icon:"controls-repeat",title:"Reset post type and form scheme",onClick:this.resetVisuals}]})),(0,s.createElement)(l.Disabled,null,(0,s.createElement)("div",{class:"atw-flex atw-grow "},r&&(0,s.createElement)("div",{class:"atw-flex-none atw-m-0 atw-pr-4 atw-justify-center -adverts-single-author-avatar"},(0,s.createElement)("img",{alt:"",src:"http://1.gravatar.com/avatar/496c0741682ce4dc7c7f73ca4fe8dc5e?s=64&d=mm&r=g",class:"avatar avatar-64 photo atw-m-0 atw-p-0 atw-block "+i,loading:"lazy",decoding:"async",width:n,height:n})),(0,s.createElement)("div",{class:"atw-flex atw-flex-col atw-grow atw-justify-center -adverts-single-author-name"},(0,s.createElement)("div",{class:"atw-block"},(0,s.createElement)("span",{class:"atw-font-bold atw-text-gray-700 atw-text-xl"},"John Doe")),(0,s.createElement)("div",{class:"atw-block"},h.includes("published")&&(0,s.createElement)("span",{class:"atw-text-gray-500 atw-text-base"},"Published 17/07/2023 - 2 hours ago")))))):(0,s.createElement)(s.Fragment,null,this.renderInit()))}}const h=u,c=JSON.parse('{"name":"wpadverts/single-author","textdomain":"wpadverts","apiVersion":1,"title":"Classifieds Single Author","icon":"megaphone","category":"wpadverts","example":{},"attributes":{"post_type":{"type":"string","default":""},"layout":{"type":"string","default":"list"},"show_avatar":{"type":"boolean","default":true},"avatar_size":{"type":"int","default":64},"avatar_radius":{"type":"string","default":"atw-rounded-full"},"data_main":{"type":"array","default":[]},"data_secondary":{"type":"array","default":["published"]}}}');(0,e.registerBlockType)(c,{edit:h,save:({attributes:e})=>null})})();