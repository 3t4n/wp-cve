(()=>{"use strict";window.wp.i18n;const e=window.wp.blocks;function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function o(e,o,a){return l=function(e,o){if("object"!=t(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,"string");if("object"!=t(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==t(l)?l:String(l))in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e;var l}const a=window.React,l=window.wp.element,n=window.wp.blockEditor,s=window.wp.components,r=window.wp.primitives,i=(0,a.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(r.Path,{fillRule:"evenodd",d:"M6.863 13.644L5 13.25h-.5a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5H5L18 6.5h2V16h-2l-3.854-.815.026.008a3.75 3.75 0 01-7.31-1.549zm1.477.313a2.251 2.251 0 004.356.921l-4.356-.921zm-2.84-3.28L18.157 8h.343v6.5h-.343L5.5 11.823v-1.146z",clipRule:"evenodd"})),h=window.lodash,{Component:p,RawHTML:c,Fragment:d}=wp.element,{__,sprintf:m}=wp.i18n,u=wp.apiFetch,{addQueryArgs:g}=wp.url,{Placeholder:C,Spinner:b}=wp.components;class v extends p{constructor(e){super(e),this.state={response:null,prevResponse:null}}componentDidMount(){this.isStillMounted=!0,this.fetch(this.props),this.fetch=(0,h.debounce)(this.fetch,500)}componentWillUnmount(){this.isStillMounted=!1}componentDidUpdate(e){(0,h.isEqual)(e,this.props)||this.fetch(this.props)}fetch(e){if(!this.isStillMounted)return;null!==this.state.response&&this.setState((e=>({response:null,prevResponse:e.response})));const{block:t,attributes:o=null,urlQueryArgs:a={}}=e;if("post"==this.props.method)var l="POST",n={},s={uses_payload:!0,...o};else l="GET",n=o,s=null;const r=function(e,t=null,o={}){return g(`/wp/v2/block-renderer/${e}`,{context:"edit",payload:"0",...null!==t?{attributes:t}:{},...o})}(t,n,a),i=this.currentFetchRequest=u({path:r,method:l,data:s}).then((e=>{this.isStillMounted&&i===this.currentFetchRequest&&e&&this.setState({response:e.rendered})})).catch((e=>{this.isStillMounted&&i===this.currentFetchRequest&&this.setState({response:{error:!0,errorMsg:e.message}})}));return i}render(){const{right:e,top:t,unit:o}=this.props.spinnerLocation,l=this.state.response,n=this.state.prevResponse;let s="";null!==n&&(s=`<div style="position:relative;"><div style="position:absolute;right:${e}${o};top:${t}${o}"><span class="components-spinner"></span></div>${n}</div>`);const{className:r,EmptyResponsePlaceholder:i,ErrorResponsePlaceholder:h,LoadingResponsePlaceholder:p}=this.props;return""===l?(0,a.createElement)(i,{response:l,...this.props}):l?l.error?(0,a.createElement)(h,{response:l,...this.props}):(0,a.createElement)(c,{key:"html",className:r},l):(0,a.createElement)(d,null,(0,a.createElement)(c,{key:"html",className:r},s))}}v.defaultProps={spinnerLocation:{right:0,top:10,unit:"px"},EmptyResponsePlaceholder:({className:e})=>(0,a.createElement)(C,{className:e},__("Block rendered as empty.")),ErrorResponsePlaceholder:({response:e,className:t})=>{const o=m(
// translators: %s: error message describing the problem
__("Error loading block: %s"),e.errorMsg);return(0,a.createElement)(C,{className:t},o)},LoadingResponsePlaceholder:({className:e})=>(0,a.createElement)(C,{className:e},(0,a.createElement)(b,null))};const y=v;window.wp.compose;class E extends l.Component{constructor(e){super(e),o(this,"togglePopover",(()=>{this.setState({popover:!this.state.popover})})),o(this,"setColor",(e=>{console.log(e),this.setState({color:e.hex})})),o(this,"applyColor",(()=>{this.value=this.state.color,this.setState({popover:!1,color:null}),this.props.onChange(this.value)})),o(this,"cancelColor",(()=>{this.setState({popover:!1,color:null})})),o(this,"resetColor",(()=>{this.value="",this.setState({popover:!1,color:null}),this.props.onChange(this.value)})),this.state={popover:!1,color:null},this.value=this.props.value}render(){const{value:e,label:t,labelPosition:o}=this.props;return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.BaseControl,{label:t,labelPosition:"top"},(0,a.createElement)("div",{className:"wpa-color-indicator-wrap"},(0,a.createElement)("span",{className:"wpa-color-indicator",style:{background:this.value}}),(0,a.createElement)(s.Button,{variant:"secondary",isSmall:"true",onClick:this.togglePopover},"Select Color"),(0,a.createElement)(s.Button,{variant:"link",onClick:this.resetColor},"Reset")),!0===this.state.popover&&(0,a.createElement)(s.Popover,null,(0,a.createElement)(s.ColorPicker,{style:{padding:"5px"},color:this.value,onChangeComplete:this.setColor,enableAlpha:!0,defaultValue:"#000"}),(0,a.createElement)("div",{style:{padding:"0px 16px 12px 16px"}},(0,a.createElement)(s.Button,{onClick:this.applyColor,variant:"primary"},"Apply"),"Â ",(0,a.createElement)(s.Button,{onClick:this.cancelColor,variant:"secondary"},"Cancel")))))}}const w=E;class S extends l.Component{constructor(e){super(e),o(this,"onTextChange",(e=>{this.data.text=e,this.props.onChange(this.data)})),o(this,"onDesktopClick",(e=>{console.log(e),this.data.desktop=e,this.props.onChange(this.data)})),o(this,"onMobileClick",(e=>{this.data.mobile=e,this.props.onChange(this.data)})),o(this,"onColorTextChange",(e=>{this.data.color_text=e,this.props.onChange(this.data)})),o(this,"onColorBgChange",(e=>{this.data.color_bg=e,this.props.onChange(this.data)})),o(this,"onColorBorderChange",(e=>{this.data.color_border=e,this.props.onChange(this.data)})),o(this,"onColorTextHoverChange",(e=>{this.data.color_text_h=e,this.props.onChange(this.data)})),o(this,"onColorBgHoverChange",(e=>{this.data.color_bg_h=e,this.props.onChange(this.data)})),o(this,"onColorBorderHoverChange",(e=>{this.data.color_border_h=e,this.props.onChange(this.data)})),o(this,"onModeToggleClick",(e=>{this.setState({mode:e})})),o(this,"togglePopover",(()=>{this.setState({popover_is_visible:!this.state.popover_is_visible})})),o(this,"setPopoverMode",(e=>{this.setState({popover_mode:e,popover_is_visible:!1})})),o(this,"onBorderRadiusChange",(e=>{this.data.border_radius=e,this.props.onChange(this.data)})),o(this,"onBorderWidthChange",(e=>{this.data.border_width=e,this.props.onChange(this.data)})),o(this,"onCustomizeChange",(e=>{this.data.customize=!0===e?1:0,this.props.onChange(this.data)})),this.data={text:"",desktop:"",mobile:"",border_radius:"",border_width:"",color_text:"",color_bg:"",color_border:"",color_text_h:"",color_bg_h:"",color_border_h:"",customize:0,...e.data},console.log(this.data),this.state={mode:"normal",popover_mode:"desktop",popover_is_visible:!1}}shouldComponentUpdate(e){return!0}render(){const{desktop:e,mobile:t,text:o,border_radius:l,border_width:n,color_text:r,color_bg:i,color_border:h,color_text_h:p,color_bg_h:c,color_border_h:d,customize:m}=this.data,{mode:u,popover_is_visible:g,popover_mode:C}=this.state,b=[{name:"white",color:"#FFFFFF"},{name:"black",color:"#000000"},{name:"red",color:"#B91C1C"},{name:"yellow",color:"#B45309"},{name:"green",color:"#047857"},{name:"blue",color:"#1D4ED8"},{name:"indigo",color:"#4338CA"},{name:"purple",color:"#6D28D9"}],v=[{name:"white",color:"#FFFFFF"},{name:"black",color:"#000000"},{name:"red",color:"#B91C1C"},{name:"yellow",color:"#B45309"},{name:"green",color:"#047857"},{name:"blue",color:"#1D4ED8"},{name:"indigo",color:"#4338CA"},{name:"purple",color:"#fff000"}];return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.Panel,null,(0,a.createElement)(s.PanelBody,{title:this.props.title,initialOpen:this.props.initialOpen},(0,a.createElement)(s.TextControl,{label:"Button Text",placeholder:this.props.placeholder,value:o,onChange:this.onTextChange}),(0,a.createElement)(s.BaseControl,null,"Button Display",(0,a.createElement)(s.Button,{variant:"tertiary",isSmall:!0,onClick:this.togglePopover},(0,a.createElement)("span",{className:"fas fa-"+C}),g&&(0,a.createElement)(s.Popover,{position:"bottom center"},(0,a.createElement)(s.Button,{onClick:e=>this.setPopoverMode("desktop"),style:{display:"inline-block",width:"100%"},variant:"secondary",isSmall:!0},(0,a.createElement)("span",{className:"fas fa-desktop"})),(0,a.createElement)(s.Button,{onClick:e=>this.setPopoverMode("mobile"),style:{display:"inline-block",width:"100%"},variant:"secondary",isSmall:!0},(0,a.createElement)("span",{className:"fas fa-mobile-alt"})))),"desktop"==C&&(0,a.createElement)(s.SelectControl,{value:e,options:[{label:"Text",value:"text"},{label:"Icon",value:"icon"},{label:"Text and Icon",value:"text-and-icon"}],onChange:this.onDesktopClick}),"mobile"===C&&(0,a.createElement)(s.SelectControl,{value:t,options:[{label:"Text",value:"text"},{label:"Icon",value:"icon"},{label:"Text and Icon",value:"text-and-icon"}],onChange:this.onMobileClick})),(0,a.createElement)(s.ToggleControl,{label:"Customize the default form styling",checked:m,onChange:this.onCustomizeChange}),(0,a.createElement)("div",{className:"wpa-block-editor-common-tip"},"The default button styling (applied to all WPAdverts buttons) you can change in the ",(0,a.createElement)("a",{href:"http://localhost/wpadverts/wp-admin/edit.php?post_type=advert&page=adverts-extensions&module=styling",target:"_blank"},"Styling Settings"),"."),1===m&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.BaseControl,{label:"Border Radius"},(0,a.createElement)(s.RangeControl,{min:"0",max:"6",step:"1",xmarks:[{value:0,label:"None"},{value:1,label:"XS"},{value:2,label:"S"},{value:3,label:"M"},{value:4,label:"L"},{value:5,label:"XL"},{value:6,label:"Full"}],showTooltip:!1,withInputField:!1,value:l,onChange:this.onBorderRadiusChange})),(0,a.createElement)(s.BaseControl,{label:"Border Width"},(0,a.createElement)(s.RangeControl,{min:"0",max:"3",step:"1",xmarks:[{value:0,label:"None"},{value:1,label:"Thin"},{value:2,label:"Thick"},{value:3,label:"Extra Thick"}],showTooltip:!1,withInputField:!1,value:n,onChange:this.onBorderWidthChange})),(0,a.createElement)(s.ButtonGroup,{style:{width:"100%"}},(0,a.createElement)(s.Flex,{className:"wpa-space-bottom",justify:"space-between"},(0,a.createElement)(s.Button,{style:{width:"100%",justifyContent:"center"},variant:"secondary",isPressed:"normal"===u,onClick:e=>this.onModeToggleClick("normal")},"Normal"),(0,a.createElement)(s.Button,{style:{width:"100%",justifyContent:"center"},variant:"secondary",isPressed:"hover"===u,onClick:e=>this.onModeToggleClick("hover")},"Hover"))),"normal"==u&&(0,a.createElement)("div",null,(0,a.createElement)(s.BaseControl,{label:"Text Color"},(0,a.createElement)(w,{value:r,onChange:this.onColorTextChange})),(0,a.createElement)(s.BaseControl,{label:"Background Color"},(0,a.createElement)(w,{colors:b,value:i,onChange:this.onColorBgChange})),(0,a.createElement)(s.BaseControl,{label:"Border Color"},(0,a.createElement)(w,{colors:b,value:h,onChange:this.onColorBorderChange}))),"hover"==u&&(0,a.createElement)("div",null,(0,a.createElement)(s.BaseControl,{label:"Text Color"},(0,a.createElement)(w,{colors:v,value:p,onChange:this.onColorTextHoverChange})),(0,a.createElement)(s.BaseControl,{label:"Background Color"},(0,a.createElement)(w,{colors:v,value:c,onChange:this.onColorBgHoverChange})),(0,a.createElement)(s.BaseControl,{label:"Border Color"},(0,a.createElement)(w,{colors:v,value:d,onChange:this.onColorBorderHoverChange})))))))}}const f=S;class _ extends l.Component{constructor(e){super(e),o(this,"onPaletteChange",(e=>{this.data.palette=e,this.props.onChange(this.data)})),o(this,"onStyleChange",(e=>{this.data.style=e,this.props.onChange(this.data)})),o(this,"onShadowChange",(e=>{this.data.shadow=e,this.props.onChange(this.data)})),o(this,"onRoundedChange",(e=>{this.data.rounded=e,this.props.onChange(this.data)})),o(this,"onBorderChange",(e=>{this.data.border=e,this.props.onChange(this.data)})),o(this,"onPXChange",(e=>{this.data.px=e,this.props.onChange(this.data)})),o(this,"onPYChange",(e=>{this.data.py=e,this.props.onChange(this.data)})),o(this,"onCustomizeChange",(e=>{this.data.customize=!0===e?1:0,this.props.onChange(this.data)})),o(this,"void",(e=>{this.props.onChange(this.data)})),this.data={style:"wpa-solid",shadow:"wpa-none",palette:"cool-gray",rounded:"3",px:"",py:"",border:"1",customize:0,...e.data},this.state={}}render(){const{style:e,shadow:t,palette:o,rounded:l,px:n,py:r,border:i,customize:h}=this.data,{}=this.state;return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.Panel,null,(0,a.createElement)(s.PanelBody,{title:this.props.title,initialOpen:this.props.initialOpen},(0,a.createElement)(s.ToggleControl,{label:"Customize the default form styling",checked:h,onChange:this.onCustomizeChange}),(0,a.createElement)("div",{className:"wpa-block-editor-common-tip"},"The default form styling (applied to all WPAdverts form by default) you can change in the ",(0,a.createElement)("a",{href:"http://localhost/wpadverts/wp-admin/edit.php?post_type=advert&page=adverts-extensions&module=styling",target:"_blank"},"Styling Settings"),"."),1===h&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.SelectControl,{label:"Color Palette",labelPosition:"top",value:o,options:[{label:"Blue Gray",value:"blue-gray"},{label:"Cool Gray",value:"cool-gray"},{label:"Gray",value:"gray"},{label:"True Gray",value:"true-gray"},{label:"Warm Gray",value:"warm-gray"}],onChange:this.onPaletteChange}),(0,a.createElement)(s.SelectControl,{label:"Style",labelPosition:"top",value:e,options:[{label:"None (default styling)",value:"wpa-unstyled"},{label:"Flat",value:"wpa-flat"},{label:"Solid",value:"wpa-solid"},{label:"Bottom Border",value:"wpa-bottom-border"}],onChange:this.onStyleChange}),(0,a.createElement)(s.SelectControl,{label:"Shadow",labelPosition:"top",value:t,options:[{label:"None (default styling)",value:"wpa-shadow-none"},{label:"Small",value:"wpa-shadow-sm"},{label:"Medium",value:"wpa-shadow-md"},{label:"Inside",value:"wpa-shadow-inside"}],onChange:this.onShadowChange}),(0,a.createElement)(s.BaseControl,{label:"Border Width"},(0,a.createElement)(s.RangeControl,{min:"0",max:"3",step:"1",xmarks:[{value:0,label:"None"},{value:1,label:"Thin"},{value:2,label:"Thick"},{value:3,label:"Extra Thick"}],showTooltip:!1,withInputField:!1,value:i,onChange:this.onBorderChange})),(0,a.createElement)(s.BaseControl,{label:"Round Corners"},(0,a.createElement)(s.RangeControl,{min:"0",max:"6",step:"1",xmarks:[{value:0,label:"None"},{value:1,label:"XS"},{value:2,label:"S"},{value:3,label:"M"},{value:4,label:"L"},{value:5,label:"XL"},{value:6,label:"Full"}],showTooltip:!1,withInputField:!1,value:l,onChange:this.onRoundedChange})),(0,a.createElement)(s.TextControl,{label:"Padding - Horizontal",type:"number",value:n,onChange:this.onPXChange}),(0,a.createElement)(s.TextControl,{label:"Padding - Vertical",type:"number",value:r,onChange:this.onPYChange})))))}}const x=_;class B extends l.Component{constructor(e){super(e),o(this,"onFormSchemeChange",(e=>{this.props.setAttributes({form_scheme:e})})),o(this,"onPartialPrimaryButtonChange",(e=>{this.props.setAttributes({primary_button:{...e}})})),o(this,"onPartialSecondaryButtonChange",(e=>{this.props.setAttributes({secondary_button:{...e}})})),o(this,"onPartialFormChange",(e=>{this.props.setAttributes({form:{...e}})})),o(this,"onButtonsPositionChange",(e=>{console.log(e),this.props.setAttributes({buttons_pos:e})})),o(this,"onSelectPostType",(e=>{this.props.setAttributes({post_type:e,form_scheme:""})})),o(this,"onSelectFormScheme",(e=>{this.props.setAttributes({form_scheme:e})})),o(this,"onSetRedirectTo",(e=>{this.props.setAttributes({redirect_to:e})})),o(this,"getAvailablePostTypes",(()=>{var e=[{label:"",value:""}];return this.state.post_types.forEach((function(t,o){e.push({label:t.label,value:t.post_type})})),e})),o(this,"getAvailableSearchForms",(e=>[{label:"",value:""}].concat(this.state.post_types[0].form_schemes.search))),o(this,"initVisuals",(()=>{const{post_type:e,form_scheme:t}=this.props.attributes;""!==e&&this.setState({initiated:!0})})),o(this,"resetVisuals",(()=>{this.props.setAttributes({post_type:"",form_scheme:""}),this.setState({initiated:!1,loading:!0}),this.runApiFetchForms()})),this.state={initiated:!1,post_types:[],loading:!0},this.initVisuals()}componentDidMount(){this.runApiFetchForms()}runApiFetchForms(){wp.apiFetch({path:"wpadverts/v1/classifieds-types"}).then((e=>{this.setState({post_types:e.data,loading:!1,initiated:""!==this.props.attributes.post_type}),console.log(this.state)}))}render(){const{className:e,attributes:t}=this.props,{post_type:o,form_scheme:l,form:r,primary_button:h,secondary_button:p,buttons_pos:c,redirect_to:d}=t;return(0,a.createElement)(a.Fragment,null,!0===this.state.initiated?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(n.InspectorControls,{className:"wpa-admin"},(0,a.createElement)(s.PanelBody,{title:"Options"},(0,a.createElement)(s.BaseControl,{label:"Custom Post Type",help:"",style:{paddingBottom:"12px"}},(0,a.createElement)("div",null,(0,a.createElement)("code",null,o))),(0,a.createElement)(s.BaseControl,{label:"Seach Form Scheme",help:"",style:{paddingBottom:"12px"}},(0,a.createElement)(s.SelectControl,{value:l,options:this.getAvailableSearchForms(),onChange:this.onSelectFormScheme}),(0,a.createElement)("p",{style:{fontSize:"12px",color:"rgb(117,117,117)",marginTop:"-12px"}},"To use custom search form you need the ",(0,a.createElement)("a",{href:"#"},"Custom Fields")," extension.")),(0,a.createElement)("div",null,(0,a.createElement)(s.SelectControl,{label:"Search and Filter Buttons Position",labelPosition:"top",value:c,options:[{label:"On the right side",value:"atw-flex-row"},{label:"Below the search form",value:"atw-flex-col"}],onChange:this.onButtonsPositionChange})),(0,a.createElement)(s.TextControl,{label:"Redirect To",labelPosition:"top",value:d,onChange:this.onSetRedirectTo})),(0,a.createElement)(x,{title:"Styling / Form",onChange:this.onPartialFormChange,data:r,initialOpen:!1}),(0,a.createElement)(f,{title:"Styling / Primary Button",placeholder:"Search",onChange:this.onPartialPrimaryButtonChange,data:h,initialOpen:!1}),(0,a.createElement)(f,{title:"Styling / Secondary Button",placeholder:"Filter",onChange:this.onPartialSecondaryButtonChange,data:p,initialOpen:!1})),(0,a.createElement)(n.BlockControls,null,(0,a.createElement)(s.Toolbar,{controls:[{icon:"controls-repeat",title:"Reset post type and form scheme",onClick:this.resetVisuals}]})),(0,a.createElement)(s.Disabled,null,(0,a.createElement)(y,{block:"wpadverts/search",attributes:this.props.attributes,spinnerLocation:{right:0,top:10,unit:"px"},method:"get"}))):(0,a.createElement)(s.Placeholder,{icon:i,label:"Classifieds Search Form",instructions:"Select custom post type and search form scheme to continue.",isColumnLayout:"true"},!0===this.state.loading?(0,a.createElement)(s.Spinner,null):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.SelectControl,{label:"Custom Post Type",labelPosition:"top",value:o,options:this.getAvailablePostTypes(),onChange:this.onSelectPostType,style:{lineHeight:"1rem"}}),""!==o&&(0,a.createElement)(s.SelectControl,{label:"Search Form Scheme",labelPosition:"top",value:l,options:this.getAvailableSearchForms(o),onChange:this.onSelectFormScheme,style:{lineHeight:"1rem"}}),(0,a.createElement)("div",null,(0,a.createElement)(s.Button,{variant:"primary",disabled:""===o,onClick:this.initVisuals},"Apply")))))}}const P=B,k=JSON.parse('{"name":"wpadverts/search","textdomain":"wpadverts","apiVersion":1,"title":"Classifieds Search","icon":"megaphone","category":"wpadverts","example":{},"attributes":{"post_type":{"type":"string","default":""},"form_scheme":{"type":"string","default":""},"form":{"type":"object","default":{}},"primary_button":{"type":"object","default":{"desktop":"icon","mobile":"text-and-icon","text":"Search"}},"secondary_button":{"type":"object","default":{"desktop":"icon","mobile":"text-and-icon","text":"Filter"}},"buttons_pos":{"type":"string","default":"atw-flex-row"},"redirect_to":{"type":"string","default":""}}}');(0,e.registerBlockType)(k,{edit:P,save:({attributes:e})=>null})})();