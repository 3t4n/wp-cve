{"version":3,"file":"../../js/llms-metabox-students.min.js","sources":["llms-metabox-students.js"],"sourcesContent":["/**\n * LifterLMS Students Metabox Functions\n *\n * @package LifterLMS/Scripts\n *\n * @since 3.0.0\n * @version 3.33.0\n */\n\n/**\n * LifterLMS Students Metabox Functions\n *\n * @since 3.0.0\n * @since 3.33.0 Added the logic to handle the Student's enrollment deletion.\n */\n( function( $, undefined ) {\n\n\twindow.llms = window.llms || {};\n\n\tvar MetaboxStudents = function() {\n\n\t\t/**\n\t\t * Initialize\n\t\t *\n\t\t * @return void\n\t\t * @since  3.0.0\n\t\t * @version  3.0.0\n\t\t */\n\t\tthis.init = function() {\n\n\t\t\tvar screens = [ 'course', 'llms_membership' ];\n\n\t\t\tif ( window.llms.post.post_type && -1 !== screens.indexOf( window.llms.post.post_type ) ) {\n\n\t\t\t\tthis.$metabox = $( '#lifterlms-students' );\n\n\t\t\t\tthis.bind();\n\t\t\t}\n\n\t\t};\n\n\t\t/**\n\t\t * Bind dom events\n\t\t *\n\t\t * @since 3.0.0\n\t\t * @since 3.4.0 Unknown.\n\t\t * @since 3.33.0 Added enrollment deletion handlers.\n\t\t *\n\t\t * @return void\n\t\t */\n\t\tthis.bind = function() {\n\n\t\t\tvar self = this;\n\n\t\t\tthis.$metabox.on( 'click', 'a.llms-remove-student', function( e ) {\n\t\t\t\te.preventDefault();\n\t\t\t\tself.remove_student( $( this ) );\n\t\t\t} );\n\n\t\t\tthis.$metabox.on( 'click', 'a.llms-delete-enrollment', function( e ) {\n\t\t\t\te.preventDefault();\n\t\t\t\tself.delete_student_enrollment( $( this ) );\n\t\t\t} );\n\n\t\t\tthis.$metabox.on( 'click', 'a.llms-add-student', function( e ) {\n\t\t\t\te.preventDefault();\n\t\t\t\tself.add_student( $( this ) );\n\t\t\t} );\n\n\t\t\t$( '#llms-add-student-select' ).llmsStudentsSelect2( { multiple: true } );\n\n\t\t\t$( '#llms-enroll-students' ).on( 'click', function() {\n\t\t\t\tself.enroll_students( $( this ) );\n\t\t\t} );\n\n\t\t};\n\n\t\t/**\n\t\t * Add a Student\n\t\t *\n\t\t * @param    obj  $el  jQuery selector of the add button\n\t\t * @since    3.0.0\n\t\t * @version  3.0.0\n\t\t */\n\t\tthis.add_student = function( $el ) {\n\t\t\tthis.update_student_enrollment( $el.attr( 'data-id' ), 'add' );\n\t\t};\n\n\t\t/**\n\t\t * Handle bulk enrollment via \"Enroll New Students\" area\n\t\t *\n\t\t * @param    obj   $el  jQuery selector for the triggering button\n\t\t * @return   void\n\t\t * @since    3.0.0\n\t\t * @version  3.4.0\n\t\t */\n\t\tthis.enroll_students = function( $el ) {\n\n\t\t\tvar self       = this,\n\t\t\t\t$select    = $( '#llms-add-student-select' ),\n\t\t\t\tids        = $select.val(),\n\t\t\t\t$container = this.$metabox.find( '.llms-metabox-students-add-new' );\n\n\t\t\tLLMS.Spinner.start( $container );\n\n\t\t\twindow.LLMS.Ajax.call( {\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'bulk_enroll_students',\n\t\t\t\t\tstudent_ids: ids,\n\t\t\t\t},\n\t\t\t\tbeforeSend: function( xhr ) {\n\t\t\t\t\tif ( ! ids ) {\n\t\t\t\t\t\t$el.before( '<span class=\"llms-error\">' + LLMS.l10n.translate( 'Please select a student to enroll' ) + '</span>' );\n\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\tLLMS.Spinner.stop( $container );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsuccess: function( r ) {\n\n\t\t\t\t\t$select.val( null ).trigger( 'change' );\n\t\t\t\t\tLLMS.Spinner.stop( $container );\n\t\t\t\t\twindow.llms.admin_tables.reload( $( '#llms-gb-table-student-management' ) );\n\n\t\t\t\t},\n\t\t\t} );\n\n\t\t};\n\n\t\t/**\n\t\t * Remove a Student\n\t\t *\n\t\t * @param    obj  $el  jQuery selector of the add button\n\t\t * @since    3.0.0\n\t\t * @version  3.0.0\n\t\t */\n\t\tthis.remove_student = function( $el ) {\n\t\t\tthis.update_student_enrollment( $el.attr( 'data-id' ), 'remove' );\n\t\t};\n\n\t\t/**\n\t\t * Delete a Student's enrollment.\n\t\t *\n\t\t * @since 3.33.0\n\t\t *\n\t\t * @param  obj  $el  jQuery selector of the add button.\n\t\t * @return void\n\t\t */\n\t\tthis.delete_student_enrollment = function( $el ) {\n\t\t\tthis.update_student_enrollment( $el.attr( 'data-id' ), 'delete' );\n\t\t};\n\n\t\t/**\n\t\t * Execute AJAX call, add spinners, update html view\n\t\t *\n\t\t * @since 3.0.0\n\t\t *\n\t\t * @param int id Student id.\n\t\t * @param string status New status [add|remove|delete].\n\t\t * @return void\n\t\t */\n\t\tthis.update_student_enrollment = function( id, status ) {\n\n\t\t\tvar $table     = $( '#llms-gb-table-student-management' ),\n\t\t\t\t$container = $table.closest( '.llms-table-wrap' );\n\n\t\t\tLLMS.Spinner.start( $container );\n\n\t\t\twindow.LLMS.Ajax.call( {\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'update_student_enrollment',\n\t\t\t\t\tstatus: status,\n\t\t\t\t\tstudent_id: id,\n\t\t\t\t},\n\t\t\t\tsuccess: function() {\n\t\t\t\t\t// spinner doesn't stop because the table reloader will stop it\n\t\t\t\t\twindow.llms.admin_tables.reload( $table );\n\t\t\t\t},\n\t\t\t} );\n\n\t\t};\n\n\t\t// go\n\t\tthis.init();\n\n\t};\n\n\t// initialize the object\n\twindow.llms.MetaboxStudents = new MetaboxStudents();\n\n} )( jQuery );\n"],"names":["$","window","llms","MetaboxStudents","this","init","post","post_type","indexOf","$metabox","bind","self","on","e","preventDefault","remove_student","delete_student_enrollment","add_student","llmsStudentsSelect2","multiple","enroll_students","$el","update_student_enrollment","attr","$select","ids","val","$container","find","LLMS","Spinner","start","Ajax","call","data","action","student_ids","beforeSend","xhr","before","l10n","translate","abort","stop","success","r","trigger","admin_tables","reload","id","status","$table","closest","student_id","jQuery"],"mappings":"AAeA,CAAA,SAAYA,GAEXC,OAAOC,KAAOD,OAAOC,MAAQ,GA0K7BD,OAAOC,KAAKC,gBAAkB,IAxKR,WASrBC,KAAKC,KAAO,WAINJ,OAAOC,KAAKI,KAAKC,WAAa,CAAC,IAFtB,CAAE,SAAU,mBAEwBC,QAASP,OAAOC,KAAKI,KAAKC,SAAU,IAErFH,KAAKK,SAAWT,EAAG,qBAAsB,EAEzCI,KAAKM,KAAK,EAGZ,EAWAN,KAAKM,KAAO,WAEX,IAAIC,EAAOP,KAEXA,KAAKK,SAASG,GAAI,QAAS,wBAAyB,SAAUC,GAC7DA,EAAEC,eAAe,EACjBH,EAAKI,eAAgBf,EAAGI,IAAK,CAAE,CAChC,CAAE,EAEFA,KAAKK,SAASG,GAAI,QAAS,2BAA4B,SAAUC,GAChEA,EAAEC,eAAe,EACjBH,EAAKK,0BAA2BhB,EAAGI,IAAK,CAAE,CAC3C,CAAE,EAEFA,KAAKK,SAASG,GAAI,QAAS,qBAAsB,SAAUC,GAC1DA,EAAEC,eAAe,EACjBH,EAAKM,YAAajB,EAAGI,IAAK,CAAE,CAC7B,CAAE,EAEFJ,EAAG,0BAA2B,EAAEkB,oBAAqB,CAAEC,SAAU,CAAA,CAAK,CAAE,EAExEnB,EAAG,uBAAwB,EAAEY,GAAI,QAAS,WACzCD,EAAKS,gBAAiBpB,EAAGI,IAAK,CAAE,CACjC,CAAE,CAEH,EASAA,KAAKa,YAAc,SAAUI,GAC5BjB,KAAKkB,0BAA2BD,EAAIE,KAAM,SAAU,EAAG,KAAM,CAC9D,EAUAnB,KAAKgB,gBAAkB,SAAUC,GAEhC,IACCG,EAAaxB,EAAG,0BAA2B,EAC3CyB,EAAaD,EAAQE,IAAI,EACzBC,EAAavB,KAAKK,SAASmB,KAAM,gCAAiC,EAEnEC,KAAKC,QAAQC,MAAOJ,CAAW,EAE/B1B,OAAO4B,KAAKG,KAAKC,KAAM,CACtBC,KAAM,CACLC,OAAQ,uBACRC,YAAaX,CACd,EACAY,WAAY,SAAUC,GACdb,IACNJ,EAAIkB,OAAQ,4BAA8BV,KAAKW,KAAKC,UAAW,mCAAoC,EAAI,SAAU,EACjHH,EAAII,MAAM,EACVb,KAAKC,QAAQa,KAAMhB,CAAW,EAEhC,EACAiB,QAAS,SAAUC,GAElBrB,EAAQE,IAAK,IAAK,EAAEoB,QAAS,QAAS,EACtCjB,KAAKC,QAAQa,KAAMhB,CAAW,EAC9B1B,OAAOC,KAAK6C,aAAaC,OAAQhD,EAAG,mCAAoC,CAAE,CAE3E,CACD,CAAE,CAEH,EASAI,KAAKW,eAAiB,SAAUM,GAC/BjB,KAAKkB,0BAA2BD,EAAIE,KAAM,SAAU,EAAG,QAAS,CACjE,EAUAnB,KAAKY,0BAA4B,SAAUK,GAC1CjB,KAAKkB,0BAA2BD,EAAIE,KAAM,SAAU,EAAG,QAAS,CACjE,EAWAnB,KAAKkB,0BAA4B,SAAU2B,EAAIC,GAE9C,IAAIC,EAAanD,EAAG,mCAAoC,EACvD2B,EAAawB,EAAOC,QAAS,kBAAmB,EAEjDvB,KAAKC,QAAQC,MAAOJ,CAAW,EAE/B1B,OAAO4B,KAAKG,KAAKC,KAAM,CACtBC,KAAM,CACLC,OAAQ,4BACRe,OAAQA,EACRG,WAAYJ,CACb,EACAL,QAAS,WAER3C,OAAOC,KAAK6C,aAAaC,OAAQG,CAAO,CACzC,CACD,CAAE,CAEH,EAGA/C,KAAKC,KAAK,CAEX,CAKC,EAAGiD,MAAO","sourceRoot":"../../js"}