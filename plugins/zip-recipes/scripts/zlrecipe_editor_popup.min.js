(function(){tinymce.create("tinymce.plugins.zrdnEditRecipe",{init:function(d,b){var c=this;c.url=b;d.onBeforeSetContent.add(function(f,g){g.content=c._convert_codes_to_imgs(g.content)});d.onExecCommand.add(function(f,g){if(g==="mceInsertContent"){var h=tinyMCE.activeEditor.selection.getBookmark();tinyMCE.activeEditor.setContent(c._convert_codes_to_imgs(tinyMCE.activeEditor.getContent()));tinyMCE.activeEditor.selection.moveToBookmark(h)}});d.onPostProcess.add(function(f,g){if(g.get){g.content=c._convert_imgs_to_codes(g.content)}});var e=jQuery("body");var a={overflow:e.css("overflow"),position:e.css("position")};d.addButton("zrdn_buttons",{title:"Zip Recipes",image:b+"/../images/zip-recipes-icon-20.png",onclick:function(){var h=null;var j=d.dom.select("img.amd-zlrecipe-recipe")[0];if(j){d.selection.select(j);h=/amd-zlrecipe-recipe-([0-9]+)/i.exec(d.selection.getNode().id);d.selection.collapse()}var f=baseurl+"/wp-admin/media-upload.php?recipe_post_id="+((h)?"1-"+h[1]:post_id)+"&type=z_recipe&tab=amd_zlrecipe&TB_iframe=true&width=640&height=523&post_id="+post_id;var g=Math.min(780,Math.max(document.documentElement.clientWidth,window.innerWidth||0)-20);var i=Math.min(600,Math.max(document.documentElement.clientHeight,window.innerHeight||0)-36*3-jQuery(window.parent.document.getElementById("wpadminbar")).height());d.windowManager.open({title:j?"Edit Recipe":"Add a Recipe",url:f,width:g,height:i,onClose:function(k){if(g<780){e.css("overflow",a.overflow);e.css("position",a.position)}}},{editor:d,width:g})}})},_convert_codes_to_imgs:function(a){if(a.indexOf("amd-zlrecipe-recipe")!==-1){return a.replace(/\[amd-zlrecipe-recipe:([0-9]+)\]/g,function(d,c){return'<img id="amd-zlrecipe-recipe-'+c+'" class="amd-zlrecipe-recipe" src="'+plugindir+'/images/zip-recipes-placeholder.png" alt="" />'})}else{return a.replace(/\[zrdn-recipe id="([0-9]+)"\]/g,function(d,c){return'<img id="amd-zlrecipe-recipe-'+c+'" class="amd-zlrecipe-recipe" src="'+plugindir+'/images/zip-recipes-placeholder.png" alt="" />'})}},_convert_imgs_to_codes:function(a){return a.replace(/\<img[^>]*?\sid="amd-zlrecipe-recipe-([0-9]+)[^>]*?\>/g,function(d,c){return'[zrdn-recipe id="'+c+'"]'})},getInfo:function(){return{longname:"Zip Recipes Plugin",author:"RogierLankhorst",authorurl:"https://www.ziprecipes.net/",infourl:"https://www.ziprecipes.net/",version:"6.0"}}});tinymce.PluginManager.add("zrdn_plugin",tinymce.plugins.zrdnEditRecipe)})();