jQuery(document).ready(function(f){f("body > :not(#zrdn-recipe-container)").hide();f("#zrdn-recipe-container").appendTo("body");var a=g();var c=e(a,"id");var d=c.value;b(a);function g(){var l=window.location.href;var n=l.split("?");if(n.length===1){return false}var i=n[1].split("&");var k=[];for(var j in i){if(i.hasOwnProperty(j)){var h=i[j].split("=");var m=new Object();m.name=h[0];m.value=decodeURIComponent(h[1]);if(m.name!=="mode"&&m.name!=="recipe_image"){k.push(m)}}}return k}function e(h,i){for(var j in h){if(h.hasOwnProperty(j)){var k=h[j];if(k.name===i){return k}}}return false}function b(h){if(!d){return}f(".zrdn-element_recipe_image").append('<div class="zrdn-image-controls"><div class="zrdn-edit-image-text"><div class="dashicons dashicons-edit"></div></div></div>');var k='<span class="zrdn-image-controls-divider">|</span><a href="#" class="zrdn_remove_image"><div class="dashicons dashicons-trash"></div></a>';f(".zrdn-element_recipe_image .zrdn-image-controls").append(k);var i=null;var j;f(document).on("click",".zrdn-element_recipe_image img, .dashicons-edit",function(){if(f(this).hasClass("dashicons-edit")){j=f(this).closest(".zrdn-recipe_image").find("img")}else{j=f(this)}i=wp.media({frame:"post",state:"insert",multiple:false});i.on("insert",function(){var o=i.state().get("selection").length;var l=i.state().get("selection").models;for(var n=0;n<o;n++){var m=l[n].id;var p;if(l[n].attributes.sizes.hasOwnProperty("zrdn_recipe_image_main")){p=l[n].attributes.sizes.zrdn_recipe_image_main}else{if(l[n].attributes.sizes.hasOwnProperty("zrdn_recipe_image")){p=l[n].attributes.sizes.zrdn_recipe_image}else{if(l[n].attributes.sizes.hasOwnProperty("large")){p=l[n].attributes.sizes.large}else{p=l[n].attributes.sizes.full}}}var q=p.url;f.ajax({type:"POST",url:zrdn_editor_preview.admin_url,dataType:"json",data:({recipe_id:d,recipe_image_id:m,recipe_image:q,action:"zrdn_update_recipe_image",nonce:zrdn_editor_preview.nonce}),success:function(r){if(r.success){j.attr("src",q);j.attr("srcset",q);f("input[name=zrdn_recipe_image_id]",window.parent.document).val(m);f(".zrdn-preview-snippet",window.parent.document).attr("src",q)}}})}});i.open()});f(document).on("click",".zrdn_remove_image, .dashicons-trash",function(l){l.preventDefault();var m=f(this).closest(".zrdn-element_recipe_image").find("img");f.ajax({type:"POST",url:zrdn_editor_preview.admin_url,dataType:"json",data:({recipe_id:d,nonce:zrdn_editor_preview.nonce,action:"zrdn_clear_image"}),success:function(n){if(n.success){m.attr("src",zrdn_editor_preview.default_image);m.attr("srcset",zrdn_editor_preview.default_image);f("input[name=zrdn_recipe_image_id]",window.parent.document).val(0);f(".zrdn-preview-snippet",window.parent.document).remove()}else{m.parent().append(" Clearing image failed...")}}})})}});