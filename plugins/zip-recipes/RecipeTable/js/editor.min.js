jQuery(document).ready(function(h){h(document).on("click",".zrdn-add-author",function(){var n=h(".zrdn-template").get(0).outerHTML;h(this).closest(".field-group").find(".zrdn-author-frame").append(n);h(this).closest(".field-group").find(".zrdn-author-frame .zrdn-hidden").removeClass("zrdn-hidden")});h(document).on("click",".zrdn-delete-author",function(){h(this).closest(".zrdn-author-container").remove()});h.fn.outerHTML=function(){return(!this.length)?this:(this[0].outerHTML||(function(n){var p=document.createElement("div");p.appendChild(n.cloneNode(true));var o=p.innerHTML;p=null;return o})(this[0]))};h(".zrdn-field-textarea").on("paste",function(o){var n=h(this);window.setTimeout(function(){var p=n.val().split(/\n/);var r=[];for(var q=0;q<p.length;q++){if(/\S/.test(p[q])){r.push(h.trim(p[q]))}}var s=r.join("\n");n.val(s)},500)});h(document).on("click",".zrdn-tablinks",function(){h(".zrdn-tablinks").removeClass("active");h(this).addClass("active");h(".zrdn-tabcontent").removeClass("active");h("#"+h(this).data("tab")).addClass("active");h("input[name=zrdn_active_tab]").val(h(this).data("tab"))});var j=h("#zrdn-preview");var d=false;m();setTimeout(function(){m()},2000);function m(q){q=typeof q!=="undefined"?q:false;if(j.length){var t;var n=[];h(".zrdn-field input").each(function(){var v=h(this).attr("name");if(typeof v==="undefined"){return}if(v==="zrdn_recipe_image"||v==="zrdn_recipe_image_id"){return}t=a(v,h(this).val());n.push(t)});h(".zrdn-field textarea").each(function(){if(h(this).hasClass("wp-editor-area")){return}var v=h(this).attr("name");if(typeof v==="undefined"){return}t=a(v,e(h(this)));n.push(t)});if(q){n.push(q)}var p=h("input[name=zrdn_recipe_id]").val();t=a("recipe_id",p);n.push(t);var r=h("input[name=zrdn_post_permalink]").val();if(r.length===0){return}var o=r+"?mode=zrdn-preview&id="+p;var u;var s;if(!d){j.html('<iframe id="preview_iframe" width="1024" height="0" src="'+o+'"></iframe>');j.find("iframe").attr("src",o).on("load",function(){u=document.getElementById("preview_iframe");s=u.contentDocument.getElementById("zrdn-recipe-container");g(n,h(s));k(u);d=true})}else{u=document.getElementById("preview_iframe");s=u.contentDocument.getElementById("zrdn-recipe-container");g(n,h(s));k(u)}}}function g(o,p){for(var q in o){if(o.hasOwnProperty(q)){var t=o[q];var r=p.find(".zrdn-element_"+t.name);var n=p.find("."+t.name+" .zrdn-nutrition-value");if(n.length){r=n}t.value=decodeURIComponent(t.value);if(r.prop("tagName")==="OL"||r.prop("tagName")==="UL"){r.nextAll().remove();t.value=t.value.replace(t.value.substr(0,4),"");t.value=t.value.replace(t.value.slice(t.value.length-5),"")}r.html((t.value));var s=p.find(".zrdn-fieldvalue-"+t.name);if(s.length){r=s}r.html((t.value))}}l(o,p);f(o,p);c(o,p)}setTimeout(function(){if(typeof tinymce==="undefined"){return}for(var n=0;n<tinymce.editors.length;n++){tinymce.editors[n].onChange.add(function(o,r){var p=o.id;var q=a(p,o.getContent());m(q)});tinymce.editors[n].onKeyUp.add(function(o,r){var p=o.id;var q=a(p,o.getContent());m(q)})}},1000);function k(p){var n=p.contentWindow.document.body||p.contentDocument.body,o=h(n).find("#zrdn-recipe-container").height();if(p.oHeight!==o){h(p).height(0);p.style.height=0;h(p).height(o);p.style.height=parseInt(o)+200+"px";p.oHeight=o}}h(document).on("keyup","input[type=text]",function(n){m()});h(document).on("keyup mouseup","input[type=number]",function(n){m()});h(document).on("keyup","textarea",function(n){m()});function a(n,o){var p=new Object();p.name=n.replace("zrdn_","");p.value=encodeURIComponent(o);return p}function e(n){var w="UL";if(n.attr("name").indexOf("instructions")!=-1){w=h("input[name=zrdn_instructions_list_type]").val()}else{w=h("input[name=zrdn_ingredients_list_type]").val()}var v=n.val();var o="";var u=v.split("\n");u=u.filter(Boolean);u.forEach(function(z){if(z.substring(0,1)==="!"){o+="</"+w+'><h4 class="zrdn-subtitle">'+z.substring(1)+"</h4><"+w+">"}else{if(z.substring(0,1)==="%"){var A=/(?:%)([http|https?:\/\/=?\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:\/?#[\]@!\$&'\(\)\*\+,;=.\/]+[a-zA-N])/g;var y=z.match(A);if(y){var x=y[0];var B=x.substring(1);o+=z.replace(x,'<img style="max-width:100%" src="'+B+'">')}}else{o+="<li>"+z+"</li>"}}});if(o.length){var p;var t=/(\*[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\*)/g;var r=o.match(t);if(r&&r.length){for(p=0;p<r.length;p++){var q=r[p];var s=q;s=s.replace(/\*$/i,"</b>").replace(/^\*/i,"<b>");o=o.replace(q,s)}}t=/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/g;r=o.match(t);if(r&&r.length){for(p=0;p<r.length;p++){o=o.replace(/\[([^\]\|\[]*)\|([^\]\|\[]*)\]/i,'<a target="_blank" href="$2">$1</a>')}}t=/(\_[a-zA-Z\-\_\(\)\<\>\/\\\$\!\@\#\:\;\.\,\?\+\=]*\_)/g;r=o.match(t);if(r&&r.length){for(p=0;p<r.length;p++){var q=r[p];if(q==="_placeholder_"){return}var s=q;s=s.replace(/\_$/i,"</i>").replace(/^\_/i,"<i>");o=o.replace(q,s)}}}o="<"+w+">"+o+"</"+w+">";return o}h(document).on("click",".zrdn-image-reset",function(){var q=h(this);var o=q.closest(".zrdn-field");var n=o.find(".zrdn-image-upload-field");var p=n.attr("name");o.find(".zrdn-preview-snippet").attr("src",zrdn_editor.image_placeholder);h("input[name="+p+"_id]").val("");h("input[name="+p+"]").val("")});h(document).on("click",".zrdn-image-uploader",function(){var r=h(this);var o=r.closest(".zrdn-field");var n=o.find(".zrdn-image-upload-field");var q=n.data("size");var p=n.attr("name");o.find(".zrdn-image-resolution-warning").hide();if(p==="zrdn_recipe_image"){q="full"}media_uploader=wp.media({frame:"post",state:"insert",multiple:false});media_uploader.on("insert",function(){o.append('<div class="loading-gif"></div>');var s=media_uploader.state().get("selection").length;var x=media_uploader.state().get("selection").models;for(var z=0;z<s;z++){var A=x[z].id;var u=false;if(x[z].attributes.sizes.hasOwnProperty(q)){u=x[z].attributes.sizes[q]}else{if(x[z].attributes.sizes.hasOwnProperty(q+"_s")){u=x[z].attributes.sizes[q+"_s"]}else{if(x[z].attributes.sizes.hasOwnProperty("thumbnail")){u=x[z].attributes.sizes.thumbnail}}}if(u){var v=u.url;o.find(".zrdn-preview-snippet").attr("src",v);h("input[name="+p+"_id]").val(A);h("input[name="+p+"]").val(v);if(p==="zrdn_recipe_image"){var t=document.getElementById("preview_iframe");var y=t.contentDocument.getElementById("zrdn-recipe-container");var w=h(y).find(".zrdn-recipe-image img");if(w.length){w.attr("src",v);w.attr("srcset",v)}}}else{o.find(".zrdn-image-resolution-warning").show()}}o.find(".loading-gif").remove()});media_uploader.open()});function f(o,q){var p=new Object();var n=new Object();var u=new Object();for(var s in o){if(o.hasOwnProperty(s)){var t=o[s];var r=t.name;if(r.indexOf("prep")!=-1){if(r.indexOf("minute")!==-1){p.minutes=t.value}if(r.indexOf("hour")!==-1){p.hours=t.value}}if(r.indexOf("cook")!=-1){if(r.indexOf("minute")!==-1){n.minutes=t.value}if(r.indexOf("hour")!==-1){n.hours=t.value}}if(r.indexOf("wait")!=-1){if(r.indexOf("minute")!==-1){u.minutes=t.value}if(r.indexOf("hour")!==-1){u.hours=t.value}}}q.find(".zrdn-element_prep_time").html(i(p.hours,p.minutes));q.find(".zrdn-element_cook_time").html(i(n.hours,n.minutes));q.find(".zrdn-element_wait_time").html(i(u.hours,u.minutes));q.find(".zrdn-element_total_time").html(i(parseInt(p.hours)+parseInt(n.hours),parseInt(p.minutes)+parseInt(n.minutes)))}}function i(n,o){var p="";if(n>0){p+=n+" "+zrdn_editor.str_hours}if(o>0){if(p.length>0){o=", "+o}p+=o+" "+zrdn_editor.str_minutes}return p}function l(n,p){if(!h("#zrdn-nutrition-label").length){return}var o=b(n,"calories");var q=p.find("#zrdn-nutrition-label");if(parseInt(o.value)===0){q.hide()}else{q.show()}}function c(n,o){var p=b(n,"video_url");var q=p.value;h.ajax({type:"GET",url:zrdn_editor.admin_url,dataType:"json",data:({video_url:q,action:"zrdn_get_embed_code"}),success:function(r){if(r.success){o.find(".zrdn-element_"+p.name).html(r.embed)}}})}function b(n,o){for(var p in n){if(n.hasOwnProperty(p)){var q=n[p];if(q.name===o){return q}}}return false}});